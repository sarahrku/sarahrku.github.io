% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Visualisering af biologiske datasæt - 2022},
  pdfauthor={Sarah Rennie},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Visualisering af biologiske datasæt - 2022}
\author{Sarah Rennie}
\date{Last updated: 2022-04-18}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{basics}{%
\chapter{Grundlæggende R}\label{basics}}

\hypertarget{inledning-til-kapitel}{%
\section{Inledning til kapitel}\label{inledning-til-kapitel}}

Her opsummerer jeg nogle grundlæggende R og statistik, der betragtes som forudsætninger i det nuværende kursus. Selvom vi i kurset skifter hurtigt over til den tidyverse-pakke løsning, som erstatter meget af funktionaliteten fra base-R, er det stadig vigtigt at have et grundlæggende kendskab til hvordan tingene fungerer i base-R - derfor hvis du har meget lidt erfaring med base-R anbefaler jeg, at du også bruger noget ekstra tid udover den første mødegange til at komme op på niveauet.

For at bestå kurset er det ikke forventningen, at du kender til alle detaljer og teori bag de statistiske metoder, men at du kan anvende dem hensigtsmæssigt i praksis i R, samt fortolke resultaterne. Jeg giver masser af muligheder for at øve dig med at lave statistik hele vejen gennem kurset, og i selve eksamen stiller jeg ikke spørgsmål om metoder, der ikke bliver dækkede blandt de forskellige øvelser (herunder workshop opgaver). Jeg kommer også ind på lineær regression igen senere gennem forelæsningerne så vær ikke bekymret hvis du ikke har set det hele før.

Se gerne også ``Quiz - grundlæggende'' på Absalon for at tjekke din forståelse og udfylde eventuelle huller i din viden (OBS: Quizzen er tilgængelig lidt inden starten af kurset).

\hypertarget{rstudio}{%
\section{RStudio}\label{rstudio}}

Vi kommer fremadrettet til at være afhængig af RStudio til at lave blandt andet R Markdown dokumenter. Kendskab til R Markdown er emnet i vores næste lektion og jeg antager, at du ikke har benyttet det før.

Det allerførste du skulle gør, hvis du ikke har installeret RStudio på din computer, er at downloade det gratis på nettet:

\url{https://www.rstudio.com/products/rstudio/download/\#download}

Følg venligst RStudios egne anvisninger til at få det installeret. Bemærk, at installering af RStudio er ikke den samme som at have R installeret på din computer - man skal installere dem begge to (man kan bruge R uden RStudio men ikke omvendt.

\hypertarget{de-forskellige-vinduer-i-rstudio}{%
\subsection{De forskellige vinduer i RStudio}\label{de-forskellige-vinduer-i-rstudio}}

Du kan læse følgende for at lære de fire forskellige vinduer i RStudio at kende:

\url{https://bookdown.org/ndphillips/YaRrr/the-four-rstudio-windows.html}

Her er et kort oversigt:

\begin{itemize}
\tightlist
\item
  Man skriver kode i \textbf{Source} (øverst til venstre)
\item
  Man kører kode ved at tryk CMD+ENTER (eller WIN-KEY+ENTER)
\item
  Koder køres ind i \textbf{Console} (som plejer at være nederst til venstre, selvom det er øverst til højere i billedet). Man kan også skrive koder direkte i Console, men det ikke anbefales generelt, når koden ikke bliver gemt.
\item
  \textbf{Environment} - her kan man se blandt andet, alle objekter i Workspace.
\end{itemize}

\hypertarget{working-directory}{%
\section{Working directory}\label{working-directory}}

Når man arbejder på et projekt, er det ofte nyttigt at vide, den \emph{working directory} som R arbejder fra - det er den mappe, hvor R forsøger at åbne eller gemme filer fra, medmindre man angiver et andet sted.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{() }\CommentTok{\#se nuværende working directory}
\FunctionTok{list.dirs}\NormalTok{(}\AttributeTok{path =} \StringTok{"."}\NormalTok{, }\AttributeTok{recursive =} \ConstantTok{FALSE}\NormalTok{) }\CommentTok{\#se mappe indenfor working directory}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"\textasciitilde{}/Documents/"}\NormalTok{) }\CommentTok{\#sætte en ny working directory (C:/Users/myname/Documents hvis man bruger Windows)}
\end{Highlighting}
\end{Shaded}

Hvis man bruger Windows, husk at man kan skrive en path på følgende måde:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#notrun}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"C:/Users/myname/Documents"}\NormalTok{) }\CommentTok{\#enten med /}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"C:}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Users}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{myname}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{Documents"}\NormalTok{) }\CommentTok{\#eller med \textbackslash{}\textbackslash{}}
\end{Highlighting}
\end{Shaded}

\textbf{OBS}: jeg bruger Mac, så hvis der er et vigtigt ting at man skal huske hvis man bruger en Windows computer, kan jeg også tilføje det her. Bemærk dog, at de allerfleste ting ved R programmering og tidyverse er ens uanset om man bruger Windows eller Mac.

\hypertarget{r-pakker}{%
\section{R pakker}\label{r-pakker}}

R pakker er simpelthen en samling af funktioner (eller datasæt i nogle tilfælde), der udvider hvad er tilgængelige i base-R (den R man få, uden at indlæse en pakke). I R er der mange tusind R pakker (op mod 100,000), der er tilgængelige på \textbf{CRAN} (\url{https://cran.r-project.org/}). Indenfor det biologiske fag er der også mange flere pakker på \textbf{Bioconductor} (\url{https://www.bioconductor.org/}), og i nogle tilfælde kan R pakker også installeres direkte fra \textbf{Github}.

I dette kursus arbejder vi rigtig meget med en pakke der hedder \textbf{tidyverse}. \textbf{tidyverse} er faktisk en samling af otte R pakker, som indlæses på en gang. Inden du indlæse pakken, skal du først sikre dig, at pakken er installeret på systemet ved følgende kommando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Alle pakker på \textbf{CRAN} er installeret på samme måde. Når du faktisk gerne vil bruge en R pakke, skal du først indlæse den ved at bruge \texttt{library()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.6     v dplyr   1.0.8
## v tidyr   1.2.0     v stringr 1.4.0
## v readr   2.1.2     v forcats 0.5.1
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

Vi kommer til at arbejde med \textbf{tidyverse} pakker fra kapitel tre (vi starter med \textbf{ggplot2} og så nogle af de andre pakke fra \textbf{tidyverse} fra kapitel fire), \textbf{så det er en god idé at har tidyverse installeret allerede nu}, når det nogle gange kan tage lidt tid til at installere eller opdatere de mange andre mulige pakker, der \textbf{tidyverse} er afhængig af.

Vær opmærksom på, at der nogle gange opstår konflikter når det samme funktionnavn findes i flere pakker - for eksempel, funktionen \texttt{filter()} findes indenfor to forskellige pakker, nemlig \texttt{dplyr} og \texttt{stats}. Når du skriver \texttt{filter()} så ved R ikke, hvilke pakker du mener. I dette tilfælde kan du være gennemskueligt overfor den pakke, du gerne vil bruge ved at skrive \texttt{dplyr::filter()} eller \texttt{stats:filter()} i stedet for bare \texttt{filter()}.

Som sidste kommentar, er det god praksis at indlæse alle pakker, der du benytter sig af, på toppen af din script, så at du hurtigt kan få overblik over, hvilke pakker, der skal indlæses til at få dine koder til at fungere.

\hypertarget{hvor-kommer-vores-data-fra}{%
\section{Hvor kommer vores data fra?}\label{hvor-kommer-vores-data-fra}}

De forskellige datasæt, vi kommer til at arbejde med i kurset stammer fra mange forskellige steder.

\hypertarget{indbyggede-datasuxe6t}{%
\subsection{Indbyggede datasæt}\label{indbyggede-datasuxe6t}}

I R er der mange indbygget datasæt som er meget brugbart for at vise koncepter, hvilket gøre dem især populært i undervisningsmateriale. Indbyggede datasæt er ofte tilgængligt indenfor mange pakker, men \texttt{library(datasets)} er den mest brugt (der er også mange indenfor \texttt{library(ggplot2)}. For eksempel, for at indlæse datasættet, der hedder `iris', kan man bruge \texttt{data()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(datasets)}
\FunctionTok{data}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

Så er en \emph{dataframe}, der hedder `iris' tilgængelige som en \emph{objekt} i \emph{workspacen} - se den ``Environment'' fane på højere side i RStudio, eller indtaste \texttt{ls()}, så bør du kunne se et objekt med navnet `iris'. Man kan kun arbejde med objekter som er en del af workspacen.

\hypertarget{importering-af-data-fra-.txt-fil}{%
\subsection{Importering af data fra .txt fil}\label{importering-af-data-fra-.txt-fil}}

Det er meget hyppigt, at man har sin data i formen af en .txt fil eller .xlsx fil på sin computer. Den nemmeste måde at få åbnet en .txt fil er ved at bruge \texttt{read.table()}, som i nedenstående:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"mydata.txt"}\NormalTok{) }\CommentTok{\#indlæse data filen mydata.txt som er i working directory}
\FunctionTok{head}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

Hvis datasættet har kolonner navne, der er skrevet ind i filen, så skal man huske at bruge \texttt{header=T} for at undgå, at den første række i datasættet bliver disse tekste i stedet for virkelige observationer.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"mydata.txt"}\NormalTok{,}\AttributeTok{header=}\NormalTok{T) }\CommentTok{\#indlæse data filen mydata.txt som er i working directory}
\FunctionTok{head}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\hypertarget{importering-af-data-fra-excel}{%
\subsection{Importering af data fra Excel}\label{importering-af-data-fra-excel}}

Der findes også en hjælpsom pakke, som hedder \textbf{readxl}, der kan indlæse Excel-ark direkte ind i R:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data.xlsx"}\NormalTok{)}
\NormalTok{data}
\end{Highlighting}
\end{Shaded}

\hypertarget{kaggle}{%
\subsection{Kaggle}\label{kaggle}}

Hvis du gerne vil øve dig med statistike analyser (udover nuværende kursus), er Kaggle en fantastisk ressource til at finde forskellige datasæt. I rigtige mange tilfælde kan man også finde analyser some andre har lavet I R (også Python), hvilket kan inspirere jeres egen læring.

Link hvis interesseret: \url{https://www.kaggle.com/}

\hypertarget{beregninger-i-r}{%
\section{Beregninger i R}\label{beregninger-i-r}}

Her er nogle helt grundlæggende koncepter når man arbejder med R. Du må selvfølgelige gerne springe sektionen over, hvis du allerede har meget erfaring med base R, men det kan være værd at tjekke, om der noget ting, der lige skal gennemgås. En god tilgang er bare at arbejde gennem problemstillingerne nedenfor, og bruger følgende notater som en reference.

\hypertarget{vectorer}{%
\subsection{Vectorer}\label{vectorer}}

I R laver man en vector med \texttt{c()}, hvor man adskiller de forskellige elementer med en komma, som i nedenstående eksempel:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{) }\CommentTok{\#sæt objektet \textquotesingle{}a\textquotesingle{} til at være en vector af tal }
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5
\end{verbatim}

Man er ikke begrænset til tal:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{c }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"cat"}\NormalTok{,}\StringTok{"mouse"}\NormalTok{,}\StringTok{"horse"}\NormalTok{,}\StringTok{"sheep"}\NormalTok{,}\StringTok{"dog"}\NormalTok{)}
\NormalTok{c}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "cat"   "mouse" "horse" "sheep" "dog"
\end{verbatim}

\hypertarget{datatyper}{%
\subsection{datatyper}\label{datatyper}}

Nar vi kommer til at arbejde med visualiseringer og data beardejdning er det vigtigt at have styr på datatyper i datasættet. For eksempel har vectoren \texttt{c} ovenpå typen \texttt{character} (forkortet \texttt{chr}) og ikke \texttt{numeric} (forkortet \texttt{num}):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.numeric}\NormalTok{(c)}
\DocumentationTok{\#\# [1] FALSE}
\FunctionTok{is.character}\NormalTok{(c)}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Her er en list overfor nogle af de vigtigste datatyper:

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.33}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.42}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 4\tabcolsep) * \real{0.25}}@{}}
\toprule
Datatype & Navn & Beskrivelse \\
\midrule
\endhead
\texttt{int} & integer & kun hel tal \texttt{c(-1,0,1,2,3)} \\
\texttt{lgl} & logical & \texttt{TRUE\ TRUE\ FALSE\ TRUE\ FALSE} \\
\texttt{chr} & character & \texttt{c("Bob","Sally","Brian",...)} \\
\texttt{fct} & factor & bestemte niveauer e.g.~\texttt{Species}: \texttt{c("setosa","versicola")} \\
\texttt{dbl} & double & Tal fk. c(\texttt{4.3902}, \texttt{3.12}, \texttt{4.5}) \\
\texttt{lst} & list & blande forskellige data typer og specificere elementer med \texttt{{[}{[}i{]}{]}} \texttt{{[}{[}1{]}{]}\ {[}1{]}\ c("red","blue")} \texttt{{[}{[}2{]}{]}\ {[}1{]}\ TRUE} \texttt{{[}{[}3{]}{]}\ {[}1{]}\ c(3,2.3,1.459)} \\
\bottomrule
\end{longtable}

En datatype, der bør få særlig opmærksomhed er \texttt{fct} (factor). I følgende vector \texttt{tea\_coffee} har vi tekst, men blandt de fem elementer er der kun to bestemte niveauer (nemlig ``tea'' og ``coffee'').

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tea\_coffee }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"tea"}\NormalTok{,}\StringTok{"tea"}\NormalTok{,}\StringTok{"coffee"}\NormalTok{,}\StringTok{"coffee"}\NormalTok{,}\StringTok{"tea"}\NormalTok{)}
\FunctionTok{is.factor}\NormalTok{(tea\_coffee)}
\DocumentationTok{\#\# [1] FALSE}
\NormalTok{tea\_coffee}
\DocumentationTok{\#\# [1] "tea"    "tea"    "coffee" "coffee" "tea"}
\end{Highlighting}
\end{Shaded}

Vi vil derfor gerne fortælle R, at \texttt{tea\_coffee} er ikke bare nogle tilfældig tekst men at der er en struktur med, så vi bruger funktionen \texttt{as.factor} for at lave den om til datatypen \texttt{fct}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tea\_coffee }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(tea\_coffee)}
\FunctionTok{is.factor}\NormalTok{(tea\_coffee)}
\DocumentationTok{\#\# [1] TRUE}
\NormalTok{tea\_coffee}
\DocumentationTok{\#\# [1] tea    tea    coffee coffee tea   }
\DocumentationTok{\#\# Levels: coffee tea}
\end{Highlighting}
\end{Shaded}

Den `ekstra' oplysninger man har ved at sige, at en variabel betragtes som factor bliver vigtigt når man arbejder med visualiseringer - for eksempel, hvis vi gerne vil lave et barplot hvor man gerne vil adskille søjlerne efter de to niveauer ``tea'' og ``coffee'' (visualiseringer er emnet fra kapitel 3).

\hypertarget{dataframes}{%
\section{Dataframes}\label{dataframes}}

\url{http://www.r-tutor.com/r-introduction/data-frame}

Mange af de ting, som vi laver i R tager udgangspunkten i dataframes (eller datarammer).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"personID"}\OtherTok{=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{, }\StringTok{"height"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{140}\NormalTok{,}\DecValTok{187}\NormalTok{,}\DecValTok{154}\NormalTok{,}\DecValTok{132}\NormalTok{,}\DecValTok{165}\NormalTok{), }\StringTok{"age"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{34}\NormalTok{,}\DecValTok{31}\NormalTok{,}\DecValTok{25}\NormalTok{,}\DecValTok{43}\NormalTok{,}\DecValTok{29}\NormalTok{))}
\NormalTok{mydf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age
## 1        1    140  34
## 2        2    187  31
## 3        3    154  25
## 4        4    132  43
## 5        5    165  29
\end{verbatim}

Man kan fa adgang til variabler i en dataframe ved at bruge det dollar tegn \texttt{\$}. For eksempel giver følgende variablen \texttt{personID} fra dataframen \texttt{mydf}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf}\SpecialCharTok{$}\NormalTok{personID}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2 3 4 5
\end{verbatim}

Husk, at vores dataframe, ligesom et matrix (i R: \texttt{matrix()}) har to dimensioner - række og kolonner Forskellen mellem en matrix og en dataramme er, at datarammer kan indeholde mange forskellige data typer (herunder numeriske, faktorer, karakterer osv.), men matrix indeholder kun numeriske data. For eksempel i tilfældet af ovenstående dataframen er alle variabler numeriske, men vi kan godt tilføje en variabel som er ikke-numeriske:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf}\SpecialCharTok{$}\NormalTok{colour }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{,}\StringTok{"blue"}\NormalTok{,}\StringTok{"green"}\NormalTok{,}\StringTok{"orange"}\NormalTok{,}\StringTok{"purple"}\NormalTok{) }\CommentTok{\#make new variable which is non{-}numeric}
\NormalTok{mydf}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age colour
## 1        1    140  34    red
## 2        2    187  31   blue
## 3        3    154  25  green
## 4        4    132  43 orange
## 5        5    165  29 purple
\end{verbatim}

Nu er \texttt{mydf} er en dataframe, der blander forskellige datatyper, men følgende er en matrix

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{matrix}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{6}\NormalTok{), }
    \AttributeTok{nrow=}\DecValTok{3}\NormalTok{,}
    \AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##      [,1] [,2]
## [1,]    1    4
## [2,]    2    5
## [3,]    3    6
\end{verbatim}

og kan kun indeholde numeriske data, som kan bruges til at lave matematik operationer (matrix multiplikation osv.). I dette kursus beskæftiger os primært med dataframes (som bliver kaldt for tibbles i \textbf{tidyverse}).

\hypertarget{delmuxe6gder-af-dataframes}{%
\subsection{Delmægder af dataframes}\label{delmuxe6gder-af-dataframes}}

Selvom vi kommer til at redefinere hvordan man laver delmængde når vi kommer til at arbejde med pakken \textbf{tidyverse}, er det alligevel vigtigt at forstå, hvordan man laver en delmængde i base-R, og det er et område, der ofte skaber forvirring blandt de uerfarne.

Når man vil gerne har en bestemt delmængde af en vector, bruger man firkantet paranteser \texttt{{[}\ {]}}. Følgende kode giver mig de første to værdier fra vectoren \texttt{a}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2
\end{verbatim}

Bemærk, at mens vectorer har kun en dimension, \textbf{har dataframes to dimensioner}. Når man skal lave en delmægde af en dataframe, skal man derfor fortælle R, hvilke række og hvilke kolonner skal være med.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[række indekser, kolonner indekser]  }\CommentTok{\#not run}
\end{Highlighting}
\end{Shaded}

For eksempel, hvis vi gerne vil have den første to observationer med, samt kun den anden variabel, skriver man følgende:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{]  }\CommentTok{\#first two rows (observations), second column (variable) only}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 140 187
\end{verbatim}

Hvis vi vil beholde den første to observationer og samtlige variabler, kan den anden plads være tom:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{, ]  }\CommentTok{\#first two rows, all columns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age colour
## 1        1    140  34    red
## 2        2    187  31   blue
\end{verbatim}

Jeg kan også angive et variabelnavn direkte:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{,}\StringTok{"height"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 140 187
\end{verbatim}

Man kan kigge på en subset af rækkerne i de data ved at

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[mydf}\SpecialCharTok{$}\NormalTok{height}\SpecialCharTok{\textgreater{}=}\DecValTok{165}\NormalTok{,] }\CommentTok{\#alle rækker i datarammen med height = 165 eller over}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age colour
## 2        2    187  31   blue
## 5        5    165  29 purple
\end{verbatim}

Her er en tabel af comparitiver, og jeg gengiver samme tabel når I kommer til at lave delmængde i \textbf{tidyverse}:

\begin{longtable}[]{@{}ll@{}}
\toprule
comparitiv & beskrivelse \\
\midrule
\endhead
\texttt{\textless{}} & less than \\
\texttt{\textgreater{}} & greater than \\
\texttt{\textless{}=} & less than or equal to \\
\texttt{\textgreater{}=} & greater than or equal to \\
\texttt{==} & equal to \\
\texttt{!=} & not equal to \\
\texttt{\&} & and \\
\texttt{\%in\%} & in \\
\texttt{\textbar{}} & or \\
\texttt{!} & not \\
\bottomrule
\end{longtable}

Jeg mener, at \texttt{\%in\%} er særlig brugbart og er værd at lære:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[mydf}\SpecialCharTok{$}\NormalTok{personID }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{),] }\CommentTok{\#alle personer med personID 1,3 eller 5 }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age colour
## 1        1    140  34    red
## 3        3    154  25  green
## 5        5    165  29 purple
\end{verbatim}

Her er et eksempel på, hvordan man bruger udråbstegnet: personer med personID, der ikke er 1,3 eller 5:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf[}\SpecialCharTok{!}\NormalTok{(mydf}\SpecialCharTok{$}\NormalTok{personID }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{)),] }\CommentTok{\#alle personer med personID 2 eller 4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   personID height age colour
## 2        2    187  31   blue
## 4        4    132  43 orange
\end{verbatim}

\hypertarget{descriptive-statistics}{%
\section{Descriptive statistics}\label{descriptive-statistics}}

\hypertarget{simulere-data-fra-den-normale-fordeling}{%
\subsection{Simulere data fra den normale fordeling}\label{simulere-data-fra-den-normale-fordeling}}

Hvis du har bruge for at vide mere om den normale fordeling: \url{http://www.r-tutor.com/elementary-statistics/probability-distributions/normal-distribution}

Man kan nemt lave sin egne `fake' data ved at simulere det fra en fordeling, der vil typiske være den normale fordeling, idet den normale fordeling opstår mest hyppigt i den virkelige verden (husk den klassiske klokke-form). I R kan man bruge funktionen \texttt{rnorm} til at simulere data - først angiver man, hvor mange observationer man vil have, og dernæst den mean og standard deviation (sd), som er de to nødvendige parametre for at beskrive en normal fordeling

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{25}\NormalTok{,}\AttributeTok{mean=}\DecValTok{0}\NormalTok{,}\AttributeTok{sd=}\DecValTok{1}\NormalTok{) }\CommentTok{\#standard normal distribution}
\NormalTok{x }\CommentTok{\#så har vi 25 værdier fra en normal distribution med mean=0 og standard deviation=1.}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] -1.44298135 -1.29490882 -0.18766910 -0.06217884  0.15052664 -0.01777189
##  [7]  2.04844656 -0.44290878  0.35968202  0.23619413 -1.13732791  1.53681532
## [13]  1.10508885  0.06586895 -0.43349239  0.44762130 -0.34788940  0.16963958
## [19] -1.24747685  0.43346455 -0.14446346  0.55452115  0.35108834  3.26144336
## [25]  1.11562923
\end{verbatim}

I stedet for at kigge på alle værdier på én gang, vil vi måske hellere kigge kun på de første (eller sidste) værdier:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(x) }\CommentTok{\#første 6}
\DocumentationTok{\#\# [1] {-}1.44298135 {-}1.29490882 {-}0.18766910 {-}0.06217884  0.15052664 {-}0.01777189}
\FunctionTok{tail}\NormalTok{(x) }\CommentTok{\#sidste 6}
\DocumentationTok{\#\# [1]  0.4334645 {-}0.1444635  0.5545211  0.3510883  3.2614434  1.1156292}
\NormalTok{x[}\DecValTok{1}\NormalTok{] }\CommentTok{\#første værdi}
\DocumentationTok{\#\# [1] {-}1.442981}
\NormalTok{x[}\FunctionTok{length}\NormalTok{(x)] }\CommentTok{\#sidste data point}
\DocumentationTok{\#\# [1] 1.115629}
\end{Highlighting}
\end{Shaded}

Bemærk, at til forskellen af Python og mange andre programmering sprog, R bruger 1-baserende indicer - det betyder, at den første værdi er \texttt{x{[}1{]}} og \textbf{ikke} \texttt{x{[}0{]}} som i Python.

\hypertarget{measures-of-central-tendency}{%
\subsection{Measures of central tendency}\label{measures-of-central-tendency}}

\begin{longtable}[]{@{}ll@{}}
\toprule
function & Description \\
\midrule
\endhead
\texttt{mean()} & mean \(\bar{x}_{i} = \frac{1}{n}\sum_{i=1}^{n} x_{i}\) \\
\texttt{median()} & median value \\
\texttt{max()} & maximum value \\
\texttt{min()} & minimum value \\
\texttt{var()} & variance \(s^2 = \frac{1}{n-1}\sum_{i=1}^{n} (x_{i} - \bar{x}_{i})^2\) \\
\texttt{sd()} & standard deviation \(s\) \\
\bottomrule
\end{longtable}

Lad os afprøve dem på vores simulerede data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_mean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(x)}
\NormalTok{my\_median }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(x)}
\NormalTok{my\_max }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(x)}
\NormalTok{my\_min }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(x)}
\NormalTok{my\_var }\OtherTok{\textless{}{-}} \FunctionTok{var}\NormalTok{(x)}
\NormalTok{my\_sd }\OtherTok{\textless{}{-}} \FunctionTok{sd}\NormalTok{(x)}
\FunctionTok{c}\NormalTok{(my\_mean,my\_median,my\_max,my\_min,my\_var,my\_sd) }\CommentTok{\#print results}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  0.2030784  0.1505266  3.2614434 -1.4429814  1.1193251  1.0579816
\end{verbatim}

Man kan også lave et summary af dataen, som bestå af mange af de statistiker navnt ovenpå:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1.4430 -0.3479  0.1505  0.2031  0.4476  3.2614
\end{verbatim}

\hypertarget{tapply}{%
\subsection{\texorpdfstring{\texttt{tapply()}}{tapply()}}\label{tapply}}

En meget brugbar funktion, som er værd at vide, er \texttt{tapply()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}
\FunctionTok{tapply}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length,iris}\SpecialCharTok{$}\NormalTok{Species,mean) }\CommentTok{\# ovenstående i kun en linje}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##     setosa versicolor  virginica 
##      5.006      5.936      6.588
\end{verbatim}

Her tager vi en variabel der hedder \texttt{Sepal.Length}, opdeler den efter \texttt{Species}, og beregner \texttt{mean} for enhver af de tre arter i \texttt{Species} (setosa, versicolor og virginica). Man kan opnå det samme resultat ved at beregne \texttt{mean} for de tre \texttt{Species} hver for sig (en tilgang, der ikke opskaleres særlig godt!):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# gennemsnit Sepal Length for Species setosa}
\NormalTok{mean\_setosa }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length[iris}\SpecialCharTok{$}\NormalTok{Species}\SpecialCharTok{==}\StringTok{"setosa"}\NormalTok{])}

\CommentTok{\# gennemsnit Sepal Length for Species versicolor}
\NormalTok{mean\_versi }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length[iris}\SpecialCharTok{$}\NormalTok{Species}\SpecialCharTok{==}\StringTok{"versicolor"}\NormalTok{]) }

\CommentTok{\# gennemsnit Sepal Length for Species virginica}
\NormalTok{mean\_virgin }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length[iris}\SpecialCharTok{$}\NormalTok{Species}\SpecialCharTok{==}\StringTok{"virginica"}\NormalTok{])}

\FunctionTok{c}\NormalTok{(mean\_setosa,mean\_versi,mean\_virgin)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.006 5.936 6.588
\end{verbatim}

Det er også værd at ved koncepten, fordi vi kommer til lære en lignende koncept i \textbf{tidyverse} (med \texttt{group\_by} og \texttt{summarise}).

\hypertarget{statistike-tester}{%
\section{Statistike tester}\label{statistike-tester}}

Her giver jeg et oversigt over nogle af de baserende tests man kan lave på data i R - det giver noget, du kan referere til senere hvis der er brug for det. Jeg går ikke i detaljer eller teorien af testerne (se dit tidligere kursus), men jeg forventer at I er i stand til at bruge dem på en hensigtsmæssigt måde i R, og fortolker resultaterne. Vær ikke bekymret hvis du ikke har set de hele før, jeg giver masser a muligheder for at øve statistik gennem forløbet.

\hypertarget{korrelation}{%
\subsection{Korrelation}\label{korrelation}}

Måler sammenhængen mellem to normalfordelte variabler:

\begin{itemize}
\tightlist
\item
  \(>0\) betyder, at der er en postiv sammenhæng
\item
  \(<0\) betyder, at der er en negativ sammenhæng
\item
  \(=0\) betyder, at der er ingen sammenhængen mellem de to variabler
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(cars)}
\FunctionTok{cor}\NormalTok{(cars}\SpecialCharTok{$}\NormalTok{speed, cars}\SpecialCharTok{$}\NormalTok{dist) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.8068949
\end{verbatim}

Man kan teste om korrelationen er signifikant ved at bruge \texttt{cor.test()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(cars}\SpecialCharTok{$}\NormalTok{speed, cars}\SpecialCharTok{$}\NormalTok{dist) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's product-moment correlation
## 
## data:  cars$speed and cars$dist
## t = 9.464, df = 48, p-value = 1.49e-12
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6816422 0.8862036
## sample estimates:
##       cor 
## 0.8068949
\end{verbatim}

Så kan man se, at p-værdien er 0, der er under 0.05, så konkludere man, at der er en signifikant korrelation mellem de to variabler.

\hypertarget{test-for-uafhuxe6ngighed-chi-sq-test}{%
\subsection{Test for uafhængighed (chi-sq test)}\label{test-for-uafhuxe6ngighed-chi-sq-test}}

Her undersøger man, om der er en sammenhæng mellem antal observationer i to forskellige kategorier. Se for eksempel følgende tabel, der viser antal kopi af en gen variant og to forskellige farver som phenotype (farve på en type blomst):

\begin{longtable}[]{@{}lccc@{}}
\toprule
& 0 & 1 & 2 \\
\midrule
\endhead
red & 29 & 31 & 16 \\
pink & 11 & 16 & 24 \\
\bottomrule
\end{longtable}

Vi vil gerne vide, om phenotype er afhængig af genotype:

\begin{itemize}
\tightlist
\item
  \(H_{0}:\) antal gen copi og phenotype er uafhængie af hinanden VS
\item
  \(H_{1}:\) antal gen copi og phenotype er afhængie af hinanden
\end{itemize}

Testen går ud på, at man beregner forventede værdier (baserende på de totals under nullhypotesen af de er uafængige) og sammenligne forventede værdier med observerede værdier. Man laver testen i R ved at benytte funktionen \texttt{chisq.test}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{chisq.test}\NormalTok{(dat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's Chi-squared test
## 
## data:  dat
## X-squared = 9.9516, df = 2, p-value = 0.006903
\end{verbatim}

Her er p-værdien = 0.006903 \textless{} 0.05, så vi forkaster nulhypotesen og konkluderer, at der er en afhængighed mellem de to variabler. Man kan også se fra rådatasættet, at der er langt flere røde blomster, der har ingen kopi af genet end der er røde blomster, der har to kopier af genet, og mønstret er omvendt i tilfældet af de lyserøde blomster.

\hypertarget{sample-t-test}{%
\subsection{1 sample t-test}\label{sample-t-test}}

For at vise en 1-sample t-test, simulerer jeg noget data fra den normal fordeling med \texttt{mean\ =\ 3}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{290223}\NormalTok{) }\CommentTok{\# bare for at få den samme resultat hver gang}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\AttributeTok{mean =} \DecValTok{3}\NormalTok{,}\AttributeTok{sd =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Forestil dig, at du ikke helt stoler på funktionen \texttt{rnorm()} og gerne vil teste, om \texttt{x} virkelig kommer fra en normal fordeling med et gennemsnit (\(\mu\)) på tre. Nulhypotesen og alternativ hypotesen (2-sidet test) er således:

\begin{itemize}
\tightlist
\item
  \(H_{0}: \mu = 3\), VS
\item
  \(H_{1}: \mu \neq 3\)
\end{itemize}

For at lave testen i R, bruger man funktionen \texttt{t.test()} og angiver \texttt{mu\ =\ 3} for at reflektere vores hypoteser:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t.test}\NormalTok{(x,}\AttributeTok{mu =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  x
## t = -1.1448, df = 9, p-value = 0.2818
## alternative hypothesis: true mean is not equal to 3
## 95 percent confidence interval:
##  2.169968 3.272231
## sample estimates:
## mean of x 
##  2.721099
\end{verbatim}

Fra resultatet kan man se, at p-værdien er estimeret som 0.2818, og da den er \textgreater{} 0.05 forkaster vi ikke nulhypotesen, og konkluderer at \(\mu = 3\).

\textbf{Bemærkning}: da vi simulerede vores data fra en normal fordeling med et gennemsnit på tre, vidste vi i forvejen at det korrekte svar er, at beholde nullhypotesen. Havde vi forkastet nullhypotesen, havde vi lavet en \textbf{type I fejl} - det vil sige, at vi forkaster nullhypotesen når det faktisk er sandt.

\hypertarget{sample-t-test-1}{%
\subsection{2-sample t-test}\label{sample-t-test-1}}

Undersøger om der er en forskel i de gennemsnitlige værdier mellem to grupper - kan de to grupper betragtes til at stammer fra den samme normale fordeling? Hypoteserne er således (to-sidet):

\begin{itemize}
\tightlist
\item
  \(H_{0}: \mu_{1} = \mu_{2}\), VS
\item
  \(H_{1}: \mu_{1} \neq \mu_{2}\)
\end{itemize}

I følgende kode simulere jeg to stikprøver, der kommer fra en normal fordeling med forskellige gennemsnitte og bruger funktionen \texttt{t.test}. Man kan angive at de to stikprøver har samme variance ved at skrive \texttt{var.equal\ =\ T} indenfor funktionen \texttt{t.test}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{1}\NormalTok{)}

\FunctionTok{t.test}\NormalTok{(x,y,}\AttributeTok{var.equal =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Two Sample t-test
## 
## data:  x and y
## t = -5.4258, df = 18, p-value = 3.729e-05
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -2.700858 -1.193081
## sample estimates:
## mean of x mean of y 
##  2.783056  4.730025
\end{verbatim}

Hvis man til gengæld ikke kan antage, at variansen er den samme i de to grupper:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{) }\CommentTok{\#større variance}

\FunctionTok{t.test}\NormalTok{(x,y,}\AttributeTok{var.equal =}\NormalTok{ F) }\CommentTok{\#var.equal=F er \textquotesingle{}default\textquotesingle{} så man behøver ikke at specifere}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Welch Two Sample t-test
## 
## data:  x and y
## t = -2.0238, df = 11.77, p-value = 0.0663
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -3.9077927  0.1483728
## sample estimates:
## mean of x mean of y 
##  2.757436  4.637146
\end{verbatim}

Bemærk at hvis man kan antage at variancen er den samme, så har man mere \textbf{power} (kræft) til at kalde en virkelig forskel for signifikant.

\hypertarget{paired-t-test}{%
\subsection{Paired t-test}\label{paired-t-test}}

En paired t-test bruges når man for eksempel har målinger for den samme sæt personer i hver stikprøve, og man gerne vil teste om forskellen i værdier mellem de to stikprøver er signifikant. For eksempel hvis vi har ``before'' og ``after'' målinger for den samme 10 individer:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{320}\NormalTok{)}
\NormalTok{before }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{after }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{2}\NormalTok{)}

\FunctionTok{t.test}\NormalTok{(before,after,}\AttributeTok{paired=}\NormalTok{T) }\CommentTok{\#specificy paired data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Paired t-test
## 
## data:  before and after
## t = -9.3296, df = 9, p-value = 6.356e-06
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -5.415186 -3.301613
## sample estimates:
## mean of the differences 
##               -4.358399
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t.test}\NormalTok{(before}\SpecialCharTok{{-}}\NormalTok{after,}\AttributeTok{mu=}\DecValTok{0}\NormalTok{) }\CommentTok{\#exactly the same result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  One Sample t-test
## 
## data:  before - after
## t = -9.3296, df = 9, p-value = 6.356e-06
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  -5.415186 -3.301613
## sample estimates:
## mean of x 
## -4.358399
\end{verbatim}

\hypertarget{anova-variansanalyse}{%
\subsection{ANOVA (variansanalyse)}\label{anova-variansanalyse}}

Har man flere grupper i stedet for to, kan man bruge ANOVA (analysis of variance eller variansanalyse). For en kategorisk variabel med \(k\) grupper, er nul/alternativhypotesen:

\begin{itemize}
\tightlist
\item
  \(H_{0}: \mu_{1} = \mu_{2} = \ldots = \mu_{k}\)
\item
  \(H_{1}:\) ikke alle middelværdier er enes
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#simulere data til 3 forskellige grupper fra den normale fordeling med standard afvigelse af 3}
\NormalTok{group1 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{50}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{group2 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{55}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\NormalTok{group3 }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{48}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{3}\NormalTok{)}

\CommentTok{\#data må være i en dataramme, med den ene kolon = vores værdier, og den anden kolon = grupper}
\NormalTok{y }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(group1,group2,group3)}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"G1"}\NormalTok{,}\DecValTok{50}\NormalTok{),}\FunctionTok{rep}\NormalTok{(}\StringTok{"G2"}\NormalTok{,}\DecValTok{55}\NormalTok{),}\FunctionTok{rep}\NormalTok{(}\StringTok{"G3"}\NormalTok{,}\DecValTok{48}\NormalTok{))}
\NormalTok{mydf }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"group"}\OtherTok{=}\NormalTok{x,}\StringTok{"value"}\OtherTok{=}\NormalTok{y)}
\end{Highlighting}
\end{Shaded}

Til at udføre testen bruger man funktionen \texttt{lm}. Det er en forkortelse for ``linear model'' og kan bruges til at bygge op forskellige modeller. Her angiver vi en model, således at hver group (\texttt{G1}, \texttt{G2} og \texttt{G3} fra variablen \texttt{x}) har sin egen middelværdi (variablen \texttt{value}), hvilket er modellen under alternativhypotesen:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(value}\SpecialCharTok{\textasciitilde{}}\NormalTok{group,}\AttributeTok{data=}\NormalTok{mydf) }\CommentTok{\#H1 model}
\end{Highlighting}
\end{Shaded}

Under nullhypotesen har alle grupper den samme middelværdi og vi behøver derfor ikke at have variablen \texttt{group} en del af modellen. Vi betegner situationen i modellen ved at skrive \texttt{1}, der betyder at de forventede værdier for den afhængige variabel \texttt{value} er bare dens middelværdi:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm\_null }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(value}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}\AttributeTok{data=}\NormalTok{mydf) }\CommentTok{\#H0 model}
\end{Highlighting}
\end{Shaded}

For at sammenligne de to modeller benytter vi funktionen \texttt{anova} (efter analysis of variance):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anova}\NormalTok{(mylm\_null,mylm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: value ~ 1
## Model 2: value ~ group
##   Res.Df    RSS Df Sum of Sq      F    Pr(>F)    
## 1    152 2215.4                                  
## 2    150 1509.9  2    705.55 35.047 3.245e-13 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

P-værdien er (\textless0.05), så nulhypotesen er forkastet til fordel af alternativhypotesen, altså modellen, hvor hver gruppe har sin egen middelværdi. Bemærk at det er til trods af, at to af de tre grupper kommer fra en normal fordeling med præcis de samme middelværdier (det er nok, at den trejde gruppe har en ænderledes middelværdi).

\hypertarget{lineuxe6r-regression}{%
\subsection{Lineær regression}\label{lineuxe6r-regression}}

Formål: måler (en retningsbestemt) relation mellem to kontinuerte variabler. I simpel lineær regression svarer det til, at man gerne vil finde den rette linje gennem punkterne, der bedste beskriver relationen.

Eksempel - datasættet \texttt{mtcars}, response (afgængig) variabel er \texttt{mpg} og predictor (uafhængig) variabel er \texttt{wt}.

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-45-1.pdf}

Man skriver relationen i R som \texttt{mpg\ \textasciitilde{}\ wt} og benytter \texttt{lm()}(\texttt{lm(mpg\textasciitilde{}wt,data=mtcars)}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mpg }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wt, }\AttributeTok{data=}\NormalTok{mtcars)  }\CommentTok{\# build linear regression model}
\NormalTok{mylm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = mpg ~ wt, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt  
##      37.285       -5.344
\end{verbatim}

Vores ``Coefficients'' beskriver den bedste rette linje:

\begin{itemize}
\tightlist
\item
  Skæringen (intercept): 37.285
\item
  Hældningskoefficient (slope): -5.344
\end{itemize}

Det betyder, at hvis vægten \texttt{wt} af en bil stiger med 1, så stiger \texttt{mpg} ved -5.344 (det vil sige at \texttt{mpg} reduceres med 5.344).

\hypertarget{r-squared-coefficient-of-determination}{%
\subsection{R-squared coefficient of determination}\label{r-squared-coefficient-of-determination}}

Den \(R^2\) eller ``forklaringsgraden'' (coefficeint of determination) har til formål at forklare, hvor godt vores lineær model passer til de data. For eksempel hvor meget af variansen i \texttt{mpg} forklares af variablen \texttt{wt}?

\begin{itemize}
\tightlist
\item
  Hvis det er tæt på 1 - så er der en meget tæt relation (hvis man kender vægten, så vide man også \texttt{mpg} med stor sikkerhed)
\item
  Hvis det er tæt på 0 - så er relationen svag - høj sandsynlighed for, at der er andre variabler der bedre kan forklare variansen i \texttt{mpg}.
\end{itemize}

I ovenstående model, kan man se den \(R^2\) værdi med \texttt{summary(mylm)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(mylm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = mpg ~ wt, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.5432 -2.3647 -0.1252  1.4096  6.8727 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  37.2851     1.8776  19.858  < 2e-16 ***
## wt           -5.3445     0.5591  -9.559 1.29e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.046 on 30 degrees of freedom
## Multiple R-squared:  0.7528, Adjusted R-squared:  0.7446 
## F-statistic: 91.38 on 1 and 30 DF,  p-value: 1.294e-10
\end{verbatim}

Det fortæller os, at \(R^2\) = 0.7528.

\hypertarget{antagelser---lineuxe6r-regression}{%
\subsection{Antagelser - lineær regression}\label{antagelser---lineuxe6r-regression}}

\begin{itemize}
\tightlist
\item
  Normalfordelte residualer
\item
  Residualer har samme spredning (varianshomogenitet)
\item
  Uafhængighed
\item
  Fit er linæer
\end{itemize}

Koden \texttt{plot(mylm,which=c(1))} angiver residualer vs predikterede (fitted) værdier - de skal være tilfældigt fordelt over plottet og prikkernes varians skal være nogenlunde konstant langt x-aksen (det giver, at den røde linje er flade).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(mylm,}\AttributeTok{which=}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-48-1.pdf}

Med koden \texttt{plot(mylm,which=c(2))} kan man tjekke antagelsen på en normal fordeling. Punkterne skal være nogenlunde tæt på den diagonale linje.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(mylm,}\AttributeTok{which=}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-49-1.pdf}

\hypertarget{multiple-lineuxe6r-regression}{%
\subsection{Multiple lineær regression}\label{multiple-lineuxe6r-regression}}

Her kan man tilføje flere variabler i vores model formel.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm\_disp }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mpg }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wt }\SpecialCharTok{+}\NormalTok{ disp, }\AttributeTok{data=}\NormalTok{mtcars) }\CommentTok{\# build linear regression model}
\FunctionTok{summary}\NormalTok{(mylm\_disp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = mpg ~ wt + disp, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.4087 -2.3243 -0.7683  1.7721  6.3484 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 34.96055    2.16454  16.151 4.91e-16 ***
## wt          -3.35082    1.16413  -2.878  0.00743 ** 
## disp        -0.01773    0.00919  -1.929  0.06362 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.917 on 29 degrees of freedom
## Multiple R-squared:  0.7809, Adjusted R-squared:  0.7658 
## F-statistic: 51.69 on 2 and 29 DF,  p-value: 2.744e-10
\end{verbatim}

Her kan man se, at med tilføjelsen af variablen \texttt{disp}, er \(R^2\) steget til 0.7809. Bemærk, at jo flere variabler man tilføjer til modellen, jo større bliver \(R^2\)-værdien. Den adjusted \(R^2\) værdi er lavere fordi den prøver at tage højde for kompleksiteten af modellen (hvor mange parametre der er).

Variablen \texttt{disp} er faktisk ikke selv signifikant når der er taget højde for variablen \texttt{wt} (p-værdien 0.0636 - tjek, at du selv kan finde værdien i resultatet).

Hvis en af de uafhængige variabler er kategorisk bruger man funktionen \texttt{anova} til at teste den overordnet effekt af den variabel. For eksempel har variablen \texttt{cyl} 3 mulige værdier (niveauer) - 4, 6 og 8. Vi kan inddrage variablen i vores model: --\textgreater{}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm\_cyl }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(mpg }\SpecialCharTok{\textasciitilde{}}\NormalTok{ wt }\SpecialCharTok{+} \FunctionTok{factor}\NormalTok{(cyl), }\AttributeTok{data=}\NormalTok{mtcars) }\CommentTok{\# build linear regression model}
\FunctionTok{summary}\NormalTok{(mylm\_cyl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = mpg ~ wt + factor(cyl), data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.5890 -1.2357 -0.5159  1.3845  5.7915 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   33.9908     1.8878  18.006  < 2e-16 ***
## wt            -3.2056     0.7539  -4.252 0.000213 ***
## factor(cyl)6  -4.2556     1.3861  -3.070 0.004718 ** 
## factor(cyl)8  -6.0709     1.6523  -3.674 0.000999 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.557 on 28 degrees of freedom
## Multiple R-squared:  0.8374, Adjusted R-squared:   0.82 
## F-statistic: 48.08 on 3 and 28 DF,  p-value: 3.594e-11
\end{verbatim}

Man kan ikke se den overordnet effekt af \texttt{cyl} fra den ovenstående \texttt{summary} men man kan teste den med \texttt{anova}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anova}\NormalTok{(mylm,mylm\_cyl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Analysis of Variance Table
## 
## Model 1: mpg ~ wt
## Model 2: mpg ~ wt + factor(cyl)
##   Res.Df    RSS Df Sum of Sq      F   Pr(>F)   
## 1     30 278.32                                
## 2     28 183.06  2    95.263 7.2856 0.002835 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}

Så kan man se, at \texttt{cyl} er signifikant.

\hypertarget{problemstillinger}{%
\section{Problemstillinger}\label{problemstillinger}}

Alle bør lave quizzen men ellers vælg øvelser efter egen erfaring:

\begin{itemize}
\tightlist
\item
  2-7 er meget grundlæggende og de fleste kan springer over hvis nogenlunde tryg med base-R
\item
  8-14 anbefaler jeg som en god måde at tjekke viden på
\item
  15-18 øver hvordan man laver variansanalyse/regression i R - regression kommer jeg ind på igen senere men det hjælper meget hvis du er tryg med brugen af funktionen \texttt{lm} til at lave modeller i ANOVA/simpel lineær regression.
\end{itemize}

\hypertarget{quiz---basics}{%
\subsection{Quiz - Basics}\label{quiz---basics}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\tightlist
\item
  Se quiz i Absalon, der hedder ``Quiz - Basics''.
\end{enumerate}

\hypertarget{grundluxe6ggende-r}{%
\subsection{Grundlæggende R}\label{grundluxe6ggende-r}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  (\textbf{helt baserende viden}) Åbn en ny fil i Rstudio ved at trykke på ``File'' \textgreater{} ``New File'' \textgreater{} ``R script''. Køre følgende kode en linje ad gangen og tjek, du kan forstå outputtet.
\end{enumerate}

Husk at den nemmeste måde at køre kode er ved at trykke CMD+ENTER (Mac) eller WIN-KEY+ENTER (Windows).

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2}\SpecialCharTok{+}\DecValTok{2}
\DecValTok{2}\SpecialCharTok{*}\DecValTok{2}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x}\SpecialCharTok{+}\DecValTok{2}
\FunctionTok{sqrt}\NormalTok{(x)}
\FunctionTok{sqrt}\NormalTok{(x)}\SpecialCharTok{\^{}}\DecValTok{2}
\FunctionTok{rnorm}\NormalTok{(}\DecValTok{10}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{)}
\FunctionTok{log10}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{y }\OtherTok{\textless{}{-}}  \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{3}\NormalTok{)}
\FunctionTok{mean}\NormalTok{(y)}
\FunctionTok{sd}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
  (\textbf{helt baserende viden}) Køre følgende kode til at åbne nogle af de indbygget datasæt, som vi bruger i kurset.
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Prøve \texttt{head()}, \texttt{summary()} osv.
\item
  Prøve også fk. \texttt{?cars} for at se en beskrivelse.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}
\FunctionTok{data}\NormalTok{(cars)}
\FunctionTok{data}\NormalTok{(ToothGrowth)}
\FunctionTok{data}\NormalTok{(sleep)}
\FunctionTok{head}\NormalTok{(chickwts)}
\FunctionTok{data}\NormalTok{(trees)}
\CommentTok{\#se her for andre:}
\FunctionTok{library}\NormalTok{(}\AttributeTok{help =} \StringTok{"datasets"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{3}
\tightlist
\item
  (\textbf{baserende plots}) Lad os lave plotter i `baseR'. Jeg giver nogle muligheder for datasættet ``iris''. Afprøve dem for nogle af de andre ovenstående indbygget datasæt, som du indlæst.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length,iris}\SpecialCharTok{$}\NormalTok{Sepal.Width)}
\FunctionTok{hist}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Width)}
\FunctionTok{boxplot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length}\SpecialCharTok{\textasciitilde{}}\NormalTok{iris}\SpecialCharTok{$}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

Man kan også gøre plotterne lidt pænere ved at give dem en titel/aksen-navne osv. Prøve \texttt{?plot} for at se nogle muligheder, og tilføje \texttt{ylab}, \texttt{xlab}, \texttt{main} (titel) i én af plotterne. Leg også med \texttt{col} (farver).

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{4}
\tightlist
\item
  (\textbf{dataframes}) Brug datasættet \texttt{cars} til at:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Lav et scatter plot med speed på x-aksen og dist på y-aksen
\item
  Tilføj en ny kolon:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cars}\SpecialCharTok{$}\NormalTok{fast }\OtherTok{\textless{}{-}}\NormalTok{ cars}\SpecialCharTok{$}\NormalTok{speed}\SpecialCharTok{\textgreater{}}\DecValTok{15}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Beregn gennemsnitsværdien af variablen \texttt{dist} for hurtige biler og ikke-hurtige biler hver for sig (brug funktionen \texttt{tapply}). Gem resultatet.
\item
  Brug \texttt{barplot} til at lave et plot af den gennemsnitlige \texttt{dist} for hurtige og ikke-hurtige biler.
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{4}
\tightlist
\item
  (\textbf{dataframes}) Lav en ny dataframe (funktionen \texttt{data.frame()}) med tre kolonner som hedder ``navn'', ``alder'' og ``yndlings\_farve'' (find bare selv på værdierne). Sørge for, at den har 4 rækker.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"navn"}\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"alice"}\NormalTok{,}\StringTok{"freddy"}\NormalTok{, ... ), }\StringTok{"alder"} \OtherTok{=} \FunctionTok{c}\NormalTok{(...), ...) }\CommentTok{\#not run, slette "..." og skrive videre}
\FunctionTok{dim}\NormalTok{(mydf) }\CommentTok{\# fire række og tre kolonner}
\NormalTok{mydf}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{5}
\tightlist
\item
  (\textbf{dataframes}) Tilføj en ny variabel \texttt{random} til ovenstående dataframe, hvor værdierne kommer fra en normal fordeling med et gennemsnit på 5 og sd på 1 (bruge funktionen \texttt{rnorm}).
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydf}\SpecialCharTok{$}\NormalTok{random }\OtherTok{\textless{}{-}} \CommentTok{\#??}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{6}
\tightlist
\item
  (\textbf{delmængder af dataframes}) Åbn datasættet ``ToothGrowth'' med følgende kode:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"ToothGrowth"}\NormalTok{)}
\NormalTok{?ToothGrowth}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Find delmængden af datasættet således at diet (variablen \texttt{supp}) er ``OJ'' og længden (variablen \texttt{len}) er større end 15.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{newdf }\OtherTok{\textless{}{-}}\NormalTok{ ToothGrowth[}\CommentTok{\#skrive her til at lave subset af observationerne,]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Hvor mange rækker er der i den nye dataframe \texttt{newdf}?
\item
  Hvor mange unikke værdier er der i variablen \texttt{dose} (brug funktionen \texttt{unique}) ?
\item
  Find delmængden af datasættet \texttt{ToothGrowth}, hvor variablen \texttt{dose} er 0.5 eller 1.5 og \texttt{supp} er ``VC''.
\item
  Beregn den gennemsnitlige længde for observationerne i delmængden.
\end{itemize}

\hypertarget{kort-analyse-med-reaktionstider}{%
\subsection{Kort analyse med reaktionstider}\label{kort-analyse-med-reaktionstider}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{7}
\tightlist
\item
  (\textbf{indlæse data}) Åbn en fil, der sidder i Absalon og hedder ``reactions.txt'' ved at bruge funktionen \texttt{read.table()} (giv objektet et navn, e.g.~\texttt{data}). Husk at tjekke, om filen har en `header' og bruge således \texttt{header=T} hvis nødvendigt.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ ... }\CommentTok{\#replace ...}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{8}
\tightlist
\item
  (\textbf{factor variabler}) Variablerne \texttt{subject} og \texttt{time} indlæses som henholdvis data type `int' (heltal) og ``chr'' (character) men de skal hellere være `factor' variabler. Lav dem om til facktor variabler, fk.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data}\SpecialCharTok{$}\NormalTok{subject }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(data}\SpecialCharTok{$}\NormalTok{subject) }\CommentTok{\#gør subject til en faktor}
\DocumentationTok{\#\# gør den samme her for time:}
\NormalTok{data}\SpecialCharTok{$}\NormalTok{...}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{9}
\tightlist
\item
  (\textbf{delmængde af dataframe})
\end{enumerate}

Lav to delmængder af ovenstående datasæt -

\begin{itemize}
\tightlist
\item
  én til alle observationer fra tidspunktet ``before'' (\texttt{time\ =="before"}) og
\item
  én til alle observationer fra tidspunktet ``after''.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RT\_before }\OtherTok{\textless{}{-}}\NormalTok{ data[}\CommentTok{\#skrive her , ]}
\NormalTok{RT\_after }\OtherTok{\textless{}{-}} \CommentTok{\#skrive her}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{10}
\tightlist
\item
  (\textbf{mean og tapply}) Benyt funktionen \texttt{mean} til at beregne den gennemsnitlige reaktionstid (variablen \texttt{RT}) til ``before'' og ``after'' hver for sig (brug ovenstående delmængder).
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Prøv også at anvende funktionen \texttt{tapply} på det oprindelige datasæt til at gøre den samme med mindre kode.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tapply}\NormalTok{(}\CommentTok{\#skrive her,\#skrive her,\#skrive her)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{11}
\tightlist
\item
  (\textbf{beregn forskellen og mean})
\end{enumerate}

Bemærk datasættet er `paired' - målingerne er lavet på de samme personer både ``before'' og ``after''. --\textgreater{}

\begin{itemize}
\tightlist
\item
  Lav en vector \texttt{diff}, der er ændringen i reaktionstiderne mellem ``before'' og ``after''.
\item
  Beregn den gennemsnitlige forskel i rekationstiderne over de 10 personer.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diff }\OtherTok{\textless{}{-}} \CommentTok{\#change in reaction time between before and after}
\FunctionTok{mean}\NormalTok{(diff)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{12}
\tightlist
\item
  (\textbf{lav t-test i R}) Lav en t-test (funktionen \texttt{t.test}) for at teste hypotesen at ændringen i reaktionstiderne mellem ``before'' og ``after'' er anderledes end 0.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{t.test}\NormalTok{(}\CommentTok{\#skrive her..)}
\end{Highlighting}
\end{Shaded}

Find følgende i outputtet fra R:

\begin{itemize}
\tightlist
\item
  Hvor er test-statistikken \texttt{t}?
\item
  Hvor er p-værdien?
\item
  Hvad er alternativhypotesen?
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{13}
\tightlist
\item
  Skriv en kort sætning med din konklusion.
\end{enumerate}

\hypertarget{uxf8velser-med-anovaregression}{%
\subsection{Øvelser med ANOVA/regression}\label{uxf8velser-med-anovaregression}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{14}
\tightlist
\item
  (\textbf{ANOVA}) Kør følgende kode til at lave variansanalyse, der tester hulhypotesen hvor den gennemsnitlige værdi af variablen \texttt{Sepal.Width} er ens for hver af de tre arter (variablen \texttt{Species}) fra datasættet \texttt{iris}:
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{model\_h0 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Sepal.Width }\SpecialCharTok{\textasciitilde{}} \DecValTok{1}\NormalTok{, }\AttributeTok{data=}\NormalTok{iris)}
\NormalTok{model\_h1 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Sepal.Width }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Species, }\AttributeTok{data=}\NormalTok{iris)}

\FunctionTok{anova}\NormalTok{(model\_h0,model\_h1)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Er der en signifikant forskel i den gennemsnitlige \texttt{Sepal.Width} efter de forskellige \texttt{Species}?
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{15}
\tightlist
\item
  (\textbf{ANOVA}) Lav en lignende analyse på datasættet \texttt{chickwts} for at svare på spørgsmålet:
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Er der en forskel i den gennemsnitlige vægt (variablen \texttt{weight}) efter fodertypen (variablen \texttt{feed})? Med andre ord er vægt afhængig af fodertypen?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(chickwts)}
\CommentTok{\#skriv kode herfra}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{16}
\tightlist
\item
  (\textbf{Lineær regression}) Åbn datasættet \texttt{trees} og lav et scatter plot med variablen \texttt{Girth} på x-aksen og variablen \texttt{Volume} på y-aksen.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(trees)}
\FunctionTok{summary}\NormalTok{(trees)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Anvend funktionen \texttt{cor.test} for at teste, om der er en signifikant korrelation mellem de to variabler. Brug \texttt{method\ =\ "pearson"} (default)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cor.test}\NormalTok{(???, ???,}\AttributeTok{method=}\StringTok{"pearson"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Brug \texttt{lm} til at lave en simpel lineær regression, således at respons variablen \texttt{Volume} er afhængig af variablen \texttt{Girth}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(???, }\AttributeTok{data=}\NormalTok{trees) }
\end{Highlighting}
\end{Shaded}

Brug \texttt{summary} på din model for at se:

\begin{itemize}
\tightlist
\item
  Hvad er r.squared? (multiple eller adjusted)
\item
  Er hældningen signifikant?
\item
  Hvad er ligningen på den bedste rette linje?
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{17}
\tightlist
\item
  (\textbf{Multiple lineær regression}) I ovenstående model tilføj variablen \texttt{Height} som en ekstra prediktær variabel i modellen med en ``+'' tegn.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mylm\_height }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(???}\SpecialCharTok{\textasciitilde{}}\NormalTok{??? }\SpecialCharTok{+}\NormalTok{ ???, }\AttributeTok{data=}\NormalTok{trees) }
\FunctionTok{summary}\NormalTok{(mylm\_height)}
\end{Highlighting}
\end{Shaded}

Brug \texttt{summary} for at finde ud af:

\begin{itemize}
\tightlist
\item
  Hvor meget ændre den (multiple) r.squared værdi i forhold til modellen med kun variablen \texttt{Girth}?
\item
  Brug funktionen \texttt{anova} til at sammenligne modellen uden \texttt{Height} med modellen med \texttt{Height}
\item
  Er \texttt{Volume} signifikant afhængig af \texttt{Height} (efter at man har taget højde for \texttt{Girth})?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{anova}\NormalTok{(}\CommentTok{\#model without height,\#model with height)}
\end{Highlighting}
\end{Shaded}

\hypertarget{introduktion}{%
\chapter{Introduktion til R Markdown}\label{introduktion}}

\hypertarget{hvad-er-r-markdown}{%
\section{Hvad er R Markdown?}\label{hvad-er-r-markdown}}

R Markdown kan bruges som en nem måde at arbejde med R til projekter på. Her kan du kombinere din R-kode, output og tekst i samme dokument, og derudover fremviser et pænt HTML dokument fra det. Man anvender R Markdown til følgende:

\begin{itemize}
\tightlist
\item
  Skrive, gemme og køre R kode
\item
  Få direkte adgang til datasæt
\item
  Lave rapporter som kan deles med andre
\item
  En nem tilgang til at forstå andres kode, for eks. gennem eksemplerne og opgaverne fra dette kursus
\end{itemize}

Du kommer til at bruge R markdown gennem hele kurset, og jeg anbefaler, at du bruger det udelukkende til alle opgaverne.

\hypertarget{installere-r-markdown}{%
\section{Installere R Markdown}\label{installere-r-markdown}}

R Markdown er ligesom R gratis og `open source'. Den fungerer indenfor RStudio, så

Den kan installeres indenfor R ved at bruge den følgende kommando
:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"rmarkdown"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{videodemonstrationer}{%
\section{Videodemonstrationer}\label{videodemonstrationer}}

Jeg har lavet to korte videoer som kan ses her:

Video 1:

\begin{itemize}
\tightlist
\item
  Jeg viser hvordan man laver et nyt dokument i R Markdown
\item
  Jeg viser hvordan man skriver tekst ind i dokumentet
\item
  Jeg viser hvordan man bruger ``knit'' til at lave en HTML-rapport
\item
  Jeg viser hvordan man opretter og kører kode chunks
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://vimeo.com/541035944}

Video 2:

\begin{itemize}
\tightlist
\item
  Jeg viser en kort analyse med et datasæt
\item
  Jeg indlæser de data og laver en forløbig undersøgelse
\item
  Jeg laver en paired t-test og skriver konklusioner
\item
  Jeg tjekker antagelserne omkring den normale fordeling
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://vimeo.com/541232690}

\hypertarget{lave-et-nyt-dokument-i-r-markdown}{%
\section{Lave et nyt dokument i R Markdown}\label{lave-et-nyt-dokument-i-r-markdown}}

Husk at indlæse pakken i RStudio:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(rmarkdown)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: pakke 'rmarkdown' blev bygget under R version 4.0.5
\end{verbatim}

Man åbner et nyt rmarkdown dokument ved at trykke ``New'' \textgreater{} ``New File'' \textgreater{} ``New R Markdown\ldots{}''. Man kan også trykke på ``+'' knappen øverst i venstre hjørne.

\begin{figure}
\centering
\includegraphics{plots/open_new_rmarkdown.png}
\caption{Hvordan man åbner et nyt R Markdown dokument}
\end{figure}

I de fleste tilfælde arbejder vi med HTML dokumenter, men man har også andre muligheder (PDF/Word/Shiny osv\ldots).

I mange tilfælde er det bekvemt at se resultaterne af din R kode inline, det vil sige, indenfor din .Rmd fil indenfor det R studio vindue. Til længere opgaver er det god praktisk at sikre, at man få altid en HTML rapport, der viser resultaterne. Til eksamen forventer jeg, at du afleverer en HTML rapport til mig. Det er derfor dit ansvar til at sikre, at din kode fungerer og du kan dermed successfuldt producere en fil med din løsninger.

With HTML, you can easily view it in a web browser. compiling an HTML document is generally faster than generating a PDF or other format.

\begin{figure}
\centering
\includegraphics{plots/create_new_rmarkdown.png}
\caption{Hvordan man åbne et nyt R Markdown dokument}
\end{figure}

\hypertarget{yaml}{%
\subsection{YAML}\label{yaml}}

YAML Header: Controls certain output settings that apply to the entire document.

Den første sektion hedder `YAML'. (Dette står for `YAML Ain't Markup Language').

\includegraphics{plots/YAML.png}
Det indeholder oplysninger om dokumentet, og her kan man specificere forskellige muligheder - fk. titel, forfatter, output-type (fks. HTML eller PDF), dato, osv.

I de fleste tilfælde kan vi bare nøjes med at bruge standard indstillinger, men hvis man gerne vil lære mere om de forskellige muligheder med YAML, kan man læse her:

\url{https://bookdown.org/yihui/rmarkdown/html-document.html}

eller se en liste af muligheder her på dette cheatsheet:

\url{https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf}

\hypertarget{globale-options}{%
\subsection{Globale options}\label{globale-options}}

Bemærke at der også er tekst som ser ud som følgende:

\begin{figure}
\centering
\includegraphics{plots/global_options.png}
\caption{Hvordan man åbner et nyt R Markdown dokument}
\end{figure}

Med funktionen \texttt{opts\_chunk\$set()} kan man specificere de globale indstillinger, man gerne vil have, som styrer hvordan det færdige dokument ser ud. I dette tilfælde er de fleste parametre angivet som `default' (da de ikke er nævnt eksplicit), og \texttt{echo} er den eneste der har noget andet angivet. Hvis \texttt{echo} er \texttt{TRUE}, så betyder det, at når man kører sine kode og kompilerer dokumentet, så kan man også se den kode, der er kørte, ligesom dens output, som en del af den færdige HTML, der fremvises.

\hypertarget{skrive-baseret-tekst}{%
\section{Skrive baseret tekst}\label{skrive-baseret-tekst}}

Her er nogle nyttige måder, man kan skrive tekst på, i opgaverne eller rapporter.

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{*}\NormalTok{italic}\SpecialCharTok{*}   \ErrorTok{**}\NormalTok{bold}\SpecialCharTok{**}

\NormalTok{\_italic\_   \_\_bold\_\_}
\end{Highlighting}
\end{Shaded}

\emph{italic} \textbf{bold}

\emph{italic} \textbf{bold}

\hypertarget{headers}{%
\subsection{Headers}\label{headers}}

Man kan også lave sektioner:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Header 1}

\DocumentationTok{\#\# Header 2}

\DocumentationTok{\#\#\# Header 3}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\centering
\includegraphics{header_eksempel.png}
\caption{Caption for the picture.}
\end{figure}

\hypertarget{liste}{%
\subsection{liste}\label{liste}}

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{*}\NormalTok{ Item }\DecValTok{1}
\SpecialCharTok{*}\NormalTok{ Item }\DecValTok{2}
    \SpecialCharTok{+}\NormalTok{ Item 2a}
    \SpecialCharTok{+}\NormalTok{ Item 2b}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Item 1
\item
  Item 2

  \begin{itemize}
  \tightlist
  \item
    Item 2a
  \item
    Item 2b
  \end{itemize}
\end{itemize}

\hypertarget{kode-indenfor-teksten-inline-chunks}{%
\section{Kode indenfor teksten (`Inline chunks')}\label{kode-indenfor-teksten-inline-chunks}}

This is useful when you want to include information about your data in the written summary. We'll add a few examples of inline code to our R Markdown Guide to illustrate how it works.

De fleste koder skrives indenfor såkaldte `chunks' som vi kommer til nedenfor. Men nogle gange kan det være nyttigt at skrive kode direkte indenfor teksten. Dette gøres ved at skrive

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Her er min }\StringTok{\textasciigrave{}}\AttributeTok{kode}\StringTok{\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

som ser sådan ud indenfor teksten:

Her er min \texttt{kode}

I dette tilfælde, bliver koden ikke kørte. Hvis man vil køre koden indenfor teksten, kan man skrive (for eksempel):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{De gennemsnitlige antal af observationer er }\StringTok{\textasciigrave{}}\AttributeTok{r mean(c(5,7,4,6,3,3))}\StringTok{\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

som ser sådan ud indenfor teksten:

De gennemsnitlige antal af observationer er 4.6666667

Og hvis man glemmer `r', så bliver koden ikke kørte:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{De gennemsnitlige antal af observationer er }\StringTok{\textasciigrave{}}\AttributeTok{mean(c(5,7,4,6,3,3))}\StringTok{\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

giver:

De gennemsnitlige antal af observationer er \texttt{mean(c(5,7,4,6,3,3))}

\hypertarget{kode-chunks}{%
\section{Kode chunks}\label{kode-chunks}}

Man kan oprette en ny chunk, enten ved at trykke på de \emph{Insert a new code chunk} knap ovenpå, eller ved at trykke \emph{Cmd+Option+I} på tastaturet (hvis man bruger MAC) eller \emph{Ctrl+Alt+I} (hvis man bruger Windows).

Tryk på den grønne pile, der hedder \emph{Run current chunk} for at køre hele den chunk. Resultatet kan ses lige nedenunder. Man kan også trykke på den grønne pile som ligger øverst til højre i den kode chunk.

Det er ofte hurtigere at bruge \emph{Run current chunk} i stedet for at \emph{Knit} (se nedenfor) hver gang man vil køre kode, fordi her kører man kun den enkele chunk, man er interesset i, i stedet for det hele dokument (som er tilfældet med \emph{Knit}).

\hypertarget{chunk-options}{%
\subsection{Chunk options}\label{chunk-options}}

One of the great things about R Markdown is that you have many options to control how each chunk of code is evaluated and presented. This allows you to build presentations and reports from the ground up --- including code, plots, tables, and images --- while only presenting the essential information to the intended audience. For example, you can include a plot of your results without showing the code used to generate it.

Mastering code chunk options is essential to becoming a proficient R Markdown user. The best way to learn chunk options is to try them as you need them in your reports, so don't worry about memorizing all of this now. Here are the key chunk options to learn:

For eksempel, en chunk med en `option' nævnt ser sådan ud (fjerne \# symbol)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r,eval=FALSE\}}
\CommentTok{\#}
\CommentTok{\#\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Her er nogle muligheder (sektionen ``Embed code with knitr syntax''):

\url{https://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf}

Her er seks populær muligheder som jeg har kopiret fra nettet:

\begin{itemize}
\tightlist
\item
  \texttt{include\ =\ FALSE}

  \begin{itemize}
  \tightlist
  \item
    prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.
  \end{itemize}
\item
  \texttt{echo\ =\ FALSE}

  \begin{itemize}
  \tightlist
  \item
    prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
  \end{itemize}
\item
  \texttt{message\ =\ FALSE}

  \begin{itemize}
  \tightlist
  \item
    prevents messages that are generated by code from appearing in the finished file.
  \end{itemize}
\item
  \texttt{warning\ =\ FALSE}

  \begin{itemize}
  \tightlist
  \item
    prevents warnings that are generated by code from appearing in the finished.
  \end{itemize}
\item
  \texttt{fig.cap\ =\ "..."}

  \begin{itemize}
  \tightlist
  \item
    adds a caption to graphical results.
  \end{itemize}
\item
  \texttt{eval\ =\ FALSE}

  \begin{itemize}
  \tightlist
  \item
    does not evaluate the code
  \end{itemize}

  Do not put all your R commands into one big R chunk. Instead, split it into well-defined smaller chunks,
  which you may even give names. Investing effort in choosing good chunk names will pay off in terms of
  structuring your R code.
\end{itemize}

\hypertarget{knit-kode}{%
\section{Knit kode}\label{knit-kode}}

Man bruger \emph{Knit} for at gengive filen i HTML form. Når man trykke på \emph{Knit}, bliver alle kode i filen kørt og et HTML dokument fremvises. Man kan også bruge \emph{Preview}, der kører ikke kode chunks, men bruger kun koden som er blevet kørt før.

\hypertarget{matematik}{%
\section{Matematik}\label{matematik}}

For example, the inline code \texttt{\$\textbackslash{}int\_0\^{}5\ x\^{}2\ dx\$} will typeset as \(\int_0^5 x^2 dx\):

\hypertarget{problemstillinger-1}{%
\section{Problemstillinger}\label{problemstillinger-1}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  Jeg har lavet en kort \textbf{quiz} i Absalon, som hedder ``Quiz - R Markdown''.
\item
  Lave et nyt R Markdown dokument i R Studio. Prøve at lave en list og nogle overskrifter af forskellige størrelser.
\item
  Tryk på \texttt{Knit} og tjekke at et html-dokument fremvises som forventet.
\item
  Edit the title of the markdown document to My first Markdown document, and click Knit again. Notice
  how the title of the output document changes
\item
  Tilføj en ny R chunk, med noget kode. e.g.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{20}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{) }\CommentTok{\#make a sample of normally distributed data}
\FunctionTok{plot}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

Øve med at trykke enten på den grønne pile, eller på knit. Prøve også at køre linjene en ad gangen med Ctrl + Enter.

Bemærk, at det tager længere til at \texttt{knit} hver eneste gang, end at bare køre chunks individ indenfor dit dokument.

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{5}
\item
  \emph{Kør en chunk} Trykke på den hjule i øverste hjørn af chunket og ændre på de forskellige chunk options. Tryk på `knit' for at se, hvad der sker.
\item
  \emph{Skriv matematik} Bruge \texttt{\$\ \$} til at skrive en lindring ind i teksten, \(\bar{x}\). Hint: \texttt{\$\textbackslash{}sum\_\{i=1\}\^{}\{n\}\$} and \texttt{\$\{x\_\{i\}\}\$}.
\item
  \emph{Ændr dokument type} Hver gang du knit, du lave en HTML dokument. Prøve at lave en andet type dokument i stedet for - erståtte html\_document med word\_document.
\end{enumerate}

The code in Rmd-file must be self-contained in the sense that you cannot use datasets (or other objects)
that you have imported ``outside'' the Rmd-file. You therefore have to include the commands for data
import in the file.

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{8}
\tightlist
\item
  \emph{Vigtig at husk} Tilføj følgende chunk til dit dokument og trykke på ``knit''. Få du en fejlmedelse?
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(}\StringTok{"mtcars"}\NormalTok{)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(cyl}\SpecialCharTok{==}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Bemærk, at du får en fejlmeddelse. Det er fordi, du endnu ikke har indlæst den påkrævet pakke til at få koden til at virke. Det kan ske, selvom du måske har indlæste pakken i Console eller i Packages tab.

\begin{itemize}
\tightlist
\item
  Først prøve at køre ``library(tidyverse)'' indenfor Console og dernæst prøve at knitte dit dokument igen - du får stadig en fejmeddelse.
\item
  Tilføj følgende \textbf{øverst i ovenstående chunk}, som du tilføjede i dit dokument. Nu bør dit dokument knitte.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{9}
\tightlist
\item
  Ind på Absalon har jeg lagt en R Markdown fil som hedder ``R Markdown opgave'', som I kan bruge til at starte med at arbejde lidt med R Markdown baserede opgaver. Det kombinerer koncepter fra de forudgående kapitel om de grundlæggende ting i R og statistik.
\end{enumerate}

\hypertarget{slut-for-ugen}{%
\section{Slut for ugen}\label{slut-for-ugen}}

Huske at sende mig eventuelle spørgsmål, som jeg kan svare på i Zoom rummet (sende gerne via mail eller chat).

Næste gang begynder vi at arbejde vi med \texttt{ggplot2}.

\hypertarget{ekstra-links}{%
\section{Ekstra links}\label{ekstra-links}}

\url{https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf?_ga=2.49295910.1034302809.1602760608-739985330.1601281773}

Her er en `quick tour' som kan være nyttig (valgfri)
\url{https://rmarkdown.rstudio.com/authoring_quick_tour.html}

Bonus: R Markdown Cheatsheet
RStudio has published numerous cheatsheets for working with R, including a detailed cheatsheet on using R Markdown! The R Markdown cheatsheet can be accessed from within RStudio by selecting Help \textgreater{} Cheatsheets \textgreater{} R Markdown Cheat Sheet.

\hypertarget{visual1}{%
\chapter{Visualisering - ggplot2 dag 1}\label{visual1}}

\includegraphics[width=2.9in]{plots/ggplot2_logo}

\hypertarget{inledning-og-videoer}{%
\section{Inledning og videoer}\label{inledning-og-videoer}}

Dette kapitel giver en introduktion i hvordan man kan visualisere data med R med pakken \textbf{ggplot2}.

\hypertarget{luxe6ringsmuxe5lene-for-dag-1}{%
\subsection{Læringsmålene for dag 1}\label{luxe6ringsmuxe5lene-for-dag-1}}

I skal være i stand til at:

\begin{itemize}
\tightlist
\item
  Forstå hvad ``Grammar of Graphics'' betyder og sammenhængen med den \textbf{ggplot2}-pakke
\item
  Lære at bruge funktionen \texttt{ggplot} og den relevante \textbf{geoms} (\texttt{geom\_point()}, \texttt{geom\_bar()}, \texttt{geom\_boxplot()}, \texttt{geom\_density()})
\item
  Lave en `færdig' figur med en titel og korrekte etiketter på akserne
\item
  Begynde at arbejde med farver og temaer
\end{itemize}

\hypertarget{hvad-er-ggplot2}{%
\subsection{\texorpdfstring{Hvad er \textbf{ggplot2}?}{Hvad er ggplot2?}}\label{hvad-er-ggplot2}}

De fleste i kurset har anvendte funktionen \texttt{plot()}, der er den standard base-R funktion til at lave et plot på. Man kan godt kan blive ved med at lave adskillige plotter i base-pakken, men det er ofte meget tidskrævende så snart man gerne vil lave noget mere indviklet eller pænere.

\textbf{ggplot2} er den mest populær pakke fra \textbf{tidyverse}, og giver en alternativ måde at lave plotter på i R. Som vi kommer til at se i dette kapitel, har den \textbf{ggplot2} løsning en ret logisk tilgang, hvor man bygger et plot op i forskellige komponenter. Det kan virke uoverskueligt i først omgang, men er faktisk meget intuitiv når man er vant til det. Det nyttige i at lære \textbf{ggplot2} kan også ses når man begynder at integrere de øvrige \textbf{tidyverse} pakker fra kapitel 4.

\hypertarget{brugen-af-materialerne}{%
\subsection{Brugen af materialerne}\label{brugen-af-materialerne}}

Jeg har optaget videoer hvor jeg viser nogle `quick-start' type eksempler indenfor min RStudio. Videoerne er ikke designet til at indeholde alle detaljer, men til at fungere som udgangspunkt til at kunne komme i gang med øvelserne. Vær opmærksom på, at alle koder i videoerne findes også i kursusnotaterne, hvis men selv vil afprøve dem. Jeg anbefaler at bruge kursusnotaterne som en reference gennem kurset når man arbejder på øvelserne (hvor effektiv læring sker), og vær også opmærksom på, at jeg ofte introducerer nye ting i selve øvelserne.

\hypertarget{video-ressourcer}{%
\subsection{Video ressourcer}\label{video-ressourcer}}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544299069}

\begin{itemize}
\tightlist
\item
  I video 1 demonstrerer jeg, hvordan man lave sit første plot med \texttt{ggplot2}.
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/543945046}

\begin{itemize}
\tightlist
\item
  I video 2 dækker vi boxplots.
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/543989990}

OBS: jeg sagde i videoen at \texttt{alpha=0.5} gøre punkterne mere markant, men jeg mente selvfølgelige mindre markant ;)

\begin{itemize}
\tightlist
\item
  I video 3 demonstrerer jeg barplots.
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544033975}

\begin{itemize}
\tightlist
\item
  Video 5: Histogram og density plots
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544188160}

\hypertarget{transition-fra-base-r-til-ggplot2}{%
\section{Transition fra base R til ggplot2}\label{transition-fra-base-r-til-ggplot2}}

Vi starter som udgangspunkt med base-R og viser, hvordan man laver et lignende plot med \textbf{ggplot2}. Til dette formål bruger vi det indbyggede datasæt, der hedder \texttt{iris}. Det er et meget berømt datasæt, og det er næsten sikkert, at du støder ind (eller har stødt ind) i det mange gange uden for dette kursus, enten på nettet eller i forbindelse med andre kurser som handler om R. Datasættet var oprindeligt samlet af statistikker og biologer Ronald Fisher i 1936 og indeholder 50 stikprøver, der dækker forskellige målinger, for hver af tre arter af planten iris (Iris setosa, Iris virginica og Iris Versicolor).

\includegraphics[width=0.85\linewidth]{plots/iris_picture}

Man kan indlæse et indbyggede datasæt med hjælp af funktionen \texttt{data()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

Først vil vi have et overblik over datasættet. Til at gøre dette bruger vi \texttt{summary()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
##  Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
##  1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
##  Median :5.800   Median :3.000   Median :4.350   Median :1.300  
##  Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
##  3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
##  Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
##        Species  
##  setosa    :50  
##  versicolor:50  
##  virginica :50  
##                 
##                 
## 
\end{verbatim}

Forestil, at vi gerne vil lave et plot, som viser sammenhængen mellem længden og bredden af sepal (bægerblad), eller specifikt er vi interesseret i kolonnerne \texttt{iris\$Sepal.Length} og \texttt{iris\$Sepal.Width}. Lad os starte med at visualisere variablerne i base-R, ved at bruge \texttt{plot}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Sepal.Width)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-112-1.pdf}

Man kan gøre det meget pænere eksempelvis ved at bruge forskellige farver til at betegne de forskellige arter, eller ved at give en hensigtsmæssig overskrift eller aksenavne.

\hypertarget{vores-fuxf8rste-ggplot}{%
\section{Vores første ggplot}\label{vores-fuxf8rste-ggplot}}

Vi vil imidlertid fokusere på at lave et lignende plot med \texttt{ggplot2}. Hvis man ikke allerede har gjort det, så husk at indlæse pakken i R for at få nedenstående koder til at virke.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("ggplot2") \#hvis ikke allerede installeret}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

For at lave et plot med \texttt{ggplot2} tager man altid udgangspunkt i funktionen \texttt{ggplot()}. Først specificerer vi vores data - altså at vi gerne vil bruge dataframe \texttt{iris}. Dernæst angiver vi indenfor funktionen \texttt{aes()} (som sidder indenfor \texttt{ggplot()}), at x-aksen skal være \texttt{Sepal.Length} og y-aksen \texttt{Sepal.Width}. Det ser sådan ud:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width))}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-114-1.pdf}

Koden fungerer, men bemærk at plottet er helt blank og derfor ikke særligt brugbart. Men der er blevet lavet et grundlag (se aksenavne osv.).

Det er blank fordi vi endnu ikke har fortalt, hvilket plot type det skal være - for eksempel søljediagram/bar plot, histogram, punktplot/scatter plot (og jeg benytter de engelske begreber herned). Her vil vi gerne bruge et scatter plot, som betegnes af funktionen \texttt{geom\_point()} i \textbf{ggplot2}. Vi forbinder derfor funktionen \texttt{geom\_point()} til den \texttt{ggplot()} funktion, vi allerede har specificeret. Husk altid, at man bruger \texttt{+} til at forbinde de to ``komponenter'' (altså \texttt{ggplot()} og \texttt{geom\_point()}) af plottet (ellers få vi et blank plot).

Koden for et meget simpelt scatter plot er således:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-115-1.pdf}

Bemærk, at vi ikke har skrevet noget indeni de runde parenteser i funktionen \texttt{geom\_point()}. Det betyder, at vi accepterer alle standard eller `default' parametre, som funktionen tager. Hvis vi vil have noget andet end de standard parametre, kan vi godt specificere det. For eksempel kan vi gøre punkterne lidt større end ved standard (prøve at tjekke \texttt{?geom\_point()} for at se en list overfor de mulige parametre, man kan ændre på):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-116-1.pdf}

Vi har nu et plot, som vi kan sammenligne med det ovenstående plot, vi lavet i base-pakken. Ligesom i base-pakken vil vi gerne tilføje nogle ting for at gøre vores plot til vores \emph{færdige figur}, som vi kunne præsentere overfor andre. Her i \textbf{ggplot2} gøres det ved at tilføje flere komponenter ovenpå, med brugen af \texttt{+}, ligesom vi gjorde da vi tilføjede \texttt{geom\_point()} til \texttt{ggplot()}. Det vil vi sikkert komme til at uddybe, men første vil jeg gerne skrive nogle orde om \textbf{ggplot2} generelt, og filosofien bag.

\hypertarget{lidt-om-ggplot2}{%
\section{Lidt om ggplot2}\label{lidt-om-ggplot2}}

\hypertarget{syntax}{%
\subsection{Syntax}\label{syntax}}

Som vi har lige set, \texttt{ggplot()} tager altid udgangspunkt i en dataframe, som vi specificerer først. I \texttt{ggplot()} indeholder den dataramme, der vi specificerer, \textbf{alle} de data vi skal bruge til at få lavet vores færdige figur. Til at gøre det til noget mere konkret, lad os sammenligne kodet mellem base-pakken og \texttt{ggplot()} til vores \texttt{iris} data. Her kan man bemærke, at i base-pakken specificerede vi direkte vektorer \texttt{iris\$Sepal.Length} og \texttt{iris\$Sepal.Width} som parametre \texttt{x} og \texttt{y}, der tager henholdsvis første og andens-plads i funktionen. Til gengæld i \texttt{ggplot()}, specificerer vi først den hele dataramme i den første plads, og så bagefter med brugen af \texttt{aes()} angav vi hvordan x-aksen og y-aksen ser ud.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#baseplot solution}
\FunctionTok{plot}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length, iris}\SpecialCharTok{$}\NormalTok{Sepal.Width) }

\CommentTok{\#ggplot2 solution}
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

En anden fordel af \texttt{ggplot2()} er, at man kan blive ved med at forbedre plottet ved at tilføje ting ovenpå det plot, som vi allerede har lavet, i hvad man kan beskriver som en lagring tilgang. Det gøres intuitiv ved brugen af ``+''. Man kan derfor starte med noget simpelt, og derefter opbygge det til noget mere kompleks. Dette er uafhængig af den type plot, vi laver.

Efter vi har angivet vores dataframe, angiver vi indenfor funktionen \texttt{aes()}, hvilke variabler i datarammen, vi gerne vil visualisere. \texttt{aes()} er forkortelse af `aesthetic' og det er her at vi fortæller \texttt{ggplot2} om de variabler der skal være i plottet - for eksempel her kan man specificere hvilken variable skal være på x-aksen og hvilken skal være på y-aksen.

Hvis vi eksempelvis har en dataramme med en \texttt{variabel1} og \texttt{variabel2}, kan specifikationen se ud som følger:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#not run, bare for at vise hvordan man bruger ggplot:}
\FunctionTok{ggplot}\NormalTok{(dataramme, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{variabel1, }\AttributeTok{y=}\NormalTok{variabel2)) }
\end{Highlighting}
\end{Shaded}

Her har vi således angivet, at vi er interesseret i \texttt{variabel1} på x-aksen og \texttt{variabel2} på y-aksen, samt at de er kolonner af en dataramme som hedder \texttt{dataramme}.

Næste kan kan vi tilføje hvilket plot type, vi ønsker at lave (i dette tilfælde et scatterplot), og forbinder med \texttt{+} tegn:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#not run, bare for at vise hvordan man bruger ggplot:}
\FunctionTok{ggplot}\NormalTok{(dataramme, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{variabel1, }\AttributeTok{y=}\NormalTok{variabel2)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{globale-versus-lokale-uxe6stetik}{%
\subsection{Globale versus lokale æstetik}\label{globale-versus-lokale-uxe6stetik}}

De fleste gange bruger man funktionen \texttt{aes()} indenfor \texttt{ggplot()}, med betydningen, at de variabler specificeret indenfor \texttt{aes()} gælder globalt over alle komponenter i plottet. Man kan faktisk også skrive \texttt{aes()} lokale indenfor \texttt{geom\_point()} (eller andet geom funktion):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width))}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-120-1.pdf}

Vi får det samme plot som før, men det er kun \texttt{geom\_point()} der er påvirket af specificeringen indenfor \texttt{aes()}. I simpel situationer som ovenpå er der ingen forskel, men når man har mange forskellige komponenter i spil, så kan det give mening at bruge lokale æstetik.

\hypertarget{specificere-axse-tekst-og-titel}{%
\section{Specificere axse tekst og titel}\label{specificere-axse-tekst-og-titel}}

Vi tager udgangspunkt i plottet, vi lavet i ovenstående og prøver at gøre det bedre, ved at tilføje nye etiketter og en titel. I \texttt{ggplot} kan man opdatere y-akse og x-akse etiketter ved at bruge henholdsvis \texttt{ylab} og \texttt{xlab}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Width"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-121-1.pdf}

Vi tilføjer en titel med funktionen \texttt{ggtitle()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Width"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Scatter plot of Sepal Width vs Sepal Length"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-122-1.pdf}

\hypertarget{uxe6ndre-farver}{%
\section{Ændre farver}\label{uxe6ndre-farver}}

I \texttt{ggplot2} kan man specificere ``automatisk'' farver for at skelne imellem de tre forskellige \texttt{Species} i datasættet \texttt{iris}. I næste lektion dækker jeg hvordan man kan være mere fleksibel ved at sætte farver manuelt, men ofte vil vi bare bruge som udgangspunkt den nemme løsning, eventuelle rette op på det bagefter med en ny komponent, hvis der er behøv for det. Vi skriver \texttt{color=Species} indenfor \texttt{aes()}, som i følgende. Bemærk, at der kommer en `legend' med, der fortæller os, hvilken art få hvilken farve.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width,}\AttributeTok{color=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Width"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Scatter plot of Sepal Width vs Sepal Length"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-123-1.pdf}

\hypertarget{uxe6ndre-temaet}{%
\section{Ændre temaet}\label{uxe6ndre-temaet}}

Det standard tema har en grå baggrund og ``grid'' linjer, men vi kan godt vælge noget andet. For eksempel kan man tilføje \texttt{theme\_minimal()} som i nedenstående. Her får vi en hvid baggrund i stedet for, mens vi får stadig grid linjer. Man kan afprøve forskellige temaer (for eksempel \texttt{theme\_classic()}, \texttt{theme\_bw()}), og se, hvilket tema fungerer bedst i det enkelt plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width,}\AttributeTok{color=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Width"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Scatter plot of Sepal Width vs Sepal Length"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-124-1.pdf}

Her er nogle ekslemper på mulige temaer du kan bruge i dine plots (det er dog generelt op til dig).

\begin{longtable}[]{@{}l@{}}
\toprule
theme \\
\midrule
\endhead
\texttt{theme\_grey()} \\
\texttt{theme\_classic()} \\
\texttt{theme\_bw()} \\
\texttt{theme\_dark()} \\
\texttt{theme\_minimal()} \\
\texttt{theme\_light()} \\
\bottomrule
\end{longtable}

Se også her hvis du er interesseret i flere temaer: \url{https://r-charts.com/ggplot2/themes/}

\hypertarget{forskellige-type-plots}{%
\section{Forskellige type plots}\label{forskellige-type-plots}}

Indtil videre har vi kun arbejdet med \texttt{geom\_point()} for at lave et scatter plot, men det kan være at vi gerne vil lave noget andet. Her gennemgår jeg følgende ``geoms'':

\begin{longtable}[]{@{}ll@{}}
\toprule
geom & plot \\
\midrule
\endhead
\texttt{geom\_point()} & scatter plot \\
\texttt{geom\_bar()} & barplot \\
\texttt{geom\_boxplot()} & boxplot \\
\texttt{geom\_histogram()} & histogram \\
\texttt{geom\_density()} & density \\
\bottomrule
\end{longtable}

For at lave disse plot typer, skal man tillægge funktionen til den \texttt{ggplot()} kommando med \texttt{+}, ligesom vi gjorde med \texttt{geom\_point()}. Der kan dog være for nogle plot-type specifikke overvejelser som er værd at vide, indenfor man selv prøver dem. Jeg anbefaler at du første går i gang med problemstillingerne og refererer tilbage til den plot type at du bliver bedt om lave i kursusnotaterne.

\hypertarget{boxplot-geom_box}{%
\subsection{\texorpdfstring{Boxplot (\texttt{geom\_box})}{Boxplot (geom\_box)}}\label{boxplot-geom_box}}

For at lave et boxplot og \texttt{Sepal.Length} opdelt efter \texttt{Species}, angiver vi \texttt{Species} på x-aksen og \texttt{Sepal.Length} på y-aksen. Vi vil også have, at hver art få sin egen farve, så bruger vi \texttt{fill=Species}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species, }\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Boxplot"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-125-1.pdf}

\textbf{Lave punkter ovenpå}

Det kan ofte være nyttigt at plotte de egentlige data punkter ovenpå boxplottet, så I kan se både fordelingen i de data samt de rå data. En løsning er at benytte \texttt{geom\_point()} ved at tilføje det som komponent over vores eksisterende kode.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species, }\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Boxplot with points overlayed"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-126-1.pdf}

Man kan dog se, at det ikke er særlig informativ, da alle punkter er på den samme lodrette linje. Hvis vi har mange punkter med samme eller næsten samme værdier, så kan vi ikke se de fleste af dem i plottet. En bedre løsning er at indføre noget tilfældighed i punkterne langt x-aksen, så at man mere tydelige kan se dem. Det er kaldes for ``jitter'' og man specificerer jitter ved at bruge \texttt{geom\_jitter} i stedet for \texttt{geom\_point}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species, }\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_jitter}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Boxplot with jitter"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-127-1.pdf}

Jeg kan vi også specificere \texttt{alpha}, som indføre gøre punkterne gennemsigtige, for at gøre dem mindre markant. Man kan også ændre på \texttt{width} som kontrollerer deres spredning langt x-axsen.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species, }\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{,}\AttributeTok{width=}\FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Boxplot with jitter and transparency"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-128-1.pdf}

\textbf{Fjerne legend hvis unødvendige}

Man kan se, at når man specificerer farver, få man en legend på højre side af plotte. I dette tilfælde er det faktisk ikke nødvendige, da man kan se uden legend hvad de tre boxplots refererer til. Defor fjerner vi den fra plottet ved at bruge \texttt{theme(legend.position="none")}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species, }\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_jitter}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Boxplot with jitter and no legend"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position=}\StringTok{"none"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-129-1.pdf}

\hypertarget{barplot-geom_bar}{%
\subsection{\texorpdfstring{Barplot (\texttt{geom\_bar})}{Barplot (geom\_bar)}}\label{barplot-geom_bar}}

Med \texttt{ggplot()} kan man representere data i et bar plot ved at bruge \texttt{geom\_bar()}. I følgende vil vi gerne tælle op de antal observationer for hver art (variable \texttt{Species}), og visualerer dem således som søjler (eller bare ``bars'') Indenfor \texttt{geom\_bar()} specificerer vi således \texttt{stat="count"}, som er den meste almindelige brugt mulighed.

Vi bruger også \texttt{fill=Species} her for at lave forskellige farver automatiske for hver af de tre arte. Bemærk, at det var \texttt{color=Species} i forudgående plotte når vi anvendte \texttt{geom\_point()}. Det er fordi, \texttt{color} bruges for punkter og linjer, mens \texttt{fill} er til større regioner som skal være udfyldt, såsom bars og histograms.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Number of observations by species"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-130-1.pdf}

\textbf{Barplot: stack vs dodge}

Hvis man har flere gruppe variabler (altså \texttt{Species} og måse en anden), kan man lave bar plotte på forskellige måder. Da vi ikke har en ekstra gruppe variabel, jeg laver én, der hedder \texttt{Sepal.Group}, der skelne imellem \texttt{Long} og \texttt{Short} værdier af variablen \texttt{Sepal.Length}. Her specificerer jeg bare (med funktionen \texttt{ifelse()}), at hvis \texttt{Sepal.Length} er længere end den gennemsnitlige \texttt{Sepal.Length}, så er det \texttt{Long}, ellers er det \texttt{Short}.

Hvis jeg lave en barplot med de to variabler, kan jeg tilføje \texttt{Sepal.Group} som \texttt{fill}, og \texttt{ggplot} splitter de antal observationer efter \texttt{Sepal.Group} med farver som repræsenterer \texttt{Sepal.Group} og tilføjer en tilsvarende legend.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris}\SpecialCharTok{$}\NormalTok{Sepal.Group }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length}\SpecialCharTok{\textgreater{}}\FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length),}\StringTok{"Long"}\NormalTok{,}\StringTok{"Short"}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Sepal.Group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{)  }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-131-1.pdf}

Mange gange vil vi hellere få bars som stå ved siden af hinanden. Det kan vi specificere med blot at tilføje \texttt{position="dodge"} ind i \texttt{geom\_bar()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Sepal.Group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{,}\AttributeTok{position=}\StringTok{"dodge"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-132-1.pdf}

\hypertarget{histogram-geom_histogram}{%
\subsection{\texorpdfstring{Histogram (\texttt{geom\_histogram})}{Histogram (geom\_histogram)}}\label{histogram-geom_histogram}}

En histogram bruges til at få overblik over hvordan data fordeler sig. I \texttt{ggplot2} kan man lave en histogram med \texttt{geom\_histogram()}. Den x-akse variable skal være en `continuous' variable. Her specificerer vi, at vi gerne vil have et histogram for hver Species.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Iris histogram"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-133-1.pdf}

Man kan også gøre det nemmere at skelne imellem de tre arter ved at sætte \texttt{alpha=0.5} indenfor \texttt{geom\_histogram} og ved at angive en linje farve som mulighed inden for \texttt{geom\_histogram()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{,}\AttributeTok{color=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Iris histogram"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-134-1.pdf}

\hypertarget{density-geom_density}{%
\subsection{\texorpdfstring{Density (\texttt{geom\_density})}{Density (geom\_density)}}\label{density-geom_density}}

Med en density plot, ligesom med en histogram, kan man se fordelingen, de data har, i formen af en glat (eller ``smooth'') kurv.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{color=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Density plot"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-135-1.pdf}

\textbf{Density plot med fill og gennemsigtig farver}

Vi kan angive en værdi for \texttt{alpha} indenfor \texttt{geom\_density()}. Den parameter \texttt{alpha} specificerer gennemsigtigheden af de density kurver i plottet.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Density plot with alpha=0.5"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-136-1.pdf}

\textbf{Tilføje middelværdi linjer}

Vi bruger funktionen \texttt{tapply()} til at beregne middelværdier af \texttt{Sepal.Length} for hver af de tre \texttt{Species}. Vi kan derefter tilføje dem som lodrette linjer to vores plot. Her bruger vi \texttt{geom\_vline()} (OBS det er \texttt{geom\_hline()} hvis man vil have en vandret linje) og fortæller, at \texttt{xintercept} skal vare lig med de middelværdier, som vi har beregnet. Parameteren \texttt{lty=2} betyder, at vi vil gerne have en ``dashed'' linje.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{means }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length,iris}\SpecialCharTok{$}\NormalTok{Species,median)}

\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{color=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Sepal Length"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Density plot with alpha=0.5"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_vline}\NormalTok{(}\AttributeTok{xintercept =}\NormalTok{ means,}\AttributeTok{lty=}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-137-1.pdf}

\hypertarget{troubleshooting}{%
\section{Troubleshooting}\label{troubleshooting}}

Her er en lille list over nogle ting, der forårsager en fejl når man kører kode med \textbf{ggplot2}. Jeg tilføjer også andre ting som opstå i vores lektion :).

\begin{itemize}
\item
  \texttt{ggplot(data=iris,\ aes(....))} : husk her \texttt{data=iris} er korrekt og \textbf{ikke} \texttt{Data=iris} (R skelner mellem store og små bogstaver). Man kan også undlade at bruge \texttt{data=} og skrive bare \texttt{iris} i stedet for.
\item
  Den forkerte stavning - dobbelt tjek, at du har stavet variabler eller funktioner navne korrekt.
\item
  Glemte \texttt{+} symbol - for at forbinde komponenterne i plottet, skal man huske at tilføje \texttt{+} i slutningen af en linje og så skrive de næste komponent bagefter (man behøver ikke at skrive hver komponent på en ny linje med det gøre det nemmere at læse koden).
\item
  Skrev \texttt{\%\textgreater{}\%} symbol i stedet for \texttt{+} - de øvrige pakker fra \textbf{tidyverse} bruger \texttt{\%\textgreater{}\%}.
\item
  Glemte parentes: her har man glemt den sidste parentes: skal være \texttt{fill=Species))} og \textbf{ikke} \texttt{fill=Species)}. Man får bare en \texttt{+} fordi R forventer at du fortsætter med at skrive mere kode.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\SpecialCharTok{\textgreater{}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{fill=}\NormalTok{Species)}
\SpecialCharTok{+} 
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{fill} og \texttt{colour} - indenfor \texttt{aes()} refererer \texttt{fill} til at man fylder fk. bars eller regioner med farver, og \texttt{colour} referere til farven af linjer eller punkter.
\end{itemize}

\hypertarget{problemstillinger-2}{%
\section{Problemstillinger}\label{problemstillinger-2}}

\textbf{1)} Quiz på Absalon - det hedder \texttt{Quiz\ -\ ggplot2\ part\ 1}.

\emph{OBS: Husk at lave følgende øvelser i R Markdown. Det er god praksis at sikre, at jeres dokument knitter - i selve eksamen afleverer du et html dokument.}

\begin{itemize}
\tightlist
\item
  \emph{Lav et nyt R Markdown dokument og fjern de eksempel koder. Husk at oprette en ny chunk ved at trykke på ``Insert'' new chunk", eller bruge shortcut-kommandoen CMD+ALT+I eller CTRL+ALT+I. Jeg anbefaler, at I oprette en ny chunk for hver plot, I laver}.
\end{itemize}

Vi øver også med at lave de tre plot typer, med labeller og titler. Vi bruger datasættet der hedder \texttt{diamonds}. Huske at først indlæse de data:*

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(diamonds)}
\end{Highlighting}
\end{Shaded}

Her er beskrivelsen af \texttt{diamonds}:

\emph{Prices of over 50,000 round cut diamonds:} a dataset containing the prices and other attributes of almost 54,000 diamonds.

Se også ?diamonds for en beskrivelse af de variabler.

\textbf{2)} Bruge datasættet \texttt{diamonds} til at lave et scatter plot (\texttt{geom\_point()}):

\begin{itemize}
\tightlist
\item
  \texttt{caret} på x-aksen
\item
  \texttt{price} på y-aksen
\end{itemize}

Så at I har noget at sammenligne med, skal det se sådan ud:

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-140-1.pdf}

\textbf{3)} Tilføj nogle komponenter til dit plot fra 2).

\begin{itemize}
\tightlist
\item
  En x-akse label (\texttt{xlab()}) og en y-akse label (\texttt{ylab()})
\item
  En titel (\texttt{ggtitle()})
\item
  Et tema som hedder \texttt{theme\_bw()}
\item
  Huske at forbinde komponenterne med \texttt{+} og skrive de nye komponenter på deres egen linje.
\end{itemize}

Det skal se sådan ud:

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-141-1.pdf}

\textbf{4)} Ændre temaet til \texttt{theme\_classic()} eller \texttt{theme\_minimal()} i stedet for \texttt{theme\_bw()} og kig på resultatet.

Ekstra: Hvis man (måske ved uheld) skriver ind \textbf{to} temaer på samme tid (for eksempel \texttt{+\ theme\_bw()\ +\ theme\_classic()}) - hvilke tema får man så i plotten?

\emph{Valgfri ekstra: her er nogle flere tema man kan prøve: \url{https://ggplot2.tidyverse.org/reference/ggtheme.html}}

\textbf{5)} Lave det samme plot som i \textbf{4)}, med \texttt{color=color} indenfor \texttt{aes()}. Den første \texttt{color} refererer til punkt farver og den anden til en variable i datarammen der hedder \texttt{color}.

Det skal se sådan ud:
\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-142-1.pdf}

\textbf{6)} Bruge stadig \texttt{diamonds}, til at lave et boxplot:

\begin{itemize}
\tightlist
\item
  \texttt{cut} på x-aksen (giv x-aksen label \texttt{Cut})
\item
  \texttt{price} på y-aksen (giv y-aksen label \texttt{Price\ of\ diamond})
\item
  bruge \texttt{fill} til at give forskellige farver til de mulige værdier af \texttt{cut}.
\item
  bruge temaet \texttt{theme\_bw()}
\end{itemize}

Det skal se sådan ud:

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-143-1.pdf}

Ekstra: hvordan ser det ud, hvis man bruger \texttt{color} i stedet for \texttt{fill}?

\textbf{7)} Lav følgende ekstra ændringer til din boxplot fra ovenstående:

\begin{itemize}
\tightlist
\item
  Tilføj \texttt{geom\_jitter()} til din boxplot
\item
  fjern de legend (se notaterne).
\end{itemize}

Det skal se sådan ud:

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-144-1.pdf}

\emph{Ekstra 1}: man kan også prøve at forbedre plottet ved at give nogle indstillinger ind i \texttt{geom\_jitter()}, for eksempel kan man prøve \texttt{geom\_jitter(size=.2,color="grey",alpha=0.5)} for at gøre punkter mindre overbelastende i plottet (eller kan man bare fjerne dem).

Leg med de tre indstilling \texttt{size},\texttt{color} og \texttt{alpha} og ser på forskellen. Her er en note om \texttt{alpha}:

\emph{Alpha refers to the opacity of a geom. Values of alpha range from 0 to 1, with lower values corresponding to more transparent colors.} \url{https://ggplot2.tidyverse.org/reference/aes_colour_fill_alpha.html}

\emph{Ekstra 2}: Prøve også at skifte rækkefølgerne af \texttt{geom\_jitter()} og \texttt{geom\_boxplot()} i den plot kode og se - gøre det en forskel til hvordan plottet ser ud?

\textbf{8)}

Lave en bar plot med \texttt{stat="count"}:

\begin{itemize}
\tightlist
\item
  Variable \texttt{clarity} på x-aksen
\item
  Forskellige farver til den gruppe-variable \texttt{cut}
\item
  Specificerer \texttt{position="dodge"} for at få bars ved siden af hinanden
\item
  Tilføje et tema
\end{itemize}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-145-1.pdf}

\textbf{9)} Bare ekstra øvelse: Lege frit med at lave andre plots fra \texttt{diamonds} med ggplot2. Eksempelvis

\begin{itemize}
\tightlist
\item
  Boxplots med \texttt{carat} opdelte efter \texttt{clarity}
\item
  Barplots for de forskellige farver (variable \texttt{color})
\item
  Et scatter plot af \texttt{depth} vs \texttt{price}.
\end{itemize}

I alle tilfælde tilføje akse-labs, en titel, et tema osv.

\hypertarget{nuxe6ste-gang}{%
\section{Næste gang}\label{nuxe6ste-gang}}

Efter at have lavet de problemstillinger skal man kunne se, at der er rigtig meget fleksibilitet involveret med at lave et plot med \texttt{ggplot2}. I morgen går vi videre med andre plot typer, og hvordan man fk. sætte farver manuelt.

\hypertarget{visual2}{%
\chapter{Visualisering - ggplot2 dag 2}\label{visual2}}

\includegraphics[width=2.9in]{plots/ggplot2_logo}

\hypertarget{indledning-og-videoer}{%
\section{Indledning og videoer}\label{indledning-og-videoer}}

I dag udvider vi værktøjskassen af kommandoer i \textbf{ggplot2} for at tillade større fleksibilitet og appel i dine visualiseringer. Jeg anbefaler at du ser videoerne inden undervisningstimerne og bruger notaterne som en slags reference samtidig at du arbejder med problemstillingerne.

\hypertarget{luxe6ringsmuxe5lene}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene}}

I skal være i stand til at:

\begin{itemize}
\tightlist
\item
  Arbejde fleksibelt med koordinat systemer - transformering, modificering og flipping af x- og y-aksen.
\item
  Udvide brugen af farver og form.
\item
  Tilføje tekst direkte på plottet med \texttt{geom\_text()}.
\item
  Bruge \texttt{facet\_grid()} eller \texttt{facet\_wrap()} til at lave yderligere opdeling af plots.
\item
  Gemme dit færdigt plot i en fil.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2) }\CommentTok{\#husk}
\end{Highlighting}
\end{Shaded}

\hypertarget{video-ressourcer-1}{%
\subsection{Video ressourcer}\label{video-ressourcer-1}}

\begin{itemize}
\tightlist
\item
  Video 2: Koordinat systemer
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544201985}

\begin{itemize}
\tightlist
\item
  Video 3: Farver og punkt former
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544218153}

\begin{itemize}
\tightlist
\item
  Video 4: Labels - \texttt{geom\_text()} og \texttt{geom\_text\_repel()}
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/544226498}

\hypertarget{koordinat-systemer}{%
\section{Koordinat systemer}\label{koordinat-systemer}}

Her arbejder vi videre med koordinater i pakken \textbf{ggplot2}.

\hypertarget{zoom-puxe5-plottet-coord_cartesian}{%
\subsection{\texorpdfstring{Zoom på plottet (\texttt{coord\_cartesian()})}{Zoom på plottet (coord\_cartesian())}}\label{zoom-puxe5-plottet-coord_cartesian}}

Man kan bruge funktionen \texttt{coord\_cartesian()} til at zoome ind på et bestemt område i plottet. Indenfor \texttt{coord\_cartesian()} angiver man \texttt{xlim()} og \texttt{ylim()}, som specificerer de øvre og nedre grænser langt henholdsvis x-aksen og y-aksen. Man kan også bruge \texttt{xlim()} og \texttt{ylim()} udenom \texttt{coord\_cartesian()}, men i dette tilfælde bliver punkterne, som ikke kan ses i plottet (fordi deres koordinater ligger udenfor de angivne grænser), smidt væk, og så får man en advarsel. Med \texttt{coord\_cartesian()} beholder man til gengæld samtlige data, og man får således ikke en advarsel.

Her ses vores oprindeligt scatter plot:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Sepal.Width,}\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-151-1.pdf}

Og her bruger vi funktionen \texttt{coord\_cartesian()} med \texttt{xlim()} og \texttt{ylim()} indenfor til at zoome ind på et ønsket område på plottet.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Sepal.Width,}\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{coord\_cartesian}\NormalTok{(}\AttributeTok{xlim =} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{), }\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\FloatTok{2.2}\NormalTok{,}\FloatTok{4.5}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-152-1.pdf}

Hvis man har lyst til det kan man også zoome ud ved at bruge \texttt{expand\_limits()}. For eksempel hvis jeg gerne vil have punkterne \(x = 0\) og \(y = 0\) (\texttt{c(0,0)}, eller ``origin'') med på plottet:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width,}\AttributeTok{col=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{expand\_limits}\NormalTok{(}\AttributeTok{x =} \DecValTok{0}\NormalTok{, }\AttributeTok{y =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-153-1.pdf}

\hypertarget{transformering-af-akserne---log-sqrt-osv-scale_x_continuous.}{%
\subsection{\texorpdfstring{Transformering af akserne - log, sqrt osv (\texttt{scale\_x\_continuous}).}{Transformering af akserne - log, sqrt osv (scale\_x\_continuous).}}\label{transformering-af-akserne---log-sqrt-osv-scale_x_continuous.}}

Nogle gange kan det være svært at visualisere nogle variabler på grund af deres fordeling. Er der mange outliers i variablen så er de fleste punkter samlede i et lille område i plottet. Transformering med \texttt{log} and \texttt{sqrt} på x-aksen og y-aksen. Vi kan bruge disse til at transformere skaleringen på akserne, så de data kan ses på en mere informativ måde.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width,}\AttributeTok{col=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{trans =} \StringTok{"log2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{trans =} \StringTok{"log2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-154-1.pdf}

Man kan også prøve fk. ``sqrt'' i stedet for ``log2''. Formålet er, at hvis de data fordeler sig mere `normalt', kan man nemmere visualiser det i et plot - en måde til at gøre der er ved at transformere de data med ``sqrt'' eller ``log2''.

\hypertarget{flip-coordinates-coord_flip}{%
\subsection{\texorpdfstring{Flip coordinates (\texttt{coord\_flip})}{Flip coordinates (coord\_flip)}}\label{flip-coordinates-coord_flip}}

Vi kan bruge \texttt{coord\_flip()} til at spejler x-aksen på y-aksen og omvendt (det svarer til, at man drejer plottet ved 90 grader).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Sepal.Group defineret som i går}
\NormalTok{iris}\SpecialCharTok{$}\NormalTok{Sepal.Group }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length}\SpecialCharTok{\textgreater{}}\FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length),}\StringTok{"Long"}\NormalTok{,}\StringTok{"Short"}\NormalTok{)}

\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Sepal.Group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{,}\AttributeTok{position=}\StringTok{"dodge"}\NormalTok{,}\AttributeTok{color=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-155-1.pdf}

Man kan ændre på rækkefølgen af de tre \texttt{Species} ved at bruge funktionen \texttt{scale\_x\_discrete()} og angiver den nye rækkefølger med indstillingen \texttt{limits}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Sepal.Group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{,}\AttributeTok{position=}\StringTok{"dodge"}\NormalTok{,}\AttributeTok{color=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"virginica"}\NormalTok{, }\StringTok{"versicolor"}\NormalTok{,}\StringTok{"setosa"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-156-1.pdf}

\hypertarget{mere-om-farver-og-punkt-former}{%
\section{Mere om farver og punkt former}\label{mere-om-farver-og-punkt-former}}

Der er flere måder at specificere farver på i \texttt{ggplot2}. Man kan vælger den automatiske løsning, som er hurtigt (og effektiv i mange kontekster), eller kan man bruge den manuelt løsning (som kan tager lidt mere tid men er nyttige hvis man gerne vil lave et plot til at præsentere til andre.)

\hypertarget{automatisk-farver}{%
\subsection{Automatisk farver}\label{automatisk-farver}}

Man kan automatisk specificere at vi gerne vil have forskellige farver, ligesom vi gjorde i går med \texttt{colour=Species} indenfor \texttt{aes()} i \texttt{ggplot} funktion.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#automatisk løsning}
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width, }\AttributeTok{colour=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-157-1.pdf}

\hypertarget{farver-manuelt}{%
\subsection{Farver manuelt}\label{farver-manuelt}}

Hvis man foretrækker at specificere sine egne farver, kan man det ved at benytte \texttt{scale\_colour\_manual}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#manuelt løsning}
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width, }\AttributeTok{colour=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{scale\_colour\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\StringTok{"purple"}\NormalTok{, }\StringTok{"yellow"}\NormalTok{,}\StringTok{"pink"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-158-1.pdf}

Man kan også bruge farver fra \texttt{RColorBrewer}-pakken. Pakken indeholder mange forskellige ``colour palettes'', som er gruppe af farver som passer godt med hinanden, så at man kan slipper for at vælge den bedste kombination af farver til deres plot. De palettes tager også i betragtning, fk. hvis man er farveblind, eller om man vil have en farvegradient eller et sæt diskrete farver som ikke ligner hinanden.

Der er andre pakke som også har andre colour palettes som man kan bruge, som jeg anbefaler at I tjekke ud på Google hvis interesseret.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("RColorBrewer")}
\FunctionTok{library}\NormalTok{(RColorBrewer)}

\CommentTok{\#manuelt løsning}
\FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length, }\AttributeTok{y=}\NormalTok{Sepal.Width, }\AttributeTok{colour=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette=}\StringTok{"Set1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-159-1.pdf}

Bemærk, at \texttt{scale\_color\_brewer()} eller \texttt{scale\_color\_maual()} sætte farver af punkt og linjer, mens i en boxplot eller barplot sammenhænge, ligesom man specificerede \texttt{fill=Species} indenfor \texttt{aes()}, bruger man \texttt{scale\_fill\_manual()} eller \texttt{scale\_fill\_brewer()} i tilfældet af RColourBrewer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{y=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette=}\StringTok{"Set2"}\NormalTok{)  }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-160-1.pdf}

Her er en tabel over de fire funktioner.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
fuktion & beskrivelse \\
\midrule
\endhead
\texttt{scale\_fill\_manual(values=c("firebrick3","blue"))} & manuelle farver til boxplots og barplots osv. \\
\texttt{scale\_color\_maual(values=c("darkorchid","cyan4"))} & manulle farver til punkter og linjer osv. \\
\texttt{scale\_fill\_brewer(palette="Dark2")} & \texttt{RColourBrewer} løsning til boxplots/barplots/osv. \\
\texttt{scale\_color\_brewer(palette="Set1")} & \texttt{RColourBrewer} løsning til punkter og linjer osv. \\
\bottomrule
\end{longtable}

Der er også andre, for eksempel for continuous scala kan man google efter \texttt{scale\_fill\_gradient}.

\textbf{\emph{Farver i RColourBrewer}}

Bare som reference for de forskellige farver tilgængelige i pakken \texttt{RColourBrewer}.

\begin{figure}
\centering
\includegraphics{plots/rcolorbrewer.png}
\caption{Mulige colour palettes tilgængelige i RColourBrewer}
\end{figure}

\hypertarget{punkt-former}{%
\subsection{Punkt former}\label{punkt-former}}

Ligesom man kan lave forskellige farver, kan man også lave forskellige punkt former.

Vi starter med den automatiske løsning ligesom vi gjorde med farver. Når det er en variable vi specificer, skal vi skrive indenfor aes(). Her, da \texttt{shape} er en parameter som er meget specifik til \texttt{geom\_point}, her vælger vi at sætte den indenfor en ny \texttt{aes()} indenfor \texttt{geom\_point()} i stedet for indenfor \texttt{ggplot()}. Husk, at i funktionen \texttt{ggplot()} specificerer vi globale ting som gælder for hele plot, og i funktionen \texttt{geom\_pont()} ting som gælder kun for \texttt{geom\_point()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Sepal.Width)) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette=}\StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{shape=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-161-1.pdf}
Så har vi fået en kombination af båre forskellige farver og punkter til hver \texttt{Species}.

\textbf{\emph{Sætte punkte former manuelt}}

Hvis vi ikke kan lide de tre punkt former vi få automatisk, kan vi ændre dem ved at bruge \texttt{scale\_shape\_manual} - her vælger jeg \texttt{values=c(1,2,3)}, men der er en reference nedenunder, hvor I kan se, de mappings mellem de numeriske tal og de punkt former, så at I kan vælger jeres egne.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Sepal.Length, }\AttributeTok{y =}\NormalTok{ Sepal.Width, }\AttributeTok{colour=}\NormalTok{Species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{shape=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette=}\StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_shape\_manual}\NormalTok{(}\AttributeTok{values=}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-162-1.pdf}

\textbf{\emph{Reference for punkt former}}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-163-1.pdf}

\hypertarget{annotations}{%
\section{Annotations}\label{annotations}}

\hypertarget{tilfuxf8je-labeller-direkte-puxe5-plottet.}{%
\subsection{Tilføje labeller direkte på plottet.}\label{tilfuxf8je-labeller-direkte-puxe5-plottet.}}

Man kan bruge \texttt{geom\_text()} til at tilføje tekst på punkterne direkte på plottet. Her skal man fortælle, hvad for nogle tekst skal være på plottet - her specificerer vi navne på biler fra datasættet \texttt{mtcars}. Plottet er en scatter plot mellem variabler \texttt{mpg} og \texttt{wt}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(mtcars)}

\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-164-1.pdf}

For at gøre det nemmere at læse kan man også fjerne de punkter:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \CommentTok{\#geom\_point() +}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-165-1.pdf}

Teksten på plottet er stadig meget svært at læse. En god løsning kan være at bruge R-pakken \texttt{ggrepel}.

\hypertarget{pakken-ggrepel-for-at-tilfuxf8je-tekst-labeller}{%
\subsection{\texorpdfstring{Pakken \texttt{ggrepel} for at tilføje tekst labeller}{Pakken ggrepel for at tilføje tekst labeller}}\label{pakken-ggrepel-for-at-tilfuxf8je-tekst-labeller}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages(ggrepel) \#installere hvis nødvendeigt}
\end{Highlighting}
\end{Shaded}

For at anvende pakken \texttt{ggrepel} for det \texttt{mtcars} datasæt. Man erstatter bare \texttt{geom\_text()} med \texttt{geom\_text\_repel()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 9 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-167-1.pdf}

Så kan vi se, at nu er der ingen navne som sidder lige overfor hinanden, fordi ggrepel har været dygtig til at placerer dem tæt på deres punkter med ikke ovenpå hinanden. Man kan også se her at der er nogle punkter, hvor funktionen har tilføjet en linje her for at gøre det klart, de punkt teksten referer til.

Man kan se, at vi fik en advarsel her. Så vi kan prøve hvad vi er blevet bedt om her, og fortæl, at vi vil have max.overlaps måske 20.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars),}\AttributeTok{max.overlaps =} \DecValTok{20}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-168-1.pdf}

Så vi kan se, at vi ikke længere få en advarsel, og vi har tekst for alle vores punkter her.

\hypertarget{tilfuxf8je-rektangler-i-regioner-af-interesse-annotate}{%
\subsection{\texorpdfstring{Tilføje rektangler i regioner af interesse (\texttt{annotate})}{Tilføje rektangler i regioner af interesse (annotate)}}\label{tilfuxf8je-rektangler-i-regioner-af-interesse-annotate}}

Ekstra: hvis man gerne vil fremhæv en bestemt region i plottet, kan man prøve \texttt{annotate}. Prøve at selv regne ud, hvad de muligheden indenfor \texttt{annotate} gå ud på.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars)) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"rect"}\NormalTok{,}\AttributeTok{xmin=}\DecValTok{18}\NormalTok{,}\AttributeTok{xmax=}\DecValTok{23}\NormalTok{,}\AttributeTok{ymin=}\FloatTok{2.5}\NormalTok{,}\AttributeTok{ymax=}\DecValTok{3}\NormalTok{,}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{,}\AttributeTok{fill=}\StringTok{"orange"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 9 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-169-1.pdf}

Man kan også tilføje nogle tekst på en bestemt lokation med \texttt{annotate}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(mtcars,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{mpg,}\AttributeTok{y=}\NormalTok{wt)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\AttributeTok{label=}\FunctionTok{row.names}\NormalTok{(mtcars)) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"rect"}\NormalTok{,}\AttributeTok{xmin=}\DecValTok{18}\NormalTok{,}\AttributeTok{xmax=}\DecValTok{23}\NormalTok{,}\AttributeTok{ymin=}\FloatTok{2.5}\NormalTok{,}\AttributeTok{ymax=}\DecValTok{3}\NormalTok{,}\AttributeTok{alpha=}\FloatTok{0.2}\NormalTok{,}\AttributeTok{fill=}\StringTok{"orange"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{,}\AttributeTok{x=}\DecValTok{25}\NormalTok{,}\AttributeTok{y=}\FloatTok{2.75}\NormalTok{,}\AttributeTok{label=}\StringTok{"Cars of interest"}\NormalTok{,}\AttributeTok{col=}\StringTok{"orange"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: ggrepel: 9 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-170-1.pdf}

\hypertarget{opdele-plots-facet_gridfacet_wrap}{%
\section{\texorpdfstring{Opdele plots (\texttt{facet\_grid}/\texttt{facet\_wrap})}{Opdele plots (facet\_grid/facet\_wrap)}}\label{opdele-plots-facet_gridfacet_wrap}}

En stor fordele af at bruge \texttt{ggplot} er evne til at lave en \texttt{facet\_grid} til at adskille grupperne i en variable over separate plotter. For eksempel:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-171-1.pdf}

bliver (ligger mærke til \texttt{\textasciitilde{}} her, som betyder at vi gerne vil opdele efter \texttt{Species}):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Length,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{Species) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-172-1.pdf}

Vi leger lidt videre med \texttt{facet\_grid()} i problemstillinger nedenfor.

\hypertarget{problemstillinger-3}{%
\section{Problemstillinger}\label{problemstillinger-3}}

\textbf{1}) Lave quiz - ``Quiz - ggplot2 part 2''

Vi arbejder med \texttt{Palmer\ Penguins}.

Data beskrivelse: \emph{The palmerpenguins data contains size measurements for three penguin species observed on three islands in the Palmer Archipelago, Antarctica.}

\includegraphics[width=0.2\linewidth]{plots/palmerpenguins}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("palmerpenguins") \#køre hvis ikke allerede installeret}
\FunctionTok{library}\NormalTok{(palmerpenguins)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{head}\NormalTok{(penguins)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE # A tibble: 6 x 8
FALSE   species island bill_length_mm bill_depth_mm flipper_length_~ body_mass_g sex  
FALSE   <fct>   <fct>           <dbl>         <dbl>            <int>       <int> <fct>
FALSE 1 Adelie  Torge~           39.1          18.7              181        3750 male 
FALSE 2 Adelie  Torge~           39.5          17.4              186        3800 fema~
FALSE 3 Adelie  Torge~           40.3          18                195        3250 fema~
FALSE 4 Adelie  Torge~           NA            NA                 NA          NA <NA> 
FALSE 5 Adelie  Torge~           36.7          19.3              193        3450 fema~
FALSE 6 Adelie  Torge~           39.3          20.6              190        3650 male 
FALSE # ... with 1 more variable: year <int>
\end{verbatim}

Man kan bruge \texttt{?penguins} for at se flere detaljer om variable navner.

\emph{I skal starte med at rydde op lidt med datasættet. Køre følgende for at fjerne række som har NA værdier:}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins }\OtherTok{\textless{}{-}} \FunctionTok{drop\_na}\NormalTok{(penguins)}
\end{Highlighting}
\end{Shaded}

\textbf{2}) \emph{Histogram}

Lave en histogram:

\begin{itemize}
\tightlist
\item
  \texttt{flipper\_length\_mm} på x-aksen
\item
  brug \texttt{fill} til at opdele efter \texttt{species}
\item
  specificer sort linjer omkring de bars, så man mere tydeligt kan se dem
\item
  specificer hensigtsmæssige tekst (akserne, titel) og et tema
\end{itemize}

I få en advarsel: \emph{\texttt{stat\_bin()} using \texttt{bins\ =\ 30}. Pick better value with \texttt{binwidth}.}

\begin{itemize}
\tightlist
\item
  Prøve at ændre indstillingen \texttt{bins} til noget andet indenfor \texttt{geom\_histogram()}.
\end{itemize}

Det skal ser sådan ud:

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-176-1.pdf}

\textbf{3}) \emph{Density plots og introduktion til facet\_grid()}

\textbf{a)} Lave et density plot af \texttt{body\_mass\_g}.

\begin{itemize}
\tightlist
\item
  Bruge \texttt{fill} til at opdele efter \texttt{sex}
\item
  Gøre dine density plots gennemsigtige
\item
  Skrive en sætning om forskellen i \texttt{body\_mass\_g} mellem females og males.
\item
  Hvorfor tror du, at de densities har flere topper?
\end{itemize}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-177-1.pdf}

\textbf{b)} Vi vil gerne adskille vores densities yderligere, efter \texttt{species}.

\begin{itemize}
\tightlist
\item
  Nu tilføj linjen \texttt{facet\_grid(\textasciitilde{}species)} til dit plot og opdag, hvad der sker.
\item
  Skriv endnu en sætning, som beskriver forskellen i \texttt{body\_mass\_g} mellem de to køn over de tre \texttt{species}.
\end{itemize}

\textbf{4}) \emph{Manuelt farver og punkter} \textbf{a}) Lave en scatter plot med \texttt{ggplot}:

\begin{itemize}
\tightlist
\item
  \texttt{bill\_length\_mm} på x-aksen
\item
  \texttt{bill\_depth\_mm} på y-aksen
\item
  give hver \texttt{species} sin egen farve (automatisk)
\item
  sætte et tema
\end{itemize}

\textbf{b}) Lav følgende ændringer til det plot:

\begin{itemize}
\tightlist
\item
  Ændre farver manuelt - prøve både at angive farver med \texttt{scale\_color\_manual} og afprøve også løsningen med pakken \texttt{RColorBrewer} (husk at installere/indlæse pakken hvis nødvendigt).
\item
  Angiv at der skal være forskellige punkt former for hver \texttt{species}.
\item
  Prøv at vælge nogle punkt former fra listen og specificer dem manuelt.
\end{itemize}

\begin{figure}
\centering
\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-180-1.pdf}
\caption{\label{fig:unnamed-chunk-180}Min løsning}
\end{figure}

\textbf{5}) \emph{Coordinate systemer}

Tag overstående scatter plot fra \textbf{4}) og

\begin{itemize}
\tightlist
\item
  bruge \texttt{coord\_cartesian()} så at man fanger kun en bill længde mellem 40 og 50, og en bill depth mellem 16 og 19.\\
\item
  som ekstra afprøve pakken \texttt{ggrepel} (husk at installere/inlæse) ved at tilføje de navne af de forskellige øer som labels direkte på plottet (valfrig opfordring: man kan lave en subset af de data og specificere det indenfor den relevant \texttt{ggrepl} funktion, for at undgå, at de labels bliver plottet for punkterne udenfor området angivet med \texttt{coord\_cartesian()}).
\end{itemize}

\begin{figure}
\centering
\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-181-1.pdf}
\caption{\label{fig:unnamed-chunk-181}Min løsning}
\end{figure}

\textbf{6}) \emph{Coordinate systemer}

Lave en bar plot af counts for \texttt{species} opdelte efter \texttt{sex}.

\begin{itemize}
\tightlist
\item
  Anvende en `coordinate flip' for at få den til at være horizontal.
\item
  Vælge nogle manuelt farver.
\item
  Vælge et tema som I godt kan lide.
\end{itemize}

\begin{figure}
\centering
\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-182-1.pdf}
\caption{\label{fig:unnamed-chunk-182}Min løsning}
\end{figure}

\begin{itemize}
\tightlist
\item
  I vil have at de tre arter få rækkefølgen, således at den \texttt{species} med de meste observationer er på toppen og den \texttt{species} med den færrest er på bunden. Ændre rækkefølgen af de tre \texttt{species}.
\item
  Prøve også \texttt{scale\_y\_reverse()} og kig på resultatet.
\end{itemize}

\textbf{7}) Lave boxplots af \texttt{body\_mass\_g} opdelte efter \texttt{species}.

\begin{itemize}
\item
  Tilføj punkter ovenpå.
\item
  Specificere nogle farver manuelt for de boxes.
\item
  Giv det en hensigtsmæssig titel og nogle akser-labels
\item
  Adskille plotterne ved at opdele efter de forskellige \texttt{islands}.
\item
  Ekstra: skrive en sætning om \texttt{body\_mass\_g} ser forskellige ud for \texttt{Adelie} over de tre \texttt{islands}.
\item
  Ekstra: udforsk \texttt{?geom\_violin} som erstatning for \texttt{geom\_boxplot}.
\end{itemize}

\textbf{8}) \emph{Annotations}. \textbf{a}) Lav et scatter plot af \texttt{bill\_length\_mm} vs \texttt{bill\_depth\_mm}.

\begin{itemize}
\tightlist
\item
  Anvend hensigtsmæssigt titel/labels/tema
\item
  Anvend forskellige farver for de tre \texttt{species}.
\item
  Tjekke funktionen \texttt{?annotate} og bruge den med \texttt{geom="text"} og hensigtsmæssigt x- og y-akse værdier til at tilføje \texttt{species} navne som tekst direkte på plottet (se eksempel nedenfor for at se, hvad jeg mener).
\item
  Udforske hvordan man gøre teksten større, som jeg har gjorte i men løsning.
\item
  Fjerne den legend med \texttt{show.legend\ =\ FALSE} indenfor \texttt{geom\_point()}
\item
  Ekstra: bruge \texttt{annotate} igen til at lave et orange rektangel omkring alle de blå punkter (se kursusnotaterne).
\end{itemize}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-185-1.pdf}

\textbf{b}) Vi vil gerne tilføje noget lodrette og vandrette linjer til plottet som specificer de middelværdier af de tre fordelinger.

\begin{itemize}
\tightlist
\item
  Bruge \texttt{tapply} til at beregne de gennemsnitlige værdier for henholdsvis \texttt{bill\_length\_mm} og \texttt{bill\_depth\_mm} opdelte efter \texttt{species}.
\item
  Lave en dataramme, med kolonner \texttt{species}, \texttt{mlength} og \texttt{mdepth}, hvor \texttt{mlength} og \texttt{mdepth} er dine middelværdier for henholdsvis \texttt{bill\_length\_mm} og \texttt{bill\_depth\_mm}. Kalde det for \texttt{mydf}. Fk.
\end{itemize}

\begin{verbatim}
##        species  mlength   mdepth
## Adelie  Adelie 38.82397 18.34726
\end{verbatim}

\begin{itemize}
\tightlist
\item
  For de lodrette linjer anvende \texttt{geom\_vline()} og specificere din ny dataramme indenfor med \texttt{data=mydf}. Tilføj også \texttt{xintercept=mlength} og \texttt{colour=species} (husk at da \texttt{mlength} og \texttt{species} er variabler fra \texttt{mydf} skal man bruge \texttt{aes()})\\
\item
  Tilføje de relevante vandrette linjer.
\item
  Specificer ``dashed'' linjer
\end{itemize}

Plotten skal ser sådan ud

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-187-1.pdf}

\textbf{9}) Valgfri: Lav et scatter plot og inddrag \texttt{?scale\_colour\_gradient2} (se fk. \url{https://michaeltoth.me/a-detailed-guide-to-ggplot-colors.html})

\hypertarget{workshop-opgave-obs-fredag}{%
\section{Workshop opgave (OBS Fredag)}\label{workshop-opgave-obs-fredag}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\item
  I uge arbejder vi direkte på en skabalon som jeg har lavet i rmarkdown. Filen hedder \texttt{markdown\_visualisering.Rmd} og er tilgængelige på Absalon.
\item
  Jeg kommer rundt i breakout rooms og tilbudde min støtte.
\item
  Derefter poster jeg mine løsninger på problemer, som du måske kan bruge til at tage noget ekstra videre til næste gang.
\item
  På mandag gå vi igennem nogle af de punkter som I havde meste svært ved.
\end{enumerate}

\hypertarget{ekstra-notat-gemme-dit-plot}{%
\section{Ekstra notat: gemme dit plot}\label{ekstra-notat-gemme-dit-plot}}

Her bruger vi R Markdown til at lave et rapport som indeholder vores plots, men det kan være at man gerne vil gemme sit plot som en fil på computeren. Til at gemme et plot kan man bruge kommandoen \texttt{ggsave()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggsave}\NormalTok{(myplot, }\StringTok{"myplot.pdf"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Figuren vil blive gemt i den \emph{working directory}. Filtypen \texttt{.pdf} kan erstattes med andre formater, for eksempel \texttt{.png} eller \texttt{jpeg} osv. Hvis man gerne vil tage sit plot og redigerer det videre (fk. Adobe Illustrater eller Inkscape), vil jeg anbefalder at I bruge \texttt{.pdf}.

Det kan være når man har gemt sit plot, vil man gerne ændre højden og bredden på plottet. Det kan man ændre med \texttt{width} og \texttt{height}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggsave}\NormalTok{(myplot, }\StringTok{"myplot.pdf"}\NormalTok{, }\AttributeTok{width =} \DecValTok{4}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ekstra-links-1}{%
\section{Ekstra links}\label{ekstra-links-1}}

ggthemes pakke:

\url{https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/}

\url{https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf}

R Graphics cookbook

\url{https://r-graphics.org/}

Bar charts

\url{https://www.r-graph-gallery.com/218-basic-barplots-with-ggplot2.html}

\hypertarget{slut-for-ugen-1}{%
\section{Slut for ugen}\label{slut-for-ugen-1}}

Nærværende kapitel har givet en introduktion til nogle af de grundlæggende elementer i, hvordan man visualiserer datarammer med \texttt{ggplot2}-pakken i \texttt{R}.

Næste uge begynder vi med R-pakken tidyverse.

\hypertarget{data}{%
\chapter{Bearbejdning dag 1}\label{data}}

\includegraphics[width=0.15\linewidth]{plots/hex-tidyverse}

\hypertarget{inledning-og-luxe6ringsmuxe5lene}{%
\section{Inledning og læringsmålene}\label{inledning-og-luxe6ringsmuxe5lene}}

I skal være i stand til at:

\begin{itemize}
\tightlist
\item
  Beskrive generelle hvad R-pakken \texttt{Tidyverse} kan benyttes til.
\item
  Beskrive en tibble og genkende når et datasæt er betragtet som ``tidy''.
\item
  Benytte nogle vigtige \texttt{Tidyverse}-verbs til at bearbejde data (\texttt{filter()},\texttt{select()}, \texttt{mutate()}, \texttt{rename()}, \texttt{arrange()}, \texttt{recode()}).
\item
  Bruge \texttt{\%\textgreater{}\%} til at forbinde \texttt{Tidyverse}-verber sammen og at overføre data til et plot.
\end{itemize}

\hypertarget{video-ressourcer-2}{%
\section{Video ressourcer}\label{video-ressourcer-2}}

\begin{itemize}
\tightlist
\item
  Video 1 - introduktion til uge, hvad er den \texttt{tidyverse}-pakke? Hvad er en tibble?
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/547107062}

\begin{itemize}
\tightlist
\item
  Video 2 - rydder op den titanic datasæt med \texttt{select()} og \texttt{drop\_na()}
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910795}

\begin{itemize}
\tightlist
\item
  Video 3 - introduktion til \texttt{\%\textgreater{}\%}
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910781}

\begin{itemize}
\tightlist
\item
  Video 4 - \texttt{tidyverse} verber: \texttt{select} og \texttt{filter}
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910758}

\begin{itemize}
\tightlist
\item
  Video 5 - \texttt{tidyverse} verber: \texttt{mutate} og \texttt{arrange}
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910712}

\hypertarget{hvad-er-tidyverse}{%
\section{Hvad er Tidyverse?}\label{hvad-er-tidyverse}}

\textbf{Tidyverse} er en samling af pakker i R, som man bruger til at bearbejde datasæt. Formålet er ikke nødvendigvis at erstatte funktionaliteten af base-pakken, men til at bygge på den. Som vi kommer til at se i detaljer, \textbf{tidyverse} deler faktisk meget af den samme tankegang bag \textbf{ggplot2} - men i stedet for at bruge \texttt{+} til at bygge komponenter op i et plot, bruger man \texttt{\%\textgreater{}\%} (udtales `pipe') til at tilknytte de forskellige funktioner til hinanden.

\begin{figure}
\centering
\includegraphics[width=0.45\textwidth,height=\textheight]{plots/tidyverse2_packages.png}
\caption{Most common tidyverse packages}
\end{figure}

Lad os starte med at indlæse pakken \textbf{tidyverse}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("tidyverse)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

Du kan se, at det faktisk er ikke kun én, men otte pakker som blev indlæst. Her er nogle beskrivelser af pakkerne:

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
pakke & korte beskrivelse \\
\midrule
\endhead
\texttt{readr} & indlæse data \\
\texttt{ggplot2} & plot data \\
\texttt{tibble} & lave ``tibbles'' - \textbf{\emph{tidyverse}}'s svar på datarammer (data.frame). \\
\texttt{tidyr} & skifte imellem data forms (fk. `long' \textgreater{} `wide' format, eller omvendt) \\
\texttt{purrr} & for functional programming. \\
\texttt{dplyr} & manipulere tibbles (eller datarammer) - skabe nye variable, beregne oversigtsstatistikker osv. \\
\texttt{stringr} & manipulere strings \\
\texttt{forcats} & FOR CATegorical data (factors); this makes it easier to reorder and rename the levels in factor variables. \\
\bottomrule
\end{longtable}

Man kan også indlæse alle pakke individuelt ved at bruge fk. \texttt{library(dplyr)}, men det er meget bekvemt bare at indlæse alle på samme tid med brugen af \texttt{library(tidyverse)}.

\hypertarget{princippen-med-tidy-data}{%
\subsection{Princippen med `tidy data'}\label{princippen-med-tidy-data}}

Idéen bag \textbf{tidyverse} er, at hvis alle datasæt følger præcis den samme struktur, så er det ligefrem at bearbejde med vores data, til præcis som vi gerne vil have det. Datasæt som har den struktur hedder ``tidy data''. For at betragte et datasæt som ``tidy'', må det opfylde tre kriterie:

\begin{itemize}
\tightlist
\item
  Hver variabel i datasættet har sin egen kolonne
\item
  Hver observation i datasættet har sin egen række
\item
  Hver værdi i datasættet få sin egen cell
\end{itemize}

Iris er et godt eksempel af \textbf{tidy data}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}
\FunctionTok{head}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
\end{verbatim}

Hver variabel (\texttt{Sepal.Length}, \texttt{Sepal.Width}, \texttt{Petal.Length}, \texttt{Petal.Width} og \texttt{Species}) har sin egen kolon, og hver observation (e.g.~1,2,3, osv.) har sin egen række. Derudover har hver cell sin egen data værdi og det er dermed meget klart at læse og forstå dataframen ved øjnene.

\begin{figure}
\centering
\includegraphics[width=1\textwidth,height=\textheight]{plots/tidy-1.png}
\caption{Principper af tidy data}
\end{figure}

Det er tilfældet, at de fleste af datasæt i dette kursus hører til ``tidy data'', især i disse notater, hvor vi benytter en del af indbygget datasæt. Nogle gange kan det dog være, at vi er nødt til at gøre noget, til at lave et datasæt om til en ``tidy datasæt''. R-pakker \textbf{dplyr} og \textbf{tidyr} er velegnet til at hjælpe med at transformere et datasæt til en, der er ``tidy'', og bagefter kan man forsætte i den sædvanlige måde med at analyse datasættet. Bemærk dog, at bar fordi et datasæt er ``tidy'', betyder det ikke nødvendigvis, at det er klart til at analysere, for der kan godt være, at man har bruge for at filtrere eller rydde op i det. Pakken \textbf{dplyr} indeholder mange funktioner til at håndtere

\hypertarget{lidt-om-tibbles}{%
\section{\texorpdfstring{Lidt om \texttt{tibbles}}{Lidt om tibbles}}\label{lidt-om-tibbles}}

En \texttt{tibble} er det \texttt{tidyverse} svar på en \texttt{data.frame} fra base-R. De ligner hinanden meget og derfor skal man ikke tænk for meget over forskellen, men der er nogle opdateret aspekter i en \texttt{tibble} - for eksempel bruger en \texttt{tibble} ikke \texttt{row.names}, og når man visualiserer en \texttt{tibble} i R Markdown, få man lidt ekstra oplysninger, såsom dimensioner og data typer.

Man kan lave sin egen \texttt{tibble} på samme måde som en \texttt{data.frame}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{,}\AttributeTok{y=}\FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{,}\StringTok{"b"}\NormalTok{,}\StringTok{"c"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##       x y    
##   <int> <chr>
## 1     1 a    
## 2     2 b    
## 3     3 c
\end{verbatim}

Man kan også lave en \texttt{tribble}, som er den samme som en \texttt{tibble} men har en lidt anderledes måde at indsætte data på. For eksempel er følgende tilsvarende til den overstående tibble:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tribble}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{x, }\SpecialCharTok{\textasciitilde{}}\NormalTok{y,}
       \DecValTok{1}\NormalTok{, }\StringTok{"a"}\NormalTok{,}
       \DecValTok{2}\NormalTok{, }\StringTok{"b"}\NormalTok{,}
       \DecValTok{3}\NormalTok{, }\StringTok{"c"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##       x y    
##   <dbl> <chr>
## 1     1 a    
## 2     2 b    
## 3     3 c
\end{verbatim}

Den fleste \texttt{tidyverse} kode fungerer lige så godt uanset om man har en \texttt{tibble} eller en \texttt{data.frame}.

Man kan lave en \texttt{data.frame} om til en \texttt{tibble} som i følgende:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as\_tibble}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           <dbl>       <dbl>        <dbl>       <dbl> <fct>  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # ... with 140 more rows
\end{verbatim}

\hypertarget{transition-fra-base-til-tidyverse}{%
\section{Transition fra base til tidyverse}\label{transition-fra-base-til-tidyverse}}

Jeg introducerer \textbf{tidyverse} gennem et meget berømt datasæt som hedder \textbf{titanic} - det er ikke biologiske data men er stadigvæk ret interessent, og sjovt at manipulere.

\textbf{titanic} er brugt som en del af en åben konkurrence på kaggle, hvor mindst 31.000 mennesker indtil videre har arbejdet på at lave den bedste maskinlærings model til at forudsige, hvem der overlever katastrofen - linket er her, hvor du kan også læse noget om den baggrund til datasættet \url{https://www.kaggle.com/c/titanic}.

\hypertarget{om-titanic-datasuxe6t}{%
\subsection{\texorpdfstring{Om \textbf{Titanic} datasæt}{Om Titanic datasæt}}\label{om-titanic-datasuxe6t}}

Man kan godt downloade datasættet, der hedder \texttt{titanic\_train}, direkte fra Kaggle, men der faktisk er en R-pakke, som gøre det mere bekvemt:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#install.packages("titanic") \#hvis ikke allerede installerede}
\FunctionTok{library}\NormalTok{(titanic)}
\end{Highlighting}
\end{Shaded}

Beskrivelsen for pakken:

\emph{\textbf{titanic} is an R package containing data sets providing information on the fate of passengers on the fatal maiden voyage of the ocean liner ``Titanic'', summarized according to economic status (class), sex, age and survival. These data sets are often used as an introduction to machine learning on Kaggle.}

Vi vil gerne bruge datasættet der hedder \texttt{titanic\_train} - det hedder det fordi det bliver brugt i Kaggle til at train maskinelærings modeller (som bliver testet på \texttt{titanic\_test} for at evaluere, hvor god modellen er).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(titanic\_train)}
\FunctionTok{head}\NormalTok{(titanic)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 12
##   PassengerId Survived Pclass Name    Sex     Age SibSp Parch Ticket  Fare Cabin
##         <int>    <int>  <int> <chr>   <chr> <dbl> <int> <int> <chr>  <dbl> <chr>
## 1           1        0      3 Braund~ male     22     1     0 A/5 2~  7.25 ""   
## 2           2        1      1 Cuming~ fema~    38     1     0 PC 17~ 71.3  "C85"
## 3           3        1      3 Heikki~ fema~    26     0     0 STON/~  7.92 ""   
## 4           4        1      1 Futrel~ fema~    35     1     0 113803 53.1  "C12~
## 5           5        0      3 Allen,~ male     35     0     0 373450  8.05 ""   
## 6           6        0      3 Moran,~ male     NA     0     0 330877  8.46 ""   
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Jeg har også kopieret de variable beskrivelser her:

\begin{itemize}
\tightlist
\item
  PassengerId: unique index for each passenger
\item
  Survived: Whether or not the passenger survived. 0 = No, 1 = Yes.
\item
  Pclass: Ticket class: 1 = 1st Class, 2 = 2nd Class, 3 = 3rd Class.
\item
  Name: A character string containing the name of each passenger.
\item
  Sex: Character strings for passenger sex (``male''/ ``female'').
\item
  Age: Age in years.
\item
  SibSp: The number of siblings/spouses aboard the titanic with the passenger
\item
  Parch: The number of parents/children aboard the titanic with the passenger
\item
  Ticket: Another character string containing the ticket ID of the passenger.
\item
  Fare: The price paid for tickets in pounds Sterling (Keep in mind that unskilled workers made around 1 pound a week - these were expensive tickets!)
\item
  Cabin: The cabin number of the passengers (character).
\item
  Embarked: Where passengers boarded the titanic. C = Cherbourg, Q = Queenstown, S = Southampton).
\end{itemize}

\hypertarget{titanic-lidt-oprydning}{%
\subsection{Titanic: lidt oprydning}\label{titanic-lidt-oprydning}}

Der er faktisk nogle rengøring i datasættet vi skal tage os af, før vi gøre noget videre. Lad os lige tjekke hvor mange observationer vi har i datasættet:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(titanic)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 891
\end{verbatim}

For det første, har det fleste (687) passagerer ingenting for variabel \texttt{cabin}, og andre har mere end en cabin alloceret:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(titanic}\SpecialCharTok{$}\NormalTok{Cabin)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{40}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##                             A10             A14             A16             A19 
##             687               1               1               1               1 
##             A20             A23             A24             A26             A31 
##               1               1               1               1               1 
##             A32             A34             A36              A5              A6 
##               1               1               1               1               1 
##              A7            B101            B102             B18             B19 
##               1               1               1               2               1 
##             B20             B22             B28              B3             B30 
##               2               2               2               1               1 
##             B35             B37             B38             B39              B4 
##               2               1               1               1               1 
##             B41             B42             B49              B5             B50 
##               1               1               2               2               1 
##     B51 B53 B55 B57 B59 B63 B66         B58 B60             B69             B71 
##               2               2               2               1               1
\end{verbatim}

Det ser ikke særlig \textbf{tidy} ud, og man kan hellere ikke forestille sig at lave en fornuftig analyse fra den. Vi vælger derfor bare at fjerne hele kolon med funktionen \texttt{select()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_no\_cabin }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(titanic, }\SpecialCharTok{{-}}\NormalTok{Cabin) }
\end{Highlighting}
\end{Shaded}

\texttt{select()} er en af de core funktioner man bruger i \textbf{tidyverse} - her angiver vi, hvilke kolonner vi gerne vil beholde eller fjerne fra datasættet. I dette tilfælde har vi specificeret \texttt{-Cabin}, som betyder, at vi \emph{ikke} vil have kolonen der hedder \texttt{Cabin} med, men gerne vil beholde resten af kolonnerne. Prøv at køre \texttt{select(titanic,\ Cabin)} i stedet for - så får vi kun \texttt{Cabin} og fjerner resten af vores variable.

Næste kan vi tjekke for \texttt{NA} i datasættet. Man kan se, at \texttt{Age} faktisk har 177 \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colSums}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(titanic\_no\_cabin))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## PassengerId    Survived      Pclass        Name         Sex         Age 
##           0           0           0           0           0         177 
##       SibSp       Parch      Ticket        Fare    Embarked 
##           0           0           0           0           0
\end{verbatim}

Vi kan vælge at fjerne alle passagerer som har \texttt{NA} i stedet for deres alder. Her kan vi bare bruge \texttt{drop\_na} som fjerner alle observationer, med \texttt{NA} i mindst èn variabel.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}} \FunctionTok{drop\_na}\NormalTok{(titanic\_no\_cabin)}
\FunctionTok{colSums}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(titanic\_clean))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## PassengerId    Survived      Pclass        Name         Sex         Age 
##           0           0           0           0           0           0 
##       SibSp       Parch      Ticket        Fare    Embarked 
##           0           0           0           0           0
\end{verbatim}

Nu kan vi tjekke igen, hvor mange observationer og variabel vi har tilbage.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(titanic\_clean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 714
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(titanic\_clean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11
\end{verbatim}

Vi har stadig 714 observationer og 11 kolonner, og vores datasæt opfylder kriteren for at være \textbf{tidy}.

\hypertarget{pipe}{%
\subsection{Pipe}\label{pipe}}

Man kan faktisk gøre den samme som i ovenstående ved at bruge pipe \texttt{\%\textgreater{}\%}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}}\NormalTok{ titanic }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# we take the titanic dataset}
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Cabin) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# select the bits we want}
    \FunctionTok{drop\_na}\NormalTok{() }\CommentTok{\# then remove the NAs}
\end{Highlighting}
\end{Shaded}

Man bruger pipe \%\textgreater\% til kat ombinere funktioner i samme kommando - linjen slutter med \texttt{\%\textgreater{}\%}, der fortæller, at vi skal bruge resultatet fra den linje som input i den næste linje. Logikken er således, at vi starter med en dataramme, og så dernæst gør én ting ad gangen.

Bemærk, at processen ligner den vi bruger i \textbf{ggplot2}, men forskellen er at man bruger \texttt{\%\textgreater{}\%} i stedet for \texttt{+} i denne ramme. Bemærk også her, at ligesom i \textbf{ggplot2}, skriver vi koden over flere linjer. Det er ikke et krav men det gøre det nemmere at læse og forstå koden.

For at illustrerer logikken, kan man se, at følgende to linjer er tilsvarende:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{f}\NormalTok{(x)}
\NormalTok{x }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ f}
\end{Highlighting}
\end{Shaded}

I tilfældet af \texttt{x\ \%\textgreater{}\%\ f} starter vi med \texttt{x}, og så anvender vi funktionen \texttt{f} med \texttt{x} som argument - det er den \textbf{tidyverse} løsning.

På sammen måde i vores titanic oprydning kan man både pakke funktionen \texttt{select()} ind i funktionen \texttt{drop\_na()}, eller bruge den \textbf{tidyverse} løsning, ligesom i nedenstående - de to giver det tilsvarende resultat: første bruger vi \texttt{select()} til at fjerne kolonnen \texttt{Cabin}, og så bruger vi \texttt{drop\_na()} til at fjerne alle række med mindste én \texttt{NA} (manglende værdi).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}} \FunctionTok{drop\_na}\NormalTok{(}\FunctionTok{select}\NormalTok{(titanic,}\SpecialCharTok{{-}}\NormalTok{Cabin))}

\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}}\NormalTok{ titanic }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Cabin) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{drop\_na}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

Vi kommer til at bruge den \textbf{tidyverse} løsning meget fremadrettet.

\hypertarget{bearbejdning-af-data-dplyr}{%
\section{\texorpdfstring{Bearbejdning af data: \texttt{dplyr}}{Bearbejdning af data: dplyr}}\label{bearbejdning-af-data-dplyr}}

Den meste nyttige pakke, der kan bruges til at bearbejde datarammer, er \texttt{dplyr}, som vi vil fokusere på i følgende sektioner.

\url{https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr) }\CommentTok{\#behøves ikke hvis pakken tidyverse allerede er indlæste}
\end{Highlighting}
\end{Shaded}

Pakken giver nogle basale funktioner, der gør det nemt at bearbejde datarammer (\texttt{data.frame} eller \texttt{tibble}).

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
dplyr verbs & Description \\
\midrule
\endhead
\texttt{select()} & udvælge kolonner (\emph{variable}) \\
\texttt{filter()} & udvælge rækker (\emph{observationer}) \\
\texttt{arrange()} & sortere rækker \\
\texttt{mutate()} & tilføje eller ændre eksisterende kolonner \\
\texttt{rename()} & ændre navne på kolonner \\
\texttt{group\_by()} & lave `split' operationer over en gruppe variabel, som forudsætning til \texttt{summarise()} \\
\texttt{summarise()} & aggregere rækker \\
\bottomrule
\end{longtable}

Med alle disse funktioner, at de tager man udgangspunkt i en dataramme, få man altid en ny dataramme som output. Ved at kunne bruge disse funktioner og kombinere dem (ved hjælp af \texttt{\%\textgreater{}\%}), har man godt styr på bearbejdningen af datarammer.

\hypertarget{dplyr-verbs-select}{%
\subsection{\texorpdfstring{dplyr verbs: \texttt{select()}}{dplyr verbs: select()}}\label{dplyr-verbs-select}}

Med \texttt{select()} vælger man bestemte \textbf{variabler}. Vi kan vælger at beholde, fjerne eller andre rækkefølgen af variablerne i datarammen.

Som eksempel, hvis vi kun skal bruge bestemte variabler i vores dataramme, eksempelvis \texttt{Name} og \texttt{Age}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Name, Age) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   Name                                                  Age
##   <chr>                                               <dbl>
## 1 Braund, Mr. Owen Harris                                22
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)    38
## 3 Heikkinen, Miss. Laina                                 26
## 4 Futrelle, Mrs. Jacques Heath (Lily May Peel)           35
## 5 Allen, Mr. William Henry                               35
## 6 McCarthy, Mr. Timothy J                                54
\end{verbatim}

Hvis vi gerne vil fjerne en variabel fra en dataramme, kan vi bruge en minus tegnet. I nedenstående fjerne vi \texttt{Name} og \texttt{Age} fra datarammen.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Name, }\SpecialCharTok{{-}}\NormalTok{Age) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 9
##   PassengerId Survived Pclass Sex    SibSp Parch Ticket            Fare Embarked
##         <int>    <int>  <int> <chr>  <int> <int> <chr>            <dbl> <chr>   
## 1           1        0      3 male       1     0 A/5 21171         7.25 S       
## 2           2        1      1 female     1     0 PC 17599         71.3  C       
## 3           3        1      3 female     0     0 STON/O2. 3101282  7.92 S       
## 4           4        1      1 female     1     0 113803           53.1  S       
## 5           5        0      3 male       0     0 373450            8.05 S       
## 6           7        0      1 male       0     0 17463            51.9  S
\end{verbatim}

\hypertarget{dplyr-verbs-filter}{%
\subsection{\texorpdfstring{dplyr verbs: \texttt{filter()}}{dplyr verbs: filter()}}\label{dplyr-verbs-filter}}

Husk, at med \texttt{select()} vælger man bestemte \textbf{variabler}. Man anvender \texttt{filter()} til at vælge bestemte observationer (rækker) fra datarammen. I nedenstående tager vi kun rækkerne fra datarammen \texttt{titanic\_clean}, hvor kolonnen \texttt{Age} er lig med 50. Bemærk, at vi bevarer alle kolonner i datarammen, og at det kun er rækkerene der bliver udvalgt.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Age }\SpecialCharTok{==} \DecValTok{50}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name         Sex     Age SibSp Parch Ticket   Fare
##         <int>    <int>  <int> <chr>        <chr> <dbl> <int> <int> <chr>   <dbl>
## 1         178        0      1 Isham, Miss~ fema~    50     0     0 PC 17~  28.7 
## 2         260        1      2 Parrish, Mr~ fema~    50     0     1 230433  26   
## 3         300        1      1 Baxter, Mrs~ fema~    50     0     1 PC 17~ 248.  
## 4         435        0      1 Silvey, Mr.~ male     50     1     0 13507   55.9 
## 5         459        1      2 Toomey, Mis~ fema~    50     0     0 F.C.C~  10.5 
## 6         483        0      3 Rouse, Mr. ~ male     50     0     0 A/5 3~   8.05
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Man kan også vælge intervaller - for eksempel hvis man vil vælge alle som er i halvtredserne.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(Age }\SpecialCharTok{\textgreater{}=} \DecValTok{50} \SpecialCharTok{\&}\NormalTok{ Age }\SpecialCharTok{\textless{}} \DecValTok{60}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex     Age SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1           7        0      1 "McCarthy, M~ male     54     0     0 17463  51.9 
## 2          12        1      1 "Bonnell, Mi~ fema~    58     0     0 113783 26.6 
## 3          16        1      2 "Hewlett, Mr~ fema~    55     0     0 248706 16   
## 4          95        0      3 "Coxon, Mr. ~ male     59     0     0 364500  7.25
## 5         125        0      1 "White, Mr. ~ male     54     0     1 35281  77.3 
## 6         151        0      2 "Bateman, Re~ male     51     0     0 S.O.P~ 12.5 
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Man kan også kombinere kriterier fra forskellige kolonner, for eksempel i nedenstående vælger vi alle personer som er kvinder \textbf{og} som rejste ved første klasse \textbf{og} som overlevede.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(Sex }\SpecialCharTok{==} \StringTok{\textquotesingle{}female\textquotesingle{}} \SpecialCharTok{\&}\NormalTok{ Pclass }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ Survived }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex     Age SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1           2        1      1 Cumings, Mrs~ fema~    38     1     0 PC 17~  71.3
## 2           4        1      1 Futrelle, Mr~ fema~    35     1     0 113803  53.1
## 3          12        1      1 Bonnell, Mis~ fema~    58     0     0 113783  26.6
## 4          53        1      1 Harper, Mrs.~ fema~    49     1     0 PC 17~  76.7
## 5          62        1      1 Icard, Miss.~ fema~    38     0     0 113572  80  
## 6          89        1      1 Fortune, Mis~ fema~    23     3     2 19950  263  
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Vi kan også inddrage flere comparitiv symboler. For eksempel i nedenståenden vælger vi personer som er kvinder \textbf{og} som rejste i \textbf{enten} første eller anden klass \textbf{og} som overlevede. Huske at tilføje round brackets omkring de to \texttt{Pclass}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(Sex }\SpecialCharTok{==} \StringTok{\textquotesingle{}female\textquotesingle{}} \SpecialCharTok{\&}\NormalTok{ (Pclass }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{|}\NormalTok{ Pclass }\SpecialCharTok{==} \DecValTok{2}\NormalTok{) }\SpecialCharTok{\&}\NormalTok{ Survived }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex     Age SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1           2        1      1 "Cumings, Mr~ fema~    38     1     0 PC 17~  71.3
## 2           4        1      1 "Futrelle, M~ fema~    35     1     0 113803  53.1
## 3          10        1      2 "Nasser, Mrs~ fema~    14     1     0 237736  30.1
## 4          12        1      1 "Bonnell, Mi~ fema~    58     0     0 113783  26.6
## 5          16        1      2 "Hewlett, Mr~ fema~    55     0     0 248706  16  
## 6          44        1      2 "Laroche, Mi~ fema~     3     1     2 SC/Pa~  41.6
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

\hypertarget{comparitiver-reference}{%
\subsection{Comparitiver reference}\label{comparitiver-reference}}

Her er en tabel af comparitiver.

\begin{longtable}[]{@{}ll@{}}
\toprule
comparitive & beskrivelse \\
\midrule
\endhead
\texttt{\textless{}} & less than \\
\texttt{\textgreater{}} & greater than \\
\texttt{\textless{}=} & less than or equal to \\
\texttt{\textgreater{}=} & greater than or equal to \\
\texttt{==} & identical to \\
\texttt{!=} & not equal to \\
\texttt{\&} & and \\
\texttt{\textbar{}} & or \\
\texttt{\%in\%} & in \\
\bottomrule
\end{longtable}

\hypertarget{kombinere-filter-og-select}{%
\subsection{\texorpdfstring{Kombinere \texttt{filter()} og \texttt{select()}}{Kombinere filter() og select()}}\label{kombinere-filter-og-select}}

Man kan også kombinere både \texttt{filter()} og \texttt{select()} i samme kommando. For eksempel i nedenstående får vi kun kolonnerne \texttt{Name} og \texttt{Fare}, for alle passagerer som som er kvinder \textbf{og} som rejste ved første klasse \textbf{og} som overlevede.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(Sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}\NormalTok{ Pclass }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ Survived }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(Name, Fare)  }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##   Name                                                 Fare
##   <chr>                                               <dbl>
## 1 Cumings, Mrs. John Bradley (Florence Briggs Thayer)  71.3
## 2 Futrelle, Mrs. Jacques Heath (Lily May Peel)         53.1
## 3 Bonnell, Miss. Elizabeth                             26.6
## 4 Harper, Mrs. Henry Sleeper (Myna Haxtun)             76.7
## 5 Icard, Miss. Amelie                                  80  
## 6 Fortune, Miss. Mabel Helen                          263
\end{verbatim}

Bemærk at man bør passe på den rækkefølge, som man anvender de forskellige funktioner. For eksempel hvis man skifter \texttt{filter()} og \texttt{select()} i ovenstående, få man en advarsel. Det er fordi, hvis man første vælger at kun beholde variabler \texttt{Name} og \texttt{Age}, så findes de andre kolonner ikke mere i de resulterende dataramme. Man kan ikke derfor bruge den \texttt{filter()} funktion på variabler \texttt{Pclass},\texttt{Sex} og \texttt{Survived}.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#virker ikke!!!!!\#\#\#\#\#}
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(Name, Fare)  }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(Pclass }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ Sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}\NormalTok{ Survived }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{dplyr-verbs-mutate}{%
\subsection{\texorpdfstring{dplyr verbs: \texttt{mutate()}}{dplyr verbs: mutate()}}\label{dplyr-verbs-mutate}}

Man kan avende funktionen \texttt{mutate()} til at tilføje en ny variable til en dataramme.

I nedenstående tilføjer vi en nye variabel ved navn \texttt{Adult}, der angiver om personen kan betragtes som en voksen (hvis de er mindst 18 år gammel).

Bemærke her, at vi gemme resultatet som en ny dataramme der hedder \texttt{titanic\_with\_Adult}, og derefter bruger vi \texttt{head()} for at se, hvordan vores nye kolon ser ud. I forudgående eksempler har vi ikke gemt resultatet (bare brugt \texttt{head()} for at se resultatet på skærmen).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_with\_Adult }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Adult =}\NormalTok{ Age}\SpecialCharTok{\textgreater{}=}\DecValTok{18}\NormalTok{)}

\FunctionTok{head}\NormalTok{(titanic\_with\_Adult}\SpecialCharTok{$}\NormalTok{Adult)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE TRUE TRUE TRUE TRUE TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(titanic\_with\_Adult}\SpecialCharTok{$}\NormalTok{Adult)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Mode   FALSE    TRUE 
## logical     113     601
\end{verbatim}

Så kan man se, at der er 601 voksne og 113 børn som passagerere på skibet.

Man kan lave samme kolon mere informativ end bare TRUE eller FALSE med en \texttt{ifelse} statement. Vi tilføjer også en \texttt{select()} funktion, bare så vi kan se variablen i nedenstående table i dette dokument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Adult =} \FunctionTok{ifelse}\NormalTok{(Age}\SpecialCharTok{\textgreater{}=}\DecValTok{18}\NormalTok{,}\StringTok{"Adult"}\NormalTok{,}\StringTok{"Child"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{select}\NormalTok{(Name,Age,Sex,Pclass,Adult) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   Name                                                  Age Sex    Pclass Adult
##   <chr>                                               <dbl> <chr>   <int> <chr>
## 1 Braund, Mr. Owen Harris                                22 male        3 Adult
## 2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)    38 female      1 Adult
## 3 Heikkinen, Miss. Laina                                 26 female      3 Adult
## 4 Futrelle, Mrs. Jacques Heath (Lily May Peel)           35 female      1 Adult
## 5 Allen, Mr. William Henry                               35 male        3 Adult
## 6 McCarthy, Mr. Timothy J                                54 male        1 Adult
\end{verbatim}

Så er kolonnen lidt mere informativ end før.

\hypertarget{rename}{%
\subsection{\texorpdfstring{\texttt{rename()}}{rename()}}\label{rename}}

Man kan bruge \texttt{rename()} til at ændre navnet på en eller flere kolonner i datasættet. Lad os måske bruge \texttt{rename()} til at give en kolon navnet `Years' i stedet for `Age'.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{Years =}\NormalTok{ Age) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex   Years SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1           1        0      3 Braund, Mr. ~ male     22     1     0 A/5 2~  7.25
## 2           2        1      1 Cumings, Mrs~ fema~    38     1     0 PC 17~ 71.3 
## 3           3        1      3 Heikkinen, M~ fema~    26     0     0 STON/~  7.92
## 4           4        1      1 Futrelle, Mr~ fema~    35     1     0 113803 53.1 
## 5           5        0      3 Allen, Mr. W~ male     35     0     0 373450  8.05
## 6           7        0      1 McCarthy, Mr~ male     54     0     0 17463  51.9 
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Så vi kan se at \texttt{Age} ikke findes, og vi har \texttt{Years} i stedet for.

Man kan også andre navne på flere kolonner på en gang. For eksempel, vi kan måske lave nogle oversættelse arbejde.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_dansk }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{Overlevede =}\NormalTok{ Survived,}
         \AttributeTok{Navn =}\NormalTok{ Name,}
         \AttributeTok{Klasse =}\NormalTok{ Pclass)}
\end{Highlighting}
\end{Shaded}

Så vi kan se vi har ændrede naverne. Lad også kalde det for \texttt{titanic\_clean\_dansk}, så vi gemme vores danske version.

Vi kan også gøre så at vi har kun små bogstaver i vores navne. Lad os bruge vores danske version, og vi anvende \texttt{rename\_with()} og specificerer \texttt{tolower}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_dansk }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename\_with}\NormalTok{(tolower)  }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   passengerid overlevede klasse navn        sex     age sibsp parch ticket  fare
##         <int>      <int>  <int> <chr>       <chr> <dbl> <int> <int> <chr>  <dbl>
## 1           1          0      3 Braund, Mr~ male     22     1     0 A/5 2~  7.25
## 2           2          1      1 Cumings, M~ fema~    38     1     0 PC 17~ 71.3 
## 3           3          1      3 Heikkinen,~ fema~    26     0     0 STON/~  7.92
## 4           4          1      1 Futrelle, ~ fema~    35     1     0 113803 53.1 
## 5           5          0      3 Allen, Mr.~ male     35     0     0 373450  8.05
## 6           7          0      1 McCarthy, ~ male     54     0     0 17463  51.9 
## # ... with 1 more variable: embarked <chr>
\end{verbatim}

Prøve også at erstatte \texttt{tolower} med \texttt{toupper}.

\hypertarget{dplyr-verbs-arrange}{%
\subsection{\texorpdfstring{dplyr verbs: \texttt{arrange()}}{dplyr verbs: arrange()}}\label{dplyr-verbs-arrange}}

Man anvender \texttt{arrange()} for at vælge rækkefølgen på observationer. I nedenstående tager vi datarammen \texttt{titanic\_clean} og arrangerer observationer efter variablen \texttt{Fare}. Det sker således at, personer som betalt mindst er på toppen af de resultarende dataramme, og personer som betalt mest er på bunden.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Arrange by increasing Fare}
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(Fare) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex     Age SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1         180        0      3 Leonard, Mr.~ male     36     0     0 LINE       0
## 2         264        0      1 Harrison, Mr~ male     40     0     0 112059     0
## 3         272        1      3 Tornquist, M~ male     25     0     0 LINE       0
## 4         303        0      3 Johnson, Mr.~ male     19     0     0 LINE       0
## 5         598        0      3 Johnson, Mr.~ male     49     0     0 LINE       0
## 6         807        0      1 Andrews, Mr.~ male     39     0     0 112050     0
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

Hvis man gerne vil få det omvendt - at personer som betalt mest er på toppen af datarammen, kan man bruge \texttt{desc()} omkring \texttt{Fare}, som i nedenstående:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Arrange by decreasing Fare}
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(Fare)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 11
##   PassengerId Survived Pclass Name          Sex     Age SibSp Parch Ticket  Fare
##         <int>    <int>  <int> <chr>         <chr> <dbl> <int> <int> <chr>  <dbl>
## 1         259        1      1 Ward, Miss. ~ fema~    35     0     0 PC 17~  512.
## 2         680        1      1 Cardeza, Mr.~ male     36     0     1 PC 17~  512.
## 3         738        1      1 Lesurer, Mr.~ male     35     0     0 PC 17~  512.
## 4          28        0      1 Fortune, Mr.~ male     19     3     2 19950   263 
## 5          89        1      1 Fortune, Mis~ fema~    23     3     2 19950   263 
## 6         342        1      1 Fortune, Mis~ fema~    24     3     2 19950   263 
## # ... with 1 more variable: Embarked <chr>
\end{verbatim}

\hypertarget{uxe6ndre-data-med-recode}{%
\section{\texorpdfstring{Ændre data med \texttt{recode()}}{Ændre data med recode()}}\label{uxe6ndre-data-med-recode}}

Med \texttt{recode()} kan man ændre hvordan en variable ser ud - fk. male/female kan ændres til 0/1, som i følgende.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Sex =} \FunctionTok{recode}\NormalTok{(Sex,  }\StringTok{"male"} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"female"} \OtherTok{=} \DecValTok{0}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{select}\NormalTok{(PassengerId,Name,Survived,Sex) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   PassengerId Name                                                Survived   Sex
##         <int> <chr>                                                  <int> <dbl>
## 1           1 Braund, Mr. Owen Harris                                    0     1
## 2           2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)        1     0
## 3           3 Heikkinen, Miss. Laina                                     1     0
## 4           4 Futrelle, Mrs. Jacques Heath (Lily May Peel)               1     0
## 5           5 Allen, Mr. William Henry                                   0     1
## 6           7 McCarthy, Mr. Timothy J                                    0     1
\end{verbatim}

Bemærk at vi benytte \texttt{recode()} indenfor funktionen \texttt{mutate}: vi lave en ny variable af samme navn, men med ændret værdier indenfor variablen.

Hvis vi gerne vil skifter fra 0/1 til male/female er vi nødt til at skrive \texttt{1} / \texttt{0} for at specificie at vi har værdier som er tal, og vi gerne vil kalde dem for nogle andet (``male''/``female'' i dette tilfælde):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Sex =} \FunctionTok{recode}\NormalTok{(Sex,  }\AttributeTok{male =} \DecValTok{1}\NormalTok{, }\AttributeTok{female =} \DecValTok{0}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Sex =} \FunctionTok{recode}\NormalTok{(Sex,  }\StringTok{\textasciigrave{}}\AttributeTok{1}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"male"}\NormalTok{, }\StringTok{\textasciigrave{}}\AttributeTok{0}\StringTok{\textasciigrave{}} \OtherTok{=} \StringTok{"female"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{select}\NormalTok{(PassengerId,Name,Survived,Sex) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   PassengerId Name                                                Survived Sex  
##         <int> <chr>                                                  <int> <chr>
## 1           1 Braund, Mr. Owen Harris                                    0 male 
## 2           2 Cumings, Mrs. John Bradley (Florence Briggs Thayer)        1 fema~
## 3           3 Heikkinen, Miss. Laina                                     1 fema~
## 4           4 Futrelle, Mrs. Jacques Heath (Lily May Peel)               1 fema~
## 5           5 Allen, Mr. William Henry                                   0 male 
## 6           7 McCarthy, Mr. Timothy J                                    0 male
\end{verbatim}

\hypertarget{visualisering-bruge-som-input-i-ggplot2}{%
\section{Visualisering: bruge som input i ggplot2}\label{visualisering-bruge-som-input-i-ggplot2}}

Man kan lave nogle bearbejdning med en \texttt{tidyverse} kommando, og så specificerer de resulterende dataramme som data i et \texttt{ggplot}. I \texttt{tidyverse} stil kan man bruge \texttt{\%\textgreater{}\%} til at forbinde den \texttt{tidyverse} kommando med den \texttt{ggplot2} kode. I dette tilfælde specificerer man ikke den data indenfor funktionen \texttt{ggplot}. I nedenstående eksempel tager vi \texttt{titanic\_clean} og så lave et barplot af antallet af passagerer som rejste i hver af de tre klass.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Pclass,}\AttributeTok{fill=}\FunctionTok{as.factor}\NormalTok{(Pclass))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-230-1.pdf}

Lad os gøre det lidt mere kompliceret, ved at tage \texttt{titanic\_clean}, lave en ny kolon der hedder \texttt{Adult}, og så bruge den resulterende dataramme i et \texttt{ggplot}, hvor vi lave et plot med \texttt{Adult} på x-aksen for at tælle op antallet af adults og children.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Adult =} \FunctionTok{ifelse}\NormalTok{(Age}\SpecialCharTok{\textgreater{}=}\DecValTok{18}\NormalTok{,}\StringTok{"Adult"}\NormalTok{,}\StringTok{"Child"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
   \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Adult,}\AttributeTok{fill=}\NormalTok{Adult)) }\SpecialCharTok{+} 
   \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{) }\SpecialCharTok{+} 
   \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-231-1.pdf}

Vi kan se, at der var 600 Adults og lidt over 100 Children ombord skibet.

\hypertarget{problemstillinger-4}{%
\section{Problemstillinger}\label{problemstillinger-4}}

\textbf{1}) Lav quizzen på Absalon - ``Quiz - tidyverse - part 1''

\emph{Vi øver os med titanic. Inlæs de data og lave oprydningen med følgende kode:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(titanic)}
\NormalTok{titanic }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(titanic\_train)}

\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}}\NormalTok{ titanic }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Cabin) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\textbf{2}) \texttt{select()}. Fjerne variablen \texttt{Name} fra \texttt{titanic\_clean}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(...) }\CommentTok{\#redigere her}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Tilføj også \texttt{head()} for at få kun de første 6 rækker
\item
  Prøv at erstatte \texttt{head()} med \texttt{glimpse()} - det er bare en anden måde at kigge på datarammen.
\end{itemize}

\textbf{3}) \texttt{select()}. Lave en ny dataramme fra \texttt{titanic\_clean} med kun variabler \texttt{Name}, \texttt{Pclass} og \texttt{Fare}.

\begin{itemize}
\tightlist
\item
  Gør det en forskel, hvilke rækkefølger man skriver \texttt{Name}, \texttt{Pclass} og \texttt{Fare}?
\end{itemize}

\textbf{4}) \texttt{select()}. I stedet for at specificere bestemt kolonner navn, skriv \texttt{starts\_with("S")} indenfor \texttt{select()}. Hvad sker der?

\begin{itemize}
\tightlist
\item
  Prøve også \texttt{contains("ar")}
\end{itemize}

\textbf{5}) \texttt{filter()}. Lave en ny dataramme fra \texttt{titanic\_clean} med alle personer som er \texttt{male} og over 30 år gammel.

\textbf{6}) \texttt{filter()}. Lave en ny dataramme fra \texttt{titanic\_clean} med alle passagerer som er mellem 10 og 15 og rejst enten første eller anden klass.

\begin{itemize}
\tightlist
\item
  Hvor mange observationer er der i den ny dataramme?
\item
  Prøve at tilføje \texttt{\%\textgreater{}\%\ count()} til kommandoen - få man så samme tal?
\end{itemize}

\textbf{7}) \emph{\texttt{filter()} og \texttt{select()} : kombinering med \texttt{\%\textgreater{}\%}}

Lave en ny dataramme fra \texttt{titanic\_clean} med alle passagerer som er male og survived, og angiv kun kolonner \texttt{Name}, \texttt{Age} og \texttt{Fare}.

\textbf{8}) \emph{\texttt{filter()} og \texttt{select()} kombinering med \texttt{\%\textgreater{}\%}}

Lave en ny dataramme fra \texttt{titanic\_clean} med kun variabler \texttt{Name} og \texttt{Age} og dernæst specificere kun de passagerer som er over 60.

\begin{itemize}
\tightlist
\item
  Få man så den samme sæt observationer hvis du skriver dine \texttt{select()} og \texttt{filter()} funktioner omvendt her? Hvorfor?
\end{itemize}

\textbf{9}) \emph{\texttt{Mutate()}}. Lave en ny dataramme fra \texttt{titanic\_clean} som hedder \texttt{FareRounded} som viser \texttt{Fare} rundet til det nærmest integar (hint: benytte funktionen \texttt{round()}).

\textbf{10}) \emph{\texttt{Mutate()}}. Lave en ny dataramme fra \texttt{titanic\_clean} med en ny kolon som hedder \texttt{Family} som angiver \texttt{TRUE} hvis \texttt{Parch} er ikke nul, ellers \texttt{FALSE}.

\begin{itemize}
\tightlist
\item
  Anvende \texttt{ifelse} til at gøre variablen mere intuitive - ``Family'' og ``Not family''.
\end{itemize}

\textbf{11}) \emph{\texttt{Arrange()}}. Lave en ny dataramme fra \texttt{titanic\_clean} med observationerne arrangerede således at de yngst er på toppen og ældste er på bunden. Kig på resultatet - hvad kan du fortælle om den yngste passager ombord skibet Titanic?

\begin{itemize}
\tightlist
\item
  Hvad kan du fortælle om den ældste passager ombord skibet? Overlevede de? Hvad med de andre ældste passagerer?
\end{itemize}

\textbf{12}) \emph{\texttt{Arrange()} og kombinering med andre verber}. Lave en ny dataramme fra \texttt{titanic\_clean} med kun personer med \texttt{SibSp\textgreater{}0} og som gik ombord skibet i Southampton (\texttt{S} for variablen \texttt{Embarked}), arrangere de resulterende observationer efter \texttt{Fare} (højeste på toppen) og angiv kun kolonnerne \texttt{Name}, \texttt{Age} og \texttt{Fare}.

\textbf{13}) \emph{Rename}. Fra \texttt{titanic\_clean} angiv kun variabler \texttt{Survived},\texttt{Ticket}, og \texttt{Name} og ændre deres navne til \texttt{Overlevede}, \texttt{Billet} og \texttt{Navn}.

\begin{itemize}
\tightlist
\item
  Gøre variabler navne til store bogstaver ved at anvende \texttt{rename\_with()}.
\end{itemize}

\textbf{14}) \emph{Lave et plot}. Fra \texttt{titanic\_clean} bruge \texttt{filter()} til at lave en ny dataramme kun med personer under 30 og bruge den til at lave et barplot som viser antallet af personer opdelt efter Pclass. Bruge følgende struktur for koden:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(...) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\#rediger linjen}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(...)) }\SpecialCharTok{+}\NormalTok{ .... }\CommentTok{\#tilføj plot}
\end{Highlighting}
\end{Shaded}

\textbf{15}) \emph{Lave et plot}. Fra \texttt{titanic\_clean}, bruge \texttt{mutate()} til at lave et nyt kolon der hedder \texttt{with\_siblings\_spouses} der er \texttt{TRUE} hvis \texttt{SibSp} ikke er nul. Brug den til at lave boxplots som viser \texttt{Fare} på y-aksen og \texttt{with\_siblings\_spouses} på x-aksen.

\begin{itemize}
\tightlist
\item
  Ekstra: Ændre skalen på y-aksen for at gøre plottet klarer at fortolke.
\end{itemize}

\hypertarget{kommentarer}{%
\section{Kommentarer}\label{kommentarer}}

I morgen arbejder vi videre med tidyverse.

\hypertarget{bearbejdning-dag-2}{%
\chapter{Bearbejdning dag 2}\label{bearbejdning-dag-2}}

\includegraphics[width=0.15\linewidth]{plots/hex-tidyverse}

\hypertarget{indledning-og-luxe6ringsmuxe5lene}{%
\section{Indledning og læringsmålene}\label{indledning-og-luxe6ringsmuxe5lene}}

I dag skal vi arbejde videre med \texttt{tidyverse}, især på pakken \texttt{dplyr} og \texttt{tidyr}, som kan bruges til at andre på strukturen af de data, således at det passer til den struktur, som kræves for at lave plots med \texttt{ggplot2}.

\hypertarget{luxe6ringsmuxe5lene-1}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-1}}

I skal være i stand til at

\begin{itemize}
\tightlist
\item
  Benytte kombinationen af \texttt{group\_by()} og \texttt{summarise()}.
\item
  Forbinde \texttt{tidyverse} kode og \texttt{ggplot2} kode sammen for at svare på spørgsmål om datasættet.
\item
  Forstå forskellen mellem \texttt{wide} og \texttt{long} data og bruge \texttt{pivot\_longer()} til at facilitere plotting
\end{itemize}

\hypertarget{videoer}{%
\subsection{Videoer}\label{videoer}}

\begin{itemize}
\tightlist
\item
  Video 1 - vi skal kig lidt nærmere på \texttt{group\_by()} + \texttt{summarise()} og forbinde \texttt{tidyverse} kode og \texttt{ggplot2} kode sammen med \%\textgreater\%/+.
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910681}

\begin{itemize}
\tightlist
\item
  Video 2 - wide/long data forms og \texttt{pivot\_longer()} og bruge den i ggplot2
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/546910660}

\begin{itemize}
\tightlist
\item
  Video 3 - eksempel med titanic summary statistics og facet\_wrap()
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/547096274}

\hypertarget{dplyr-group_by-med-summarise}{%
\section{\texorpdfstring{dplyr: \texttt{group\_by()} med \texttt{summarise()}}{dplyr: group\_by() med summarise()}}\label{dplyr-group_by-med-summarise}}

Man kan lave summary statistics med funktionen \texttt{summarise()}. Man plejer at kombinere \texttt{summarise()} med \texttt{group\_by()}, som anvendes til at opdele datasættet efter en eller flere variabler. Her kan vi begynde at stille spørgsmål omkring vores data. For eksempel: havde mænd eller kvinde en højre sandsynlighed for at overleve tragedien?

Lad os starte med løsningen med \texttt{tapply} til at udregne proportionen af mænd og kvinde der overlevede: her opdele vi kolonnen \texttt{Survived} efter kolonnen \texttt{Sex} og tager middelværdien, som resultater i proportionen der overlevede efter køn (da \texttt{Survived} er kodet sådan at 1 betyder at man overlevede og 0 betyder at man ikke overlevede).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#tapply løsning}
\FunctionTok{tapply}\NormalTok{(titanic\_clean}\SpecialCharTok{$}\NormalTok{Survived,titanic\_clean}\SpecialCharTok{$}\NormalTok{Sex,mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    female      male 
## 0.7547893 0.2052980
\end{verbatim}

Lad os skifter over til den \texttt{tidyverse} løsning. Lad os tage udgangspunkt i \texttt{summarise()}: som et eksempel af hvordan man bruger funktionen, vil vi beregner en variable der hedder ``medianFare'' som er lig med median(fare).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\StringTok{"medianFare"}\OtherTok{=}\FunctionTok{median}\NormalTok{(Fare))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   medianFare
##        <dbl>
## 1       15.7
\end{verbatim}

Vi får faktisk en ny dataramme her, med kun variablen som vi lige har specificeret. Vi er interesseret i proportionen, der overlevede, så vi behøver at tage middelværdien af variablen \texttt{Survived}. Lad os gøre det med \texttt{summarise()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   meanSurvived
##          <dbl>
## 1        0.406
\end{verbatim}

Få at svare på spørgsmålet er vi også nødt til at opdele efter kolonnen \texttt{Sex}. Vi kan bruge den kombinering af \texttt{group\_by()} og \texttt{summarise()} - vi opdele efter \texttt{Sex} ved at anvende funktionen \texttt{group\_by()} og derefter bruger \texttt{summarise()} til at oprette en kolon der hedder \texttt{meanSurvived}, der viser proportionen der overlevede for female and male.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#tidyverse løsning}
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(Sex) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   Sex    meanSurvived
##   <chr>         <dbl>
## 1 female        0.755
## 2 male          0.205
\end{verbatim}

Lad os tage resultatet fra ovenpå og visualiserer det i et barplot, som i nedenstående:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{group\_by}\NormalTok{(Sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{meanSurvived,}\AttributeTok{fill=}\NormalTok{Sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-260-1.pdf}

\hypertarget{reference-af-summary-funktioner}{%
\subsection{\texorpdfstring{Reference af \texttt{summary()} funktioner}{Reference af summary() funktioner}}\label{reference-af-summary-funktioner}}

Nogle fuktioner man ofte bruge med \texttt{summary()} (der er mange andre muligheder).

\begin{longtable}[]{@{}ll@{}}
\toprule
fuktion & beskrivelse \\
\midrule
\endhead
\texttt{mean()} & to give us the mean value of a variable. \\
\texttt{sd()} & to give us the standard deviation of a variable. \\
\texttt{min()} & giving us the lowest value of a variable. \\
\texttt{max()} & giving us the highest value of a variable. \\
\texttt{n()} & giving us the number of observations in a variable. and many more. \\
\texttt{first()} & first values \\
\bottomrule
\end{longtable}

\hypertarget{flere-summary-statistic-puxe5-uxe9n-gang}{%
\subsection{Flere summary statistic på én gang}\label{flere-summary-statistic-puxe5-uxe9n-gang}}

Vi kan også lave flere summary statistics på én gang. For eksempel, lad os anvende funktionen \texttt{group\_by} med Sex igen, men beregner flere forskellige summary statistics:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{group\_by}\NormalTok{(Sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{(),                    }\CommentTok{\#count}
            \AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived),  }\CommentTok{\#middelværdi survived}
            \AttributeTok{meanAge =} \FunctionTok{mean}\NormalTok{(Age),            }\CommentTok{\#middelværdi age}
            \AttributeTok{propFirst =} \FunctionTok{sum}\NormalTok{(Pclass}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)}\SpecialCharTok{/}\FunctionTok{n}\NormalTok{()) }\CommentTok{\#proportionen i første klass}
\NormalTok{titanic\_clean\_summary\_by\_sex}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   Sex    count meanSurvived meanAge propFirst
##   <chr>  <int>        <dbl>   <dbl>     <dbl>
## 1 female   261        0.755    27.9     0.326
## 2 male     453        0.205    30.7     0.223
\end{verbatim}

Igen kan denne summary table bruges som et datasæt til at lave et plot med \texttt{ggplot2}. Bemærk at her bruger vi \texttt{stat="identity"}, fordi vi skal ikke tælle observationerne op, men bare plot præcis de tal som er i datarammen på y-aksen. I nedenstående laver vi barplots for \texttt{meanAge} og \texttt{propFirst} - de er plottet ved at bruge to forskellige \texttt{ggplot} kommandoer og bemærk, at det er plottet ved siden af hinanden med en funktion der hedder \texttt{grid.arrange()} fra R-pakken \texttt{gridExtra}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotA }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{titanic\_clean\_summary\_by\_sex,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{meanAge,}\AttributeTok{fill=}\NormalTok{Sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}

\NormalTok{plotB }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{titanic\_clean\_summary\_by\_sex,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{propFirst,}\AttributeTok{fill=}\NormalTok{Sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}

\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{grid.arrange}\NormalTok{(plotA,plotB,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{) }\CommentTok{\#plot both together}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-262-1.pdf}

Vi kan se, at females var i gennemsnit lidt yngere end males, og havde en højere sandsynlighed for at være i første klass. Et interessant spørgsmål er, hvordan man kan lave ovenstående plots uden at bruge to forskellige \texttt{ggplot} kommandoer - altså, en automatiske løsning hvor vi kan plotte flere summary statistiks med kun én \texttt{ggplot} kommando. Vi kommer til at se hvordan man gøre det med at første lave datasættet om til long form.

\hypertarget{mere-kompliceret-group_by}{%
\subsection{\texorpdfstring{Mere kompliceret \texttt{group\_by()}}{Mere kompliceret group\_by()}}\label{mere-kompliceret-group_by}}

Lad os også beregne hvor mange passagerer der var efter både deres klass, og hvor de gik ombord skibet:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{group\_by}\NormalTok{(Embarked, Pclass) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# group by multiple variables... }
   \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'Embarked'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{verbatim}
## # A tibble: 10 x 3
## # Groups:   Embarked [4]
##    Embarked Pclass count
##    <chr>     <int> <int>
##  1 ""            1     2
##  2 "C"           1    74
##  3 "C"           2    15
##  4 "C"           3    41
##  5 "Q"           1     2
##  6 "Q"           2     2
##  7 "Q"           3    24
##  8 "S"           1   108
##  9 "S"           2   156
## 10 "S"           3   290
\end{verbatim}

Man kan se at de flest gik om bord i Southampton (S), men der var også forholdsvis mange første klass passagerer der gik om bord i Cherbourg (C). Lad os gå videre med vores \texttt{Survived} eksempel og beregne proportionen der overlevede efter de tre variabler \texttt{Adult}, \texttt{Sex} og \texttt{Pclass}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_survived }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Adult =} \FunctionTok{ifelse}\NormalTok{(Age}\SpecialCharTok{\textgreater{}=}\DecValTok{18}\NormalTok{,}\StringTok{"Adult"}\NormalTok{,}\StringTok{"Child"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Adult,Sex,Pclass) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'Adult', 'Sex'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_survived}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 12 x 4
## # Groups:   Adult, Sex [4]
##    Adult Sex    Pclass meanSurvived
##    <chr> <chr>   <int>        <dbl>
##  1 Adult female      1       0.974 
##  2 Adult female      2       0.903 
##  3 Adult female      3       0.418 
##  4 Adult male        1       0.371 
##  5 Adult male        2       0.0682
##  6 Adult male        3       0.133 
##  7 Child female      1       0.875 
##  8 Child female      2       1     
##  9 Child female      3       0.543 
## 10 Child male        1       1     
## 11 Child male        2       0.818 
## 12 Child male        3       0.233
\end{verbatim}

Og så kan vi også bruge resultatet ind i en \texttt{ggplot}, hvor vi kombinerer de tre variabler og adskiller efter \texttt{Pclass}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(titanic\_clean\_summary\_survived,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{meanSurvived,}\AttributeTok{fill=}\NormalTok{Adult)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{Pclass) }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Proportion survived"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-265-1.pdf}

\hypertarget{tidyr-pakke---wide-og-long-data}{%
\section{Tidyr pakke - Wide og Long data}\label{tidyr-pakke---wide-og-long-data}}

\textbf{Tidy data} findes i to former: wide data og long data. Som vi vil se, kan det være nyttigt at transformere de data fra den ene form til den anden, for fk. at facilitere et plot med \texttt{ggplot2}. Indenfor R-pakken \texttt{tidyr} er der funktioner som kan bruges til at lave disse transformeringer.

Inden vi begynde at kigge lidt nærmere på \texttt{tidyr} skal vi beskrive, hvad betyder long data og wide data.

\begin{figure}
\includegraphics[width=0.75\linewidth]{plots/original-dfs-tidy} \caption{source: https://www.garrickadenbuie.com/project/tidyexplain/}\label{fig:unnamed-chunk-266}
\end{figure}

\textbf{Wide data}: Her har man en kolon til hver variable og en række til hver observation. Det gøre de data nem at forstå og denne data type findes ofte indenfor biologi - for eksempel hvis man har forskellige samples (treatments, controls, conditions osv.) som variabler.

\textbf{Long data}: Med long data har man værdier samlet i en enkel kolon og en kolon som en slags nøgle, som fortæller også hvilken variable hver værdi hørte til i den wide format. Datasættet er stadig betragtet som \textbf{tidy} men informationen opbevares på en anden måde. Det er lidt sværer at læse men nemmere at arbejde med når man analyser de data.

Når man transformer data fra wide til long eller omvendt, kaldes det for \textbf{reshaping}.

\hypertarget{tidyr-pakke---oversigt}{%
\subsection{Tidyr pakke - oversigt}\label{tidyr-pakke---oversigt}}

Her er en oversigt over de fire vigtigste funktioner fra R-pakken \texttt{tidyr}.

\begin{longtable}[]{@{}ll@{}}
\toprule
\texttt{tidr} funktion & Beskrivelse \\
\midrule
\endhead
\texttt{pivot\_longer()} & short til long \\
\texttt{pivot\_wider()} & long til short \\
\texttt{separate()} & opdele strings fra en kolon til to \\
\texttt{unite()} & tilføje strings sammen ind fra to til én kolon \\
\bottomrule
\end{longtable}

Vi fokuserer på funktionen \texttt{pivot\_longer()}, da den er mest brugbar, men nævne kort de andre funktioner.

\hypertarget{wide---long-med-pivot_longer}{%
\subsection{\texorpdfstring{Wide -\textgreater{} Long med \texttt{pivot\_longer()}}{Wide -\textgreater{} Long med pivot\_longer()}}\label{wide---long-med-pivot_longer}}

Lad os arbejde med datasættet \texttt{Iris}. Man få Iris` i long form med følgende kommando:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Species)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\includegraphics[width=1\linewidth]{plots/wide_to_long} \caption{wide til long med Iris}\label{fig:unnamed-chunk-268}
\end{figure}

Til venstre har vi målingerne i datasættet over fire forskellige kolonner som hedder \texttt{Sepal.Length}, \texttt{Sepal.Width}, \texttt{Petal.Length} og \texttt{Petal.Width}, og en ekstra kolon der skelne imellem de tre \texttt{Species}. Til højre har vi fået alle målingerne ind i en enkel kolon der hedder \texttt{values}, og så bruger man en anden `nøgle' kolon der hedder \texttt{name} til at fortælle os om det er en måling for \texttt{Sepal.Length} eller \texttt{Sepal.Width} osv.

Man specificer \texttt{cols=-Species}, fordi det kun er kolonnerne med målinger som vi gerne vil have samlet i en enkel kolon, og det inkluderer så ikke Species.

Jeg kan kalde de kolonner navne for målingerne og nøglen til nogle andre en default: for eksempel i nedenstående skal målingerne hedde \texttt{measurements} og nøglen hedde \texttt{trait}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris.long }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Species,}
                                    \AttributeTok{names\_to =} \StringTok{"trait"}\NormalTok{,}
                                    \AttributeTok{values\_to =} \StringTok{"measurement"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=1\linewidth]{plots/wide_to_long_names}

Man kan for eksempel bruge den long form den til at visualisere samtlige mulige boxplots opdelt efter Species og trait på samme plot:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(iris.long,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{measurement,}\AttributeTok{x=}\NormalTok{Species,}\AttributeTok{fill=}\NormalTok{Species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{trait) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-271-1.pdf}

\hypertarget{separate}{%
\subsection{\texorpdfstring{\texttt{separate()}}{separate()}}\label{separate}}

Funktionen \texttt{separate()} fra pakken \texttt{tidyr} kan bruges til at opdele to forskellige dele som eksisterer i samme kolon. For eksempel, i \texttt{iris} har vi variabler med navne \texttt{Sepal.Width}, \texttt{Sepal.Length} osv. - man kan forestille sig, at opdele disse navne over to kolonner i stedet for en - fk. ``Sepal'' og ``Width'' i tilfældet af \texttt{Sepal.Width}. I nedenstående kan man se, hvordan man anvende \texttt{separate()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Species, }\AttributeTok{names\_to =} \StringTok{"trait"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"measurement"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\AttributeTok{col =}\NormalTok{ trait, }\AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"part"}\NormalTok{, }\StringTok{"measure"}\NormalTok{),}\AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   Species part  measure measurement
##   <fct>   <chr> <chr>         <dbl>
## 1 setosa  Sepal Length          5.1
## 2 setosa  Sepal Width           3.5
## 3 setosa  Petal Length          1.4
## 4 setosa  Petal Width           0.2
## 5 setosa  Sepal Length          4.9
## 6 setosa  Sepal Width           3
\end{verbatim}

Man specificerer variablen \texttt{trait}, og at det skal opdeles til to variabler \texttt{part} og \texttt{measure}. Vi angiver \texttt{sep\ =\ "\textbackslash{}\textbackslash{}."} som betyder, at vi gerne vil have \texttt{part} som delen af \texttt{trait} foran `.' og \texttt{measure} som delen af \texttt{trait} efter \texttt{.}. Vi bruger ``\textbackslash.'' til at fortælle, at vi er interesseret i punktum og ikke en ``anonym character'', som punktum plejer at betyde i ``string''-sprog. Man behøver faktisk ikke at specifice \texttt{sep\ =\ "\textbackslash{}\textbackslash{}."} i dette tilfælde - som standard kigger funktionen efter `non-character' tegne og bruger dem til at lave opdelingen.

Samme resultat:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Species, }\AttributeTok{names\_to =} \StringTok{"trait"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"measurement"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\AttributeTok{col =}\NormalTok{ trait, }\AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"part"}\NormalTok{, }\StringTok{"measure"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   Species part  measure measurement
##   <fct>   <chr> <chr>         <dbl>
## 1 setosa  Sepal Length          5.1
## 2 setosa  Sepal Width           3.5
## 3 setosa  Petal Length          1.4
## 4 setosa  Petal Width           0.2
## 5 setosa  Sepal Length          4.9
## 6 setosa  Sepal Width           3
\end{verbatim}

Bruger resultatet i et plot:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\NormalTok{Species, }\AttributeTok{names\_to =} \StringTok{"trait"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"measurement"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{separate}\NormalTok{(}\AttributeTok{col =}\NormalTok{ trait, }\AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"part"}\NormalTok{, }\StringTok{"measure"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{measurement,}\AttributeTok{x=}\NormalTok{part,}\AttributeTok{fill=}\NormalTok{part)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{measure) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-274-1.pdf}

Se også \texttt{unite()} som gøre de modsatte til \texttt{separate()}.

\hypertarget{eksempel-titanic-summary-statistics}{%
\section{Eksempel: Titanic summary statistics}\label{eksempel-titanic-summary-statistics}}

Lad også tage vores Titanic summary statistic eksempel hvor man andvender de forskellige koncepter fra ovenstående.

\begin{itemize}
\tightlist
\item
  \texttt{group\_by()} og \texttt{summarise()}
\end{itemize}

Vi laver vores summary statistics som i ovenstående.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{group\_by}\NormalTok{(Sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{meanSurvived =} \FunctionTok{mean}\NormalTok{(Survived),}
            \AttributeTok{meanAge =} \FunctionTok{mean}\NormalTok{(Age),}
            \AttributeTok{propFirst =} \FunctionTok{sum}\NormalTok{(Pclass}\SpecialCharTok{==}\DecValTok{1}\NormalTok{)}\SpecialCharTok{/}\FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{pivot\_longer()}
\end{itemize}

Vi transformerer eller \textbf{reshape} datarammen fra wide data til long data. Vi vil få kun de summary statistics samlet i en enkel kolon, så variablen \texttt{Sex} ikke skal med.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{{-}}\NormalTok{Sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 3
##   Sex    name           value
##   <chr>  <chr>          <dbl>
## 1 female count        261    
## 2 female meanSurvived   0.755
## 3 female meanAge       27.9  
## 4 female propFirst      0.326
## 5 male   count        453    
## 6 male   meanSurvived   0.205
## 7 male   meanAge       30.7  
## 8 male   propFirst      0.223
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{ggplot()} med \texttt{facet\_grid()}
\end{itemize}

Vi kombinerer \texttt{pivot\_longer()} med et plot af vores summary statistics og benytte \texttt{facet\_grid()} til at separere ved de forskellige statistiker.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{{-}}\NormalTok{Sex) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{Sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-277-1.pdf}

\begin{itemize}
\tightlist
\item
  \texttt{facet\_wrap()}
\end{itemize}

Vi laver den sammen som ovenstående men specificerer \texttt{facet\_wrap()} i stedet for \texttt{facet\_grid()} - indenfor \texttt{facet\_wrap()} kan man bruge indstillingen \texttt{scales="free"} som gøre, at de fire plots få hver deres egne akse limits.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{{-}}\NormalTok{Sex) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sex,}\AttributeTok{y=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{Sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name,}\AttributeTok{scales=}\StringTok{"free"}\NormalTok{,}\AttributeTok{ncol=}\DecValTok{4}\NormalTok{) }\SpecialCharTok{+}  
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-278-1.pdf}

\hypertarget{demonstration-af-pivot_wider}{%
\subsection{\texorpdfstring{Demonstration af \texttt{pivot\_wider()}}{Demonstration af pivot\_wider()}}\label{demonstration-af-pivot_wider}}

\begin{itemize}
\tightlist
\item
  Wide -\textgreater{} Long
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{{-}}\NormalTok{Sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 3
##   Sex    name           value
##   <chr>  <chr>          <dbl>
## 1 female count        261    
## 2 female meanSurvived   0.755
## 3 female meanAge       27.9  
## 4 female propFirst      0.326
## 5 male   count        453    
## 6 male   meanSurvived   0.205
## 7 male   meanAge       30.7  
## 8 male   propFirst      0.223
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Wide -\textgreater{} Long --\textgreater{} Wide
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean\_summary\_by\_sex }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=}\SpecialCharTok{{-}}\NormalTok{Sex)  }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 5
##   Sex    count meanSurvived meanAge propFirst
##   <chr>  <dbl>        <dbl>   <dbl>     <dbl>
## 1 female   261        0.755    27.9     0.326
## 2 male     453        0.205    30.7     0.223
\end{verbatim}

\hypertarget{problemstillinger-5}{%
\section{Problemstillinger}\label{problemstillinger-5}}

\textbf{1}) Lav quizzen - ``Quiz - tidyverse - part 2''.

\emph{Vi øver os med titanic. Inlæs de data og lave oprydningen med følgende kode:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(titanic)}
\NormalTok{titanic }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(titanic\_train)}

\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}}\NormalTok{ titanic }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Cabin) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\textbf{2}) \emph{\texttt{summarise()}}. Fra \texttt{titanic\_clean} beregne den median alder af alle passagerer ombord skibet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic\_clean }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(....) }\CommentTok{\#rediger her}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  I samme kommando beregne også den maksimum alder og minimum alder, samt med den standard afvigelse af alder. Datarammen skal ser sådan ud:
\end{itemize}

\begin{verbatim}
## # A tibble: 1 x 4
##   mean_alder max_alder min_alder sd_alder
##        <dbl>     <dbl>     <dbl>    <dbl>
## 1       29.7        80      0.42     14.5
\end{verbatim}

\textbf{3}) \emph{\texttt{group\_by()} og \texttt{summarise()}}. Beregne samme summary statistics som i \textbf{2}) men anvende \texttt{group\_by()} til at først opdele efter variablen \texttt{Pclass}.

\begin{itemize}
\tightlist
\item
  Lave et barplot med \texttt{stat="identity"} som viser den gennemsnitlige alder på y-aksen opdelt efter \texttt{Pclass} på x-aksen.
\item
  OBS: prøve at tilføje \texttt{fill=Pclass} til dit plot og kigge på farverne/legend. Hvad er skete? Kigg på datarammen \texttt{titanic\_clean} (som skulle være en \texttt{tibble} her) og tjekke datatypen.
\item
  Gør variablen til en ``factor'' variable indenfor plottet.
\end{itemize}

\textbf{4}) \emph{\texttt{group\_by()} og \texttt{summarise()}}. Beregne samme summary statistics som i \textbf{2}) men anvende \texttt{group\_by()} til at først opdele efter både variablerne \texttt{Pclass} og \texttt{Sex}. Man få en advarsel ``\texttt{summarise()} has grouped output by `Pclass' \ldots{}'' som du kan se bort fra.

\begin{itemize}
\tightlist
\item
  Lave et barplot med \texttt{stat=="identity"} som viser den gennemsnitlige alder opdelt efter \texttt{Pclass}, adskilte efter \texttt{Sex} (\texttt{facet\_grid()})
\end{itemize}

\textbf{5}) \emph{Ekstra øvelse med \texttt{group\_by()} og \texttt{summarise()}}. Med \texttt{titanic\_clean} som udgangspunkt angiv både Pclass og Embarked i \texttt{group\_by()} og brug \texttt{summarise()} til at beregne de gennemsnitlige \texttt{Fare} til passagerene.

\begin{itemize}
\tightlist
\item
  OBS: Der er et par observationer med en blank værdi for ``Embarked'' - bruge \texttt{filter()} i linjen før man anvender \texttt{group\_by()} for at først få dem fjernet (Hint: benyt \texttt{!=} tegn).
\item
  Lav et barplot med \texttt{Embarked} på x-aksen og den gennemsnitlige \texttt{Fare} på y-aksen og adskille efter \texttt{Pclass}.
\item
  Hvilke gruppe betalte mest i gennemsnit for deres billet?
\end{itemize}

\textbf{6}) \emph{\texttt{group\_by()} med tre variabler og \texttt{summarise()}}. Afprøve en kombination med tre forskellige variabler indenfor \texttt{group\_by()} og bruge \texttt{summarise()} til at beregne middelværdien for \texttt{Age}.

\begin{itemize}
\tightlist
\item
  Leg med at lave et plot for at visualisere de data. Idé: som mulighed kan man tilføje variabler til \texttt{facet\_grid()} - for eksempel \texttt{facet\_grid(\textasciitilde{}Pclass\ +\ Sex)}.
\end{itemize}

\textbf{6} \emph{\texttt{recode()}} Tjekk kursus notaterne og se funktionen \texttt{recode()}. Afpøve den ved at ændre værdierne i variablen \texttt{Embarked} således at man få de fulde navne af de steder folk gik ombord skibet, i stedet for kun den første bogstav. Fra data beskrivelsen:

\begin{itemize}
\tightlist
\item
  Embarked: Where passengers boarded the titanic. C = Cherbourg, Q = Queenstown, S = Southampton).
\end{itemize}

\textbf{7}) \emph{\texttt{pivot\_longer()}}

\begin{itemize}
\item
  Lave en ny dataramme fra \texttt{titanic\_clean} der viser tre summary statistics opdelt efter Survived: den gennemsnitlige alder, den gennemsnitlige \texttt{Fare} og proportionen som er ``male''.
\item
  Benyt \texttt{pivot\_longer()} til at få de resulterende dataramme i Long form. Husk at angiv \texttt{-Survived} da vi kun vil have vores beregnet værdier med.
\item
  Bruge resultatet til at lav et barplot med \texttt{Survived} på x-aksen og \texttt{value} på y-aksen (husk at angiv i plot, at \texttt{Survived} er en factor).
\item
  Anvend \texttt{facet\_wrap()} til at adskille efter \texttt{name} og bruger indstillingen \texttt{scales="free"}.
\end{itemize}

\textbf{8}) \emph{Mere øvelse med \texttt{pivot\_longer()}}

Her er nogle fiktiv data om hjerterytmene for seks forskellige patienter, efter at have taget fire forskellige lægemidler:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{heart\_rate }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\StringTok{"patient"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\StringTok{"George"}\NormalTok{,}\StringTok{"Sally"}\NormalTok{,}\StringTok{"Henry"}\NormalTok{,}\StringTok{"Peter"}\NormalTok{,}\StringTok{"Charlotte"}\NormalTok{,}\StringTok{"Jason"}\NormalTok{),}\StringTok{"drugA"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{72}\NormalTok{,}\DecValTok{84}\NormalTok{,}\DecValTok{64}\NormalTok{,}\DecValTok{60}\NormalTok{,}\DecValTok{74}\NormalTok{,}\DecValTok{88}\NormalTok{),}\StringTok{"drugB"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{74}\NormalTok{,}\DecValTok{84}\NormalTok{,}\DecValTok{66}\NormalTok{,}\DecValTok{58}\NormalTok{,}\DecValTok{72}\NormalTok{,}\DecValTok{87}\NormalTok{),}\StringTok{"drugC"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{80}\NormalTok{,}\DecValTok{88}\NormalTok{,}\DecValTok{68}\NormalTok{,}\DecValTok{64}\NormalTok{,}\DecValTok{78}\NormalTok{,}\DecValTok{88}\NormalTok{),}\StringTok{"drugD"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\DecValTok{68}\NormalTok{,}\DecValTok{76}\NormalTok{,}\DecValTok{64}\NormalTok{,}\DecValTok{58}\NormalTok{,}\DecValTok{70}\NormalTok{,}\DecValTok{72}\NormalTok{))}
\NormalTok{heart\_rate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   patient   drugA drugB drugC drugD
##   <chr>     <dbl> <dbl> <dbl> <dbl>
## 1 George       72    74    80    68
## 2 Sally        84    84    88    76
## 3 Henry        64    66    68    64
## 4 Peter        60    58    64    58
## 5 Charlotte    74    72    78    70
## 6 Jason        88    87    88    72
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Bruge \texttt{pivot\_longer()} til at få datasættet i Long form. Er der nogle kolonner som ikke skal med i den enkel kolon med værdier? Kalde den kolon med værdier ``heartrate'' og den nøgle kolon med variable-navne ``drug''.
\item
  Bruge \texttt{group\_by()} og \texttt{summarise()} til at beregne den gennemsnitlige heartrate efter drug.
\item
  Lave et plot som viser den gennemsnitlige heartrate efter drug.
\end{itemize}

\textbf{9}) \emph{\texttt{Pivot\_wider()}} Vi har en \texttt{tribble} som jeg har kopiret fra \url{https://r4ds.had.co.nz/index.html}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{people }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{name,             }\SpecialCharTok{\textasciitilde{}}\NormalTok{names,  }\SpecialCharTok{\textasciitilde{}}\NormalTok{values,}
  \CommentTok{\#{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}}
  \StringTok{"Phillip Woods"}\NormalTok{,   }\StringTok{"age"}\NormalTok{,       }\DecValTok{45}\NormalTok{,}
  \StringTok{"Phillip Woods"}\NormalTok{,   }\StringTok{"height"}\NormalTok{,   }\DecValTok{186}\NormalTok{,}
  \StringTok{"Jessica Cordero"}\NormalTok{, }\StringTok{"age"}\NormalTok{,       }\DecValTok{37}\NormalTok{,}
  \StringTok{"Jessica Cordero"}\NormalTok{, }\StringTok{"height"}\NormalTok{,   }\DecValTok{156}\NormalTok{,}
  \StringTok{"Brady Smith"}\NormalTok{,     }\StringTok{"age"}\NormalTok{,       }\DecValTok{23}\NormalTok{,}
  \StringTok{"Brady Smith"}\NormalTok{,     }\StringTok{"height"}\NormalTok{,   }\DecValTok{177}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Brug \texttt{pivot\_wider()} på \texttt{people}. Vi er nødt til at specificer \texttt{names\_from} og \texttt{values\_from} indenfor \texttt{pivot\_wider()} - prøv at angiv de relevante kolonner.

\textbf{10}) \emph{\texttt{Separate()} øvelse}

\begin{itemize}
\item
  Benytt funktionen \texttt{Separate()} til at opdele variablen \texttt{Name} ind til to variabler, ``Surname'' og ``Rest'' (Hint: bruge \texttt{sep=",\ "} for at undgå, at man få en mellemrum lige før ``Rest'').
\item
  Anvend \texttt{Separate()} en gang til, men for at opdele variablen \texttt{Rest} into to variabler, ``Title'' og ``Names''. Hvad bruger man som \texttt{sep}? (Hint: husk at bruge ``\textbackslash\textbackslash{}'' foran en punktum).
\item
  Optæll hvor mange der er i hver af de forskellige ``Titles'' og beregne også den maksimum og den minimum alder for hver ``Title''.
\end{itemize}

\textbf{11}) Valgfri ekstra hvis man er færdig: lave en ny dataramme med alle passagerer, der hedder ``Alice'' eller ``Elizabeth'' (brug Google her).

\hypertarget{opgave-fredag-workshop-om-tidyverse}{%
\section{Opgave (fredag workshop om tidyverse)}\label{opgave-fredag-workshop-om-tidyverse}}

Fredag opgave bliver tilgængelige fredag morgen.

\hypertarget{ekstra-links-2}{%
\section{Ekstra links}\label{ekstra-links-2}}

Cheatsheet: \url{https://github.com/rstudio/cheatsheets/blob/master/data-import.pdf}

\hypertarget{sidste-kommentarer}{%
\section{Sidste kommentarer}\label{sidste-kommentarer}}

--\textgreater{}

\hypertarget{forbine-tables-iterations-og-funktioner}{%
\chapter{Forbine tables, iterations og funktioner}\label{forbine-tables-iterations-og-funktioner}}

\includegraphics[width=0.15\linewidth]{plots/hex-tidyverse}

\hypertarget{inledning-og-luxe6ringsmuxe5lene-1}{%
\section{Inledning og læringsmålene}\label{inledning-og-luxe6ringsmuxe5lene-1}}

\hypertarget{luxe6ringsmuxe5lene-2}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-2}}

I skal være i stand til at:

\begin{itemize}
\tightlist
\item
  Benytte \texttt{left\_join()} til at tilføje sample information til datasættet.
\item
  Anvende \texttt{map()} - funktioner til at udføre beregninger iterativt over flere kolonner og \texttt{nest()} til at lave analyser over forskellige dele af datasættet.
\item
  Kombinere \texttt{map()} med custom funktioner til at forbedre reproducerbarhed i analyser.
\end{itemize}

\hypertarget{introduktion-til-chapter}{%
\subsection{Introduktion til Chapter}\label{introduktion-til-chapter}}

Det er ofte tilfældet indenfor biologi, at man har sine data i den ene dataramme og nogle ekstra sample oplysninger i den anden dataramme. Derfor vil vi gerne have en måde, at integrere de to datarammer i R, som gøre, at vi kan inddrage de ekstra oplysninger når vi lave plots af de data.

Det er også ofte tilfældet indenfor biologi, at man har sine data værdier over forskellige kolonner som refererer til rigtige mange samples, replikater eller konditioner. Vi beskæftiger os med de \texttt{map()} funktioner, som kan benyttes til at lave iterativ baserende analyser i \texttt{R}.

\hypertarget{video-ressourcer-3}{%
\subsection{Video ressourcer}\label{video-ressourcer-3}}

\begin{itemize}
\tightlist
\item
  Video 1: left\_join of tables with extra sample information and plot
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/549630870}

\begin{itemize}
\tightlist
\item
  Video 2: Introduction to map functions for iterating over columns
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/549630848}

\begin{itemize}
\tightlist
\item
  Video 3: Introduction to custom functions and combining them with map
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/549630825}

\begin{itemize}
\tightlist
\item
  Video 4: Introduction to nest functions for breaking data into sections
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/549630798}

\hypertarget{tilfuxf8je-sample-oplysninger-med-left_join}{%
\section{\texorpdfstring{Tilføje sample oplysninger med \texttt{left\_join()}}{Tilføje sample oplysninger med left\_join()}}\label{tilfuxf8je-sample-oplysninger-med-left_join}}

For at bedste demonstrere scenariet, har jeg lavet nogle fiktiv data fra et eksperiment, hvor man indhenter målinger over 100 tidspunkter, for to konditioner (treatment og control). Der er tre replikater til hver kondition. Jeg har også lavet en table, som viser forskellige oplysninger om de samples, som ikke er med i de egentlige data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_exper }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/hb7m63agz4jti6w/fictive\_left\_join.txt?dl=1"}\NormalTok{,}\AttributeTok{header=}\NormalTok{T)}

\NormalTok{samples }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"control\_rep1"}\NormalTok{, }\StringTok{"control\_rep2"}\NormalTok{, }\StringTok{"control\_rep3"}\NormalTok{,}\StringTok{"treat\_rep1"}\NormalTok{, }\StringTok{"treat\_rep2"}\NormalTok{, }\StringTok{"treat\_rep3"}\NormalTok{)}
\NormalTok{condition }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"(.+)\_rep[1|2|3]"}\NormalTok{,}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{1"}\NormalTok{,samples)}
\NormalTok{replicate }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{".+\_rep([1|2|3])"}\NormalTok{,}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{1"}\NormalTok{,samples)}
\NormalTok{batch }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{,}\StringTok{"A"}\NormalTok{,}\StringTok{"B"}\NormalTok{)}
\NormalTok{sample\_info }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\StringTok{"sample"}\OtherTok{=}\NormalTok{samples,}\StringTok{"condition"}\OtherTok{=}\NormalTok{condition,}\StringTok{"replicate"}\OtherTok{=}\NormalTok{replicate,}\StringTok{"batch"}\OtherTok{=}\NormalTok{batch)}
\end{Highlighting}
\end{Shaded}

Lad os kigge på datasættet \texttt{data\_expr}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(data\_exper)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    x control_rep1 control_rep2 control_rep3 treat_rep1 treat_rep2 treat_rep3
## 1  2   -0.6222110    12.112904     8.624800  10.504877  -5.793916   22.26163
## 2  4   -5.7463250    26.082811    -8.929131 -13.287492   8.068806   11.50306
## 3  6    2.7762770     3.834661    14.663878  16.328472  18.107530   10.11893
## 4  8    5.4739947     0.344840    -6.184393   7.770677   7.311946   20.78667
## 5 10   -9.1930518    10.890655     6.855960   6.299163  21.456005   23.81832
## 6 12    0.2531807    13.079257    -5.423093   8.472125  27.178203   29.94170
\end{verbatim}

Lad os også kigge på de sample oplysninger, som kan være nyttige at inddrage i vores analyse/plotter for at undersøge eventualle batch effekter osv.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(sample\_info)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##         sample condition replicate batch
## 1 control_rep1   control         1     A
## 2 control_rep2   control         2     B
## 3 control_rep3   control         3     A
## 4   treat_rep1     treat         1     B
## 5   treat_rep2     treat         2     A
## 6   treat_rep3     treat         3     B
\end{verbatim}

Som man kan se, har vi en kolon som viser hvilke kondition og replikate vores samples kommer fra (det er også oplagt fra sample navne her, men det er ikke altid), samt den batch, hver sample kommer fra. For at integrere de to tables, skal vi første have de data i \textbf{Long form}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_long }\OtherTok{\textless{}{-}}\NormalTok{ data\_exper }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols=} \SpecialCharTok{{-}}\NormalTok{x, }
                                        \AttributeTok{names\_to=}\StringTok{"sample"}\NormalTok{,}
                                        \AttributeTok{values\_to=}\StringTok{"measurement"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(data\_long)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##       x sample       measurement
##   <int> <chr>              <dbl>
## 1     2 control_rep1      -0.622
## 2     2 control_rep2      12.1  
## 3     2 control_rep3       8.62 
## 4     2 treat_rep1        10.5  
## 5     2 treat_rep2        -5.79 
## 6     2 treat_rep3        22.3
\end{verbatim}

\hypertarget{fuktionen-left_join-fra-dplyr-pakken}{%
\subsection{\texorpdfstring{Fuktionen \texttt{left\_join()} fra dplyr-pakken}{Fuktionen left\_join() fra dplyr-pakken}}\label{fuktionen-left_join-fra-dplyr-pakken}}

Funktionen \texttt{left\_join()} er en del af pakken \texttt{dplyr} som vi har arbejdet meget med indtil videre i kurset. Her er en meget kort beskrivelse af de fire hoved \texttt{join} funktioner.

\begin{longtable}[]{@{}ll@{}}
\toprule
funktion & Beskrivelse \\
\midrule
\endhead
\texttt{left\_join()} & Join matching rows from second table to the first \\
\texttt{right\_join()} & Join matching rows from the first table to the second \\
\texttt{inner\_join()} & Join two tables, returning all rows present in both \\
\texttt{full\_join()} & Join data with all possible rows present \\
\bottomrule
\end{longtable}

Vi fokuserer her på funktionen \texttt{left\_join()} fordi den er den meste brugbart i biologiske data analyser. Her er en grafiske demonstration af \texttt{left\_join()}:

\textbackslash begin\{figure\}
\includegraphics[width=0.6\linewidth]{plots/left_join} \textbackslash caption\{left\_join graphical demonstration (source \url{https://mgimond.github.io/ES218/Week03c.html})\}\label{fig:unnamed-chunk-310}
\textbackslash end\{figure\}

\hypertarget{anvende-left_join-for-vores-fiktiv-dataset.}{%
\subsection{\texorpdfstring{Anvende \texttt{left\_join()} for vores fiktiv dataset.}{Anvende left\_join() for vores fiktiv dataset.}}\label{anvende-left_join-for-vores-fiktiv-dataset.}}

For at bedste forstå funktionen \texttt{left\_join()} skal vi afprøve den med vores datasæt. Her tager vi udgangspunkt i \texttt{data\_long} og så tilføjer de data fra \texttt{sample\_info}. Her angiver vi \texttt{by\ =\ "sample"} fordi det er navnet til kolonnen som vi geerne vil bruge til at forbinde de to datarammer - altså, det er med i begge to datarammer, så \texttt{left\_join()} kan bruge den som en slags nøgle til at vide, hvor alle de forskellige oplysninger skal tilføjes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_long\_join }\OtherTok{\textless{}{-}}\NormalTok{ data\_long  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{left\_join}\NormalTok{(sample\_info,}\AttributeTok{by =} \StringTok{"sample"}\NormalTok{)}
\NormalTok{data\_long\_join}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 600 x 6
##        x sample       measurement condition replicate batch
##    <int> <chr>              <dbl> <chr>     <chr>     <chr>
##  1     2 control_rep1      -0.622 control   1         A    
##  2     2 control_rep2      12.1   control   2         B    
##  3     2 control_rep3       8.62  control   3         A    
##  4     2 treat_rep1        10.5   treat     1         B    
##  5     2 treat_rep2        -5.79  treat     2         A    
##  6     2 treat_rep3        22.3   treat     3         B    
##  7     4 control_rep1      -5.75  control   1         A    
##  8     4 control_rep2      26.1   control   2         B    
##  9     4 control_rep3      -8.93  control   3         A    
## 10     4 treat_rep1       -13.3   treat     1         B    
## # ... with 590 more rows
\end{verbatim}

Nu at vi har fået forbundet de to datarammer, kan man inddrage de ekstra oplysninger vi har fået i et plot. Her laver vi et plot med en farve til hver kondition og et plot med en farve til hver batch.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gg1 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_long\_join,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{measurement,}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{colour=}\NormalTok{condition)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\FloatTok{0.75}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{())}

\NormalTok{gg2 }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(data\_long\_join,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y=}\NormalTok{measurement,}\AttributeTok{x=}\NormalTok{x,}\AttributeTok{colour=}\NormalTok{batch)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\FloatTok{0.75}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set3"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{())}

\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{grid.arrange}\NormalTok{(gg1,gg2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-312-1.pdf}

Vi kan se, at man kan godt kan skelne imellem de målingerne for de to konditioner, men ikke så meget for de to batches. Det betyder, at vores kondition effekt er stærkere end den batch effekt, som er en god tegn for vores analyse af datasættet.

\hypertarget{iterativ-processer-med-map-fuktioner}{%
\section{\texorpdfstring{Iterativ processer med \texttt{map()} fuktioner}{Iterativ processer med map() fuktioner}}\label{iterativ-processer-med-map-fuktioner}}

Når man lave en interativ proces, vil man gerne lave samme ting gentagne gange. Det kan være for eksempel, at vi har ti variabler og vi gerne vil beregne middelværdien for hver variable. Indenfor biologi er det et meget realistisk scenarie, for eksempel hvis man har mange replikater, konditioner eller tidspunkter og gerne vil beregne noget på dem alle sammen - det kan være at man gerne vil normalisere ekspressionsniveauerne over forskellige gener, osv.

I resten af dette kapitel, lad os beskæftige os med en datasæt der hedder \texttt{eukaryotes}, som indeholder meget oplysninger om forskellige organismer som hører til eukaryotes - for eksempel deres navne, gruppe, sub-gruppe, antal proteins/genes, genom størrelse og så videre. Man kan få de data indlæste med følgende kommando og se en list over for de forskellige kolon navne nedenfor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes }\OtherTok{\textless{}{-}} \FunctionTok{read\_tsv}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/3u4nuj039itzg8l/eukaryotes.tsv?dl=1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 11508 Columns: 19
## -- Column specification --------------------------------------------------------
## Delimiter: "\t"
## chr  (10): organism_name, bioproject_accession, group, subgroup, assembly_ac...
## dbl   (7): taxid, bioproject_id, size_mb, gc, scaffolds, genes, proteins
## date  (2): release_date, modify_date
## 
## i Use `spec()` to retrieve the full column specification for this data.
## i Specify the column types or set `show_col_types = FALSE` to quiet this message.
\end{verbatim}

Vi tager udgangspunkt i kun fire variabler, så for at gøre tingene mere enkel, har jeg brugt \texttt{select()} til at kun får de fire variabler \texttt{organism\_name},\texttt{center},\texttt{group} og \texttt{subgroup} i en dataramme.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#eukaryotes\_full \textless{}{-} eukaryotes}
\NormalTok{eukaryotes\_subset }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(organism\_name, center, group, subgroup)}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   organism_name              center                               group subgroup
##   <chr>                      <chr>                                <chr> <chr>   
## 1 Pyropia yezoensis          Ocean University                     Other Other   
## 2 Emiliania huxleyi CCMP1516 JGI                                  Prot~ Other P~
## 3 Arabidopsis thaliana       The Arabidopsis Information Resourc~ Plan~ Land Pl~
## 4 Glycine max                US DOE Joint Genome Institute (JGI-~ Plan~ Land Pl~
## 5 Medicago truncatula        International Medicago Genome Annot~ Plan~ Land Pl~
## 6 Solanum lycopersicum       Solanaceae Genomics Project          Plan~ Land Pl~
\end{verbatim}

Lad os forestille os, at vi er interesseret i antallet af unikke organismer (variablen \texttt{organism\_name}). Der er en funktion der hedder \texttt{n\_distinct} som beregner antallet af unikke værdier i en vector/variable. Her vælger vi \texttt{organism\_name} og så tilføjer \texttt{n\_distinct()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(organism\_name) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{n\_distinct}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6111
\end{verbatim}

Lad os forestille os, at vi også er interesseret i antallet af unikke værdier i variablerne \texttt{center}, \texttt{group} og \texttt{subgroup} - som er de tre andre kolonner i datasættet. Vi har forskellige muligheder:

\begin{itemize}
\tightlist
\item
  Skrive dem ud - men hvad nu hvis vi havde 100 variabler at håndtere?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(organism\_name) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{n\_distinct}\NormalTok{()}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(center) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{n\_distinct}\NormalTok{()}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{n\_distinct}\NormalTok{()}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(subgroup) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{n\_distinct}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6111
## [1] 2137
## [1] 5
## [1] 19
\end{verbatim}

\begin{itemize}
\tightlist
\item
  Vi kræver en mere automatiske løsning på det. Vi bruger ikke tid på det her, men der er den traditionele programmering løsning: for loop, som fungerer også i R:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{col\_names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(eukaryotes\_subset)}

\ControlFlowTok{for}\NormalTok{(column\_name }\ControlFlowTok{in}\NormalTok{ col\_names)}
\NormalTok{\{}
  \FunctionTok{print}\NormalTok{(eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} 
          \FunctionTok{select}\NormalTok{(column\_name) }\SpecialCharTok{\%\textgreater{}\%} 
          \FunctionTok{n\_distinct}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Note: Using an external vector in selections is ambiguous.
## i Use `all_of(column_name)` instead of `column_name` to silence this message.
## i See <https://tidyselect.r-lib.org/reference/faq-external-vector.html>.
## This message is displayed once per session.
\end{verbatim}

\begin{verbatim}
## [1] 6111
## [1] 2137
## [1] 5
## [1] 19
\end{verbatim}

Man i teorien kan holde sig til for loops men jeg vil gerne præsentere den \texttt{tidyverse} løsning, som bliver mere intuitiv og nemmere for ændre at læse koden når man er vant til det (det integrerer også bedre med de andre \texttt{tidyverse} pakker).

\hypertarget{introduktion-til-map-funktioner}{%
\subsection{\texorpdfstring{Introduktion til \texttt{map()} funktioner}{Introduktion til map() funktioner}}\label{introduktion-til-map-funktioner}}

Den \texttt{tidyverse} løsning til at lave iterativ processer er såkaldte \texttt{map()} funktioner, som er en del af pakken \texttt{purrr} og er stadig relative nye. Jeg introducerer dem her frem for de base-R løsninger ikke bare fordi de er \texttt{tidyverse}, men fordi de er en meget fleksibelt og nemt at forstå tilgang, når man vænner sig til dem.

Jeg viser hvordan de fungere igennem \texttt{eukaryotes} og bagefter introducerer dem i konteksten af custom funktioner og \texttt{nest()} som kan bruges til at opdele datasættet indtil forskellige dele (ovenpå hvori man kan lave flere iterativ processer).

\texttt{map()} er det \texttt{tidyverse} svar til en for loop (eller \texttt{apply} hvis man har kendskab til det). Man anvender \texttt{map()} ved at angiv funktionen navn \texttt{n\_distinct} indenfor \texttt{map()}, og \texttt{map()} beregner \texttt{n\_distinct()} for hver kolon i datasættet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map}\NormalTok{(n\_distinct) }\CommentTok{\#do \textquotesingle{}n\_distinct\textquotesingle{} for every single column}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $organism_name
## [1] 6111
## 
## $center
## [1] 2137
## 
## $group
## [1] 5
## 
## $subgroup
## [1] 19
\end{verbatim}

Så kan man se, at vi har fået en \texttt{list} tilbage, med en tal som viser antallet af unikke værdier til hver af de fire kolonner. Det fungerer lidt som den base-R funktion \texttt{apply}, men med \texttt{apply} skal man bruge \texttt{2} i anden plads til at fortælle, at vi gerne vil iterate over kolonnerne.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{apply}\NormalTok{(eukaryotes\_subset,}\DecValTok{2}\NormalTok{,n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## organism_name        center         group      subgroup 
##          6111          2137             5            19
\end{verbatim}

Bemærk at vi har fået her en vector af tal tilbage, men vi fået en \texttt{list} med \texttt{map}. Der er faktisk andre varianter af \texttt{map} som kan benyttes til at give resultatet som andre data typer. For eksempel, kan man bruge \texttt{map\_dbl()} til at få en double \texttt{dbl} tilbage - en vector af tal ligesom vi fået med \texttt{apply} i ovenstående.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Apply n\_distinct to all variables, returning a double}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_dbl}\NormalTok{(n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## organism_name        center         group      subgroup 
##          6111          2137             5            19
\end{verbatim}

Man kan også bruge \texttt{map\_df()} for at få en dataramme (\texttt{tibble}) tilbage - det er særligt nyttigt for os, fordi vi tager altid udgangspunkt i en dataramme når vi skal få lavet et plot.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Apply n\_distinct to all variables, returning a dataframe}
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##   organism_name center group subgroup
##           <int>  <int> <int>    <int>
## 1          6111   2137     5       19
\end{verbatim}

For eksempel, kan man tilføje de tal fra \texttt{map\_df} direkte ind i et ggplot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{map\_df}\NormalTok{(n\_distinct) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\FunctionTok{everything}\NormalTok{(), }\AttributeTok{names\_to =} \StringTok{"variable"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"count"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ variable, }\AttributeTok{y =}\NormalTok{ count,}\AttributeTok{fill =}\NormalTok{ variable)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-322-1.pdf}

\hypertarget{reference-for-the-different-map-functions}{%
\subsection{Reference for the different map functions}\label{reference-for-the-different-map-functions}}

\begin{longtable}[]{@{}ll@{}}
\toprule
Funktion & Beskrivelse \\
\midrule
\endhead
\texttt{map\_lgl()} & returns a logical \\
\texttt{map\_int()} & returns an integer vector \\
\texttt{map\_dbl()} & returns a double vector \\
\texttt{map\_chr()} & returns a character vector \\
\texttt{map\_df()} & returns a data frame \\
\bottomrule
\end{longtable}

\hypertarget{custom-functions}{%
\section{Custom functions}\label{custom-functions}}

Vi kan lave vores egne funktioner og betnytter dem indenfor map til at yderligere øge fleksibiliteten i R. For eksempel, kan det være at vi har en bestemt idé overfor, hvordan vi gerne vil normalisere vores data, og der eksisterer ikke en relevant funktion indenfor R i forvejen.

\hypertarget{simple-functions}{%
\subsection{Simple functions}\label{simple-functions}}

Vi starter med en simpel funktion fra base-R og så forklare den i den table bagefter. Vi bruger mest en anden form af funktioner i \textbf{tidyverse} som vi kigger på næste, men koncepten er den samme.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_function }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(.x)}
\NormalTok{\{}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{sum}\NormalTok{(.x)}\SpecialCharTok{/}\FunctionTok{length}\NormalTok{(.x))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}ll@{}}
\toprule
Kode & Beskrivelse \\
\midrule
\endhead
\texttt{my\_function\_name} & funktion navn \\
\texttt{\textless{}-\ function(.x)} & fortæl R, at vi lave en funktion med nogle data \texttt{.x} \\
\texttt{sum(.x)/length(.x)} & brug data \texttt{.x} til at beregne middelværdi \\
\texttt{return()} & hvad funktionen skal output - her middelværdi \\
\bottomrule
\end{longtable}

Lad også afprøve vores nye funccion ved at beregne den gennemsnitlige værdi for \texttt{Sepal.Length} i \texttt{iris}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{my\_function}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\FunctionTok{mean}\NormalTok{(iris}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5.843333
## [1] 5.843333
\end{verbatim}

\hypertarget{custom-functions-with-mapping}{%
\subsection{Custom functions with mapping}\label{custom-functions-with-mapping}}

Indenfor den \texttt{tidyverse} bruger man en lidt anden måde at skrive samme funktion på.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_function }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{sum}\NormalTok{(.x)}\SpecialCharTok{/}\FunctionTok{length}\NormalTok{(.x)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{\textasciitilde{}} betyder at vi definere en funktion
\item
  \texttt{.x} betyder de data, der vi angiver funktionen (for eksempel variablen \texttt{Sepal.Length} fra \texttt{iris}). Man bruger den symbol \texttt{.x} hver gang og R ved automatiske hvad det betyder.
\end{itemize}

Vi kan bruge \texttt{my\_function} indenfor \texttt{map()} for at beregne den gennemsnitlige værdi for alle variabler (uden Species), og vi kan se at vi få tilsvarende resultat til funktionen \texttt{mean()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{map\_df}\NormalTok{(my\_function)}

\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{map\_df}\NormalTok{(mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##          <dbl>       <dbl>        <dbl>       <dbl>
## 1         5.84        3.06         3.76        1.20
## # A tibble: 1 x 4
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##          <dbl>       <dbl>        <dbl>       <dbl>
## 1         5.84        3.06         3.76        1.20
\end{verbatim}

Man kan også placere funktionen direkte indenfor \texttt{map\_df} i stedet for at kalde den for nogle (fk. \texttt{my\_funktion}):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{sum}\NormalTok{(.x)}\SpecialCharTok{/}\FunctionTok{length}\NormalTok{(.x)) }\CommentTok{\#for each data column, compute the sum and divide by the length}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##          <dbl>       <dbl>        <dbl>       <dbl>
## 1         5.84        3.06         3.76        1.20
\end{verbatim}

Vi kan godt specificere andre funktioner.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{nth}\NormalTok{(.x,}\DecValTok{10}\NormalTok{)) }\CommentTok{\#tag hver kolon, kalde det for .x og finde 10. værdi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          <dbl>       <dbl>        <dbl>       <dbl> <fct>  
## 1          4.9         3.1          1.5         0.1 setosa
\end{verbatim}

eller når \texttt{nth} is a \textbf{tidyverse} funktion kan vi bruge \texttt{\%\textgreater{}\%}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{.x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nth}\NormalTok{(}\DecValTok{10}\NormalTok{)) }\CommentTok{\#tag hver kolon, kalde det for .x og finde 10. værdi}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          <dbl>       <dbl>        <dbl>       <dbl> <fct>  
## 1          4.9         3.1          1.5         0.1 setosa
\end{verbatim}

Antallet af distinkt værdier som ikke er \texttt{NA}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#tag hver kolon, kalde det for .x og beregne n\_distinct}

\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{n\_distinct}\NormalTok{(.x,}\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          <int>       <int>        <int>       <int>   <int>
## 1           35          23           43          22       3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{.x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{n\_distinct}\NormalTok{(}\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\CommentTok{\#fordi n\_dinstict er fra tidyverse}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          <int>       <int>        <int>       <int>   <int>
## 1           35          23           43          22       3
\end{verbatim}

Bemærk at hvis det er en indbygget funktion og vi benytter default parametre (altså na.rm = FALSE i ovenstående) kan man bare skrive:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 5
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##          <int>       <int>        <int>       <int>   <int>
## 1           35          23           43          22       3
\end{verbatim}

Et andet eksempel: tilføje 3 og square:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{(.x }\SpecialCharTok{+} \DecValTok{3}\NormalTok{)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
##          <dbl>       <dbl>        <dbl>       <dbl>
## 1         65.6        42.2         19.4        10.2
## 2         62.4        36           19.4        10.2
## 3         59.3        38.4         18.5        10.2
## 4         57.8        37.2         20.2        10.2
## 5         64          43.6         19.4        10.2
## 6         70.6        47.6         22.1        11.6
\end{verbatim}

Jo mere funktionen bliver indviklet, jo mere mening det giver at specificere den udenfor den \texttt{map()} funktion:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_function }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\NormalTok{(.x }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(.x))}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{+} \FloatTok{0.5}\SpecialCharTok{*}\NormalTok{(.x }\SpecialCharTok{{-}} \FunctionTok{sd}\NormalTok{(.x))}\SpecialCharTok{\^{}}\DecValTok{2} \CommentTok{\#en lang funktion}

\NormalTok{iris }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(my\_function) }\CommentTok{\#beregne my\_function for hver kolon og output en dataramme }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 150 x 4
##    Sepal.Length Sepal.Width Petal.Length Petal.Width
##           <dbl>       <dbl>        <dbl>       <dbl>
##  1         9.68        4.89         5.63       1.16 
##  2         9.18        3.29         5.63       1.16 
##  3         8.80        3.84         6.15       1.16 
##  4         8.66        3.55         5.13       1.16 
##  5         9.41        5.30         5.63       1.16 
##  6        10.6         6.71         4.24       0.705
##  7         8.66        4.51         5.63       0.916
##  8         9.41        4.51         5.13       1.16 
##  9         8.46        3.06         5.63       1.16 
## 10         9.18        3.55         5.13       1.43 
## # ... with 140 more rows
\end{verbatim}

\hypertarget{nesting-nest}{%
\section{\texorpdfstring{Nesting \texttt{nest()}}{Nesting nest()}}\label{nesting-nest}}

Vi kommer til at se i næste lektion, at det er meget nyttige at bruge funktionen \texttt{nest()} for at få svar på adskillige statistiske spørgsmål. Det kan være for eksempel:

\begin{itemize}
\tightlist
\item
  Vi har lavet 10 eksperimental under lidt forskellige konditioner, og gerne vil lave præcis samme analyse på alle 10.
\item
  Vi har 5 forskellige type bakterier med 3 replikater til hver, og gerne vil transformere de data på samme måde efter bakterien og replikat.
\end{itemize}

Funktionen \texttt{nest()} kan virke lidt abstract i starten men koncepten er faktisk ret simpelt. Vi kan opelde vores datasæt (som indeholder vores forskellige konditioner/replikats etc.) med \texttt{group\_by()} og så bruge \texttt{nest()} til at gemme de opdelt ``sub'' datasæt i en list. De bliver gemt indenfor en kolon i en \texttt{tibble}, og det gøre det bekvemt at arbejde med de forskellige datasæt på samme tid (med hjælp af \texttt{map()}).

\includegraphics[width=1\linewidth]{plots/tidyr-nest}

Lad os opdele \texttt{eurkaryotes\_subset} efter variablen `group' og anvende \texttt{nest()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset\_nested }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_subset }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{()}

\NormalTok{eukaryotes\_subset\_nested}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
## # Groups:   group [5]
##   group    data                
##   <chr>    <list>              
## 1 Other    <tibble [51 x 3]>   
## 2 Protists <tibble [888 x 3]>  
## 3 Plants   <tibble [1,304 x 3]>
## 4 Fungi    <tibble [6,064 x 3]>
## 5 Animals  <tibble [3,201 x 3]>
\end{verbatim}

Vi kan se at vi har to variabler - \texttt{group} og \texttt{data}. Variablen \texttt{data} er indeholde faktisk fem dataramme (tibble), for eksempel den første datasæt har kun observationerne hvor \texttt{group} er lig med ``Other'', den anden dataset har kun observationerne hvor \texttt{group} er lig med ``Protists'' osv.

Vi kan tjekke ved at kig på den første datasæt: her er to måder at gøre det på:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{first\_dataset }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_subset\_nested}\SpecialCharTok{$}\NormalTok{data[[}\DecValTok{1}\NormalTok{]] }
\NormalTok{first\_dataset }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_subset\_nested }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pluck}\NormalTok{(}\StringTok{"data"}\NormalTok{,}\DecValTok{1}\NormalTok{)}
\NormalTok{first\_dataset }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   organism_name                         center                          subgroup
##   <chr>                                 <chr>                           <chr>   
## 1 Pyropia yezoensis                     Ocean University                Other   
## 2 Thalassiosira pseudonana CCMP1335     Diatom Consortium               Other   
## 3 Guillardia theta CCMP2712             JGI                             Other   
## 4 Cyanidioschyzon merolae strain 10D    National Institute of Genetics~ Other   
## 5 Galdieria sulphuraria                 Galdieria sulphuraria Genome P~ Other   
## 6 Phaeodactylum tricornutum CCAP 1055/1 Diatom Consortium               Other
\end{verbatim}

Hvis vi gerne vil tilbage til vores oprindeligt datasæt, kan vi brug \texttt{unnest()} og specificer kolonnen \texttt{data}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset\_nested }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unnest}\NormalTok{(data) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
## # Groups:   group [1]
##   group organism_name                         center                    subgroup
##   <chr> <chr>                                 <chr>                     <chr>   
## 1 Other Pyropia yezoensis                     Ocean University          Other   
## 2 Other Thalassiosira pseudonana CCMP1335     Diatom Consortium         Other   
## 3 Other Guillardia theta CCMP2712             JGI                       Other   
## 4 Other Cyanidioschyzon merolae strain 10D    National Institute of Ge~ Other   
## 5 Other Galdieria sulphuraria                 Galdieria sulphuraria Ge~ Other   
## 6 Other Phaeodactylum tricornutum CCAP 1055/1 Diatom Consortium         Other
\end{verbatim}

Spørgsmålet er: hvordan kan vi inddrage ``nested'' data indenfor vores analyser?

\hypertarget{anvende-map-med-nested-data}{%
\subsection{Anvende map() med nested data}\label{anvende-map-med-nested-data}}

De fleste gange vi arbejder med nested data, er fordi vi gerne vil lave samme ting på hver af de ``sub'' datasæt. Derfor hænger det sammen med funktionen \texttt{map()}. Den typiske process er:

\begin{itemize}
\tightlist
\item
  Tag nested datasæt
\item
  Tilføj en ny kolon med \texttt{mutate()}, hvor vi:
\item
  Tag hver datasæt fra kolonnen \texttt{data} og brug \texttt{map()}, i nedenstående tilfælde til at finde antallet af rækkerne.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_subset\_nested }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_row =} \FunctionTok{map\_dbl}\NormalTok{(data,nrow))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
## # Groups:   group [5]
##   group    data                 n_row
##   <chr>    <list>               <dbl>
## 1 Other    <tibble [51 x 3]>       51
## 2 Protists <tibble [888 x 3]>     888
## 3 Plants   <tibble [1,304 x 3]>  1304
## 4 Fungi    <tibble [6,064 x 3]>  6064
## 5 Animals  <tibble [3,201 x 3]>  3201
\end{verbatim}

Vi kan også bruge en custom funktion. I nedenstående beregne man antallet af unikke organisme fra variablen \texttt{orangism\_name} i datasættet. Husk:

\begin{itemize}
\tightlist
\item
  \texttt{\textasciitilde{}} betyder at vi lave en funktion, som kommer til at fungere for alle de fem datasæt.
\item
  Tag et datasæt og kalde det for \texttt{.x} - det referer til en bestemt datasæt fra en af de fem datasæt som hører under kolonnen \texttt{data} i den \texttt{nest()} data.
\item
  Vælg variablen \texttt{organism\_name} fra \texttt{.x}
\item
  Beregn \texttt{n\_dinstinct}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{n\_distinct\_organisms }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\#take data}
  \FunctionTok{select}\NormalTok{(organism\_name) }\SpecialCharTok{\%\textgreater{}\%}  \CommentTok{\#select organism name}
\NormalTok{  n\_distinct }\CommentTok{\#give back distinct}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#repeat function for each of the five datasets:}
\NormalTok{eukaryotes\_subset\_nested }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_organisms =} \FunctionTok{map\_dbl}\NormalTok{(data, n\_distinct\_organisms))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
## # Groups:   group [5]
##   group    data                 n_organisms
##   <chr>    <list>                     <dbl>
## 1 Other    <tibble [51 x 3]>             35
## 2 Protists <tibble [888 x 3]>           490
## 3 Plants   <tibble [1,304 x 3]>         673
## 4 Fungi    <tibble [6,064 x 3]>        2926
## 5 Animals  <tibble [3,201 x 3]>        1987
\end{verbatim}

Her er en anden eksempel. Her handler det om de \texttt{eukaryotes} data (ikke den subset), som har oplysninger om fk. GC-content med variablen \texttt{gc}. Her bruger vi \texttt{pull} i stedet for \texttt{select} - det er næsten den samme men med \texttt{pull()} få vi en vector som fungerer med \texttt{median} som er en base-R funktion.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{func\_gc }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(gc) }\SpecialCharTok{\%\textgreater{}\%}       \CommentTok{\# ligesom select men vi har bruge for en vector for at beregne median}
  \FunctionTok{median}\NormalTok{(.x,}\AttributeTok{na.rm=}\NormalTok{T) }\CommentTok{\# \textasciigrave{}na.rm\textasciigrave{} fjerne \textasciigrave{}NA\textasciigrave{} værdier)}

\NormalTok{ekaryotes\_gc\_by\_group }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\StringTok{"median\_gc"}\OtherTok{=}\FunctionTok{map\_dbl}\NormalTok{(data, func\_gc))}
\NormalTok{ekaryotes\_gc\_by\_group}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
## # Groups:   group [5]
##   group    data                  median_gc
##   <chr>    <list>                    <dbl>
## 1 Other    <tibble [51 x 18]>         46.7
## 2 Protists <tibble [888 x 18]>        49.4
## 3 Plants   <tibble [1,304 x 18]>      37.9
## 4 Fungi    <tibble [6,064 x 18]>      47.5
## 5 Animals  <tibble [3,201 x 18]>      40.6
\end{verbatim}

Og jeg kan bruge resultatet ind i et plot ligesom vi plejer:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ekaryotes\_gc\_by\_group }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{group,}\AttributeTok{y=}\NormalTok{median\_gc,}\AttributeTok{fill=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-342-1.pdf}

\textbf{flere statistik på en gang}

Lave funktionerne:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{func\_genes }\OtherTok{\textless{}{-}}    \ErrorTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(genes)     }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{median}\NormalTok{(.x,}\AttributeTok{na.rm=}\NormalTok{T)}
\NormalTok{func\_proteins }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(proteins)  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{median}\NormalTok{(.x,}\AttributeTok{na.rm=}\NormalTok{T)}
\NormalTok{func\_size }\OtherTok{\textless{}{-}}     \ErrorTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(size\_mb)   }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{median}\NormalTok{(.x,}\AttributeTok{na.rm=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

Anvende \texttt{nest()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_nested }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

Tilføje resultatet over de fem datasæt med \texttt{mutate()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_stats }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_nested }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mean\_genes =} \FunctionTok{map\_dbl}\NormalTok{(data,func\_genes),}
         \AttributeTok{proteins =} \FunctionTok{map\_dbl}\NormalTok{(data,func\_proteins),}
         \AttributeTok{mean\_size\_mb =} \FunctionTok{map\_dbl}\NormalTok{(data,func\_size))}
\end{Highlighting}
\end{Shaded}

Husk at fjerne kolonnen \texttt{data} før man anvende \texttt{pivot\_longer()} (ellers får man en advarsel):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_stats }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{group) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{group,}\AttributeTok{y=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name,}\AttributeTok{scales=}\StringTok{"free"}\NormalTok{,}\AttributeTok{ncol=}\DecValTok{4}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-346-1.pdf}

\hypertarget{problemstillinger-6}{%
\section{Problemstillinger}\label{problemstillinger-6}}

\textbf{1}) Lave Quiz på Absalon ``Quiz - tables, maps and functions''

\textbf{2}) \emph{\texttt{left\_join()} øvelse}. Kør følgende kode:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{superheroes }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
       \SpecialCharTok{\textasciitilde{}}\NormalTok{name, }\SpecialCharTok{\textasciitilde{}}\NormalTok{alignment,  }\SpecialCharTok{\textasciitilde{}}\NormalTok{gender,          }\SpecialCharTok{\textasciitilde{}}\NormalTok{publisher,}
   \StringTok{"Magneto"}\NormalTok{,      }\StringTok{"bad"}\NormalTok{,   }\StringTok{"male"}\NormalTok{,            }\StringTok{"Marvel"}\NormalTok{,}
     \StringTok{"Storm"}\NormalTok{,     }\StringTok{"good"}\NormalTok{, }\StringTok{"female"}\NormalTok{,            }\StringTok{"Marvel"}\NormalTok{,}
  \StringTok{"Mystique"}\NormalTok{,      }\StringTok{"bad"}\NormalTok{, }\StringTok{"female"}\NormalTok{,            }\StringTok{"Marvel"}\NormalTok{,}
    \StringTok{"Batman"}\NormalTok{,     }\StringTok{"good"}\NormalTok{,   }\StringTok{"male"}\NormalTok{,                }\StringTok{"DC"}\NormalTok{,}
     \StringTok{"Joker"}\NormalTok{,      }\StringTok{"bad"}\NormalTok{,   }\StringTok{"male"}\NormalTok{,                }\StringTok{"DC"}\NormalTok{,}
  \StringTok{"Catwoman"}\NormalTok{,      }\StringTok{"bad"}\NormalTok{, }\StringTok{"female"}\NormalTok{,                }\StringTok{"DC"}\NormalTok{,}
   \StringTok{"Hellboy"}\NormalTok{,     }\StringTok{"good"}\NormalTok{,   }\StringTok{"male"}\NormalTok{, }\StringTok{"Dark Horse Comics"}
\NormalTok{  )}

\NormalTok{publishers }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{publisher, }\SpecialCharTok{\textasciitilde{}}\NormalTok{yr\_founded,}
        \StringTok{"DC"}\NormalTok{,       1934L,}
    \StringTok{"Marvel"}\NormalTok{,       1939L,}
     \StringTok{"Image"}\NormalTok{,       1992L}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Vi har to tables - \texttt{superheroes} og \texttt{publishers}. Hvilke kolon kan man bruge til at forbinde de to tables? Brug \texttt{left\_join()} til at tilføje oplysninger fra \texttt{publishers} til datarammen \texttt{superheroes}.

\begin{itemize}
\tightlist
\item
  Få man alle observationer fra superheroes med i resultatet?
\item
  Benyt \texttt{inner\_join()} til at forbinde publishers til superheroes - få man så nu alle observationer med?
\item
  Benyt \texttt{full\_join()} til at forbinde publishers til superheroes - hvor mange observationer få man med nu? Hvorfor?
\end{itemize}

\textbf{3}) \emph{\texttt{left\_join()} øvelse}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(iris)}
\NormalTok{iris2 }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(iris)}
\FunctionTok{names}\NormalTok{(iris2) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"sample1"}\NormalTok{,}\StringTok{"sample2"}\NormalTok{,}\StringTok{"sample3"}\NormalTok{,}\StringTok{"sample4"}\NormalTok{,}\StringTok{"Species"}\NormalTok{)}
\NormalTok{samp\_table }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
                      \SpecialCharTok{\textasciitilde{}}\NormalTok{sample, }\SpecialCharTok{\textasciitilde{}}\NormalTok{part, }\SpecialCharTok{\textasciitilde{}}\NormalTok{measure,}
                      \CommentTok{\#{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}{-}\#}
                      \StringTok{"sample1"}\NormalTok{, }\StringTok{"Sepal"}\NormalTok{, }\StringTok{"Length"}\NormalTok{,}
                      \StringTok{"sample2"}\NormalTok{, }\StringTok{"Sepal"}\NormalTok{, }\StringTok{"Width"}\NormalTok{,}
                      \StringTok{"sample3"}\NormalTok{, }\StringTok{"Petal"}\NormalTok{, }\StringTok{"Length"}\NormalTok{,}
                      \StringTok{"sample4"}\NormalTok{, }\StringTok{"Sepal"}\NormalTok{, }\StringTok{"Width"}
\NormalTok{                     )}


\FunctionTok{head}\NormalTok{(iris2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   sample1 sample2 sample3 sample4 Species
##     <dbl>   <dbl>   <dbl>   <dbl> <fct>  
## 1     5.1     3.5     1.4     0.2 setosa 
## 2     4.9     3       1.4     0.2 setosa 
## 3     4.7     3.2     1.3     0.2 setosa 
## 4     4.6     3.1     1.5     0.2 setosa 
## 5     5       3.6     1.4     0.2 setosa 
## 6     5.4     3.9     1.7     0.4 setosa
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{samp\_table}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##   sample  part  measure
##   <chr>   <chr> <chr>  
## 1 sample1 Sepal Length 
## 2 sample2 Sepal Width  
## 3 sample3 Petal Length 
## 4 sample4 Sepal Width
\end{verbatim}

Man kan se, at vi har to tables - \texttt{iris2} og \texttt{sample\_table}. \texttt{iris2} er ikke særlig informativ med hensyn til hvad de samples er, men oplysningerne stå i \texttt{sample\_table}. Bruge \texttt{left\_join()} til at tilføje \texttt{sample\_table} til \texttt{iris2} for at få en dataramme som indeholder både de data og de samples oplysninger.

\textbf{4}) \emph{\texttt{map()} øvelse}

Eksempel:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(cut,color,depth) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##     cut color depth
##   <int> <int> <int>
## 1     5     7   184
\end{verbatim}

Husk også referencen med de forskellige varianter af \texttt{map()} som kan bruges for at få en anden output type.

Indlæse \texttt{diamonds} med \texttt{data(diamonds)}. Brug \texttt{map()} funktioner til at beregne følgende:

\begin{itemize}
\tightlist
\item
  Select variabler \texttt{carat}, \texttt{depth}, \texttt{table} og \texttt{price} og beregne den median værdi til hver. Resultatet skulle være en list (anvende deault \texttt{map()} funktion).
\item
  Select variabler \texttt{cut}, \texttt{color} og \texttt{clarity} og beregne antallet af distinkt værdier til hver. Resultatet skal være en double.
\item
  Select alle variabler og return de datatyper (funktion en \texttt{typeof()}). Resultatet skal være en dataramme.
\end{itemize}

\textbf{5}) \emph{\texttt{map()} øvelse med funktioner}

Indlæse \texttt{diamonds} med \texttt{data(diamonds)}.

Husk at når man inddrager nogle data \texttt{.x}, for eksempel når man vil bruge en custom funktion eller specificer non-default indstillinger såsom \texttt{na.rm=TRUE} (for at fjerne \texttt{NA} værdier i beregningen) i funktionen, skal man angiv \texttt{\textasciitilde{}} i starten:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(n\_distinct) }\CommentTok{\#specificere funktion unden instillinger}
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{n\_distinct}\NormalTok{(.x,}\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\CommentTok{\#non{-}default funktion}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Afprøve følgende kode linjer og beskrive hvad der sker.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(carat, depth, price) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{(.x}\SpecialCharTok{{-}}\FunctionTok{mean}\NormalTok{(.x)) )}
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(carat, depth, price) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{ifelse}\NormalTok{(.x}\SpecialCharTok{\textgreater{}}\FunctionTok{mean}\NormalTok{(.x),}\StringTok{"big\_value"}\NormalTok{,}\StringTok{"small\_value"}\NormalTok{))}
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(cut}\SpecialCharTok{==}\StringTok{"Ideal"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\StringTok{"color"}\NormalTok{,}\StringTok{"clarity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{sum}\NormalTok{(.x}\SpecialCharTok{==}\FunctionTok{nth}\NormalTok{(.x,}\DecValTok{1}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

Brug funktioner indenfor \texttt{map()} til at beregne følgende:

\begin{itemize}
\tightlist
\item
  Select alle variabler og output den 100th observation. Resultatet skal være en list.
\item
  Select variabler \texttt{carat}, \texttt{depth}, \texttt{table} og \texttt{price} og for hver kolon tilføj tre og så tag square (\texttt{\^{}2}). Resultatet skal være en dataramme.
\item
  Select variabler \texttt{carat}, \texttt{depth}, \texttt{table} og \texttt{price} og angiv \texttt{TRUE} hvis den første værdi er større en den median værdi, ellers \texttt{FALSE}. Resultatet skal være en logical.
\item
  Select variabler \texttt{carat}, \texttt{depth}, \texttt{table} og \texttt{price} og beregne den \texttt{log2} transformering til være. Resultatet skal være en dataramme. Brug resulterende dataramme til at lave et scatter plot af \(\log2\)(\texttt{caret}) på x-aksen og \(\log2\)(\texttt{price}) på y-aksen.
\end{itemize}

\textbf{6}) \emph{nest øvelse}

\textbf{a}) For datasættet \texttt{iris}, anvend \texttt{group\_by(Species)} og tilføj dernæst \texttt{nest()}, og kigger på resultatet.

\begin{itemize}
\tightlist
\item
  tilføj \texttt{pull(data)} og se på resultatet
\item
  tilføj prøve også \texttt{pluck("data",1)} for at se den første dataramme.
\item
  tilføj \texttt{unnest(data)} i stedet for og se på resultatet
\item
  tilføj følgende i stedet for og prøve at forstå hvad der sker:

  \begin{itemize}
  \tightlist
  \item
    \texttt{mutate(new\_column\_nrow\ =\ map\_dbl(data,nrow))}
  \item
    \texttt{mutate(new\_column\_cor\ =\ map\_dbl(data,\textasciitilde{}cor(.x\$Sepal.Width,.x\$Sepal.Length)))}
  \item
    \texttt{mutate(new\_column\_sum\_SW\ =\ map\_dbl(data,\textasciitilde{}.x\ \%\textgreater{}\%\ pull(Sepal.Width)\ \%\textgreater{}\%\ sum))}
  \end{itemize}
\item
  Bemærk at vi har brugt \texttt{map\_dbl} til at få tal som vi nemt kan læse i kolonner - prøve bare \texttt{map()} i stedet for og se resultatet. Man er nødt til at bruge \texttt{unnest()} til at se resultatet i dette tilfælde.
\end{itemize}

\textbf{b})

\begin{itemize}
\tightlist
\item
  Afprøve følgende funktioner indenfor samme ramme og angiv hensigtsmæssigt kolon navne i \texttt{mutate()}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func\_1 }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\NormalTok{.x }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(Petal.Length,Petal.Width) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  sum}

\NormalTok{my\_func\_2 }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{cor}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{Sepal.Width,.x}\SpecialCharTok{$}\NormalTok{Sepal.Length)}


\NormalTok{my\_func\_3 }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{t.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{Petal.Width,.x}\SpecialCharTok{$}\NormalTok{Sepal.Length)}\SpecialCharTok{$}\NormalTok{statistic}
\end{Highlighting}
\end{Shaded}

\textbf{c})

\begin{itemize}
\tightlist
\item
  Indenfor samme ramme tilføj selv kode linjer som beregner til hver af de tre datasæt:

  \begin{itemize}
  \tightlist
  \item
    den maksimum værdi
  \item
    den maksimum værdi for \texttt{Petal.Width}
  \item
    den gennemsnitlige værdi af \texttt{Petal.Width/Petal.Length}
  \item
    den gennemsnitlige værdi af \texttt{Sepal.Width\textgreater{}3}
  \end{itemize}
\end{itemize}

\textbf{d})

\begin{itemize}
\tightlist
\item
  Lav et barplot for nogle dine beregninger, adskilte efter de forskellige statistikker.

  \begin{itemize}
  \tightlist
  \item
    Husk at få fjernet kolonnen \texttt{data} før man anvende \texttt{pivot\_long()}.
  \end{itemize}
\end{itemize}

\textbf{7}) \emph{Introduktion til næste lektion}

For at se værdien af at bruge \texttt{group\_by()} og \texttt{nest()} kan vi gennemgå en simpel eksampel som indledning til vores næste lektion.

Tag funktionen:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{t.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{Petal.Width,.x}\SpecialCharTok{$}\NormalTok{Sepal.Length)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  anvend \texttt{group\_by(Species)} og dernæst \texttt{nest()} som i sidste spørgsmål
\item
  tilføj \texttt{mutate()} til at lave en ny kolon som hedder \texttt{t\_test} og bruge funktionen indenfor \texttt{map()}.
\item
  tilføj \texttt{pull(t\_test)} - man får de tre t-test frem, som man lige har beregnet.
\item
  prøv \texttt{unnest(t\_test)} i stedet for \texttt{pull(t\_test)} - man får en advarsel fordi de t-test resultater ikke er i en god form til at vise indenfor en dataramme. Vi vil gerne gøre dem tidy først.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\begin{itemize}
\tightlist
\item
  Nu installer R-pakken \texttt{broom} (\texttt{install.packages("broom")})
\item
  Lav samme som ovenstående men bruge følgende funktion i stedet for.
\item
  \texttt{glance()} få de statistik fra \texttt{t.test()} ind i en pæn form (\textbf{tidy})
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: pakke 'broom' blev bygget under R version 4.0.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}} \FunctionTok{t.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{Petal.Width,.x}\SpecialCharTok{$}\NormalTok{Sepal.Length) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glance}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Tilføj \texttt{pull} eller \texttt{unnest} som før og se på resultatet.
\item
  Man får en pæn dataramme frem med alle de forskellige statistik fra \texttt{t.test()}.
\end{itemize}

\hypertarget{ekstra-notater-og-nuxe6ste-gang}{%
\section{Ekstra notater og næste gang}\label{ekstra-notater-og-nuxe6ste-gang}}

\url{https://r4ds.had.co.nz/iteration.html}
\url{https://sanderwuyts.com/en/blog/purrr-tutorial/}

\hypertarget{visualising-trends}{%
\chapter{Visualising trends}\label{visualising-trends}}

\includegraphics[width=0.15\linewidth]{plots/hex-tidyverse}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#load packages}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{library}\NormalTok{(broom)}
\FunctionTok{library}\NormalTok{(glue)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE Warning: pakke 'glue' blev bygget under R version 4.0.5
\end{verbatim}

\hypertarget{indledning-og-luxe6ringsmuxe5lene-1}{%
\section{Indledning og læringsmålene}\label{indledning-og-luxe6ringsmuxe5lene-1}}

\hypertarget{luxe6ringsmuxe5lene-3}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-3}}

I skal være i stand til at

\begin{itemize}
\tightlist
\item
  Anvende \texttt{nest()} og \texttt{map()} strukturen til at gentage en korrelation analyse over flere forskellige datasæt.
\item
  Bruge \texttt{ggplot} funktion \texttt{geom\_smooth()} til at visualisere lineær regression eller loess trend linjer.
\item
  Kombinere \texttt{map()} og \texttt{lm()} til at beregne regression statistike for flere lineær regression modeller og tilføje dem til plottet til at gøre det mere informativ.
\end{itemize}

\hypertarget{introduktion-til-chapter-1}{%
\subsection{Introduktion til chapter}\label{introduktion-til-chapter-1}}

I dette chapter demonstranter jeg hvordan man anvende den \texttt{nest()} og \texttt{map()} struktur som vi så sidste gange til at lave statistiske analyser med korrelation og lineær regression. Vi lærer hvordan vi kan visualisere trends og korrelations og tilføj relevante statistikker til plots til at gøre dem endnu mere informativ.

\hypertarget{video-ressourcer-4}{%
\subsection{Video ressourcer}\label{video-ressourcer-4}}

(OBS: kunne desværre ikke nå videoerne til i dag pga. forkølelse/travlhed men kan eventuelle lave dem senere hvis der er efterspørgsel)

\begin{itemize}
\tightlist
\item
  Video 0: Korrelation koefficient med \texttt{nest()} og \texttt{map()}
\item
  Video 1: Lineær regression linjer med ggplot2
\item
  Video 2: Lineær regression med \texttt{nest()} og \texttt{map()}
\item
  Video 3: Tilføj labels med \texttt{lm()} statistik på plottet
\end{itemize}

\hypertarget{nest-og-map-eksempel-med-korrelation}{%
\section{\texorpdfstring{\texttt{nest()} og \texttt{map()}: eksempel med korrelation}{nest() og map(): eksempel med korrelation}}\label{nest-og-map-eksempel-med-korrelation}}

Vi kigger på korrelation analyse først men gentage samme struktur med \texttt{nest()} og \texttt{map()} når vi gennemgå lineær regression.

\hypertarget{korrelation-analyse-i-r}{%
\subsection{Korrelation analyse i R}\label{korrelation-analyse-i-r}}

Man kan lave en korrelation analyse i R ved at anvende \texttt{cor.test()}. For eksempel, forestille os at vi gerne vil finde ud af korrelationen mellem gc content (variablen \texttt{gc}) og genes (variablen \texttt{genes}) for de data \texttt{eukaryotes} fra sidste lektion. Vi plotter en histogram og beslutter os for at lave korrelation mellem \texttt{gc} og den transformerede variable \texttt{log10(genes)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{log10\_size\_mb =} \FunctionTok{log10}\NormalTok{(size\_mb)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(log10\_size\_mb,gc) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\FunctionTok{everything}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{name)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins=}\DecValTok{40}\NormalTok{,}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name,}\AttributeTok{scales=}\StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 388 rows containing non-finite values (stat_bin).
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-369-1.pdf}

Vi mistænkter, at der kan være nogle sub-struturer indenfor de data - for eksempel over de forskellige organismer grupper i variablen \texttt{Group}. Vi benytter alligevel \texttt{cor.test()} til at teste for korrelation mellem \texttt{gc} og \texttt{log10(size\_mb)} over hele datasæt:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_cor\_test }\OtherTok{\textless{}{-}} \FunctionTok{cor.test}\NormalTok{(eukaryotes}\SpecialCharTok{$}\NormalTok{gc,}\FunctionTok{log10}\NormalTok{(eukaryotes}\SpecialCharTok{$}\NormalTok{size\_mb))}
\NormalTok{my\_cor\_test}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Pearson's product-moment correlation
## 
## data:  eukaryotes$gc and log10(eukaryotes$size_mb)
## t = -15.678, df = 11118, p-value < 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  -0.1652066 -0.1288369
## sample estimates:
##        cor 
## -0.1470715
\end{verbatim}

Her vil jeg også gerne introducerer en funktion der hedder \texttt{glance()} som findes i R-pakken \texttt{broom}. Funktionen \texttt{glance()} anvendes til at tage den output fra en statistiske test (fk. \texttt{cor.test()}) og lave det om til et \textbf{tidy} dataramme. Det gøre det nemmere for eksempel til at lave et plot, eller samler op statistikker fra forskellige tests.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(broom)}
\FunctionTok{glance}\NormalTok{(my\_cor\_test)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE # A tibble: 1 x 8
FALSE   estimate statistic  p.value parameter conf.low conf.high method    alternative
FALSE      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
FALSE 1   -0.147     -15.7 8.25e-55     11118   -0.165    -0.129 Pearson'~ two.sided
\end{verbatim}

Vi kan se at over hele datasæt, er der en signifikant negativ korrelation (estimate -0.147 og p-værdi \ensuremath{8.25054\times 10^{-55}}) mellem de to variabler, men vi er dog stadig mistænksom overfor eventuelle forskelligheder blandt de fem grupper fra variablen \texttt{group}.

Vi vil gerne gentage vores nalyse for hver af de fem grupper fra \texttt{group}. En god tilgang til at undersøge det er at bruge den ramme med \texttt{group\_by()} og \texttt{nest()} som vi lært sidste gange.

\hypertarget{korrelation-over-flere-datasuxe6t-puxe5-en-gang}{%
\subsection{Korrelation over flere datasæt på en gang}\label{korrelation-over-flere-datasuxe6t-puxe5-en-gang}}

Lad os først tjekke fordelingen af de to variabler opdelt efter variablen \texttt{group}. Bemærk at når de to variabler er i forskellige kolonner er vi nødt til at først få vores data i long form med \texttt{pivot\_longer()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{log10\_size\_mb =} \FunctionTok{log10}\NormalTok{(size\_mb)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(log10\_size\_mb,gc,group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{group) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins=}\DecValTok{40}\NormalTok{,}\AttributeTok{alpha=}\FloatTok{0.5}\NormalTok{,}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set1"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name,}\AttributeTok{scales=}\StringTok{"free"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 388 rows containing non-finite values (stat_bin).
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-372-1.pdf}

Vi kan se, at der er forskelligheder blandt de fem grupper og der kan forekommer forskellige sammenhænge mellem de to variabler. Vi benytter i følgende den \texttt{group\_by()} + \texttt{nest()} ramme som blev introducerede sidste lektion.

\textbf{Definere korrelation funktion}

Lad os definere den korrelation test mellem \texttt{gc} og \texttt{size\_mb} i en funktion:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_test }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{cor.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{gc,}\FunctionTok{log10}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{size\_mb))}
\end{Highlighting}
\end{Shaded}

Husk:

\begin{itemize}
\tightlist
\item
  Brug \texttt{\textasciitilde{}} lige i starten for at fortælle R, at vi arbejde med en funktion.
\item
  Specificer det indiv datasæt indenfor \texttt{cor.test()} med \texttt{.x} (husk at \texttt{map()} her fungere over en list af datasæt, så indenfor et datasæt specificerer
  vi kolonner \texttt{gc} og \texttt{size\_mb} ved \texttt{.x\$gc} og \texttt{.x\$size\_mb}).
\end{itemize}

Vi vil gerne få statistikker fra \texttt{cor.test()} i en pænt form så vi tilføjer \texttt{glance()} i funktionen:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_test }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{cor.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{gc,}\FunctionTok{log10}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{size\_mb)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glance}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\textbf{Benytte \texttt{group\_by()} + \texttt{nest()}}

For at lave et \texttt{cor.test()} til hver af de fem grupper i variablen \texttt{group()}, skal vi først anvende \texttt{nest()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_nest }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(group) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{()}
\NormalTok{eukaryotes\_nest}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
## # Groups:   group [5]
##   group    data                 
##   <chr>    <list>               
## 1 Other    <tibble [51 x 18]>   
## 2 Protists <tibble [888 x 18]>  
## 3 Plants   <tibble [1,304 x 18]>
## 4 Fungi    <tibble [6,064 x 18]>
## 5 Animals  <tibble [3,201 x 18]>
\end{verbatim}

Vi har fået vores fem sub-datasæt i en list der hedder \texttt{data}.

\textbf{Bruge map() på de nested datasæt}

Nu lad os køre vores funktion på den nested data. Vi bruger \texttt{map()} til at lave samme funktion for hver af de fem datasæt. Vi bruger \texttt{map} indenfor \texttt{mutate} til at lave en ny kolon der hedder \texttt{test\_stats}, hvor resultaterne for hver af de fem tests kan lagres.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_cor }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_nest }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{test\_stats=}\FunctionTok{map}\NormalTok{(data,cor\_test),}
\NormalTok{    )}
\NormalTok{eukaryotes\_cor}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
## # Groups:   group [5]
##   group    data                  test_stats      
##   <chr>    <list>                <list>          
## 1 Other    <tibble [51 x 18]>    <tibble [1 x 8]>
## 2 Protists <tibble [888 x 18]>   <tibble [1 x 8]>
## 3 Plants   <tibble [1,304 x 18]> <tibble [1 x 8]>
## 4 Fungi    <tibble [6,064 x 18]> <tibble [1 x 8]>
## 5 Animals  <tibble [3,201 x 18]> <tibble [1 x 8]>
\end{verbatim}

For at kunne se de statistics skal man bruge funktionen \texttt{unnest()} på variablen \texttt{test\_stats}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_cor }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_cor }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unnest}\NormalTok{(test\_stats)}
\NormalTok{eukaryotes\_cor}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 10
## # Groups:   group [5]
##   group    data     estimate statistic   p.value parameter conf.low conf.high
##   <chr>    <list>      <dbl>     <dbl>     <dbl>     <int>    <dbl>     <dbl>
## 1 Other    <tibble>   0.489       3.80 4.22e-  4        46  0.238      0.679 
## 2 Protists <tibble>   0.301       9.26 1.54e- 19       860  0.239      0.361 
## 3 Plants   <tibble>  -0.203      -7.37 3.10e- 13      1267 -0.255     -0.149 
## 4 Fungi    <tibble>   0.377      31.2  3.87e-198      5884  0.355      0.399 
## 5 Animals  <tibble>   0.0437      2.42 1.57e-  2      3053  0.00825    0.0790
## # ... with 2 more variables: method <chr>, alternative <chr>
\end{verbatim}

Vi kan bruge den direkte i et plot. Lad os fokusere på den korrelaton koefficient i kolonnen \texttt{estimate} og omsætte den til et plot:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_plot }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_cor }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{group,}\AttributeTok{y=}\NormalTok{estimate,}\AttributeTok{fill=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set3"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Corrlation estimate"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{() }
\NormalTok{cor\_plot}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-378-1.pdf}

Vi kan gå videre med vores plot og tilføje nogle labels efter p-værdien for at gøre det mere informativ - lad os først gå videre til at lave en lignende analyse med lineær regression.

\hypertarget{visualisering-af-lineuxe6r-regression-med-ggplot2}{%
\section{Visualisering af lineær regression med ggplot2}\label{visualisering-af-lineuxe6r-regression-med-ggplot2}}

\hypertarget{lineuxe6r-trends}{%
\subsection{Lineær trends}\label{lineuxe6r-trends}}

Man kan benytter lineær regression til at visualisere trends i de data. For eksempel kan man se i følgende scatter plot mellem \texttt{body\_mass\_g} og \texttt{bill\_length\_mm} i datasættet \texttt{penguins} at der er plottet en bedste rette linje igennem punkterne, som viser, at der er en postiv sammenhæng mellem de to variabler.

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-379-1.pdf}

Den bedste rette linje har en formel \(y = a + bx\), hvor \(a\) er den ``intercept'' og \(b\) er den ``slope'' (hælde) af linjen. Idéen med simpel lineær regression er, at man gerne vil finde den bedste mulige værdier for \(a\) og \(b\) for at plotte ovenstående linje således, at afstanden mellem linjen og punkterne bliver minimeret. Uden at gå i detaljer om hvordan det beregnes, kan man bruger \texttt{lm} indenfor R til at finde den bedste rette linje. For eksempel:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lm}\NormalTok{(bill\_length\_mm}\SpecialCharTok{\textasciitilde{}}\NormalTok{body\_mass\_g,}\AttributeTok{data=}\NormalTok{penguins)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g, data = penguins)
## 
## Coefficients:
## (Intercept)  body_mass_g  
##   27.150722     0.004003
\end{verbatim}

Her kan man se, at den intercept er 27.15 og den slope er 0.004 - det betyder, at hvis \texttt{body\_mass\_g} stiger ved 1, så ville den forventet \texttt{bill\_length\_mm} stiger ved 0.004. Man kan således bruge linjen til at lave forudsigelser. For eksempel, hvis jeg vejede en ny pingvin og fandt ud af, at den vejede 5000 gramms, kunne jeg bruge min linje som den bedste gætte på dens bill længde:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{y }\OtherTok{\textless{}{-}} \FloatTok{27.150722} \SpecialCharTok{+} \FloatTok{0.004003}  \SpecialCharTok{*} \DecValTok{5000}
\NormalTok{y}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 47.16572
\end{verbatim}

Så kan man se, jeg forventer en pingvin af 5000 g til at have en bill length af omkring 47.2 mm. Den kan også visualiseres i et plot:

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-382-1.pdf}

\hypertarget{plotting-lineuxe6r-trend-lines-with-geom_smooth}{%
\subsection{\texorpdfstring{plotting lineær trend lines with \texttt{geom\_smooth()}}{plotting lineær trend lines with geom\_smooth()}}\label{plotting-lineuxe6r-trend-lines-with-geom_smooth}}

Indbygget i \texttt{ggplot2} er en funktion der hedder \texttt{geom\_smooth()} som kan bruges til at tilføje den bedste rette linje til plottet. Man benytte den simpelthen ved at specificere \texttt{+\ geom\_smooth(method="lm")} indenfor plot kommando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(penguins,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{body\_mass\_g,}\AttributeTok{y=}\NormalTok{bill\_length\_mm)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-383-1.pdf}

Det er nemt at bruge (bare tilføj en kode linje) og at man kan få en konfidensinterval med, hvis man gerne vil have den: i ovenstående plot specificeret jeg \texttt{se=FALSE} men hvis jeg angiv \texttt{se=TRUE} (default), får jeg følgende plot:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(penguins,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{body\_mass\_g,}\AttributeTok{y=}\NormalTok{bill\_length\_mm)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-384-1.pdf}

\hypertarget{plotting-multiple-lineuxe6r-trend-lines-with-geom_smooth}{%
\subsection{\texorpdfstring{plotting multiple lineær trend lines with \texttt{geom\_smooth()}}{plotting multiple lineær trend lines with geom\_smooth()}}\label{plotting-multiple-lineuxe6r-trend-lines-with-geom_smooth}}

For at tilføje en bedste rette linje til hver af de tre \texttt{species} i stedet for samtlige data, er det meget nemt i \texttt{ggplot}: man angiver bare \texttt{colour=species}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(penguins,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{body\_mass\_g,}\AttributeTok{y=}\NormalTok{bill\_length\_mm,}\AttributeTok{colour=}\NormalTok{species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-385-1.pdf}

Så kan vi se, at der faktisk er tre forskellige trends her, så det giver god mening at bruge de tre forskellige linjer i stedet for kun en.

\hypertarget{plot-trends-med-methodloess-i-ggplot.}{%
\subsection{\texorpdfstring{Plot trends med \texttt{method=="loess"} i ggplot.}{Plot trends med method=="loess" i ggplot.}}\label{plot-trends-med-methodloess-i-ggplot.}}

I \texttt{ggplot} er vi ikke begrænset til \texttt{method="lm"} indenfor \texttt{geom\_smooth()}. Lad os afpøve i stedet \texttt{method="loess"}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(palmerpenguins)}
\NormalTok{penguins }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(penguins)}
\FunctionTok{ggplot}\NormalTok{(penguins,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{body\_mass\_g,}\AttributeTok{y=}\NormalTok{bill\_length\_mm,}\AttributeTok{colour=}\NormalTok{species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"loess"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-386-1.pdf}

Så kan man fange trends som ikke nødvendigvis er lineær. Men det er mere ligefrem at beskrive en lineær trend og bruge den til at beregne de nødvendige statistik til at støtte vores observationer.

\hypertarget{plot-linear-regresion-estimates}{%
\section{Plot linear regresion estimates}\label{plot-linear-regresion-estimates}}

For at finde vores estimates og tjekke signifikansen af de lineær trend, skal man arbejde direkte med den lineær model funktion \texttt{lm} som i ovenstående:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my.lm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(bill\_length\_mm}\SpecialCharTok{\textasciitilde{}}\NormalTok{body\_mass\_g,}\AttributeTok{data=}\NormalTok{penguins)}
\NormalTok{my.lm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g, data = penguins)
## 
## Coefficients:
## (Intercept)  body_mass_g  
##   27.150722     0.004003
\end{verbatim}

For at finde ud af den signifikans kan man kigge på \texttt{summary}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(my.lm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = bill_length_mm ~ body_mass_g, data = penguins)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -10.1652  -3.0664  -0.7672   2.2356  16.0371 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 2.715e+01  1.292e+00   21.02   <2e-16 ***
## body_mass_g 4.003e-03  3.016e-04   13.28   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.424 on 331 degrees of freedom
## Multiple R-squared:  0.3475, Adjusted R-squared:  0.3455 
## F-statistic: 176.2 on 1 and 331 DF,  p-value: < 2.2e-16
\end{verbatim}

De tal, som er vigtige her:

\begin{itemize}
\tightlist
\item
  Den p-værdi: \texttt{\textless{}2e-16} - den trend er statistiske signifikant.
\item
  Den R-squared værdi - det viser den proportion af variancen i \texttt{bill\_length\_mm} som \texttt{body\_mass\_g} forklarer. Det er svarende til den korrelation koefficient squared og kan fortolkes således -

  \begin{itemize}
  \tightlist
  \item
    hvis R-squared er tæt på 1, så er der tæt på en perfekt korrespondens mellem \texttt{bill\_length\_mm} og \texttt{body\_mass\_g}.
  \item
    hvis R-squared er tæt på 0, så er der nærmeste ingen korrespondens.
  \end{itemize}
\end{itemize}

\hypertarget{iteratively-estimating-multiple-trends}{%
\subsection{Iteratively estimating multiple trends}\label{iteratively-estimating-multiple-trends}}

Vi kan benytte de koncepter som vi lært i sidste lektion, og som er samme som ovenpå i vores korrelation analyse.

Vi vil gerne lave en model med \texttt{lm} som ovenpå, og vi tilføje \texttt{glance()} til at få de model statistikker i en pæn form.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm\_model\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{lm}\NormalTok{(bill\_length\_mm}\SpecialCharTok{\textasciitilde{}}\NormalTok{body\_mass\_g,}\AttributeTok{data=}\NormalTok{.x) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{glance}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Vi bruge \texttt{group\_by} til at opdele efter de tre \texttt{species} og så nest de tre datarammer:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{nest}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
## # Groups:   species [3]
##   species   data              
##   <fct>     <list>            
## 1 Adelie    <tibble [146 x 7]>
## 2 Gentoo    <tibble [119 x 7]>
## 3 Chinstrap <tibble [68 x 7]>
\end{verbatim}

Vi lave en lineær model på hver af de tre datasæt med \texttt{map} og ved at specifice funktion som vi defineret ovenpå. Vi bruger \texttt{mutate} ligesom før til at tilføje resulterende statistikker som en ny kolon der hedder \texttt{lm\_stats}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins\_lm }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lm\_stats=}\FunctionTok{map}\NormalTok{(data,lm\_model\_func),}
\NormalTok{    )}
\NormalTok{penguins\_lm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
## # Groups:   species [3]
##   species   data               lm_stats         
##   <fct>     <list>             <list>           
## 1 Adelie    <tibble [146 x 7]> <tibble [1 x 12]>
## 2 Gentoo    <tibble [119 x 7]> <tibble [1 x 12]>
## 3 Chinstrap <tibble [68 x 7]>  <tibble [1 x 12]>
\end{verbatim}

Til sidste bruger vi funkction \texttt{unnest} på vores statistikker:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins\_lm }\OtherTok{\textless{}{-}}\NormalTok{ penguins\_lm }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols=}\NormalTok{lm\_stats)}
\NormalTok{penguins\_lm}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 14
## # Groups:   species [3]
##   species data     r.squared adj.r.squared sigma statistic  p.value    df logLik
##   <fct>   <list>       <dbl>         <dbl> <dbl>     <dbl>    <dbl> <dbl>  <dbl>
## 1 Adelie  <tibble>     0.296         0.291  2.24      60.6 1.24e-12     1  -324.
## 2 Gentoo  <tibble>     0.445         0.440  2.32      93.6 1.26e-16     1  -268.
## 3 Chinst~ <tibble>     0.264         0.253  2.89      23.7 7.48e- 6     1  -168.
## # ... with 5 more variables: AIC <dbl>, BIC <dbl>, deviance <dbl>,
## #   df.residual <int>, nobs <int>
\end{verbatim}

Så kan vi se, at vi har fået en dataramme med vores lineær model statistics. Lad os omsætte dem til et plot for at sammenligne dem over de tre \texttt{species} af pingvin.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins\_lm }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(species,r.squared,p.value) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\StringTok{"{-}log10pval"} \OtherTok{=} \SpecialCharTok{{-}}\FunctionTok{log10}\NormalTok{(p.value)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{p.value) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{species) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{species,}\AttributeTok{y=}\NormalTok{value,}\AttributeTok{fill=}\NormalTok{species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name,}\AttributeTok{scale=}\StringTok{"free"}\NormalTok{,}\AttributeTok{ncol=}\DecValTok{4}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-393-1.pdf}

\hypertarget{lave-og-tilfuxf8je-labels-til-dit-regression-plot}{%
\subsection{Lave og tilføje labels til dit regression plot}\label{lave-og-tilfuxf8je-labels-til-dit-regression-plot}}

Som nævnt tidligere, kan det være nyttig at tilføje nogle labels til vores plots med de statistikker, vi lige har beregnet. I tilfældet af vores lineær regression trend lines, vi vil gerne tilføje de r-squared værdier og de p-værdier.

Til at gøre det kan man bruge følgende kode. Vi tage vores datasæt \texttt{penguins\_lm} med vores beregnet statistikker og bruge den til at lave en datasæt som kan bruges i \texttt{geom\_text()} i vores trend plot. Funktionen \texttt{glue()} (fra pakken \texttt{glue()}) er bare en nyttig måde at tilføj de \texttt{r.squared} og \texttt{p.value} værdier sammen i en string som beskriver vores forskellige trends

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(glue)  }\CommentTok{\# for putting the values together in a label}
\NormalTok{label\_data }\OtherTok{\textless{}{-}}\NormalTok{ penguins\_lm }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{rsqr =} \FunctionTok{signif}\NormalTok{(r.squared, }\DecValTok{2}\NormalTok{),  }\CommentTok{\# round to 2 significant digits}
    \AttributeTok{pval =} \FunctionTok{signif}\NormalTok{(p.value, }\DecValTok{2}\NormalTok{),}
    \AttributeTok{label =} \FunctionTok{glue}\NormalTok{(}\StringTok{"r\^{}2 = \{rsqr\}, p{-}value = \{pval\}"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(species, label)}
\NormalTok{label\_data}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE # A tibble: 3 x 2
FALSE # Groups:   species [3]
FALSE   species   label                        
FALSE   <fct>     <glue>                       
FALSE 1 Adelie    r^2 = 0.3, p-value = 1.2e-12 
FALSE 2 Gentoo    r^2 = 0.44, p-value = 1.3e-16
FALSE 3 Chinstrap r^2 = 0.26, p-value = 7.5e-06
\end{verbatim}

Vi kan tilføje vores label data indenfor \texttt{geom\_text()}. \texttt{x} og \texttt{y} specificere hvor i plottet teksten skal være, og husk at specificere \texttt{data=label\_data} og \texttt{label=label} skal stå indenfor \texttt{aes()} når det handler om en variable i \texttt{label\_data}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(penguins, }\FunctionTok{aes}\NormalTok{(body\_mass\_g, flipper\_length\_mm, }\AttributeTok{colour=}\NormalTok{species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }\AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}
    \AttributeTok{x =} \DecValTok{5500}\NormalTok{, }
    \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\DecValTok{175}\NormalTok{,}\DecValTok{180}\NormalTok{,}\DecValTok{185}\NormalTok{),}
    \AttributeTok{data =}\NormalTok{ label\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ label), }\CommentTok{\#specify label data from above}
    \AttributeTok{size =} \DecValTok{4}
\NormalTok{  ) }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-395-1.pdf}

\hypertarget{case_when-adding-bar-plot-text}{%
\subsection{\texorpdfstring{\texttt{case\_when()}: adding bar plot text}{case\_when(): adding bar plot text}}\label{case_when-adding-bar-plot-text}}

Det vil også være rart at tilføje vores p-værdier i vores barplot fra ovenstående korrelation analyse. Den kan laves igen med \texttt{geom\_text}. Husk at vi bruge lokale aethetics funktion \texttt{aes()} indenfor \texttt{geom\_text()}. Her specificerer vi at parameteren \texttt{label} skal være vores p-værdier fra vores datasæt. Parameteren \texttt{vjust} bruges til at få de tal lidt ovenpå søjlerne.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_plot }\SpecialCharTok{+} 
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(p.value,}\DecValTok{3}\NormalTok{)), }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-396-1.pdf}

Lad os transformere de p-værdi kolon til en der viser signifikans i formen af stjerne (det ses meget ofte indenfor præsentationer og publikationer). Her kan man bruge \texttt{case\_when} - det ligner \texttt{ifelse} men kan benyttes i tilfældet hvor der er flere en to muligheder. Man angiver de forskellige muligheder og separerer hvad sker hvis \texttt{TRUE} med tilde (for eksempel hvis p-værdien er mindre end 0.001 så få kolonnen \texttt{sig} tre stjerne). Her er \texttt{p.value\ \textless{}\ 0.001} skrev i linjen før \texttt{p.value\ \textless{}\ 0.01} så dette tilfælde få prioritet (hvis p-værdien er mindre end 0.001 få \texttt{sig} så tre stjerner i stedet for to).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eukaryotes\_cor\_sig }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_cor }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sig =} \FunctionTok{case\_when}\NormalTok{(p.value }\SpecialCharTok{\textless{}} \FloatTok{0.001} \SpecialCharTok{\textasciitilde{}} \StringTok{"***"}\NormalTok{,}
\NormalTok{                         p.value }\SpecialCharTok{\textless{}} \FloatTok{0.01} \SpecialCharTok{\textasciitilde{}} \StringTok{"**"}\NormalTok{,}
\NormalTok{                         p.value }\SpecialCharTok{\textless{}} \FloatTok{0.05} \SpecialCharTok{\textasciitilde{}} \StringTok{"*"}\NormalTok{,}
\NormalTok{                         p.value }\SpecialCharTok{\textless{}} \FloatTok{0.1} \SpecialCharTok{\textasciitilde{}} \StringTok{"."}\NormalTok{,}
\NormalTok{                         p.value }\SpecialCharTok{\textgreater{}=} \FloatTok{0.1} \SpecialCharTok{\textasciitilde{}} \StringTok{"n.s"}\NormalTok{))}

\NormalTok{eukaryotes\_cor\_sig }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(group,sig) }\CommentTok{\#viser hvordan det ser ud}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 2
## # Groups:   group [5]
##   group    sig  
##   <chr>    <chr>
## 1 Other    ***  
## 2 Protists ***  
## 3 Plants   ***  
## 4 Fungi    ***  
## 5 Animals  *
\end{verbatim}

Nu at vi har fået en ny kolon der hedder \texttt{sig} kan det anvendes indenfor \texttt{geom\_text} som i forudgående plot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_plot }\OtherTok{\textless{}{-}}\NormalTok{ eukaryotes\_cor\_sig }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{group,}\AttributeTok{y=}\NormalTok{estimate,}\AttributeTok{fill=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set3"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Corrlation estimate"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()  }\SpecialCharTok{+} 
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ sig),}\AttributeTok{size=}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{)}
\NormalTok{cor\_plot}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-398-1.pdf}

Mere om adding labels to barplots: \url{https://r-graphics.org/recipe-bar-graph-labels}

\hypertarget{problemstillinger-7}{%
\section{Problemstillinger}\label{problemstillinger-7}}

\textbf{0}) Quizzen på Absalon.

Husk at have indlæste følgende:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(broom)}
\FunctionTok{data}\NormalTok{(mtcars)}
\FunctionTok{data}\NormalTok{(iris)}
\end{Highlighting}
\end{Shaded}

\textbf{1}) \emph{Korrelation øvelse}

\begin{itemize}
\item
  Brug \texttt{data(mtcars)} og \texttt{cor.test()} til at lave et test af korrelationen mellem variablerne \texttt{qsec} og \texttt{drat}.
\item
  Tip: hvis du foretrækker at undgå \texttt{\$} i analysen til at speciefice en kolon indenfor \texttt{cor.test()} kan du bruge \texttt{mtcars\ \%\textgreater{}\%\ pull(qsec)} i stedet for \texttt{mtcars\$qsec}.
\item
  Tilføj funktionen \texttt{glance()} til din resultat fra \texttt{cor.test()} til at se de statistikker i \textbf{tidy} form. Kan du genkende de statistikker fra \texttt{cor.test()} i den resulterende dataramme?
\end{itemize}

\textbf{2}) \emph{Korrelation øvelse}

Vælg \texttt{Species} \texttt{setosa} fra \texttt{iris} (\texttt{data(iris)}) og brug \texttt{cor.test()} til at beregne korrelationen mellem \texttt{Sepal.Width} og \texttt{Sepal.Length}.

\begin{itemize}
\tightlist
\item
  Angiv resultaterne i \textbf{tidy} form.
\end{itemize}

\textbf{3}) \emph{Nesting øvelse}

For datasættet \texttt{mtcars} anvende \texttt{group\_by()} og \texttt{nest()} til at få en nested datasæt opdelt efter variablen \texttt{cyl}.

\begin{itemize}
\item
  Hvor mange datasæt har du fået indenfor kolonnen \texttt{data}?
\item
  Tilføj en ny kolon med \texttt{mutate} der hedder \texttt{n\_rows} som beregner antallet af række i hver af de tre datasæt - brug følgende struktur (først angiv kolonnen som indeholder vores list af datasæt, og så angive funktionen som beregner antallet af række).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(cyl) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\StringTok{"n\_rows"} \OtherTok{=} \FunctionTok{map}\NormalTok{(???,???)) }\CommentTok{\#erstatte ??? her}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Hvad få du indenfor din ny kolonnen? Prøve at andre \texttt{map} til \texttt{map\_dbl} og se hvad der sker.
\item
  Beholde \texttt{map} og tilføj \texttt{\%\textgreater{}\%\ unnest(n\_rows)} i stedet for og se hvad der sker.
\end{itemize}

\textbf{4}) \emph{Multiple korrelation}

Vi vil gerne beregne den korrelation mellem variablerne \texttt{qsec} og \texttt{drat} til hver af de tre datasæt.

\begin{itemize}
\tightlist
\item
  Tilpasse følgende funktion så at vi teste korrelation mellem de to variabler.
\item
  Tilføje \texttt{glance()} så at vi få vores data i \textbf{tidy} form.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_test }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{cor.test}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{qsec,???) }\CommentTok{\#erstatte ??? og tilføj glance funktion}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Brug map i nedenstående med din funktion til at beregne de korrelation til hver af de tre datasæt.
\item
  Huske at \texttt{unnest} kolonnen med dine korrelation statistikker bagefter.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(cyl) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{cor\_stats =}\NormalTok{ ???) }\CommentTok{\#erstatte ??? her og husk unnest}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Lave et barplot af \texttt{estimate} med den resulterende dataramme
\end{itemize}

\textbf{5}) \emph{Multiple korrelation øvelse}

Lave samme analyse som \textbf{4}) men

\begin{itemize}
\tightlist
\item
  nest de data efter \texttt{gear}
\item
  beregne korrelationen mellem \texttt{wt} og \texttt{drat}
\end{itemize}

\textbf{6}) \emph{Linear regression øvelse}

Brug \texttt{data(iris)} og anvende \texttt{lm()} til at finde den forventet \texttt{Petal.Length} med hensyn til \texttt{Petal.Width}.

\begin{itemize}
\tightlist
\item
  Hvad er den intercept og slope af den beregnet linje?
\item
  Tilføj funktionen \texttt{glance()} og angive værdier \texttt{r.squared} og \texttt{p.value}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lm}\NormalTok{(??? }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ???,}\AttributeTok{data=}\NormalTok{???) }\CommentTok{\#erstatte ???}
\end{Highlighting}
\end{Shaded}

\textbf{7}) Lave et scatter plot af Petal.Width på x-aksen og Petal.Length på y-aksen.

\begin{itemize}
\tightlist
\item
  Tilføje linjen \texttt{geom\_smooth(method="smooth")}
\item
  Ændre linjen til \texttt{geom\_smooth(method="lm")}
\item
  Ændre linjen til \texttt{geom\_smooth(method="lm",se=FALSE)}
\item
  Nu specificer en forskellige farve efter Species. Er der forskellige trends?
\end{itemize}

Vi vil gerne lave samme analyse for hver af de tre Species.

\textbf{8}) \emph{Lineær regression øvelse over multiple datasæt}

Vi vil gerne udføre lineær regression med Petal.Length og Petal.Width som i \textbf{6}), men opdelt efter de tre Species.
* Lave en funktion ved at tilpasse følgende kode. Passe på hvad \texttt{data} skal være lig med her (når vi skriver en funktion).
* Tilføj \texttt{glance()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm\_model\_func }\OtherTok{\textless{}{-}}\NormalTok{ ???}\FunctionTok{lm}\NormalTok{(??? }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ???,}\AttributeTok{data=}\NormalTok{???) }\CommentTok{\#erstat ??? }
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Anvende \texttt{group\_by()} og \texttt{nest()}
\item
  Anvende \texttt{map()} med din funktion indenfor \texttt{mutate()} til at tilføje en ny kolon som hedder \texttt{lm\_stats} til din dataramme.
\item
  Husk at \texttt{unnest} kolonnen \texttt{lm\_stats}til at kunne se statistikker.
\end{itemize}

\textbf{9}) \emph{Tilføj statistik til plottet}

Vi vil gerne tilføj de statistikker vi lige har beregnet i \textbf{8}) til plottet vi lavet i \textbf{7}).

Kopiere koden fra sektionen ``Lave og tilføje labels til dit regression plot'' og tilpasse den til din analyse med \texttt{iris}.

\textbf{10}) \emph{Tilføj statistik til plottet}

Vi vil gerne tilføj de statistikker vi lige har beregnet i \textbf{4}) til et bar plot af vores korrelation estimates.

Kopiere koden fra sektionen ``\texttt{case\_when()}: adding bar plot text'' og tilpasse den til din analyse med \texttt{mtcars}.

\hypertarget{nuxe6ste-uge}{%
\section{Næste uge}\label{nuxe6ste-uge}}

Clustering af data ind i forskellige grupper - kmeans/hierarchical clustering (kun undervisning på tirsdag og workshop på fredag).

\hypertarget{clustering}{%
\chapter{Clustering}\label{clustering}}

\hypertarget{indledning-og-luxe6ringsmuxe5lene-2}{%
\section{Indledning og læringsmålene}\label{indledning-og-luxe6ringsmuxe5lene-2}}

\hypertarget{luxe6ringsmuxe5lene-4}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-4}}

I skal være i stand til at

\begin{itemize}
\tightlist
\item
  Beskrive hvad k-means clustering går ud på
\item
  Anvende \texttt{kmeans} og output resultatet på en \textbf{tidy} måde
\item
  Iterate over forskellige antal clusters og vælge antallet som passer til de data
\item
  Anvende funktionen \texttt{hclust} for at lave et simpel hierarchical clustering
\end{itemize}

\hypertarget{inledning-til-chapter}{%
\subsection{Inledning til chapter}\label{inledning-til-chapter}}

I clustering er der til formål at dele et datasæt op i forskellige grupper (clusters eller klynge på dansk) af observationer, der mest ligner hinanden. Det øger indsigten i datasættet ved at fk. bedre forstår strukturen. De spørgsmål som vi kan prøve at give svar på er bla.:

\begin{itemize}
\tightlist
\item
  Hvor mange forskellige clusters er repræsenteret i mit datasæt?
\item
  Hvilke individuelle observationer tilhører hvilken cluster?
\end{itemize}

I dette kapitel ser vi hvordan vi kan implementere både k-means clustering og hierarchical clustering i R (indenfor den tidyverse ramme), og bruge dem til at tage beslutninger om de ovenstående spørgsmål.

\hypertarget{video-ressourcer-5}{%
\subsection{Video ressourcer}\label{video-ressourcer-5}}

\begin{itemize}
\tightlist
\item
  Video 1: K-means clustering
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/553656150}

\begin{itemize}
\tightlist
\item
  Video 2: augment, glanced og tidy med K-means
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/553656139}

\begin{itemize}
\tightlist
\item
  Video 3: Hvor mange clusters skal man vælge?
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/553656129}

\hypertarget{k-means-clustering}{%
\section{K-means clustering}\label{k-means-clustering}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(palmerpenguins)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

I k-means er alle observationer eller datapunkter tilknyttet til den nærmeste cluster, efter deres nærhed til hinanden. Man specificere i forvejen antallet af clusters som data skal være delt op ind i. Derfor, skal der være nogle undersøgelses arbejde for at vælge den bedste antal clusters som passer til problemstillingen/ bedste repræsenterer de data.

Lad os tage udgangspunkt i datasættet \texttt{penguins}. Vi begynder med at få fjernet observationerne med \texttt{NA} i mindst én variable med funktionen \texttt{drop\_na} og ved at specificere at \texttt{year} skal være en faktor (for at skelne den fra de andre numeriske kolonner):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(penguins)}
\NormalTok{penguins }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year=}\FunctionTok{as.factor}\NormalTok{(year)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{drop\_na}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

Vi vide allerede i forvejen, at der er 3 \texttt{species} med i de data, som vi plotter her med forskellige farver.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{bill\_length\_mm,}\AttributeTok{y=}\NormalTok{body\_mass\_g,}\AttributeTok{colour=}\NormalTok{species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_classic}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-421-1.pdf}

Vi vil gerne bruge k-means clustering på de numeriske variabler i de datasæt, og derefter kan det være nyttigt at sammenligne de clusters vi få med de tre species - hvor gode er de clusters til at skelne i mellem de forskellige species, eller fanger de noget andet struktur i de data (for eksempel kønnet eller øen, de bor)?

\hypertarget{hvordan-fungere-kmeans}{%
\subsection{Hvordan fungere kmeans?}\label{hvordan-fungere-kmeans}}

K-means er en iterativ process. Lad os forestille os at vi gerne vil have tre clusters i de data. Man starter med tre observationer ved tilfælde og kalde dem for de cluster middelværdierne eller ``centroids''. Man tilknytter alle observationer til en af de tre clusters (efter de nærmeste af de tre centroids), og så beregner en ny middelværdi/centroid for at hver cluster. Man tilknytter observerationer til den nye cluster centroids og så gentager man processen flere gange.

\begin{figure}
\includegraphics[width=0.5\linewidth]{plots/kmeans} \caption{source: https://towardsdatascience.com/k-means-a-complete-introduction-1702af9cd8c}\label{fig:unnamed-chunk-422}
\end{figure}

Jeg spørger ikke efter detaljerne i metoden men der er mange videoer på Youtube som bedre foreklarer hvordan k-means fungerer, for eksempel: \url{https://www.youtube.com/watch?v=4b5d3muPQmA}

Bemærk, at der er noget \textbf{tilfældighed} indbygget i algoritmen. Det betyder, at hver gang man anvende k-means, få man en lidt anderledes resultat.

\hypertarget{run-k-means-i-r}{%
\subsection{Run k-means i R}\label{run-k-means-i-r}}

K-means fungerer kun på numeriske data, som vi kan vælge fra datasættet med \texttt{select} - man kan specificere \texttt{where(is.numeric)} indenfor \texttt{select()} for at slippe for at manuelt indtaste de relevante variable navne. Vi bruger også \texttt{scale()} på de data her. Det betyder, at alle variabler få den samme skala og det undgår, at der er nogle som få mere indflydelse end andre i de færdig resultater.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins\_scaled }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{scale}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Man er også nødt til at fortælle i forvejen hvor mange clusters at opdele datasættet ind i, så lad os sige \texttt{centers=3} indenfor funktionen \texttt{kmeans} her og beregner vores clusters:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclust }\OtherTok{\textless{}{-}} \FunctionTok{kmeans}\NormalTok{(penguins\_scaled,}\AttributeTok{centers =} \DecValTok{3}\NormalTok{)}
\NormalTok{kclust}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## K-means clustering with 3 clusters of sizes 70, 119, 144
## 
## Cluster means:
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
## 1      0.8908006     0.7592465        -0.3044405  -0.4687119
## 2      0.6537742    -1.1010497         1.1607163   1.0995561
## 3     -0.9732998     0.5408171        -0.8112111  -0.6808149
## 
## Clustering vector:
##   [1] 3 3 3 3 3 3 3 3 3 3 3 3 1 3 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3
##  [38] 3 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 3 3 3 3 3 3
##  [75] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 3 1 3 3 3 3 3
## [112] 3 3 3 3 3 3 3 3 3 3 3 3 1 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 2 2
## [149] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [186] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [223] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
## [260] 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 3 1 1 1 1 1 1 1 3
## [297] 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1
## 
## Within cluster sum of squares by cluster:
## [1]  78.96005 139.46837 152.44363
##  (between_SS / total_SS =  72.1 %)
## 
## Available components:
## 
## [1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
## [6] "betweenss"    "size"         "iter"         "ifault"
\end{verbatim}

Man få forskellige ting frem, for eksempel:

\begin{itemize}
\tightlist
\item
  \texttt{Cluster\ means} - de svarer til de centroids markerede med \textbf{x} i den ovenstående figur - bemærk at her er de 5-dimensionel da vi brugt 5 variabler til at beregne resultatet.
\item
  \texttt{Clustering} vector - hvilke cluster er hver observation blevet tilknyttet til.
\item
  \texttt{Within\ cluster\ sum\ of\ squares} - Jo mindre, jo bedre - hvor meget observationerne indenfor samme cluster ligner hinanden (den totale squared afstand af observationerne fra deres nærmeste centroid).
\end{itemize}

\hypertarget{tidy-up-k-means-resultaterne-med-pakken-broom}{%
\subsection{\texorpdfstring{Tidy up k-means resultaterne med pakken \texttt{broom}}{Tidy up k-means resultaterne med pakken broom}}\label{tidy-up-k-means-resultaterne-med-pakken-broom}}

Fra pakken \texttt{broom} har vi beskæftiget os med \texttt{glance} som vi benyttede til at få enkel-linje baserede summary statistics fra flere modeller sammen i én dataramme, for at facilitete et plot/labels osv. Der er også to andre funktioner vi tager i bruge her. Her er en beskrivelse af de tre.

\begin{longtable}[]{@{}ll@{}}
\toprule
Funktion & Beskrivelse \\
\midrule
\endhead
\texttt{glance} & single line summary \\
\texttt{augment} & Connect information from the model to the original dataset \\
\texttt{tidy} & multi-line summary \\
\bottomrule
\end{longtable}

For at lave et plot af de clusters kan det være nyttigt at benytte \texttt{augment}. Her kan man se, at vi har fået en kolon der hedder \texttt{.cluster} med i den oprindelige dataramme (jeg flyttet kolonen til første plads i følgende kode så man kunne se den i de output af kursusnotater).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kc1 }\OtherTok{\textless{}{-}} \FunctionTok{augment}\NormalTok{(kclust, penguins) }\CommentTok{\#clustering = første plads, data = anden plads}
\NormalTok{kc1 }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(.cluster,}\FunctionTok{all\_of}\NormalTok{(}\FunctionTok{names}\NormalTok{(penguins)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 333 x 9
##    .cluster species island    bill_length_mm bill_depth_mm flipper_length_mm
##    <fct>    <fct>   <fct>              <dbl>         <dbl>             <int>
##  1 3        Adelie  Torgersen           39.1          18.7               181
##  2 3        Adelie  Torgersen           39.5          17.4               186
##  3 3        Adelie  Torgersen           40.3          18                 195
##  4 3        Adelie  Torgersen           36.7          19.3               193
##  5 3        Adelie  Torgersen           39.3          20.6               190
##  6 3        Adelie  Torgersen           38.9          17.8               181
##  7 3        Adelie  Torgersen           39.2          19.6               195
##  8 3        Adelie  Torgersen           41.1          17.6               182
##  9 3        Adelie  Torgersen           38.6          21.2               191
## 10 3        Adelie  Torgersen           34.6          21.1               198
## # ... with 323 more rows, and 3 more variables: body_mass_g <int>, sex <fct>,
## #   year <fct>
\end{verbatim}

Nu lad os benytte vores datasæt som vi har fået med \texttt{augment} til at lave et plot. Her giver jeg en farve efter \texttt{.cluster} og shape efter \texttt{species} så at vi kan sammenligne vores beregnet clusters med de tre forskellige species. Bemæk her, at jeg kun har to variabler i plottet, men der er faktisk fire variabler som blev brugt til at lave de clusters i med funktionen \texttt{kmeans}. En anden måde er at plotte de først to principal components i stedet for to af de fire variabler - det beskæftige vi os med næste gang.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(kc1, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{scale}\NormalTok{(bill\_length\_mm), }
                \AttributeTok{y =} \FunctionTok{scale}\NormalTok{(bill\_depth\_mm))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ .cluster, }\AttributeTok{shape =}\NormalTok{ species)) }\SpecialCharTok{+} \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-426-1.pdf}

Vi kan også fk. tælle op hvor mange af tre species vi få i hver af vores tre clusters, hvor vi kan se, at \texttt{Adelie} og \texttt{Chinstrap} er blevet mere blandet blandt to af de tre clusters end \texttt{Gentoo}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kc1 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{count}\NormalTok{(.cluster, species)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
##   .cluster species       n
##   <fct>    <fct>     <int>
## 1 1        Adelie        7
## 2 1        Chinstrap    63
## 3 2        Gentoo      119
## 4 3        Adelie      139
## 5 3        Chinstrap     5
\end{verbatim}

Lad os også kigge på resultatet af \texttt{tidy}. Her har vi fået en pæn dataramme med middelværdierne (centroids) af de tre clusters over de fire variabler som blev brugt i beregningerne.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclust\_tidy }\OtherTok{\textless{}{-}} \FunctionTok{tidy}\NormalTok{(kclust) }
\NormalTok{kclust\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 7
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g  size withinss
##            <dbl>         <dbl>             <dbl>       <dbl> <int>    <dbl>
## 1          0.891         0.759            -0.304      -0.469    70     79.0
## 2          0.654        -1.10              1.16        1.10    119    139. 
## 3         -0.973         0.541            -0.811      -0.681   144    152. 
## # ... with 1 more variable: cluster <fct>
\end{verbatim}

Lad os benytte \texttt{kclust\_tidy} som et datasæt i vores ovenstående plot indenfor en anden \texttt{geom\_point()} til at tilføje en \texttt{x} form i de centre af de tre clusters (bemærk jeg har brugt \texttt{color} og \texttt{shape} som lokale aethetics i den første \texttt{geom\_point()} her, der de ikke eksistere som kolonner i \texttt{kclust\_tidy}):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(kc1, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{scale}\NormalTok{(bill\_length\_mm), }
                \AttributeTok{y =} \FunctionTok{scale}\NormalTok{(bill\_depth\_mm))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{color =}\NormalTok{ .cluster, }\AttributeTok{shape =}\NormalTok{ species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{data =}\NormalTok{ kclust\_tidy, }
             \AttributeTok{size =} \DecValTok{10}\NormalTok{, }\AttributeTok{shape =} \StringTok{"x"}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-429-1.pdf}

Vi kan se at vores clusters fanger ikke de samme gruppe som \texttt{species} perfekt - der er forskelligheder. Det kan være at vi også har fanget nogle oplysninger om fk. øen de kommer fra eller kønnet af pingvinerne.

\hypertarget{hvor-mange-clusters-skal-der-vuxe6re}{%
\section{Hvor mange clusters skal der være?}\label{hvor-mange-clusters-skal-der-vuxe6re}}

Vi gættede på 3 clusters i ovenstående analyse (da vi havde oplysninger om de species i forvejen) men det kunne være, at et andet antal clusters passer bedre med de data. Vi kan anvende vores statistikker over de forskellige antal cluster til at tage en beslutning om, hvor mange clusters vi gerne vil beholde i vores færdig clustering resultat. Det er vigtigt at kan finde frem til en hensigtsmæssigt antal clusters - for mange clusters kan resultatere i over-fitting, hvor vi har for mange til at fortolke eller giver mening, og for få kan betyde at vi mangler indsigter ind i strukturen eller trends i de data.

\hypertarget{fuxe5-statistikker-for-antal-clusters-fra-1-til-9}{%
\subsection{Få statistikker for antal clusters fra 1 til 9}\label{fuxe5-statistikker-for-antal-clusters-fra-1-til-9}}

I nedenstående iterater vi over vectoren \texttt{1:9}, som vi angive i \texttt{kmeans} for at fortæl hvor mange clusters vi gerne vil beregne. For hver af de integar 1 til 9, benytter vi således \texttt{kmeans} med hjælp af funktionen \texttt{my\_func} (bemærk at vores input data \texttt{.x} er antallet af clusters men de datasæt er den samme hver gang). Dernæst benytte vi \texttt{tidy}, \texttt{glance} og \texttt{augment} på vores resultaterne fra \texttt{kmeans}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{kmeans}\NormalTok{(penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{scale}\NormalTok{(),}
                 \AttributeTok{centers =}\NormalTok{ .x)  }

\NormalTok{kclusts }\OtherTok{\textless{}{-}} 
  \FunctionTok{tibble}\NormalTok{(}\AttributeTok{k =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{( }\AttributeTok{kclust =} \FunctionTok{map}\NormalTok{(k, my\_func),}
          \AttributeTok{tidied =} \FunctionTok{map}\NormalTok{(kclust, tidy),}
          \AttributeTok{glanced =} \FunctionTok{map}\NormalTok{(kclust, glance),}
          \AttributeTok{augmented =} \FunctionTok{map}\NormalTok{(kclust, augment, penguins)}
\NormalTok{        )}
\end{Highlighting}
\end{Shaded}

Husk at for at få frem resultaterne i de forskellige former fra \texttt{tidy},\texttt{glance} og \texttt{augment} er vi nødt til at anvende \texttt{unnest}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclusts\_tidy    }\OtherTok{\textless{}{-}}\NormalTok{ kclusts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(tidied))}
\NormalTok{kclusts\_augment }\OtherTok{\textless{}{-}}\NormalTok{ kclusts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(augmented))}
\NormalTok{kclusts\_glance }\OtherTok{\textless{}{-}}\NormalTok{ kclusts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(glanced))}
\end{Highlighting}
\end{Shaded}

\hypertarget{manuelt-beslutning-med-elbow-plot.}{%
\subsection{Manuelt beslutning med elbow plot.}\label{manuelt-beslutning-med-elbow-plot.}}

Vi bruger \texttt{tot.withinness} fra vores \texttt{glance} output. Det måler hvor meget observationerne indenfor samme cluster ligner hinanden og er den totale afstand af observationerne fra deres nærmeste centroid. Jo flere clusters, jo mindre statistikken, men vi kan se, at efter 2-3 clusters, er der ikke meget gevinst med at bruge flere clusters. Derfor vælger man enten 2-3. Der er ofte kaldes for en `elbow' plot - man vælge de tal på den `elbow', hvor der ikke er meget gevinst med at have flere clusters i de data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclusts\_glance }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ k, }\AttributeTok{y =}\NormalTok{ tot.withinss)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-432-1.pdf}

\hypertarget{automatistke-beslutning-med-pakken-nbclust}{%
\subsection{\texorpdfstring{Automatistke beslutning med pakken \texttt{NbClust}}{Automatistke beslutning med pakken NbClust}}\label{automatistke-beslutning-med-pakken-nbclust}}

Hvis man synes at de er svært at vælge et bestemt cluster tal fra de elbow plot, kan man også prøve noget mere automatisk. For eksempel pakken NbClust lave 30 forskellige clustering algoritme af de data fra antal clusters = 2 til antal cluster = 9 og for hver af de 30 tage en beslutning om de bedste antal clusters. Man kan således se hvilket antal clusters blev valgt af de mest algoritmer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(NbClust)}
\NormalTok{cluster\_30\_indexes }\OtherTok{\textless{}{-}} \FunctionTok{NbClust}\NormalTok{(}\AttributeTok{data =}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ scale, }
                              \AttributeTok{distance =} \StringTok{"euclidean"}\NormalTok{, }
                              \AttributeTok{min.nc =} \DecValTok{2}\NormalTok{, }
                              \AttributeTok{max.nc =} \DecValTok{9}\NormalTok{, }
                              \AttributeTok{method =} \StringTok{"complete"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Man kan se her, at enten 2 eller 3 er optimelt, som passer sammen med den elbow plot methode.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as\_tibble}\NormalTok{(cluster\_30\_indexes}\SpecialCharTok{$}\NormalTok{Best.nc[}\DecValTok{1}\NormalTok{,]) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FunctionTok{factor}\NormalTok{(value))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"count"}\NormalTok{,}\AttributeTok{fill=}\StringTok{"blue"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-434-1.pdf}

\hypertarget{plot-de-forskellige-antal-clusters}{%
\subsection{Plot de forskellige antal clusters}\label{plot-de-forskellige-antal-clusters}}

Vi kan også visualisere hvordan de forskellige antal clusters ser ud. Her kan vi bruge vores resultater fra funktionen \texttt{augment} til hver af de 9 clusterings. Her har vi har plottet \texttt{flipper\_length\_mm} vs \texttt{bill\_length\_mm}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclusts\_augment }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ flipper\_length\_mm, }\AttributeTok{y =}\NormalTok{ bill\_length\_mm,}\AttributeTok{colour=}\NormalTok{.cluster)) }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{shape=}\FunctionTok{factor}\NormalTok{(species)), }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+} 
        \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ k) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-435-1.pdf}

Her introducerer jeg \texttt{sex} som en ekstra variable i de plot. Husk at variablen \texttt{sex} ikke blev brugt i k-means, men det kan være, at der er nogle aspekter af de fire variabler, som kan fortælle os nogle om kønnet af pingvingerne. For at spare plads, har jeg kun plottet antal clusters fra 2 til 5.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{kclusts\_augment }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(k }\SpecialCharTok{\%in\%} \DecValTok{2}\SpecialCharTok{:}\DecValTok{5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{scale}\NormalTok{(flipper\_length\_mm), }\AttributeTok{y =} \FunctionTok{scale}\NormalTok{(bill\_length\_mm),}\AttributeTok{colour=}\NormalTok{.cluster)) }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{shape=}\FunctionTok{factor}\NormalTok{(species)), }\AttributeTok{alpha =} \FloatTok{0.8}\NormalTok{) }\SpecialCharTok{+} 
        \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{ sex}\SpecialCharTok{+}\NormalTok{k,}\AttributeTok{nrow=}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-436-1.pdf}

\hypertarget{hierarchical-clustering}{%
\section{Hierarchical clustering}\label{hierarchical-clustering}}

K-means er en meget populær måde at lave clusters i de data på, men der er mange andre metoder til at lave clusters. Jeg nævne kort hierarchical clustering. Derfor vil jeg også navne her hierarchical clustering. Vi skifter over til \texttt{mtcars}, og ligesom i \texttt{kmeans} skal vi bruge \texttt{scale} på de numeriske kolonner i de data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_scaled }\OtherTok{\textless{}{-}}\NormalTok{ mtcars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ scale}
\end{Highlighting}
\end{Shaded}

I modsætning til k-means, for at lave hierarchical clustering skal man første beregne afstanden mellem alle de observationer i de data. De gøre man med funktionen \texttt{dist} (som bruger den Euclidean distance som default):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OtherTok{\textless{}{-}} \FunctionTok{dist}\NormalTok{(mtcars\_scaled)}
\end{Highlighting}
\end{Shaded}

For at lave en hierarchical clustering anvender man funktionen \texttt{hclust}. Metoden \texttt{complete} er default men man kan afprøve de andre methoder (der er ikke en fast regel over for, hvilken man skal bruge).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_hc }\OtherTok{\textless{}{-}} \FunctionTok{hclust}\NormalTok{(d, }\AttributeTok{method =} \StringTok{"complete"}\NormalTok{ )}
\CommentTok{\# Metoder: "average", "single", "complete", "ward.D"}
\end{Highlighting}
\end{Shaded}

I følgende arbejder vi lidt med \texttt{mtcars\_hc} til at få nogle clusters frem, og til at lave et plot.

\hypertarget{vuxe6lge-uxf8nkset-antal-clusters}{%
\subsection{Vælge ønkset antal clusters}\label{vuxe6lge-uxf8nkset-antal-clusters}}

Funktionen \texttt{cutree} anvendes til at få clusters fra de data. For eksempel, hvis man gerne vil have 4 clusters, bruger man \texttt{k\ =\ 4}. Jeg specificerer \texttt{order\_clusters\_as\_data\ =\ FALSE} for at få de clusters i de rækkefølger, som passer til plottet (dendrogram) vi lave (man skal have ovenstående pakker installeret for at få den til at fungere).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dendextend)}

\NormalTok{clusters }\OtherTok{\textless{}{-}} \FunctionTok{cutree}\NormalTok{(mtcars\_hc, }\AttributeTok{k =} \DecValTok{4}\NormalTok{, }\AttributeTok{order\_clusters\_as\_data =} \ConstantTok{FALSE}\NormalTok{)}

\FunctionTok{tibble}\NormalTok{(}\StringTok{"cluster"}\OtherTok{=}\NormalTok{clusters) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(cluster) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\FunctionTok{n}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE # A tibble: 4 x 2
FALSE   cluster `n()`
FALSE     <int> <int>
FALSE 1       1     7
FALSE 2       2     8
FALSE 3       3    12
FALSE 4       4     5
\end{verbatim}

\hypertarget{lav-et-puxe6nt-plot-af-dendrogram-med-ggplot2}{%
\subsection{Lav et pænt plot af dendrogram med ggplot2}\label{lav-et-puxe6nt-plot-af-dendrogram-med-ggplot2}}

Første vi anvende \texttt{dendro\_data} til at udtrække de dendrogram oplysninger fra de \texttt{hclust} resultater.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggdendro)}
\NormalTok{dend\_data }\OtherTok{\textless{}{-}} \FunctionTok{dendro\_data}\NormalTok{(mtcars\_hc }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ as.dendrogram, }\AttributeTok{type =} \StringTok{"rectangle"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Vi tilføjer vores clusters som vi beregnede ovenpå (det er derfor vi sikrede rækkefølgen af de clusters):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dend\_data}\SpecialCharTok{$}\NormalTok{labels }\OtherTok{\textless{}{-}}\NormalTok{ dend\_data}\SpecialCharTok{$}\NormalTok{labels }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{cluster =}\NormalTok{ clusters)}
\end{Highlighting}
\end{Shaded}

Vi benytter \texttt{dend\_data\$segments} og \texttt{dend\_data\$labels} til at lave et informativ plot af de data i \texttt{ggplot2}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(dend\_data}\SpecialCharTok{$}\NormalTok{segments) }\SpecialCharTok{+} 
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{xend =}\NormalTok{ xend, }\AttributeTok{yend =}\NormalTok{ yend)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ dend\_data}\SpecialCharTok{$}\NormalTok{labels, }
            \FunctionTok{aes}\NormalTok{(x, y, }\AttributeTok{label =}\NormalTok{ label,}\AttributeTok{col=}\FunctionTok{factor}\NormalTok{(cluster)),}
            \AttributeTok{hjust=}\DecValTok{1}\NormalTok{,}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_dendro}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-443-1.pdf}

\hypertarget{ekstra-afpruxf8ve-andre-metoder}{%
\subsection{Ekstra: afprøve andre metoder}\label{ekstra-afpruxf8ve-andre-metoder}}

Her giver jeg nogle valgfri ekstra kode til at afprøve de fire metoder - ``average'', ``single'', ``complete'' og ``ward.D''.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# samme ggplot kommando som ovenpå lavet til en funktion }
\NormalTok{den\_plot }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{ggplot}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{segments) }\SpecialCharTok{+} 
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{xend =}\NormalTok{ xend, }\AttributeTok{yend =}\NormalTok{ yend)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\AttributeTok{data =}\NormalTok{ .x}\SpecialCharTok{$}\NormalTok{labels, }
            \FunctionTok{aes}\NormalTok{(x, y, }\AttributeTok{label =}\NormalTok{ label),}
            \AttributeTok{hjust=}\DecValTok{1}\NormalTok{,}\AttributeTok{size=}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{4}\NormalTok{, }\DecValTok{10}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme\_dendro}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Vi iterate over de fire metoder og lave samme process som ovenpå med map. Derefter kan man lave et plot fk. med grid.arrange:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# fire metoder:}
\NormalTok{m }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{( }\StringTok{"average"}\NormalTok{, }\StringTok{"single"}\NormalTok{, }\StringTok{"complete"}\NormalTok{, }\StringTok{"ward.D"}\NormalTok{)}

\NormalTok{hc\_results }\OtherTok{\textless{}{-}} 
  \FunctionTok{tibble}\NormalTok{(}\AttributeTok{method =}\NormalTok{ m) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{( }\AttributeTok{kclust =} \FunctionTok{map}\NormalTok{(method, }\SpecialCharTok{\textasciitilde{}}\FunctionTok{hclust}\NormalTok{(d, }\AttributeTok{method =}\NormalTok{ .x)), }
          \AttributeTok{dendrogram =} \FunctionTok{map}\NormalTok{(kclust,as.dendrogram),}
          \AttributeTok{den\_dat =} \FunctionTok{map}\NormalTok{(dendrogram,}\SpecialCharTok{\textasciitilde{}}\FunctionTok{dendro\_data}\NormalTok{(.x,}\AttributeTok{type=}\StringTok{"rectangle"}\NormalTok{)),}
          \AttributeTok{plot =} \FunctionTok{map}\NormalTok{(den\_dat,den\_plot))}

\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{grid.arrange}\NormalTok{(}\AttributeTok{grobs =}\NormalTok{ hc\_results }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(plot),}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-445-1.pdf}

\hypertarget{problemstillinger-8}{%
\section{Problemstillinger}\label{problemstillinger-8}}

\textbf{0}) Quiz - Clustering

\textbf{1}) \emph{Funktionen kmeans}. I ovenstående anvendt vi \texttt{mtcars} i hierarchical clustering, men lad os se, hvordan det ser ud med \texttt{k-means}. Man kan tilpasse den ovenstående kode for det \texttt{penguins} datasæt:

\begin{itemize}
\item
  \textbf{a}) Benyt \texttt{kmeans} til at finde 2 clusters i de data

  \begin{itemize}
  \tightlist
  \item
    husk at vælge kun de numeriske kolonner og scale de data i forvejen
  \item
    gem din clustering som \texttt{my\_clusters}.
  \item
    hvor mange observationer er der i hver af de to clusters?
  \end{itemize}
\item
  \textbf{b}) Anvend \texttt{augment} til at forbinde de datasæt til de clusters fra \texttt{my\_clusters} (husk at din clustering resultat skrives i første plads i funktionen og så de data i anden plads).
\item
  \textbf{c}) Brug din augmented datasæt til at lave et scatter plot mellem to af de numeriske variabler i de data og give dem farver efter de clusters du har beregnet.

  \begin{itemize}
  \tightlist
  \item
    hvis du har forbundet det oprindeligt data (der ikke var scaled) i \texttt{augment}, husk at scale de data i plottet.
  \item
    prøve også to andre numeriske variabler
  \end{itemize}
\item
  \textbf{d}) Anvend \texttt{tidy} til at finde ud af de middelværdier/centroids af hver af de 2 clusters

  \begin{itemize}
  \tightlist
  \item
    tilpas min kode fra notaterne til at tilføj dem til plottet som `x'.
  \end{itemize}
\end{itemize}

\textbf{2}) \emph{k-means for forskellige k}

Åbn \texttt{LungCapData} fra nedenstående link

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{LungCapData }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/ke27fs5d37ks1hm/LungCapData.csv?dl=1"}\NormalTok{)}
\NormalTok{LungCapData }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(LungCapData)}
\FunctionTok{head}\NormalTok{(LungCapData) }\CommentTok{\#se variabler navne}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 6
##   LungCap   Age Height Smoke Gender Caesarean
##     <dbl> <int>  <dbl> <chr> <chr>  <chr>    
## 1    6.48     6   62.1 no    male   no       
## 2   10.1     18   74.7 yes   female no       
## 3    9.55    16   69.7 no    female yes      
## 4   11.1     14   71   no    male   no       
## 5    4.8      5   56.9 no    male   no       
## 6    6.22    11   58.7 no    female no
\end{verbatim}

\begin{itemize}
\item
  \textbf{a}) Anvend \texttt{kmeans} på \texttt{LungCapData}

  \begin{itemize}
  \tightlist
  \item
    Vælg de numeriske variabler og scale
  \item
    Angiv \texttt{centers\ =\ 3}
  \item
    Benytte \texttt{augment} til at forbinde resultaterne til \texttt{LungCapData} og gemme resultatet.
  \end{itemize}
\item
  \textbf{b}) Lav et scatter plot mellem \texttt{LungCap} og \texttt{Age} og giv farver efter din beregnet clusters.
\item
  \textbf{c}) Lav et scatter plot mellem \texttt{LungCap} og \texttt{Height} og giv farver efter \texttt{Smoke}.

  \begin{itemize}
  \tightlist
  \item
    Angiv en forskellige form efter \texttt{Smoke}
  \end{itemize}
\item
  \textbf{d}) Man kan også bruge \texttt{my\_clusters\_augment} til at beregne middelværdier med \texttt{group\_by} og \texttt{summarise}.

  \begin{itemize}
  \tightlist
  \item
    group efter \texttt{.cluster} og \texttt{smoke} og beregner den gennemsnitlige \texttt{LungCap} og \texttt{Height} for hver kombination.
  \item
    Angiv datarammen af resultaterne middelværdier indenfor plottet med \texttt{geom\_point} for at få dem som ``X'' punkter i plottet.
  \end{itemize}
\end{itemize}

Lad os undersøge om, 3 var en gode antal clusters til at beregne i de data.

\begin{itemize}
\tightlist
\item
  \textbf{d}) Tilpas koden nedenstående (baserende på den jeg præsenterede i notaterne) til at beregne 9 clusterings for det \texttt{LungCapData} datasæt.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{kmeans}\NormalTok{(??? }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(???) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ ???,}
                 \AttributeTok{centers =}\NormalTok{ ???)  }

\NormalTok{kclusts }\OtherTok{\textless{}{-}} 
  \FunctionTok{tibble}\NormalTok{(}\AttributeTok{k =}\NormalTok{ ???) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{( }\AttributeTok{kclust =} \FunctionTok{map}\NormalTok{(k, my\_func),}
          \AttributeTok{tidied =}\NormalTok{ ???,}
          \AttributeTok{glanced =}\NormalTok{ ???,}
          \AttributeTok{augmented =}\NormalTok{ ???}
\NormalTok{        )}


\NormalTok{kclusts\_tidy    }\OtherTok{\textless{}{-}}\NormalTok{ kclusts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{unnest}\NormalTok{(???)}
\NormalTok{kclusts\_augment }\OtherTok{\textless{}{-}}\NormalTok{ ??? }
\NormalTok{kclusts\_glance }\OtherTok{\textless{}{-}}\NormalTok{  ???}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{e}) Lav et ``elbow''-plot fra din beregnet clusterings

  \begin{itemize}
  \tightlist
  \item
    Anvend \texttt{kclusts\_glance} og plot \texttt{tot.withinss} på y-aksen.
  \end{itemize}
\item
  \textbf{e}) Afpøv automatiske method (tilpas min kode fra kursus notaterne)
\item
  \textbf{f}) Visualiser de forskellige antal clusters i et plot

  \begin{itemize}
  \tightlist
  \item
    Tilpas min kode og benytter \texttt{kclusts\_augment}
  \item
    Husk at bruge \texttt{facet\_wrap} til at adskille efter k.
  \end{itemize}
\end{itemize}

\textbf{3}) \emph{Hierarchical clustering øvelse}

Vi laver en analyse af det \texttt{msleep} datasæt. Jeg har lavet oprydningen og scaling for jer:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(msleep)}
\NormalTok{msleep\_clean }\OtherTok{\textless{}{-}}\NormalTok{ msleep }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(name,}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{drop\_na}\NormalTok{()}
\NormalTok{msleep\_scaled }\OtherTok{\textless{}{-}}\NormalTok{ msleep\_clean }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{name) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ scale}
\FunctionTok{row.names}\NormalTok{(msleep\_scaled) }\OtherTok{\textless{}{-}}\NormalTok{ msleep\_clean}\SpecialCharTok{$}\NormalTok{name}
\end{Highlighting}
\end{Shaded}

Tilpas min kode fra kursusnotaterne til at lave følgende skridt:

\begin{itemize}
\item
  \textbf{a}) Benyt funktioner \texttt{dist} og så \texttt{hclust} på datasættet \texttt{msleep\_scaled}.
\item
  \textbf{b}) Benyt \texttt{cuttree} for at finde 5 clusters i de data, og kalde det for \texttt{clusters}. Husk at anvende \texttt{order\_clusters\_as\_data\ =\ FALSE} så at vi har den korrekt rækkefølge for et plot (man skal indlæse pakken \texttt{dendextend})
\item
  \textbf{c}) Benyt \texttt{dendro\_data} til at udtrække de dendrogram fra resultaterne

  \begin{itemize}
  \tightlist
  \item
    Tilføj \texttt{clusters} til \texttt{dend\_data\$labels}
  \end{itemize}
\item
  \textbf{d}) Lav et plot af de dendrogram

  \begin{itemize}
  \tightlist
  \item
    Tilpas koden for \texttt{mtcars} eksempel for nuværende data
  \end{itemize}
\end{itemize}

\hypertarget{principal-component-analysis-pca}{%
\chapter{Principal component analysis (PCA)}\label{principal-component-analysis-pca}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\hypertarget{indledning-og-luxe6ringsmuxe5lene-3}{%
\section{Indledning og læringsmålene}\label{indledning-og-luxe6ringsmuxe5lene-3}}

\hypertarget{luxe6ringsmuxe5lene-5}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-5}}

\begin{itemize}
\tightlist
\item
  Forstå koncepten bag PCA
\item
  Benytte PCA i R og lave et plot af de data i to dimensioner
\item
  Vurdere den relative variance forklarede af de forskellige components
\item
  Anvende PCA til at vurdere variablernes bidrag til principal components
\end{itemize}

\hypertarget{introduktion-til-chapter-2}{%
\subsection{Introduktion til chapter}\label{introduktion-til-chapter-2}}

Principal component analysis er en meget populær og benyttet metode og kan anvendes til bla. at visualisere data med en høj antal dimensioner i et enktelt scatter plot med to dimensioner. Det er meget nyttige for at se de underliggende struktur i de data og indenfor biologi er det meget brugt til at visualisere hvor de forskellige samples sidder relative til hinhanden - for eksempel for at se, om de controls og treatment samples fremgå i samme steder i et plot.

\hypertarget{video-ressourcer-6}{%
\subsection{Video ressourcer}\label{video-ressourcer-6}}

\begin{itemize}
\tightlist
\item
  Video 1 - hvad er PCA?
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556581604}

\begin{itemize}
\tightlist
\item
  Video 2 - hvordan man lave PCA i R og få output i tidy form
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556581588}

\begin{itemize}
\tightlist
\item
  Video 3 - hvordan man visualisere de data (principal components, rotation matrix)
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556787141}

\hypertarget{hvad-er-principal-component-analysis-pca}{%
\section{Hvad er principal component analysis (PCA)?}\label{hvad-er-principal-component-analysis-pca}}

I vores sidste lektion arbejdede vi med \texttt{penguins}, hvor vi så at der faktisk var fire numeriske variabler - altså fire dimensioner - som blev brugt til at lave k-means clustering.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(palmerpenguins)}
\NormalTok{penguins }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{drop\_na}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{year=}\FunctionTok{as.factor}\NormalTok{(year))}

\NormalTok{penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##            <dbl>         <dbl>             <int>       <int>
## 1           39.1          18.7               181        3750
## 2           39.5          17.4               186        3800
## 3           40.3          18                 195        3250
## 4           36.7          19.3               193        3450
## 5           39.3          20.6               190        3650
## 6           38.9          17.8               181        3625
\end{verbatim}

Når man lave et plot af de data for at vise de forskellige clusters, få man et problem - hvilke to variable skal plottes? Man kan plotte hver eneste pair af variabler. For eksempel kan man prøve en pakke der hedder \texttt{GGally}, som automatiske kan plotte de forskellige pairs af numeriske variabler og beregner korrelationen mellem variablerne.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{require}\NormalTok{(GGally)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Indlæser krævet pakke: GGally
\end{verbatim}

\begin{verbatim}
## Registered S3 method overwritten by 'GGally':
##   method from   
##   +.gg   ggplot2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggscatmat}\NormalTok{(}\AttributeTok{columns =} \DecValTok{3}\SpecialCharTok{:}\DecValTok{6}\NormalTok{ ,}\AttributeTok{color =} \StringTok{"species"}\NormalTok{, }\AttributeTok{corMethod =} \StringTok{"pearson"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{scale\_color\_brewer}\NormalTok{(}\AttributeTok{palette =} \StringTok{"Set2"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-474-1.pdf}

Problemmet er, at så snart antallet af dimensioner bliver større end 4, bliver det alt for kompleks og plads krævende.

En løsning til problemmet er at ``projekt'' de data ned indtil et mindre antal demensioner (fk. kun 2 dimensioner). Disse dimensioner fanger oplysninger fra alle variablerne i datasættet, og derfor når man lave et scatter plot, få man repræsenteret det hele datasæt i stedet for kun to udvalgt variabler. Metoden for at lave disse såkaldte `projektion' kaldes for `princial component analysis'.

\hypertarget{simpel-eksempel-med-to-dimensioner}{%
\subsection{Simpel eksempel med to dimensioner}\label{simpel-eksempel-med-to-dimensioner}}

Man kan prøve at forstå hvordan PCA fungere ved at kigge på en simpel eksempel med 2 dimensioner:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#simulere data med en høj korrelation}
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{250}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{)}
\NormalTok{b }\OtherTok{\textless{}{-}}\NormalTok{ a }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{250}\NormalTok{,}\DecValTok{0}\NormalTok{,.}\DecValTok{5}\NormalTok{)}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(a,b)}
\FunctionTok{ggplot}\NormalTok{(df,}\FunctionTok{aes}\NormalTok{(a,b)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-475-1.pdf}

Vi kan se her, at der er en meget store korrelation mellem a og b. Selvom de data er plottet i 2 dimensioner kan de næsten forklares af én bedste rette linje.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(a,b)}
\FunctionTok{ggplot}\NormalTok{(df,}\FunctionTok{aes}\NormalTok{(a,b)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-476-1.pdf}

Med andre ord kan vi næsten forklare de data i kun en dimension - punkternes afstand langt linjen. Når man tager alle punkterne og beskriver dem langt en linje som bedste beskrive variancen i de data, kaldes den linje for den første principal component (PC1). Man kan dernæst beskriver en anden linje som er vinkelret til PC1 som bedste forklarer variancen i de data som ikke var fanget af PC1 - det kaldes for den anden princal component (PC2).

Vi kan se her PC1 og PC2 plottet:

\includegraphics[width=0.5\linewidth]{plots/pca_dem}

Når vi tager PC1 and PC2 og plotter dem som henholdvis x-aksen og y-aksen, svarer det til in drejning af akserne i plottet (vi finder PC1 og PC2 fra funktionen \texttt{prcomp} som jeg forklarer i næste sektion):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dat }\OtherTok{\textless{}{-}} \FunctionTok{augment}\NormalTok{(}\FunctionTok{prcomp}\NormalTok{(df),df)}
\FunctionTok{ggplot}\NormalTok{(dat,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fittedPC1,}\AttributeTok{y=}\NormalTok{.fittedPC2)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-478-1.pdf}

Vi kan se her, at de data flyder de plads i de plot bedre en før (og bemærk at de askse skala er blev meget mindre i de ny y-aksen, da de data spreder sig meget mindre langt PC2 i forhold til PC1.)

Det her er kun en eksempel hvor vores oprindelige data ligger i to dimensions (to variabler), for at gøre det nemt at visualisere dem i et plot, men de fleste datasæt (fk penguins, iris osv.) har flere end to dimensioner. Vi kan godt lave samme process, hvor vi definerer PC1 som forklarer så meget af variancen i de data som muligt, og dernæst PC2 som forklarer nogle af variancen ikke fanget af PC1, og dernæst PC3 osv., efter hvor mange dimensioner de data har. I mange praktisk situationer vælger man de første to componenter, som er mest vigtige, da de forklarer mest af variancen i de data i forhold til de andre componenter.

``So to sum up, the idea of PCA is simple --- reduce the number of variables of a data set, while preserving as much information as possible.''
\url{https://builtin.com/data-science/step-step-explanation-principal-component-analysis}

\hypertarget{fit-pca-to-data-in-r}{%
\section{Fit PCA to data in R}\label{fit-pca-to-data-in-r}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

Lad os skifte tilbage til nogle virkelige data for at benytte \texttt{prcomp}: datasættet \texttt{penguins}. Med \texttt{prcomp} fokuserer vi kun på numeriske variabler, så vi bruger \texttt{select} med \texttt{where(is.numeric)} og så anvender scaling ved at specificere \texttt{scale\ =\ TRUE} indenfor funktionen \texttt{prcomp}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# retain only numeric columns}
  \FunctionTok{prcomp}\NormalTok{(}\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\# do PCA on scaled data}

\FunctionTok{summary}\NormalTok{(pca\_fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Importance of components:
##                           PC1    PC2     PC3     PC4
## Standard deviation     1.6569 0.8821 0.60716 0.32846
## Proportion of Variance 0.6863 0.1945 0.09216 0.02697
## Cumulative Proportion  0.6863 0.8809 0.97303 1.00000
\end{verbatim}

\texttt{Proportion\ of\ Variance} indikerer hvor meget af variancen i de data blev forklaret af de forskellige komponenter. Vi kan se, at \texttt{PC1} forklaret omkring 69\% og de første to komponenter sammen forklarer 88\% af variancen i de data. Derfor hvis vi viser et plot af de første to komponenter ved vi, at vi har fanget rigtig meget oplysninger om de fire variabler i datasæsttet.

\hypertarget{integrere-pca-resultater-med-broom-pakke}{%
\section{Integrere PCA resultater med broom-pakke}\label{integrere-pca-resultater-med-broom-pakke}}

Der er flere ting som kan være nyttige at lave med vores PCA resultater:

\begin{itemize}
\tightlist
\item
  Lave et plot af de data med de første to principal components
\item
  Se for meget af variancen i de data blev forklaret af de forskellige components
\item
  Bruge den rotation matrix til at se, hvordan variabler sidder med hensyn til hinanen
\end{itemize}

For at få lavet vores plot af de principal componenter kan vi benytter \texttt{augment} ligesom vi gjorde i vores sidste lektion med k-means clustering. Her få vi værdierne til hver af de fire principal components med sammen med den oprindelige datasæt.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit\_augment }\OtherTok{\textless{}{-}}\NormalTok{ pca\_fit }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{augment}\NormalTok{(penguins) }\CommentTok{\# add original dataset back in}

\NormalTok{pca\_fit\_augment}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 333 x 13
##    .rownames species island    bill_length_mm bill_depth_mm flipper_length_mm
##    <chr>     <fct>   <fct>              <dbl>         <dbl>             <int>
##  1 1         Adelie  Torgersen           39.1          18.7               181
##  2 2         Adelie  Torgersen           39.5          17.4               186
##  3 3         Adelie  Torgersen           40.3          18                 195
##  4 4         Adelie  Torgersen           36.7          19.3               193
##  5 5         Adelie  Torgersen           39.3          20.6               190
##  6 6         Adelie  Torgersen           38.9          17.8               181
##  7 7         Adelie  Torgersen           39.2          19.6               195
##  8 8         Adelie  Torgersen           41.1          17.6               182
##  9 9         Adelie  Torgersen           38.6          21.2               191
## 10 10        Adelie  Torgersen           34.6          21.1               198
## # ... with 323 more rows, and 7 more variables: body_mass_g <int>, sex <fct>,
## #   year <fct>, .fittedPC1 <dbl>, .fittedPC2 <dbl>, .fittedPC3 <dbl>,
## #   .fittedPC4 <dbl>
\end{verbatim}

Vi kan tage \texttt{pca\_fit\_augment} og lave et plot af de første to principal components:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit\_augment  }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fittedPC1, }\AttributeTok{y=}\NormalTok{.fittedPC2, }\AttributeTok{color =}\NormalTok{ species)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-482-1.pdf}

Vi kan også integrere de clusters som vi fik fra funktionen \texttt{kmeans} i vores PCA ved at anvende \texttt{augment} på resultaterne fra \texttt{kmeans} og vores data som allerede har resultaterne fra \texttt{pca}. Da både PCA og k-means fanger oplysninger om strukturen af de data baserede på de fire numeriske variabler, kan man forventer en bedre sammenligning mellem de to (i forhold til at sammenligne de clusters med et plot med kun to af variablerne).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{penguins\_scaled }\OtherTok{\textless{}{-}}\NormalTok{ penguins }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ scale}

\NormalTok{kclust }\OtherTok{\textless{}{-}} \FunctionTok{kmeans}\NormalTok{(penguins\_scaled,}\AttributeTok{centers =} \DecValTok{3}\NormalTok{)}

\NormalTok{kclust }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{augment}\NormalTok{(pca\_fit\_augment)  }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{.fittedPC1, }\AttributeTok{y=}\NormalTok{.fittedPC2, }\AttributeTok{color =}\NormalTok{ .cluster)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-483-1.pdf}

\textbf{Output med tidy}

Næste kan vi kigge på variancen i de data som er fanget af hver af de forskellige components. Vi kan udtrække oplysningerne ved at benytte funktionen \texttt{tidy()} fra pakken \texttt{broom}, og ved at angiv \texttt{matrix\ =\ "eigenvalues"} indenfor \texttt{tidy}.

Det kaldes for ``eigenvalues'' fordi, hvis man kigger på matematikken bag principal component analysis, tager man udgangspunkt i en covariance matrix - altså det beskriver sammenhængen eller korrelationen mellem de forskellige variabler. Man bruger denne covariance matrix til at beregne de såkaldte eigenvalues og deres tilsvarende eigenvectors.

Det er faktisk den største eigenvalue som fortæller os om den første principal component - det fortæller os hvor meget af variancen i de data den første principal component fanger - jo større det er relativ til de andre eigenvalues, jo mere variancen man forklarer med den første principal component. Og den næste største fortæller os om den anden prinical component og så videre.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit\_tidy }\OtherTok{\textless{}{-}}\NormalTok{ pca\_fit }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tidy}\NormalTok{(}\AttributeTok{matrix =} \StringTok{"eigenvalues"}\NormalTok{)}
\NormalTok{pca\_fit\_tidy}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 4
##      PC std.dev percent cumulative
##   <dbl>   <dbl>   <dbl>      <dbl>
## 1     1   1.66   0.686       0.686
## 2     2   0.882  0.195       0.881
## 3     3   0.607  0.0922      0.973
## 4     4   0.328  0.0270      1
\end{verbatim}

Lad os visualisere de tal her i procenttal, med at specificere \texttt{labels\ =\ scales::percent\_format()} indenfor \texttt{scale\_y\_continuous} - så vi bare ændre på de tal som kan ses på y-aksen.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit\_tidy }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ PC, }\AttributeTok{y =}\NormalTok{ percent)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{, }\AttributeTok{fill=}\StringTok{"steelblue"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\FunctionTok{percent\_format}\NormalTok{(), }\CommentTok{\#convert labels to percent format}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-485-1.pdf}

På den ene side hvis der er meget variance som er forklaret ved de første components (for eksempel den første og den anden tilsammen), betyder det at der er en del redundans i de data, på grund af at mange af de variabler har en tæt sammenhæng med hinanden. På den anden side hvis der er meget lille andel af variancen som er forklaret af de første components, betyder det at det er svært at beskrive de data i mindre dimensioner (fordi der næsten er ingen sammenhæng mellem variablerne) - i dette tilfælde er PCA mindre effektiv.

\hypertarget{rotation-matrix-to-extract-variable-contributions}{%
\subsection{Rotation matrix to extract variable contributions}\label{rotation-matrix-to-extract-variable-contributions}}

De eigenvalues kan anvendes til at find ud af variancen i de data, men deres tilsvarende eigenvectors fortæller os om, hvordan de forskellige variabler er kombineret til at få de endelige principal component værdier, som vi bruger fk. i et scatter plot. De eigenvectors bruges til at lave et matrix som hedder `rotation matrix'.

Jeg anvender pivot\_wide for at få vores matrix mere klart at se. Vi kan se at vi har variablerne her på rækkerne og de forskellige prinicpal components i kolonnerne.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit\_rotate }\OtherTok{\textless{}{-}}\NormalTok{ pca\_fit }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tidy}\NormalTok{(}\AttributeTok{matrix =} \StringTok{"rotation"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =} \StringTok{"PC"}\NormalTok{, }\AttributeTok{names\_prefix =} \StringTok{"PC"}\NormalTok{, }\AttributeTok{values\_from =} \StringTok{"value"}\NormalTok{)}
\NormalTok{pca\_fit\_rotate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 5
##   column               PC1      PC2    PC3    PC4
##   <chr>              <dbl>    <dbl>  <dbl>  <dbl>
## 1 bill_length_mm     0.454 -0.600   -0.642  0.145
## 2 bill_depth_mm     -0.399 -0.796    0.426 -0.160
## 3 flipper_length_mm  0.577 -0.00579  0.236 -0.782
## 4 body_mass_g        0.550 -0.0765   0.592  0.585
\end{verbatim}

Den rotation matrix fortæller os hvordan man beregner værdierne af de principal components for alle observationer. For eksempel tager vi vores første observation, beregne 0.45 gange de bill length, og så minus 0.4 gang de bill depth, og så plus 0.58 x den flipper length og så plus 0.55 x body\_mass. Og så har vi værdien for observationen langt den første princip komponent.

Vi kan andvende den rotation matrix til at se hvordan de forskellige variabler relatere til hinhanden. Variablerne som er tæt på hinanden i plottet ligner hinanden. Vi kan se at flipper\_length og body\_mass ligner hinhanen ret meget i vores datasæt, mens bill\_depth sidder over til venstre langt den første principal component, så det måske indeholder nogle oplysninger om pingvinerne, der ikke kunne fanges i de andre variabler.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggrepel)}
\NormalTok{pca\_fit\_rotate }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{PC1,}\AttributeTok{y=}\NormalTok{PC2,}\AttributeTok{colour=}\NormalTok{column)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{geom\_text\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label=}\NormalTok{column)) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-487-1.pdf}

\hypertarget{pakken-factoextra}{%
\subsection{\texorpdfstring{Pakken \texttt{factoextra}}{Pakken factoextra}}\label{pakken-factoextra}}

R-pakken \texttt{factoextra} kan avendes til at lave et lignende plot fra de rotation matrix automatiske, og den arbejder ovenpå \texttt{ggplot2} så man kan ændret temaet osv. Man kan se hvordan de fungere i følgende kode.

\begin{itemize}
\tightlist
\item
  Man få det varians procenttal på akserne.
\item
  Lokationer af pilehovederne er fra den rotation matrix.
\item
  Jo mindre vinklen mellem to linjer er, og tættere på de er til hinanden
\item
  Jo nærmere til den cirkle pilehoveredne er, jo mere indflydelse den variable har i de principal components.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(factoextra)}
\FunctionTok{fviz\_pca\_var}\NormalTok{(pca\_fit, }\AttributeTok{col.var=}\StringTok{"steelblue"}\NormalTok{,}\AttributeTok{repel =} \ConstantTok{TRUE}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-488-1.pdf}

\hypertarget{quiz-og-problemstillinger}{%
\section{Quiz og problemstillinger}\label{quiz-og-problemstillinger}}

\textbf{0}) Quiz på Absalon

\textbf{1}) Download følgende datasæt ved at køre følgende kode chunk:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# the column names of the dataset}
\NormalTok{names }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}id\_number\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}diagnosis\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}radius\_mean\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}texture\_mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}perimeter\_mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}area\_mean\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}smoothness\_mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}compactness\_mean\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}concavity\_mean\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}concave\_points\_mean\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}symmetry\_mean\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fractal\_dimension\_mean\textquotesingle{}}\NormalTok{,}
           \StringTok{\textquotesingle{}radius\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}texture\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}perimeter\_se\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}area\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}smoothness\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}compactness\_se\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}concavity\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}concave\_points\_se\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}symmetry\_se\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fractal\_dimension\_se\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}radius\_worst\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}texture\_worst\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}perimeter\_worst\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}area\_worst\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}smoothness\_worst\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}compactness\_worst\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}concavity\_worst\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}concave\_points\_worst\textquotesingle{}}\NormalTok{, }
           \StringTok{\textquotesingle{}symmetry\_worst\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}fractal\_dimension\_worst\textquotesingle{}}\NormalTok{)}
  
\CommentTok{\# get the data from the URL and assign the column names}
\NormalTok{cancer }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\FunctionTok{url}\NormalTok{(}\StringTok{"https://archive.ics.uci.edu/ml/machine{-}learning{-}databases/breast{-}cancer{-}wisconsin/wdbc.data"}\NormalTok{), }\AttributeTok{col.names=}\NormalTok{names)}
\NormalTok{cancer }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(cancer)}
\NormalTok{cancer }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(cancer}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id\_number))}
\end{Highlighting}
\end{Shaded}

\textbf{1}) Anvend funktionen \texttt{ggscatmat} fra pakken \texttt{GGally} til at lave et plot hvor man sammenligne fem af de variabler.

\begin{itemize}
\tightlist
\item
  Man kan lave en tilfældig sample af fem variabler med at angive \texttt{columns\ =\ sample(2:31,5)} indenfor \texttt{ggscatmat}.
\item
  Give farver efter factor variablen \texttt{diagnosis} og vælger ``person'' som \texttt{corMethod}.
\item
  Opfatter du, at der er en del redundans i de data (altså er der høje korrelationer mellem de forskellige variabler)?
\end{itemize}

\textbf{2}) Benyt funktionen \texttt{prcomp} til at beregne en principal component analysis af de data.

\begin{itemize}
\tightlist
\item
  Husk at det skal kun være numeriske variabler og angiv \texttt{scale=TRUE} indenfor funktionen.
\item
  Lav et \texttt{summary} af resultaterne. Hvad er proportionen af variancen forklaret af den første principal component?
\item
  Hvad er proportionen af variancen forklaret af den første to principal components tilsammen?
\end{itemize}

\textbf{3}) \emph{Augment og plot} Anvend \texttt{augment} til at tilføje de rådata til ovenstående resultater fra \texttt{prcomp}.

\begin{itemize}
\tightlist
\item
  Brug den til at lave et scatter plot af de første to principal components
\item
  Giv farver efter \texttt{diagnosis}
\end{itemize}

\textbf{4}) \emph{Integrere kmeans clustering} Lav et clustering med \texttt{kmeans} på de data, med to clusters.

\begin{itemize}
\tightlist
\item
  Augment resultaterne til din rå data (med de \texttt{prcomp} resultater allerede tilføjet).
\item
  Lav et plot og give farver efter \texttt{.cluster} og forme efter \texttt{diagnosis}.
\item
  Sammenligne de clusters med \texttt{diagnosis}.
\end{itemize}

\textbf{5}) \emph{tidy form og variancen} Anvende \texttt{tidy(matrix\ =\ "eigenvalues")} til at få den bidrage af de forskellige components til variancen i de data.

\begin{itemize}
\tightlist
\item
  Lav et barplot som viser de components på x-aksen og \texttt{percent} på y-aksen.
\end{itemize}

\textbf{6}) \emph{tidy form og rotation matrix} Anvende \texttt{tidy(matrix\ =\ "rotation")} til at få den rotation matrix.

\begin{itemize}
\tightlist
\item
  Anvend \texttt{pivot\_wider} til at få den til wide form
\item
  Lav et scatter plot som viser de forskellige variabler relativ til hinanden
\item
  Anvend \texttt{geom\_text\_repel} til at give labels til de variabler
\end{itemize}

\textbf{7}) \emph{Ekstra øvelse} tilpas kode på andre datasæt

\begin{itemize}
\tightlist
\item
  \texttt{iris}
\item
  \texttt{mtcars}
\item
  \texttt{decathlon2} (indbygget data fra pakken \texttt{factoextra})
\end{itemize}

\hypertarget{ekstra-luxe6sning}{%
\section{Ekstra læsning}\label{ekstra-luxe6sning}}

Step by step explanation: \url{https://builtin.com/data-science/step-step-explanation-principal-component-analysis}

PCA tidyverse style fra claus wilke: \url{https://clauswilke.com/blog/2020/09/07/pca-tidyverse-style/}

More PCA in tidyverse framework: \url{https://tbradley1013.github.io/2018/02/01/pca-in-a-tidy-verse-framework/}

\hypertarget{emner-fra-eksperimental-design}{%
\chapter{Emner fra eksperimental design}\label{emner-fra-eksperimental-design}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(broom)}
\end{Highlighting}
\end{Shaded}

\hypertarget{inledning-og-luxe6ringsmuxe5lene-2}{%
\section{Inledning og læringsmålene}\label{inledning-og-luxe6ringsmuxe5lene-2}}

\hypertarget{luxe6ringsmuxe5lene-6}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-6}}

I skal være i stand til at

\begin{itemize}
\tightlist
\item
  Beskrive randomimisation, replication and blocking
\item
  Beskrive Simpson's paradox
\item
  Beskrive Anscombes quartet
\item
  Tjekke efter batch effects med PCA
\end{itemize}

\hypertarget{inledning-til-chapter-1}{%
\subsection{Inledning til chapter}\label{inledning-til-chapter-1}}

Formålet med dette chapter er - hvordan kan vi anvende de værktøj som vi har lært i kurset til at kigge nærmere på forskellige emner i eksperimental design. Det er slet ikke en grundig introduktion til eksperimental design, men nogle nyttige og også interesseret emner som godt viser vigtigheden af at lave hensigsmæssige visualiseringer.

Forståelse af hvordan batch effekts påvirker en analyse er særligt vigtigt indenfor biologi, når mange store sekvensering projektor involverer data samlede eller sekvenseret over forskellige batches, sekvensering maskiner eller forskellige library forberelses metoder.

\hypertarget{video-ressourcer-7}{%
\subsection{Video ressourcer}\label{video-ressourcer-7}}

\begin{itemize}
\tightlist
\item
  Part 1: randomisation, replikation, blocking + confounding

  \begin{itemize}
  \tightlist
  \item
    Læse notaterne nedenfor
  \end{itemize}
\item
  Part 2: Simpson's paradox
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556581563}

\begin{itemize}
\tightlist
\item
  Part 3: Anscombe's quartet
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556581540}

\begin{itemize}
\tightlist
\item
  Part 4: Batch effects and principal component analysis
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/556581521}

\hypertarget{baserende-princip-af-eksperimental-design}{%
\section{Baserende princip af eksperimental design}\label{baserende-princip-af-eksperimental-design}}

\hypertarget{randomisation-and-replication}{%
\subsection{Randomisation and replication}\label{randomisation-and-replication}}

Man laver et \textbf{eksperiment} for at få svar på et bestemt spørgsmål, eller hypotese. Og man designer eksperimentet ud fra princip som gøre det gyldigt at fortolke resultaterne fra analysen af de resulterende data. For et eksperiment at være gyldigt skal det kunne demonstrere hensigtsmæssige \textbf{replikation} og \textbf{randomisation}.

\textbf{Randomisation}

Resultaterne kan skyldes variabiliten i en faktor som ikke direkte er interessant i eksperimentet. Derfor bruger man randomisation til at få disse forskellige faktorer fordelte over de forskellige treatment grupper. Et eksempel kan være `double-blinding' i kliniske eksperimenter - både lægen og patienten har ikke kenskab til, hvem der hører til de forskellige grupper, og så kan man undgår forskelsbehandling som kan påvirker resultaterne.

\textbf{Replikation}

Når man gentage eksperimentet flere gange - for eksempel ved at have flere patienter i hver treatment gruppe Det tillader os til at kunne beregne variabiliteten i de data, som er nødvendige for at konkludere om der er en forskel mellem de grupper. Man kan altså ikke generalisere resultater som er blevet målt på kun én person.

\begin{figure}
\includegraphics[width=1\linewidth]{plots/randomisation} \caption{randomisation og replikation}\label{fig:unnamed-chunk-501}
\end{figure}

I ovenstående figur er der 6 replikater i hver gruppe ``treatment'' eller ``control''. I tilfældet ``Good randomisation'' er genstande som er taget ved tilfældet fra populationen vel matchet mellem de to grupper, mens i andet tilfældet ``Poor randomisatin'', kan man se, at farverne af genstandene er vel matchet indenfor samme grupper. Det gøre det derfor umuligt at fortæl, om en eventuelle forskel mellem ``treatment'' og ``control'' er i virkeligheden resultatet af farven i stedet for målingerne, at man gerne vil sammenligne.

\textbf{Confounding}

Figuren nedenfor illustratorer age som counfounding variable i et eksperiment hvor man prøver at forstå sammenhæng mellem aktivitet niveau og vægtøgning. Der ser umiddelbart ud til at være, at lave aktivitet niveauer (dependent variable) forklarer vægtøgning (indenpendt variable) men man er nødt til at tage ændre variabler ind i betragtning for at sikre, at sammenhængen ikke skyldes noget andet. For eksempel, gruppen med de høj aktivitetsniveau kunne bestå af yngre mennesker end gruppen med de lav aktivitetsniveauet, og deres alder kan påvirker deres vægtøgning (måske på grund af forskelligeheder i stress niveauer, kost osv.).

\includegraphics[width=0.6\linewidth]{plots/confounding_illus}

\textbf{Blocking}

Man kan prøve at kontrollere for ekstra variabler som vi ikke er interesseret i gennem blocking. Man laver ``blocking'' ved først at identificere gruppe af individuelle som ligner hinanden så meget som muligt. Det kan være for eksempel at tre forskellige forsker var med til at lave et stor eksperiment med mange patienter og forskellige treatment grupper. Vi er interesseret i om der er forskelen mellem de treatment grupper, men ikke om der er en forskel mellem forskernes behandling af patienterne. Derfor vil vi gerne `block' efter forsker - kontrollere for dem som en batch effect. Man kan også block efter fk. sex, for at sikre at forskellen i treatment grupper skyldes ikke forskelligheder mellem mænd og kvinder. Man laver ``blocking'' som del af en lineær model efter data er samlet, men det er nyttige at tænke over det fra starten.

\hypertarget{eksempel-med-datasuxe6ttet-toothgrowth}{%
\subsection{\texorpdfstring{Eksempel med datasættet \texttt{ToothGrowth}}{Eksempel med datasættet ToothGrowth}}\label{eksempel-med-datasuxe6ttet-toothgrowth}}

Et god eksempel på en god eksperimental design er datasættet \texttt{ToothGrowth}, som er baserende på marsvin - de fik forskellige kosttilskud og doser og så fik målte deres tænder.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{data}\NormalTok{(ToothGrowth)}
\NormalTok{ToothGrowth }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(ToothGrowth)}
\NormalTok{ToothGrowth }\OtherTok{\textless{}{-}}\NormalTok{ ToothGrowth }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{dose =} \FunctionTok{as.factor}\NormalTok{(dose))}
\FunctionTok{summary}\NormalTok{(ToothGrowth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       len        supp     dose   
##  Min.   : 4.20   OJ:30   0.5:20  
##  1st Qu.:13.07   VC:30   1  :20  
##  Median :19.25           2  :20  
##  Mean   :18.81                   
##  3rd Qu.:25.27                   
##  Max.   :33.90
\end{verbatim}

Her kan man se, at for hver grupper (efter \texttt{supp} og \texttt{dose}) er der 10 marsvin - vi har således replikation over de grupper, og hver \texttt{supp} (supplement) har hver af de tre dose. Hvis vi for eksempel ikke var interesseret i \texttt{supp} men kun dose, så kan man `block' efter \texttt{supp}for at afbøde forskelligheder i effekten af de to supplements i \texttt{supp}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ToothGrowth }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{count}\NormalTok{(supp,dose) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FunctionTok{factor}\NormalTok{(dose),}\AttributeTok{y=}\NormalTok{n,}\AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(dose))) }\SpecialCharTok{+} 
    \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of guinea pigs"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{xlab}\NormalTok{(}\StringTok{"Dosage"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{facet\_grid}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{supp) }\SpecialCharTok{+}
    \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-504-1.pdf}

Man må dog passe på, fordi vi vide ikke om, hvordan de marsvin blev tilknyttet til de forskellige grupper. For eksempel, hvis male og female marsvin er ikke tilknyttet ved tilfælde, kan det opstå, at supp ``OJ'' og dose ``0.5'' har kun male guinea pigs og supp ``OJ'' med dose ``1.0'' har kun female guninea pigs. Så kunne vi ikke fortæl, om forskellen i dose ``0.5'' vs ``1.0'' er resultatet af de dose eller kønnet.

\hypertarget{case-studies-simpsons-paradox}{%
\section{Case studies: Simpson's paradox}\label{case-studies-simpsons-paradox}}

(Se også videoressourcer Part 2).

Simpson's paradox opstå når man drager to modsætte konklusioner fra det samme datasæt - på den ene side når man kigger på de data samlede, og på den anden side når man tager nogle grupper i betragtning. Vi kan visualisere Simpson's paradox gennem eksemplet nedenfor - her har vi to variabler \texttt{x} og \texttt{y} som vi kan avende til at lave et scatter plot, samt nogle forskellige grupper indenfor variablen \texttt{group}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#library(datasauRus)}
\NormalTok{simpsons\_paradox }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/ysh3qpc7qv0ceut/simpsons\_paradox\_groups.txt?dl=1"}\NormalTok{,}\AttributeTok{header=}\NormalTok{T)}
\NormalTok{simpsons\_paradox }\OtherTok{\textless{}{-}}\NormalTok{ simpsons\_paradox }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{as\_tibble}\NormalTok{(simpsons\_paradox)}
\NormalTok{simpsons\_paradox}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE # A tibble: 222 x 3
FALSE        x     y group
FALSE    <dbl> <dbl> <chr>
FALSE  1  62.2 70.6  D    
FALSE  2  52.3 14.7  B    
FALSE  3  56.4 46.4  C    
FALSE  4  66.8 66.2  D    
FALSE  5  66.5 89.2  E    
FALSE  6  62.4 91.5  E    
FALSE  7  38.9  6.76 A    
FALSE  8  39.4 63.1  C    
FALSE  9  60.9 92.6  E    
FALSE 10  56.6 45.8  C    
FALSE # ... with 212 more rows
\end{verbatim}

Hvis vi bare ignorere \texttt{group} og ser på de data samlet, kan vi se at der er en stærk positiv sammenhæng mellem x og y. Men når vi opdele efter de forskellige grupper, ved at skrive \texttt{colour\ =\ group}, få vi faktisk en negativ sammenhæng indenfor hver af de grupper.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}}\NormalTok{ simpsons\_paradox }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(x,y)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}

\NormalTok{p2 }\OtherTok{\textless{}{-}}\NormalTok{ simpsons\_paradox }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(x,y,}\AttributeTok{colour=}\NormalTok{group)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method=}\StringTok{"lm"}\NormalTok{,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{group=}\NormalTok{group),}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{,}\AttributeTok{se=}\ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}

\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-506-1.pdf}

Simpson's paradoks sker mere ofte end man skulle tror, og derfor er det vigtigt at tænke over hvad for nogen ændre variabler man også er nødt til at tage i betragtning.

\hypertarget{berkerly-admissions}{%
\subsection{Berkerly admissions}\label{berkerly-admissions}}

Det meste berømte eksempel af Simpson's Paradox drejer sig om optagelsen til universitetet i Berkely i 1973. Følgende table fra Wikipedia viser statistikker om antallet som ansøgt samt procenttallet som blev optaget overordnet i universitet efter kønnet.

\includegraphics[width=0.85\linewidth]{plots/admissions}

Hvis vi lave et barplot af tallet, kan man se, at der er en højere procenttal af mænd end kvinder som blev optaget på universitet (som resulterede i en retsag mod universitet).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{admissions\_all }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\StringTok{"sex"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\StringTok{"all"}\NormalTok{,}\StringTok{"men"}\NormalTok{,}\StringTok{"woman"}\NormalTok{),}\AttributeTok{admitted=}\FunctionTok{c}\NormalTok{(}\StringTok{"41"}\NormalTok{,}\StringTok{"44"}\NormalTok{,}\StringTok{"35"}\NormalTok{))}

\NormalTok{admissions\_all }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{sex,}\AttributeTok{y=}\NormalTok{admitted,}\AttributeTok{fill=}\NormalTok{sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Percent admitted"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"woman"}\NormalTok{,}\StringTok{"men"}\NormalTok{,}\StringTok{"all"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-508-1.pdf}

Da man dog kiggede lidt nærmere på de samme tal, men opdelt efter de forskellige afdelinger i universitet, fik man en anderledes billede af situationen. I følgende table har vi optagelses tallene for mænd og kvinder i hver af de forskellige afdelinger (A til F).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{admissions\_separate }\OtherTok{\textless{}{-}} \FunctionTok{tribble}\NormalTok{(}
  \SpecialCharTok{\textasciitilde{}}\NormalTok{department,   }\SpecialCharTok{\textasciitilde{}}\NormalTok{all,   }\SpecialCharTok{\textasciitilde{}}\NormalTok{men,  }\SpecialCharTok{\textasciitilde{}}\NormalTok{women,}
  \CommentTok{\#{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}|{-}{-}{-}{-}{-}{-}{-}{-}\#}
  \StringTok{"A"}\NormalTok{,            }\DecValTok{64}\NormalTok{,     }\DecValTok{62}\NormalTok{,      }\DecValTok{82}\NormalTok{,}
  \StringTok{"B"}\NormalTok{,            }\DecValTok{63}\NormalTok{,     }\DecValTok{63}\NormalTok{,      }\DecValTok{68}\NormalTok{,}
  \StringTok{"C"}\NormalTok{,            }\DecValTok{35}\NormalTok{,     }\DecValTok{37}\NormalTok{,      }\DecValTok{34}\NormalTok{,}
  \StringTok{"D"}\NormalTok{,            }\DecValTok{34}\NormalTok{,     }\DecValTok{33}\NormalTok{,      }\DecValTok{35}\NormalTok{,}
  \StringTok{"E"}\NormalTok{,            }\DecValTok{25}\NormalTok{,     }\DecValTok{28}\NormalTok{,      }\DecValTok{24}\NormalTok{,}
  \StringTok{"F"}\NormalTok{,             }\DecValTok{6}\NormalTok{,      }\DecValTok{6}\NormalTok{,       }\DecValTok{7}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Man kan man se, at for de fleste af de afdelinger, er der ikke en signifikant forskel mellem mænd og kvinder, og i nogen tilfælde havde kvinder faktisk en større chance for at blive optaget.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{admissions\_separate }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{department,}\AttributeTok{names\_to=}\StringTok{"sex"}\NormalTok{,}\AttributeTok{values\_to=}\StringTok{"admitted"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{department,}\AttributeTok{y=}\NormalTok{admitted,}\AttributeTok{fill=}\NormalTok{sex)) }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Percent admitted"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{,}\AttributeTok{position =} \StringTok{"dodge"}\NormalTok{,}\AttributeTok{colour=}\StringTok{"black"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-510-1.pdf}

Hvad skyldes det her? Det viste sig, at kvinder havde en tendens til, at ansøge indenfor de afdelinger, som var sværeste at komme ind i. For eksempel, kan man se her, at department E har en relativt lav optagelses procent. Den samme afdelinger var dog en af dem, hvor langt flere kvinder ansøgt end mænd.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{applications\_E }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}\StringTok{"sex"}\OtherTok{=}\FunctionTok{c}\NormalTok{(}\StringTok{"all"}\NormalTok{,}\StringTok{"men"}\NormalTok{,}\StringTok{"woman"}\NormalTok{),}\AttributeTok{applications=}\FunctionTok{c}\NormalTok{(}\StringTok{"584"}\NormalTok{,}\StringTok{"191"}\NormalTok{,}\StringTok{"393"}\NormalTok{))}


\NormalTok{applications\_E }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{sex,}\AttributeTok{y=}\NormalTok{applications,}\AttributeTok{fill=}\NormalTok{sex)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Number of applications to dep. E"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\StringTok{"woman"}\NormalTok{,}\StringTok{"men"}\NormalTok{,}\StringTok{"all"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-511-1.pdf}

\hypertarget{case-studies-anscombes-quartet}{%
\section{Case studies: Anscombe's quartet}\label{case-studies-anscombes-quartet}}

(Se også videoressourcer Part 3).

Anscombes quartet (ser også \url{https://en.wikipedia.org/wiki/Anscombe\%27s_quartet}) er en meget nyttige og berømt eksempel som stammer fra 1973, og som forklarer vigitigheden af at få lavet en visualisering af datasættet. Vi kan få åbnet de data fra linket nedenfor - man har x værdier og y værdier som kan anvendes til at lave et scatter plot, og der er også \texttt{set}, det refererer til fire forskellige datasæt (derfor `quartet').

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anscombe }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/mlt7crdik3eih9a/anscombe\_long\_format.txt?dl=1"}\NormalTok{,}\AttributeTok{header=}\NormalTok{T)}
\NormalTok{anscombe }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(anscombe)}
\NormalTok{anscombe}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 44 x 3
##      set     x     y
##    <int> <int> <dbl>
##  1     1    10  8.04
##  2     1     8  6.95
##  3     1    13  7.58
##  4     1     9  8.81
##  5     1    11  8.33
##  6     1    14  9.96
##  7     1     6  7.24
##  8     1     4  4.26
##  9     1    12 10.8 
## 10     1     7  4.82
## # ... with 34 more rows
\end{verbatim}

Formålet med de data er, at man gerne vil fitte en lineær regression model for at finde den forventet y afhængig om x (husk \texttt{lm(y\ \textasciitilde{}\ x)}). Da vi har fire datasæt, kan man således opdele de data efter \texttt{set} og benytter rammen \texttt{nest} og \texttt{map} (se Chapter 7) til at fitte de fire lineær regression modeller. Vi anvender også \texttt{tidy} og \texttt{glance} for at få summary statistikker fra de fire modeller:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{lm}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ x, }\AttributeTok{data =}\NormalTok{ .x)}

\NormalTok{tidy\_anscombe\_models }\OtherTok{\textless{}{-}}\NormalTok{ anscombe }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_nest}\NormalTok{(set) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fit =} \FunctionTok{map}\NormalTok{(data, my\_func),}
         \AttributeTok{tidy =} \FunctionTok{map}\NormalTok{(fit, tidy),}
         \AttributeTok{glance =} \FunctionTok{map}\NormalTok{(fit, glance))}
\end{Highlighting}
\end{Shaded}

Man kan anvende \texttt{unnest} på den output fra \texttt{tidy} og kigge på den intercept og den slope af de fire modeller. Man kan se, at de to parametre er næsten identiske for de fire modeller:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidy\_anscombe\_models }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{unnest}\NormalTok{(}\StringTok{"tidy"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{id\_cols =} \StringTok{"set"}\NormalTok{,}\AttributeTok{names\_from =} \StringTok{"term"}\NormalTok{,}\AttributeTok{values\_from=}\StringTok{"estimate"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##     set `(Intercept)`     x
##   <int>         <dbl> <dbl>
## 1     1          3.00 0.500
## 2     2          3.00 0.5  
## 3     3          3.00 0.500
## 4     4          3.00 0.500
\end{verbatim}

Hvad med de andre parametre fra modellen - lad os kigge for eksempel på \texttt{r.squared} og \texttt{p.value} fra modellerne, som kan findes i output fra \texttt{glance}. Her kan vi igen se, at de er næsten identiske.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tidy\_anscombe\_models }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(glance)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(set, r.squared,p.value)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 3
##     set r.squared p.value
##   <int>     <dbl>   <dbl>
## 1     1     0.667 0.00217
## 2     2     0.666 0.00218
## 3     3     0.666 0.00218
## 4     4     0.667 0.00216
\end{verbatim}

Hvad med korrelation? Også næsten den samme:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_func }\OtherTok{\textless{}{-}} \ErrorTok{\textasciitilde{}}\FunctionTok{cor}\NormalTok{(.x}\SpecialCharTok{$}\NormalTok{x,.x}\SpecialCharTok{$}\NormalTok{y)}

\NormalTok{anscombe }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_nest}\NormalTok{(set) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{cor =} \FunctionTok{map}\NormalTok{(data, my\_func)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unnest}\NormalTok{(cor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##     set   cor
##   <int> <dbl>
## 1     1 0.816
## 2     2 0.816
## 3     3 0.816
## 4     4 0.817
\end{verbatim}

Kan man så konkludere, at de fire datasæt som underligger de forskellige modeller, er identiske? Vi laver et scatter plot af de fire datasæt (som vi faktisk skulle have gjort i starten af vores analyse).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anscombe }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ x, }\AttributeTok{y =}\NormalTok{ y,}\AttributeTok{colour=}\FunctionTok{factor}\NormalTok{(set))) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{set) }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{"lm"}\NormalTok{, }\AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-517-1.pdf}

De fire datasæt er meget forskellige. Vi ved, at de har alle samme den samme beste rette linjer, men de data er slet ikke den samme. Den første datasæt ser egnet til en lineær regression analyse men vi kan se i nummer to at der ikke engang er en linæer sammenhæng. Og de andre to har en outlier værdi, som gøre at den bedste rette linje passer ikke særlig god til de data.

\hypertarget{using-pca-to-find-batch-effects}{%
\section{Using PCA to find batch effects}\label{using-pca-to-find-batch-effects}}

(Se også videoressourcer Part 4).

Man kan også anvende visualisering til at kigge lidt nærmere på eventuelle batch effekter i de data. Det er især vigtige i store eksperimenter, hvor dele af de data var samlet på forskellige tidspunkter, lokationer, eller af forskellige personer. Det er ofte tilfældet i sekvensering-basarede datasæt, at man ser batch effects, og det kan skyldes mange ting, bla.:

\begin{itemize}
\tightlist
\item
  Sekvensering dybelse
\item
  Grupper samples lavet på forskellige tidspunkter af forskellige indivduelle
\item
  Sekvensering maskiner - samples sekvenserne på forskellige maskiner eller `lanes'.
\end{itemize}

Lad os tage udgangspunkt i nogle genekspression sekvensering data lavet i mus.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{norm.cts }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/3vhwnsnhzsy35nd/bottomly\_count\_table\_normalised.txt?dl=1"}\NormalTok{)}
\NormalTok{coldata }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/el3sm9ncvzbq6xf/bottomly\_phenodata.txt?dl=1"}\NormalTok{)}
\NormalTok{coldata }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(coldata)}
\NormalTok{norm.cts }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(norm.cts,}\AttributeTok{rownames=}\StringTok{"gene"}\NormalTok{)}
\NormalTok{coldata }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(coldata)}
\end{Highlighting}
\end{Shaded}

Jeg begynder ved at vælge kun rækker som har mindst 50 counts, for at undgå gener med lave ekspressionsniveauer. Det næste jeg gør er at transformere de data til log form. Her benytter jeg \texttt{map\_df} over alle de numeriske kolonner - et strategi er at gemme kolonnen \texttt{gene}, fjerne den fra de data, anvende \texttt{map\_df} for at lave de transformering og så tilføj \texttt{gene} som en kolon igen bagefter (OBS: der er mere effektiv måder at gøre det på - for eksempel ved at anvende \texttt{map\_at}, som I er velkommen til at undersøge).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#normalise and filter the data}
\NormalTok{norm.cts }\OtherTok{\textless{}{-}}\NormalTok{ norm.cts }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{rowSums}\NormalTok{(norm.cts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{gene))}\SpecialCharTok{\textgreater{}}\DecValTok{50}\NormalTok{) }

\NormalTok{genes }\OtherTok{\textless{}{-}}\NormalTok{ norm.cts }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(gene)}

\NormalTok{norm.cts }\OtherTok{\textless{}{-}}\NormalTok{ norm.cts }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{gene) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map\_df}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\FunctionTok{log}\NormalTok{(.x}\SpecialCharTok{+}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gene=}\NormalTok{genes,}\AttributeTok{.before=}\DecValTok{1}\NormalTok{)}

\NormalTok{norm.cts}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10,193 x 22
##    gene    SRX033480 SRX033488 SRX033481 SRX033489 SRX033482 SRX033490 SRX033483
##    <chr>       <dbl>     <dbl>     <dbl>     <dbl>     <dbl>     <dbl>     <dbl>
##  1 ENSMUS~      6.35      6.32      6.21      6.29      6.31      6.27      6.30
##  2 ENSMUS~      3.51      3.56      3.57      3.27      2.99      3.61      3.56
##  3 ENSMUS~      3.19      3.50      3.08      3.21      3.14      3.09      3.22
##  4 ENSMUS~      6.69      6.48      6.38      6.35      6.39      6.34      6.50
##  5 ENSMUS~      6.05      6.37      6.17      6.26      6.16      6.06      6.13
##  6 ENSMUS~      2.89      2.94      3.16      3.21      3.77      3.30      3.11
##  7 ENSMUS~      3.42      3.12      3.86      4.36      3.77      3.99      4.24
##  8 ENSMUS~      3.42      2.94      3.52      3.41      3.57      3.60      2.99
##  9 ENSMUS~      5.02      4.98      4.49      4.27      4.67      4.35      4.81
## 10 ENSMUS~      5.13      4.88      4.97      4.76      4.82      4.79      4.96
## # ... with 10,183 more rows, and 14 more variables: SRX033476 <dbl>,
## #   SRX033478 <dbl>, SRX033479 <dbl>, SRX033472 <dbl>, SRX033473 <dbl>,
## #   SRX033474 <dbl>, SRX033475 <dbl>, SRX033491 <dbl>, SRX033484 <dbl>,
## #   SRX033492 <dbl>, SRX033485 <dbl>, SRX033493 <dbl>, SRX033486 <dbl>,
## #   SRX033494 <dbl>
\end{verbatim}

Så der er omkring 10,000 genes i rækkerne og så 21 forskellige samples som spreder sig over kolonnerne. Vi har også nogle sample oplysninger - der er to foskellige strains af mus og også forskellige batches.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{coldata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 21 x 5
##    column    num.tech.reps strain   batch lane.number
##    <chr>             <int> <chr>    <int>       <int>
##  1 SRX033480             1 C57BL.6J     6           1
##  2 SRX033488             1 C57BL.6J     7           1
##  3 SRX033481             1 C57BL.6J     6           2
##  4 SRX033489             1 C57BL.6J     7           2
##  5 SRX033482             1 C57BL.6J     6           3
##  6 SRX033490             1 C57BL.6J     7           3
##  7 SRX033483             1 C57BL.6J     6           5
##  8 SRX033476             1 C57BL.6J     4           6
##  9 SRX033478             1 C57BL.6J     4           7
## 10 SRX033479             1 C57BL.6J     4           8
## # ... with 11 more rows
\end{verbatim}

Vi kan kigger på hvor mange af hver stain og batch vi har i de data:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(coldata}\SpecialCharTok{$}\NormalTok{strain, coldata}\SpecialCharTok{$}\NormalTok{batch)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           
##            4 6 7
##   C57BL.6J 3 4 3
##   DBA.2J   4 3 4
\end{verbatim}

Så kan man se, at både strain har repræsenteret tre eller fire samples i hver af de tre batches. Der er derfor \emph{replication} og da vi har fået repræsenteret hver kombination af strain og batch, kan man eventuaelle \textbf{block} efter batch for at få fjernet dens effekt. Her vil vi bare gerne kigger efter batch effekts og ikke fjerner dem.

For at kigger på de batch effekts kan man via prinicpal component analysis. Husk at når man lave en principal compononent analysis, få men hvad der kaldes for den rotation matrix - det anvendes til at se hvor de forskellige samples ligger relative til hinhanden i de forskellige principal components - samples der ligner hinanden vises på samme sted på plottet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pca\_fit }\OtherTok{\textless{}{-}}\NormalTok{ norm.cts }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# retain only numeric columns}
  \FunctionTok{prcomp}\NormalTok{(}\AttributeTok{scale =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\# do PCA on scaled data}
\end{Highlighting}
\end{Shaded}

For at analysere sammenhænge mellem de forskellige variabler kan man kigger på den rotation matrix med funktionen tidy:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rot\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ pca\_fit }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{tidy}\NormalTok{(}\AttributeTok{matrix =} \StringTok{"rotation"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

Vi vil gerne lave et plot af de rotation matrix, men første vil vi gerne tilføje de sample oplysninger med \texttt{left\_join}, så at vi kan se de forskellige batches eller strains. Både datarammer har en kolon som hedder \texttt{column} som referer til de sample navne, så jeg forbinde efter \texttt{column} her.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rot\_matrix }\OtherTok{\textless{}{-}}\NormalTok{ rot\_matrix  }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{left\_join}\NormalTok{(coldata,}\AttributeTok{by=}\StringTok{"column"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Anvende \texttt{pivot\_wider} til at få den i wide form:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rot\_matrix\_wide }\OtherTok{\textless{}{-}}\NormalTok{ rot\_matrix }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =} \StringTok{"PC"}\NormalTok{, }\AttributeTok{names\_prefix =} \StringTok{"PC"}\NormalTok{, }\AttributeTok{values\_from =} \StringTok{"value"}\NormalTok{)}
\NormalTok{rot\_matrix\_wide}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 21 x 26
##    column num.tech.reps strain batch lane.number    PC1      PC2     PC3     PC4
##    <chr>          <int> <chr>  <int>       <int>  <dbl>    <dbl>   <dbl>   <dbl>
##  1 SRX03~             1 C57BL~     6           1 -0.217  0.262   0.0200  -0.508 
##  2 SRX03~             1 C57BL~     7           1 -0.219  0.243   0.00586  0.166 
##  3 SRX03~             1 C57BL~     6           2 -0.217  0.303   0.0153  -0.237 
##  4 SRX03~             1 C57BL~     7           2 -0.219  0.246   0.00799  0.178 
##  5 SRX03~             1 C57BL~     6           3 -0.217  0.259   0.0974  -0.113 
##  6 SRX03~             1 C57BL~     7           3 -0.219  0.234   0.00385  0.209 
##  7 SRX03~             1 C57BL~     6           5 -0.218  0.237   0.0303  -0.179 
##  8 SRX03~             1 C57BL~     4           6 -0.217  0.00524 0.463    0.376 
##  9 SRX03~             1 C57BL~     4           7 -0.218  0.0901  0.305    0.0651
## 10 SRX03~             1 C57BL~     4           8 -0.218 -0.110   0.434   -0.161 
## # ... with 11 more rows, and 17 more variables: PC5 <dbl>, PC6 <dbl>,
## #   PC7 <dbl>, PC8 <dbl>, PC9 <dbl>, PC10 <dbl>, PC11 <dbl>, PC12 <dbl>,
## #   PC13 <dbl>, PC14 <dbl>, PC15 <dbl>, PC16 <dbl>, PC17 <dbl>, PC18 <dbl>,
## #   PC19 <dbl>, PC20 <dbl>, PC21 <dbl>
\end{verbatim}

Vi laver et plot af de første to principal components og giv farve og form efter de tre batches i de samples. Vi kan se, at vi har fået alle samples fra batch nummer 2 på samme sted i plottet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rot\_matrix\_wide }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(PC1,PC2,}\AttributeTok{shape=}\FunctionTok{factor}\NormalTok{(batch),}\AttributeTok{colour=}\FunctionTok{factor}\NormalTok{(batch))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-526-1.pdf}

Vi kan også give farver efter strain, hvor vi kan se at der nok er en forskellen mellem de to strains her.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rot\_matrix\_wide }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(PC1,PC2,}\AttributeTok{shape=}\FunctionTok{factor}\NormalTok{(strain),}\AttributeTok{colour=}\FunctionTok{factor}\NormalTok{(strain))) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size=}\DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-527-1.pdf}

Man kan også ser de data på en anden måde ved at lave boxplots for to første to principal comonponets opdelte efter batch. Vi få bekræftet vores observation at der er en stærk forskel mellem match 7 og de andre to batches langt den første principal component, og det er et problem som muligvis skal korrigeres før man laver yderligere analyser på de data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p1 }\OtherTok{\textless{}{-}}\NormalTok{ rot\_matrix\_wide }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FunctionTok{factor}\NormalTok{(batch),}\AttributeTok{y=}\NormalTok{PC1,}\AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(batch))) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{show.legend =}\NormalTok{ F) }\SpecialCharTok{+} \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{show.legend =}\NormalTok{ F) }\SpecialCharTok{+} \FunctionTok{theme\_minimal}\NormalTok{()}

\NormalTok{p2 }\OtherTok{\textless{}{-}}\NormalTok{ rot\_matrix\_wide }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FunctionTok{factor}\NormalTok{(batch),}\AttributeTok{y=}\NormalTok{PC2,}\AttributeTok{fill=}\FunctionTok{factor}\NormalTok{(batch))) }\SpecialCharTok{+} \FunctionTok{geom\_boxplot}\NormalTok{(}\AttributeTok{show.legend =}\NormalTok{ F) }\SpecialCharTok{+} \FunctionTok{geom\_jitter}\NormalTok{(}\AttributeTok{show.legend =}\NormalTok{ F) }\SpecialCharTok{+} \FunctionTok{theme\_minimal}\NormalTok{()}

\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-528-1.pdf}

\textbf{Nogle ide for hvordan man korrigere batch effekts (men ikke dækket i kurset):} \url{https://en.wikipedia.org/wiki/Batch_effect\#Correction}

\hypertarget{problemstillinger-9}{%
\section{Problemstillinger}\label{problemstillinger-9}}

\textbf{0}) Quiz på Absalon - experimental

\textbf{1}) \emph{Eksperimental design}

Jeg laver et eksperiment hvor patienter få en af tre forskellige kosttilskud. Der er 5 patienter i hver gruppe og jeg vil gerne se, om patienters energi niveau i gennemsnit er forskellige mellem de tre grupper. Alderne af de patienter i hver af de tre grupper er:

Gruppe 1: 18, 23, 31, 25, 19

Gruppe 2: 24, 29, 35, 21, 30

Gruppe 3: 43, 52, 33, 39, 40

\begin{itemize}
\tightlist
\item
  Hvad er problemet her med det eksperimental design? Lav boxplots for at viser fordelingen af de alders for hver af de tre grupper.
\item
  Hvis man finder en signifikant forskel mellem de tre kosttilskud, kan man stoler på resultaterne?
\item
  Hvad andre variabler end alder kunne skyldes en eventuelle forskel mellem de tre kosttilskud, og som måske skulle tages i betragtning?
\item
  Hvad kan man gøre med den eksperiment design for at løse problemet?
\end{itemize}

\textbf{2}) \emph{Simpson's paradoks} \textbf{Lung Cap data revisited}

Indlæse \texttt{LungCapData}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{LungCapData }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/ke27fs5d37ks1hm/LungCapData.csv?dl=1"}\NormalTok{)}
\NormalTok{LungCapData}\SpecialCharTok{$}\NormalTok{Age.Group }\OtherTok{\textless{}{-}} \FunctionTok{cut}\NormalTok{(LungCapData}\SpecialCharTok{$}\NormalTok{Age,}\AttributeTok{breaks=}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{15}\NormalTok{,}\DecValTok{17}\NormalTok{,}\DecValTok{19}\NormalTok{),}\AttributeTok{right=}\ConstantTok{FALSE}\NormalTok{,}\AttributeTok{include.lowest =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{levels}\NormalTok{(LungCapData}\SpecialCharTok{$}\NormalTok{Age.Group) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"\textless{}13"}\NormalTok{,}\StringTok{"13{-}14"}\NormalTok{,}\StringTok{"15{-}16"}\NormalTok{,}\StringTok{"17+"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Lav boxplots med \texttt{smoke} på x-aksen og \texttt{LungCap} på y-aksen.

  \begin{itemize}
  \tightlist
  \item
    Notere hvilke gruppe den højeste lungkapacitet.
  \end{itemize}
\item
  Lav samme plot men adskilte efter \texttt{Age.Group}.
\item
  Beskriv, hvordan det er et eksempel på Simpson's Paradoks.
\item
  Lav et boxplot med \texttt{Age} på y-aksen og \texttt{Smoke} på x-aksen for at støtte hvorfor man ser Simpson's Paradoks i de data.
\end{itemize}

\textbf{3}) \emph{Anscombes analyse} Gentage Anscombes analyse med dinosaurus datasæt:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(datasauRus)}
\NormalTok{data\_dozen }\OtherTok{\textless{}{-}}\NormalTok{ datasauRus}\SpecialCharTok{::}\NormalTok{datasaurus\_dozen}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  Fit en lineær regression model for hver af de datasæt (anvende \texttt{group\_by}, \texttt{nest} og \texttt{map} ramme), hvor man finde den forventet \texttt{y} afhængig om \texttt{x}.
\item
  Anvende \texttt{tidy} og \texttt{glance} på resultaterne.
\item
  Anvende resultaterne fra \texttt{tidy} til at kigge på den slope og intercept for de forskellige modeller.
\item
  Anvende også resultaterne fra \texttt{glance} til at kigge på den \texttt{r.squared} værdi og p-værdien.
\item
  Er de de samme datasæt? Lave et scatter plot adskilte efter de forskellige datasæt.

  \begin{itemize}
  \tightlist
  \item
    Hvordan ser de bedste rette linjer ud på de plots?
  \end{itemize}
\end{itemize}

\textbf{4}) Vi vil gerne tjekke for batch effects i følgende datasæt. Det er simuleret ``single cell'' sekvensering count data \texttt{cse50} samt med \texttt{batches} som angiver en batch for hver af de 500 cells i de datasæt.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cse50 }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/o0wzojpcsekeg6z/cell\_mix\_50\_counts.txt?dl=1"}\NormalTok{)}
\NormalTok{batches }\OtherTok{\textless{}{-}} \FunctionTok{read.table}\NormalTok{(}\StringTok{"https://www.dropbox.com/s/4t382bfgro46ka5/cell\_mix\_50\_batches.txt?dl=1"}\NormalTok{)}
\NormalTok{batches }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(batches)}
\NormalTok{cse50 }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(cse50)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{a}) Anvend \texttt{map\_df} til at få transformeret de data til log scale (plus 1 først og tag log bagefter).
\item
  \textbf{b}) Lav PCA på dent transformeret datasæt.
\item
  \textbf{c}) Anvend din PCA resultater til at få den rotation matrix
\item
  \textbf{c}) Forbinde oplysningerne fra datarammen \texttt{batches} med \texttt{left\_join} til din rotation matrix.

  \begin{itemize}
  \tightlist
  \item
    Først tilføj en ny kolon der hedder ``column'', som er lig med \texttt{names(cse50)}.
  \end{itemize}
\item
  \textbf{d}) Anvend \texttt{pivot\_wider} og lave et plot af den første to principal components, og angive farve efter \texttt{batch}.
\item
  \textbf{e}) Lav også boxplots for de første to prinpical components fordelt efter \texttt{batch}.

  \begin{itemize}
  \tightlist
  \item
    Kommentere på eventuelle batch effekts i de data.
  \end{itemize}
\end{itemize}

\hypertarget{tidymodels-og-introduktion-til-maskin-luxe6ring}{%
\chapter{Tidymodels og introduktion til maskin læring}\label{tidymodels-og-introduktion-til-maskin-luxe6ring}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidymodels) }\CommentTok{\# metapackage for ML }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE -- Attaching packages -------------------------------------- tidymodels 0.2.0 --
\end{verbatim}

\begin{verbatim}
FALSE v dials        0.1.1     v rsample      0.1.1
FALSE v infer        1.0.0     v tune         0.2.0
FALSE v modeldata    0.1.1     v workflows    0.2.6
FALSE v parsnip      0.2.1     v workflowsets 0.2.1
FALSE v recipes      0.2.0     v yardstick    0.0.9
\end{verbatim}

\begin{verbatim}
FALSE -- Conflicts ----------------------------------------- tidymodels_conflicts() --
FALSE x gridExtra::combine() masks dplyr::combine()
FALSE x scales::discard()    masks purrr::discard()
FALSE x dplyr::filter()      masks stats::filter()
FALSE x recipes::fixed()     masks stringr::fixed()
FALSE x dplyr::lag()         masks stats::lag()
FALSE x dials::prune()       masks dendextend::prune()
FALSE x yardstick::spec()    masks readr::spec()
FALSE x recipes::step()      masks stats::step()
FALSE * Use suppressPackageStartupMessages() to eliminate package startup messages
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse) }\CommentTok{\# metapackage for data manipulation and visulaisation}
\FunctionTok{library}\NormalTok{(ranger) }\CommentTok{\#install this, random forest}
\FunctionTok{library}\NormalTok{(palmerpenguins)}
\FunctionTok{library}\NormalTok{(kernlab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
FALSE 
FALSE Vedhæfter pakke: 'kernlab'
\end{verbatim}

\begin{verbatim}
FALSE Det følgende objekt er maskeret fra 'package:scales':
FALSE 
FALSE     alpha
\end{verbatim}

\begin{verbatim}
FALSE Det følgende objekt er maskeret fra 'package:purrr':
FALSE 
FALSE     cross
\end{verbatim}

\begin{verbatim}
FALSE Det følgende objekt er maskeret fra 'package:ggplot2':
FALSE 
FALSE     alpha
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ISLR)}
\end{Highlighting}
\end{Shaded}

\hypertarget{luxe6ringsmuxe5lene-7}{%
\section{Læringsmålene}\label{luxe6ringsmuxe5lene-7}}

\begin{itemize}
\tightlist
\item
  introducerer testing/training koncept
\item
  bruger tidymodel workflow til at lave linær regression (parsnip)
\item
  bruge samme workflow til at lave RF (tune parameter)
\item
  tage RF og lave en AUC plot til at vurdere resultatet (yardstick)
\end{itemize}

\hypertarget{purpose-of-chapter}{%
\section{Purpose of chapter}\label{purpose-of-chapter}}

Not to be a comprehensive guide to machine learning

The idea is to introduce a new workflow which you can use for modelling.

The workflow is a framework which is easy to expand as you learn new modelling methodotholgies.

It may seem like overkill for linear regression but it works particularly well for machine learning set-ups, where we can cut out a lot of steps (which are done internally by the package)

\hypertarget{testing-and-training-sets}{%
\section{Testing and training sets}\label{testing-and-training-sets}}

Introduce what testing and training is, and what the purpose is

\hypertarget{regression-in-the-tidy-model-framework}{%
\section{Regression in the tidy model framework}\label{regression-in-the-tidy-model-framework}}

Introduce the tidymodel framework with a very simple linear regression

\#mt cars

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{7834}\NormalTok{)}

\CommentTok{\# Create a split object}
\NormalTok{mtcars\_split }\OtherTok{\textless{}{-}} \FunctionTok{initial\_split}\NormalTok{(penguins }\SpecialCharTok{\%\textgreater{}\%}  \FunctionTok{drop\_na}\NormalTok{(), }\AttributeTok{prop =} \FloatTok{0.75}\NormalTok{)}

\CommentTok{\# Build training data set}
\NormalTok{mtcars\_training }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_split }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{training}\NormalTok{()}

\CommentTok{\# Build testing data set}
\NormalTok{mtcars\_test }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_split }\SpecialCharTok{\%\textgreater{}\%} 
              \FunctionTok{testing}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Make a recipe

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_recipe }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(body\_mass\_g }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ mtcars\_training) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_YeoJohnson}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_normalize}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_dummy}\NormalTok{(}\FunctionTok{all\_nominal}\NormalTok{(), }\SpecialCharTok{{-}} \FunctionTok{all\_outcomes}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

select a model

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lm\_model }\OtherTok{\textless{}{-}} \FunctionTok{linear\_reg}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{set\_engine}\NormalTok{(}\StringTok{\textquotesingle{}lm\textquotesingle{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{set\_mode}\NormalTok{(}\StringTok{\textquotesingle{}regression\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Make a workflow

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_workflow }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_model}\NormalTok{(lm\_model) }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_recipe}\NormalTok{(mtcars\_recipe)}
\end{Highlighting}
\end{Shaded}

Run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_workflow }\SpecialCharTok{\%\textgreater{}\%} 
             \FunctionTok{last\_fit}\NormalTok{(}\AttributeTok{split =}\NormalTok{ mtcars\_split)}
\end{Highlighting}
\end{Shaded}

How good is the fit?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{collect\_metrics}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   .metric .estimator .estimate .config             
##   <chr>   <chr>          <dbl> <chr>               
## 1 rmse    standard     319.    Preprocessor1_Model1
## 2 rsq     standard       0.820 Preprocessor1_Model1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Obtain test set predictions data frame}
\NormalTok{mtcars\_results }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_fit }\SpecialCharTok{\%\textgreater{}\%} 
                 \FunctionTok{collect\_predictions}\NormalTok{()}
\CommentTok{\# View results}
\NormalTok{mtcars\_results}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 84 x 5
##    id               .pred  .row body_mass_g .config             
##    <chr>            <dbl> <int>       <int> <chr>               
##  1 train/test split 4085.     9        3800 Preprocessor1_Model1
##  2 train/test split 4104.    10        4400 Preprocessor1_Model1
##  3 train/test split 3658.    12        3450 Preprocessor1_Model1
##  4 train/test split 3295.    14        3325 Preprocessor1_Model1
##  5 train/test split 3816.    17        3600 Preprocessor1_Model1
##  6 train/test split 3622.    18        3800 Preprocessor1_Model1
##  7 train/test split 3951.    22        3550 Preprocessor1_Model1
##  8 train/test split 3622.    23        3200 Preprocessor1_Model1
##  9 train/test split 3928.    35        4650 Preprocessor1_Model1
## 10 train/test split 4129.    37        3900 Preprocessor1_Model1
## # ... with 74 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mtcars\_results,}
       \AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .pred, }\AttributeTok{y =}\NormalTok{ body\_mass\_g)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}\#006EA1\textquotesingle{}}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.25}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{color =} \StringTok{\textquotesingle{}orange\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{\textquotesingle{}Linear Regression Results\textquotesingle{}}\NormalTok{,}
       \AttributeTok{x =} \StringTok{\textquotesingle{}Predicted mpg\textquotesingle{}}\NormalTok{,}
       \AttributeTok{y =} \StringTok{\textquotesingle{}Actual mpg\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-553-1.pdf}

\hypertarget{classification-in-the-tidy-model-framework}{%
\section{Classification in the tidy model framework}\label{classification-in-the-tidy-model-framework}}

Try fitting a random forest for classification

Can use the titanic dataset for this - to predict survival

Don't go into details (and give disclaimer), but to give the framework

Make an AUC curve

\hypertarget{titanic-survival}{%
\subsection{Titanic survival}\label{titanic-survival}}

Let's start with the famous Titanic dataset. We need to predict if a passenger survived the sinking of the Titanic (1) or not (0). A dataset is provided for training our models (train.csv). Another dataset is provided (test.csv) for which we do not know the answer. We will predict survival for each passenger, submit our answer to Kaggle and see how well we did compared to other folks. The metric for comparison is the percentage of passengers we correctly predict -- aka as accuracy.

First things first, let's load some packages to get us started.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(titanic)}
\NormalTok{titanic\_clean }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_train }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# we take the titanic dataset}
    \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Cabin) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# select the bits we want}
    \FunctionTok{drop\_na}\NormalTok{() }\CommentTok{\# then remove the NAs}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic }\OtherTok{\textless{}{-}}\NormalTok{ titanic\_clean}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{titanic }\OtherTok{\textless{}{-}}\NormalTok{ titanic }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survived =} \FunctionTok{as\_factor}\NormalTok{(}\FunctionTok{if\_else}\NormalTok{(Survived }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, }\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}   
            \FunctionTok{mutate}\NormalTok{(}\AttributeTok{survived =} \FunctionTok{relevel}\NormalTok{(survived, }\AttributeTok{ref =} \StringTok{"yes"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# first event is survived = yes}
             \FunctionTok{mutate}\NormalTok{(}\AttributeTok{class =} \FunctionTok{case\_when}\NormalTok{(Pclass }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\textasciitilde{}} \StringTok{"first"}\NormalTok{,}
\NormalTok{                             Pclass }\SpecialCharTok{==} \DecValTok{2} \SpecialCharTok{\textasciitilde{}} \StringTok{"second"}\NormalTok{,}
\NormalTok{                             Pclass }\SpecialCharTok{==} \DecValTok{3} \SpecialCharTok{\textasciitilde{}} \StringTok{"third"}\NormalTok{),}
                              \AttributeTok{class =} \FunctionTok{as\_factor}\NormalTok{(class),}
                              \AttributeTok{gender =} \FunctionTok{factor}\NormalTok{(Sex),}
                              \AttributeTok{port =} \FunctionTok{factor}\NormalTok{(Embarked),}
                              \AttributeTok{age =}\NormalTok{ Age,}
                              \AttributeTok{fare =}\NormalTok{ Fare,}
                              \AttributeTok{alone =} \FunctionTok{if\_else}\NormalTok{(SibSp }\SpecialCharTok{+}\NormalTok{ Parch }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\StringTok{"yes"}\NormalTok{, }\StringTok{"no"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
 \FunctionTok{select}\NormalTok{(survived, class, gender, age, alone, port, fare) }
\end{Highlighting}
\end{Shaded}

\hypertarget{fit-workflow-on-titanic-data}{%
\subsection{Fit workflow on titanic data}\label{fit-workflow-on-titanic-data}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{7834}\NormalTok{)}

\CommentTok{\# Create a split object}
\NormalTok{mtcars\_split }\OtherTok{\textless{}{-}} \FunctionTok{initial\_split}\NormalTok{(titanic, }\AttributeTok{prop =} \FloatTok{0.75}\NormalTok{)}

\CommentTok{\# Build training data set}
\NormalTok{mtcars\_training }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_split }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{training}\NormalTok{()}

\CommentTok{\# Build testing data set}
\NormalTok{mtcars\_test }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_split }\SpecialCharTok{\%\textgreater{}\%} 
              \FunctionTok{testing}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_recipe }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(survived }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ mtcars\_training) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_YeoJohnson}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_normalize}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_dummy}\NormalTok{(}\FunctionTok{all\_nominal}\NormalTok{(), }\SpecialCharTok{{-}} \FunctionTok{all\_outcomes}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Let's select a model
\end{itemize}

Her are two possible classification models, you can just use these interchangeably/pick one. Notice with the first there is an extra parameter. It is this step that has the largest difference according to which model you want to use.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_model\_RF }\OtherTok{\textless{}{-}} \FunctionTok{rand\_forest}\NormalTok{(}\AttributeTok{trees =} \DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_engine}\NormalTok{(}\StringTok{"ranger"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_mode}\NormalTok{(}\StringTok{"classification"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_model\_GLM }\OtherTok{\textless{}{-}} \FunctionTok{logistic\_reg}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_engine}\NormalTok{(}\StringTok{"glm"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_mode}\NormalTok{(}\StringTok{"classification"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_model\_SVM }\OtherTok{\textless{}{-}} \FunctionTok{svm\_rbf}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_mode}\NormalTok{(}\StringTok{"classification"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_engine}\NormalTok{(}\StringTok{"kernlab"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Beware that I just give the models without going into the details - they are just to show how you can classfy data with tidymodels. I suggest looking into glm and random forest a little more on your own before using it with your own data (but I don't expect you to know details for this course).

Let's run with both models, we can compare them later:

\begin{itemize}
\tightlist
\item
  Make a workflow
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_workflow\_RF }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_model}\NormalTok{(my\_model\_RF) }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_recipe}\NormalTok{(mtcars\_recipe)}

\NormalTok{mtcars\_workflow\_GLM }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_model}\NormalTok{(my\_model\_GLM) }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_recipe}\NormalTok{(mtcars\_recipe)}

\NormalTok{mtcars\_workflow\_SVM }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_model}\NormalTok{(my\_model\_SVM) }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_recipe}\NormalTok{(mtcars\_recipe)}
\end{Highlighting}
\end{Shaded}

Run

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit\_RF }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_workflow\_RF }\SpecialCharTok{\%\textgreater{}\%} 
             \FunctionTok{last\_fit}\NormalTok{(}\AttributeTok{split =}\NormalTok{ mtcars\_split)}

\NormalTok{mtcars\_fit\_GLM }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_workflow\_GLM }\SpecialCharTok{\%\textgreater{}\%} 
             \FunctionTok{last\_fit}\NormalTok{(}\AttributeTok{split =}\NormalTok{ mtcars\_split)}

\NormalTok{mtcars\_fit\_SVM }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_workflow\_SVM }\SpecialCharTok{\%\textgreater{}\%} 
             \FunctionTok{last\_fit}\NormalTok{(}\AttributeTok{split =}\NormalTok{ mtcars\_split)}
\end{Highlighting}
\end{Shaded}

\hypertarget{how-good-is-the-fit}{%
\section{How good is the fit?}\label{how-good-is-the-fit}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit\_RF }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{collect\_metrics}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   <chr>    <chr>          <dbl> <chr>               
## 1 accuracy binary         0.799 Preprocessor1_Model1
## 2 roc_auc  binary         0.857 Preprocessor1_Model1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit\_GLM }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{collect\_metrics}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   <chr>    <chr>          <dbl> <chr>               
## 1 accuracy binary         0.760 Preprocessor1_Model1
## 2 roc_auc  binary         0.857 Preprocessor1_Model1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit\_SVM }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{collect\_metrics}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   <chr>    <chr>          <dbl> <chr>               
## 1 accuracy binary         0.782 Preprocessor1_Model1
## 2 roc_auc  binary         0.825 Preprocessor1_Model1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Obtain test set predictions data frame}
\NormalTok{mtcars\_results }\OtherTok{\textless{}{-}}\NormalTok{ mtcars\_fit\_RF }\SpecialCharTok{\%\textgreater{}\%} 
                 \FunctionTok{collect\_predictions}\NormalTok{()}
\CommentTok{\# View results}
\NormalTok{mtcars\_results}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 179 x 7
##    id               .pred_yes .pred_no  .row .pred_class survived .config       
##    <chr>                <dbl>    <dbl> <int> <fct>       <fct>    <chr>         
##  1 train/test split    0.700    0.300     11 yes         yes      Preprocessor1~
##  2 train/test split    0.0756   0.924     19 no          yes      Preprocessor1~
##  3 train/test split    0.253    0.747     23 no          yes      Preprocessor1~
##  4 train/test split    0.510    0.490     24 yes         no       Preprocessor1~
##  5 train/test split    0.485    0.515     25 no          no       Preprocessor1~
##  6 train/test split    0.613    0.387     27 yes         no       Preprocessor1~
##  7 train/test split    0.134    0.866     29 no          no       Preprocessor1~
##  8 train/test split    0.124    0.876     38 no          no       Preprocessor1~
##  9 train/test split    0.936    0.0638    40 yes         yes      Preprocessor1~
## 10 train/test split    0.848    0.152     42 yes         yes      Preprocessor1~
## # ... with 169 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dagaa.roc }\OtherTok{=}\NormalTok{ mtcars\_results }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  yardstick}\SpecialCharTok{::}\FunctionTok{roc\_curve}\NormalTok{(survived, }
\NormalTok{                        .pred\_yes) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{autoplot}\NormalTok{()}

\NormalTok{dagaa.roc}
\end{Highlighting}
\end{Shaded}

\includegraphics{visualisering_22_files/figure-latex/unnamed-chunk-566-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#dagaa.roc \%\textgreater{}\% ggplot(aes(x=1{-}specificity,y=sensitivity)) + geom\_point() + geom\_abline(slope=1,intercept = 0,lty=2)}
\end{Highlighting}
\end{Shaded}

\hypertarget{cross-validation}{%
\section{Cross validation}\label{cross-validation}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#cross\_val\_tbl \textless{}{-} vfold\_cv(train\_tbl, v = 10)}
\end{Highlighting}
\end{Shaded}

\hypertarget{khan-data-maybe-for-workshop}{%
\subsection{Khan data (maybe for workshop)}\label{khan-data-maybe-for-workshop}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Khan\_train }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(}
  \AttributeTok{y =} \FunctionTok{factor}\NormalTok{(Khan}\SpecialCharTok{$}\NormalTok{ytrain),}
  \FunctionTok{as\_tibble}\NormalTok{(Khan}\SpecialCharTok{$}\NormalTok{xtrain)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Khan\_test }\OtherTok{\textless{}{-}} \FunctionTok{bind\_cols}\NormalTok{(}
  \AttributeTok{y =} \FunctionTok{factor}\NormalTok{(Khan}\SpecialCharTok{$}\NormalTok{ytest),}
  \FunctionTok{as\_tibble}\NormalTok{(Khan}\SpecialCharTok{$}\NormalTok{xtest)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_recipe }\OtherTok{\textless{}{-}} \FunctionTok{recipe}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ Khan\_train) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_YeoJohnson}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_normalize}\NormalTok{(}\FunctionTok{all\_numeric}\NormalTok{(), }\SpecialCharTok{{-}}\FunctionTok{all\_outcomes}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
                \FunctionTok{step\_dummy}\NormalTok{(}\FunctionTok{all\_nominal}\NormalTok{(), }\SpecialCharTok{{-}} \FunctionTok{all\_outcomes}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_ranger }\OtherTok{\textless{}{-}} \FunctionTok{rand\_forest}\NormalTok{(}\AttributeTok{trees =} \DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_engine}\NormalTok{(}\StringTok{"ranger"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{set\_mode}\NormalTok{(}\StringTok{"classification"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_workflow }\OtherTok{\textless{}{-}} \FunctionTok{workflow}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_model}\NormalTok{(iris\_ranger) }\SpecialCharTok{\%\textgreater{}\%} 
                  \FunctionTok{add\_recipe}\NormalTok{(mtcars\_recipe)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit }\OtherTok{\textless{}{-}}\NormalTok{ iris\_ranger }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{fit}\NormalTok{(y }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data=}\NormalTok{Khan\_train)}

\NormalTok{mtcars\_fit }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{augment}\NormalTok{(Khan\_test) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{conf\_mat}\NormalTok{(}\AttributeTok{truth =}\NormalTok{ y, }\AttributeTok{estimate =}\NormalTok{ .pred\_class)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Truth
## Prediction 1 2 3 4
##          1 3 0 0 0
##          2 0 6 0 0
##          3 0 0 5 0
##          4 0 0 1 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_fit }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{augment}\NormalTok{(Khan\_train) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{conf\_mat}\NormalTok{(}\AttributeTok{truth =}\NormalTok{ y, }\AttributeTok{estimate =}\NormalTok{ .pred\_class)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           Truth
## Prediction  1  2  3  4
##          1  8  0  0  0
##          2  0 23  0  0
##          3  0  0 12  0
##          4  0  0  0 20
\end{verbatim}

\hypertarget{presuxe6ntering-af-datasuxe6t-over-for-andre}{%
\chapter{Presæntering af datasæt over for andre}\label{presuxe6ntering-af-datasuxe6t-over-for-andre}}

\includegraphics[width=0.35\linewidth]{plots/shiny_logo}

\hypertarget{introduktion-til-chapter-og-luxe6ringsmuxe5lene}{%
\section{Introduktion til chapter og læringsmålene}\label{introduktion-til-chapter-og-luxe6ringsmuxe5lene}}

I dette chapter beskæftiger vi os med at lave interaktiv visualisering, som vi måske kan vise overfor ændre, fk. som en del af en presæntation. Til sidste vil der være general råd til at lave plots fk. i en powerpoint præsentation.

\hypertarget{luxe6ringsmuxe5lene-8}{%
\subsection{Læringsmålene}\label{luxe6ringsmuxe5lene-8}}

\begin{itemize}
\tightlist
\item
  Interactiv plotter med pakken \texttt{plot\_ly}.
\item
  R pakken \texttt{Shiny} - lave en simpel app og gør den interactiv
\item
  Bygger op på appen - tilføj forskellige inputs, plot typer og panels.
\item
  Generelle råd om presentering af data gennem visualiseringer
\end{itemize}

Husk evaluering!

\hypertarget{video-ressourcer-8}{%
\section{Video ressourcer}\label{video-ressourcer-8}}

\begin{itemize}
\tightlist
\item
  Video 1 - Introduktion til Shiny
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/559363250}

\begin{itemize}
\tightlist
\item
  Video 2 - Introduktion til Shiny - interaktiv plots
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/559558820}

\begin{itemize}
\tightlist
\item
  Video 3 - Introduktion til Shiny - ui layout
\end{itemize}

Link her hvis det ikke virker nedenunder: \url{https://player.vimeo.com/video/559562153}

\hypertarget{interactiv-plots}{%
\section{Interactiv plots}\label{interactiv-plots}}

Der er en nyttig pakke som hedder \texttt{plot\_ly} som man kan anvende til at lave interactiv plotte. Kig for eksempel på følgende plot og afprøve de forskellige interaktiv muligheder.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(plotly)}
\FunctionTok{data}\NormalTok{(diamonds)}
\FunctionTok{plot\_ly}\NormalTok{(diamonds, }
        \AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{cut)}
\end{Highlighting}
\end{Shaded}

Her er et scatter plot lavet med \texttt{plot\_ly}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_sample}\NormalTok{(}\AttributeTok{n =} \DecValTok{1000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{plot\_ly}\NormalTok{(}\AttributeTok{x =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ carat, }
          \AttributeTok{y =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ price) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add\_markers}\NormalTok{(}\AttributeTok{color =} \SpecialCharTok{\textasciitilde{}}\NormalTok{ color)}
\end{Highlighting}
\end{Shaded}

Bemærk at vi har specificeret \texttt{slice\_sample} her, som vælger 1000 tilfældige rækker fra de data. Det er fordi \texttt{diamonds} er en meget stor datasæt og hvis man forsøger at plotte alle observeationer på en gang med \texttt{plot\_ly} kan det være at den crasher eller kører for langsom.

Der er faktisk en nyttig funktion indenfor \texttt{plot\_ly} som hedder \texttt{ggplotly}- man kan tage et plot som var lavet i \texttt{ggplot2} og så anvende \texttt{ggplotly} til at gøre den interaktiv. Her er samme plot:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{my\_plot }\OtherTok{\textless{}{-}}\NormalTok{ diamonds }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{slice\_sample}\NormalTok{(}\AttributeTok{n =} \DecValTok{1000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{carat,}\AttributeTok{y=}\NormalTok{price,}\AttributeTok{colour=}\NormalTok{color)) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{theme\_minimal}\NormalTok{()}

\FunctionTok{ggplotly}\NormalTok{(my\_plot)}
\end{Highlighting}
\end{Shaded}

\hypertarget{shiny}{%
\section{Shiny}\label{shiny}}

Man kan anvende Shiny til at lave en interaktiv program. Det er nemt at få din første app op at køre, så vi lave en simple app hvor vi lave et plot af noget af de data som vi har arbejdet med de sidste uger.

\hypertarget{eksempeler-som-viser-shiny}{%
\subsection{Eksempeler som viser Shiny}\label{eksempeler-som-viser-shiny}}

Indenfor pakken \texttt{shiny} er der nogle eksempler som viser nogle forskellige Shiny apps. Prøve at køre nogle af følgende kode linjer.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"01\_hello"}\NormalTok{)      }\CommentTok{\# a histogram}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"02\_text"}\NormalTok{)       }\CommentTok{\# tables and data frames}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"03\_reactivity"}\NormalTok{) }\CommentTok{\# a reactive expression}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"04\_mpg"}\NormalTok{)        }\CommentTok{\# global variables}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"05\_sliders"}\NormalTok{)    }\CommentTok{\# slider bars}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"06\_tabsets"}\NormalTok{)    }\CommentTok{\# tabbed panels}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"07\_widgets"}\NormalTok{)    }\CommentTok{\# help text and submit buttons}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"08\_html"}\NormalTok{)       }\CommentTok{\# Shiny app built from HTML}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"09\_upload"}\NormalTok{)     }\CommentTok{\# file upload wizard}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"10\_download"}\NormalTok{)   }\CommentTok{\# file download wizard}
\FunctionTok{runExample}\NormalTok{(}\StringTok{"11\_timer"}\NormalTok{)      }\CommentTok{\# an automated timer}
\end{Highlighting}
\end{Shaded}

I eksempel 1 er der en histogram som viser nogle waiting times, med en slider hvor man kan specificere antallet af bins i det histogram. Man kan således ændre nogle parametre, og så plottet bliver ændret automatiske. Eksempel 2 har en table hvor man kan specificere hvor mange række man gerne vil have, og så kan man også vælger imellem forskellige datasæt.

Disse eksempeler har fordelen af, at man bare kan kopiere koden og så lave egen app og ændre den efter sin egne data.

\hypertarget{create-new-app}{%
\subsection{Create new app}\label{create-new-app}}

\includegraphics[width=0.4\linewidth]{plots/shiny_new}

\begin{itemize}
\tightlist
\item
  Man vælger en mappe, og ``Single File''. Indenfor mappen skal ligge en skript der hedder ``app.R'' (det er vigtigt at man ikke ændre navnet af ``app.R'').
\end{itemize}

\includegraphics[width=0.65\linewidth]{plots/shiny_directory}

\begin{itemize}
\tightlist
\item
  Man kan trykke på ``Run App'' indenfor R Studio for at få den at køre
\end{itemize}

\includegraphics[width=0.65\linewidth]{plots/shiny_run}

\hypertarget{struktur-af-en-shiny-app}{%
\subsection{Struktur af en Shiny App}\label{struktur-af-en-shiny-app}}

Her er den grundlæggende struktur af en Shiny app:

\includegraphics[width=0.55\linewidth]{plots/shiny_structure}

Indenfor ``app.R'' er der tre komponenter som kan skal være opmærksom på. Vi ændrer kun to af de tre komponenter.

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Dele & Beskrivelse \\
\midrule
\endhead
\texttt{ui\ \textless{}-\ fluidPage()} & ``user interface'' object: det fortæller \textbf{Shiny} hvordan appen ser ud. \\
\texttt{server\ \textless{}-\ function(input,output)\{\}} & her skrives R kode, fk til et plot, som skal være en del af den R objekt som hedder \texttt{output}. \texttt{input} er for eksempel antallet af bins som man specificerer med en slider som i det histogram eksempel. \\
\texttt{shinyApp(ui\ =\ ui,\ server\ =\ server)} & er altid den sidste linje - den ændre vi ikke. Den få appen til at køre. \\
\bottomrule
\end{longtable}

\hypertarget{minimal-example-men-ikke-interaktiv}{%
\subsection{Minimal example (men ikke interaktiv)}\label{minimal-example-men-ikke-interaktiv}}

Jeg starter med at lave et meget simpelt ``minimal'' eksempel af hvordan man kan lave et program med \textbf{Shiny}:

\begin{itemize}
\tightlist
\item
  \textbf{ui komponent}: Vi vil gerne viser et plot som hedder ``my\_plot'' - så skriver jeg \texttt{plotOutput("my\_plot")}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{) }\CommentTok{\#fortælle, at vi vil fremvise "my\_plot".}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{\texttt{server} komponent}: angiver vi koden til \texttt{my\_plot}.

  \begin{itemize}
  \tightlist
  \item
    Plottet skal være en del af vores \texttt{output}, så vi skriver \texttt{output\$my\_plot\ \textless{}-}.
  \item
    \texttt{renderPlot(\{\ \#plot\ kode\ \})} fortæl den at det vi lave er et plot og vi skriver koden indenfor.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
    \CommentTok{\#definere "my\_plot"}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        \CommentTok{\#Skriv plot kode her}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Her er appen med ovenstående kode sæt ind: man godt kan køre den men når vi ikke har nogle data eller plot kode er den meget kedelig.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{) }\CommentTok{\#fortælle, at vi vil fremvise "my\_plot".}
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
    \CommentTok{\#definere "my\_plot"}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        \CommentTok{\#Skriv plot kode her}
\NormalTok{  \})}
\NormalTok{\}}
\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

\textbf{Tilføje dataseættet \texttt{iris} og lave et plot}

Lad os tilføje nogle data til vores plot i formen af \texttt{iris}, og skriv nogle kode til et scatter plot:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{data}\NormalTok{(iris)}

\CommentTok{\#ui: output plottet \textquotesingle{}my\_plot\textquotesingle{}}
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{)}
\NormalTok{)}

\CommentTok{\#server: lav plot og kalde den for output$my\_plot}
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{        iris }\SpecialCharTok{\%\textgreater{}\%}
            \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
            \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
            \FunctionTok{theme\_classic}\NormalTok{()}
\NormalTok{  \})}
\NormalTok{\}}

\CommentTok{\# køre appen}
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

Hvis vi køre koden kan man se at vi har et plot frem. Appen er dog ikke interaktiv.

\includegraphics[width=0.75\linewidth]{plots/shiny_01}

\hypertarget{minimal-example---interactiv.}{%
\subsection{Minimal example - interactiv.}\label{minimal-example---interactiv.}}

Vi vil gerne gøre vores app mere fleksibelt - lad os gøre det interaktiv ved at plotte et subset af Iris for en af de tre species, som vælges fra en ``drop-down'' box - vi kan anvende en funktion som hedder \texttt{selectInput}:

\includegraphics[width=0.4\linewidth]{plots/selectInput}

Her er koden for vores \texttt{selectInput}, som skal tilføjes indenfor \texttt{fluidPage}.

\begin{Shaded}
\begin{Highlighting}[]
    \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{, }\CommentTok{\#giv en id}
                \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species), }\CommentTok{\#setosa, virginica eller versicola}
                \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{, }\CommentTok{\#default species}
                \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{) }\CommentTok{\#label på plottet}
\end{Highlighting}
\end{Shaded}

Vi skal også ændre koden på plottet så at det reagerer på vores \texttt{selectInput}:

\begin{itemize}
\tightlist
\item
  Vi laver en subset \texttt{iris\_subset} af de data efter ``Species'' vi valgt i vores ``drop-down box'' ved at angiv \texttt{Species==input\$Species} indenfor funktionen \texttt{filter}.
\item
  Vi laver et scatter plot med \texttt{iris\_subset}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
        
\NormalTok{        iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
            \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
            \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
            \FunctionTok{theme\_classic}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Her tilføjer jeg de kode chunks fra ovenpå til vores program:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
    \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{,}
                \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species),}
                \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{,}
                \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{),}
    
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{)}
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        
\NormalTok{        iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
        
\NormalTok{        iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
            \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
            \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
            \FunctionTok{theme\_classic}\NormalTok{()}
        
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

Som man kan se i screenshot nedenunder, har vi en ``drop-down box'' hvor vi kan vælge imellem de tre \texttt{Species}.

\includegraphics[width=0.75\linewidth]{plots/shiny_02}

\hypertarget{flere-plots-puxe5-samme-shiny-app}{%
\subsection{Flere plots på samme Shiny app}\label{flere-plots-puxe5-samme-shiny-app}}

\begin{itemize}
\tightlist
\item
  Vi laver to plotter, et scatter plot og et histogram, som reagere på \texttt{selectInput} som fortæller de subset af de data efter \texttt{Species} som skal plottes.
\item
  Vi kalder dem for \texttt{p1} og \texttt{p2} og plotte dem ved siden af hinanden med \texttt{grid.arrange}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
    \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{,}
                \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species),}
                \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{,}
                \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{),}
    
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{)}
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        
\NormalTok{        iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
        
\NormalTok{     p1 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
            \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
            \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{colour=}\StringTok{"steel blue"}\NormalTok{) }\SpecialCharTok{+} 
            \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
            \FunctionTok{theme\_classic}\NormalTok{()}
        
\NormalTok{        p2 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
            \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+} 
            \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{colour=}\StringTok{"firebrick3"}\NormalTok{) }\SpecialCharTok{+} 
            \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
            \FunctionTok{theme\_classic}\NormalTok{()}
        
        \FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
        
\NormalTok{    \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.75\linewidth]{plots/shiny_two}

\hypertarget{involvere-en-table}{%
\subsection{Involvere en table}\label{involvere-en-table}}

Vi vil gerne tilføj en table så vi kan se vores data i appen. Jeg vil gerne specificere hvor mange rækker jeg skal vise frem i appen - vi kan gøre den interaktiv ved at giv en \texttt{numericInput} funktion:

\includegraphics[width=0.4\linewidth]{plots/numericInput}

Her er koden for vores \texttt{numericInput}. Bemærk, at man skriver \texttt{tableOutput("my\_table")} for at fortælle at vi vil viser ``my\_table'' i appen.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{numericInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"num\_rows"}\NormalTok{,                           }\CommentTok{\#giv id num\_rows}
                 \AttributeTok{label =} \StringTok{"Number of observations to view:"}\NormalTok{,  }\CommentTok{\#label på selve plottet}
                 \AttributeTok{value =} \DecValTok{5}\NormalTok{),                                 }\CommentTok{\#default værdi}

\FunctionTok{tableOutput}\NormalTok{(}\StringTok{"my\_table"}\NormalTok{)                                      }\CommentTok{\#fortæl, at vi vil output "my\_table"}
\end{Highlighting}
\end{Shaded}

Her er koden for \texttt{my\_table}. Bemærk at vi anvender funktion \texttt{renderTable} i stedet for \texttt{renderPlot}, og der er en indstilling indenfor \texttt{head} hvor vi kan specificere hvor mange række vi skal have (med \texttt{n\ =\ input\$num\_rows} - altså tallet som vi skriver i appen).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{my\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{        iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
            \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
        \FunctionTok{head}\NormalTok{(iris\_subset, }\AttributeTok{n =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{num\_rows)}
\NormalTok{    \})}
\end{Highlighting}
\end{Shaded}

Jeg tilføjer de to kode chunks til vores app i følgende (som kan kopireres og blive kørte):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
  \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{,}
              \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species),}
              \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{,}
              \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{),}
  
  \FunctionTok{numericInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"num\_rows"}\NormalTok{,}
               \AttributeTok{label =} \StringTok{"Number of observations to view:"}\NormalTok{,}
               \AttributeTok{value =} \DecValTok{5}\NormalTok{),}
  
  \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{),}
  \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"my\_table"}\NormalTok{)}
  
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    
\NormalTok{    p1 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{colour=}\StringTok{"steel blue"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
\NormalTok{    p2 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{colour=}\StringTok{"firebrick3"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
    \FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
    
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    \FunctionTok{head}\NormalTok{(iris\_subset, }\AttributeTok{n =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{num\_rows)}
\NormalTok{  \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.75\linewidth]{plots/shiny_two_table}

\hypertarget{add-a-slider}{%
\subsection{Add a slider}\label{add-a-slider}}

\begin{itemize}
\tightlist
\item
  Lad os tilføj en \texttt{sliderInput} for at styr punkt eller linje størrelse i plottet. Den ser sådan ud:
\end{itemize}

\includegraphics[width=0.4\linewidth]{plots/sliderInput}

\begin{itemize}
\tightlist
\item
  Vores kode ser sådan ud. Vi lave en slider af integer fra 1 til 10.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
    \FunctionTok{sliderInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Point"}\NormalTok{,    }\CommentTok{\#giv den id Point}
                \AttributeTok{label =} \StringTok{"Point size"}\NormalTok{, }\CommentTok{\#label på selve plottet}
                \AttributeTok{min =} \DecValTok{1}\NormalTok{,              }\CommentTok{\#min værdi}
                \AttributeTok{max =} \DecValTok{10}\NormalTok{,             }\CommentTok{\#max værdi}
                \AttributeTok{step =} \DecValTok{1}\NormalTok{,             }\CommentTok{\#step size}
                \AttributeTok{value =} \DecValTok{1}\NormalTok{),           }\CommentTok{\#default værdi}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Vi referer vores point størrelse ind i plottet med \texttt{input\$Point}:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{         ....}\SpecialCharTok{+}   \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{Point, }\AttributeTok{colour=}\StringTok{"steel blue"}\NormalTok{) }\SpecialCharTok{+}\NormalTok{ ....}
\NormalTok{         ....}\SpecialCharTok{+}   \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{colour=}\StringTok{"firebrick3"}\NormalTok{,}\AttributeTok{lwd=}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Point) }\SpecialCharTok{+}\NormalTok{ ......}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Vi tilføj ovenstående kode til vores plot:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
  \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{,}
              \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species),}
              \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{,}
              \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{),}
  
  \FunctionTok{numericInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"num\_rows"}\NormalTok{,}
               \AttributeTok{label =} \StringTok{"Number of observations to view:"}\NormalTok{,}
               \AttributeTok{value =} \DecValTok{5}\NormalTok{),}
  
  \FunctionTok{sliderInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Point"}\NormalTok{,}
              \AttributeTok{label =} \StringTok{"Point size"}\NormalTok{,}
              \AttributeTok{min =} \DecValTok{1}\NormalTok{,}
              \AttributeTok{max =} \DecValTok{10}\NormalTok{,}
              \AttributeTok{step =} \DecValTok{1}\NormalTok{,}
              \AttributeTok{value =} \DecValTok{1}\NormalTok{),}
  
  \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{),}
  \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"my\_table"}\NormalTok{)}
  
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    
\NormalTok{    p1 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{Point, }\AttributeTok{colour=}\StringTok{"steel blue"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
\NormalTok{    p2 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{size =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{Point,}\AttributeTok{colour=}\StringTok{"firebrick3"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
    \FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
    
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    \FunctionTok{head}\NormalTok{(iris\_subset, }\AttributeTok{n =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{num\_rows)}
\NormalTok{  \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

\includegraphics[width=0.75\linewidth]{plots/shiny_slider2}

\hypertarget{ekstras-som-man-kan-tilfuxf8je-til-ui}{%
\subsection{\texorpdfstring{Ekstras som man kan tilføje til \texttt{ui}}{Ekstras som man kan tilføje til ui}}\label{ekstras-som-man-kan-tilfuxf8je-til-ui}}

Her er nogle ekstra tekst som vi kan tilføj - for eksempel en title. Vi kan også lave nogle forskellige panels for at fremvise de forskellige dele af vores app - for eksempel en side panel og en main panel.

\textbf{Title}

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Shiny Text"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Specificier sidebarLayout}

\begin{Shaded}
\begin{Highlighting}[]
  \FunctionTok{sidebarLayout}\NormalTok{(}
    \FunctionTok{sidebarPanel}\NormalTok{(),}
    \FunctionTok{mainPanel}\NormalTok{()}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Her er hvordan appen ser ud med titlen samt en \texttt{sidebarPanel} og \texttt{mainPanel}

\includegraphics[width=0.75\linewidth]{plots/shiny_panel3}

Her er fuld kode som man kan copy/paste ind i \texttt{app.R}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(gridExtra)}
\FunctionTok{data}\NormalTok{(iris)}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}

  \FunctionTok{titlePanel}\NormalTok{(}\StringTok{"My Iris app!"}\NormalTok{),}
  
  \FunctionTok{sidebarPanel}\NormalTok{(}
    \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Species"}\NormalTok{,}
                \AttributeTok{choices =}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(Species),}
                \AttributeTok{selected =} \StringTok{"setosa"}\NormalTok{,}
                \AttributeTok{label =} \StringTok{"Choose species"}\NormalTok{),}
    
    \FunctionTok{numericInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"num\_rows"}\NormalTok{,}
                 \AttributeTok{label =} \StringTok{"Number of observations to view:"}\NormalTok{,}
                 \AttributeTok{value =} \DecValTok{5}\NormalTok{),}
    
    \FunctionTok{sliderInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"Point"}\NormalTok{,}
                \AttributeTok{label =} \StringTok{"Point size"}\NormalTok{,}
                \AttributeTok{min =} \DecValTok{1}\NormalTok{,}
                \AttributeTok{max =} \DecValTok{10}\NormalTok{,}
                \AttributeTok{step =} \DecValTok{1}\NormalTok{,}
                \AttributeTok{value =} \DecValTok{1}\NormalTok{)}
\NormalTok{  ),}
  \FunctionTok{mainPanel}\NormalTok{(}
    \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"my\_plot"}\NormalTok{),}
    \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"my\_table"}\NormalTok{)}
\NormalTok{  )}
\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    
\NormalTok{    p1 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width,}\AttributeTok{y=}\NormalTok{Petal.Length)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{Point, }\AttributeTok{colour=}\StringTok{"steel blue"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
\NormalTok{    p2 }\OtherTok{\textless{}{-}}\NormalTok{ iris\_subset }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Sepal.Width)) }\SpecialCharTok{+} 
      \FunctionTok{geom\_density}\NormalTok{(}\AttributeTok{size =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{Point,}\AttributeTok{colour=}\StringTok{"firebrick3"}\NormalTok{) }\SpecialCharTok{+} 
      \FunctionTok{ggtitle}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{Species) }\SpecialCharTok{+}
      \FunctionTok{theme\_classic}\NormalTok{()}
    
    \FunctionTok{grid.arrange}\NormalTok{(p1,p2,}\AttributeTok{ncol=}\DecValTok{2}\NormalTok{)}
    
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{my\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{    iris\_subset }\OtherTok{\textless{}{-}}\NormalTok{ iris }\SpecialCharTok{\%\textgreater{}\%} 
      \FunctionTok{filter}\NormalTok{(Species}\SpecialCharTok{==}\NormalTok{input}\SpecialCharTok{$}\NormalTok{Species)}
    \FunctionTok{head}\NormalTok{(iris\_subset, }\AttributeTok{n =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{num\_rows)}
\NormalTok{  \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ekstra-generelle-ruxe5d}{%
\section{Ekstra generelle råd}\label{ekstra-generelle-ruxe5d}}

\begin{itemize}
\tightlist
\item
  Tilføje hensigtsmæssige title/akse labels etc. og gøre dem til en størrelse som er nem at læse (tænk i PowerPoint - personer bagest i rummet skal kunne læse teksten).
\item
  Fjerne unødvendige legends.
\item
  Anvende colour palettes som er designet til at fungere godt for de fleste (for eksempel undgå grøn og rød ved siden af hinanden).
\item
  Viser kun hvad er nødvendige for at fortælle den historie, du gerne vil videregive til andre. For eksempel undgår ekstra tekst som ikke tilføjer noget til beskeden.
\item
  En historie på en slide hvis man laver en PowerPoint præsentation.
\item
  Andvende hensigtsmæssige akse transformeringer som giver mest mening til de data
\item
  Undgå piecharts, 3D plots osv. medmindre de absolut tilføj noget ekstra til visualisering (meget sjældent).
\item
  Hvis man tilføjer et plot til en PowerPoint, anbefaler jeg at bruge PDFs og ikke PNG/JPG, når en PDF har en højere kvalitet.
\item
  Interaktiv plots kan være sjovt og interessant (men igen sikre at de tilføj nogle ekstra til din præsentation/rapport).
\end{itemize}

\hypertarget{andre-mulighederadvanceret-topics}{%
\section{Andre muligheder/advanceret topics}\label{andre-mulighederadvanceret-topics}}

\begin{itemize}
\item
  Lave præsentations i PowerPoint direkte fra RStudio: \url{https://support.rstudio.com/hc/en-us/articles/360004672913-Rendering-PowerPoint-Presentations-with-RStudio}
\item
  Shiny cheatsheet: \url{https://github.com/rstudio/cheatsheets/raw/master/shiny.pdf}
\item
  Debugging with RStudio: \url{https://support.rstudio.com/hc/en-us/articles/200713843-Debugging-with-RStudio}
\item
  Advanced R: \url{https://adv-r.hadley.nz/index.html}
\end{itemize}

\hypertarget{problemstillinger-10}{%
\section{Problemstillinger}\label{problemstillinger-10}}

\textbf{0}) Lav survey

\textbf{1}) Lav interactiv plots

Anvend funktionen \texttt{ggplotly} fra pakken \texttt{plotly} til at lave nogle interkative plots:

\begin{itemize}
\tightlist
\item
  Et barplot som viser antallet af biler for de forskellige antal cylinders i variablen \texttt{cyl} i datasættet \texttt{mtcars}.
\item
  Et scatter plot som viser \texttt{wt} på x-aksen og \texttt{qsec} på y-aksen og med farver efter variablen \texttt{gear}.

  \begin{itemize}
  \tightlist
  \item
    tilføj lineær trend linjer til plottet.
  \end{itemize}
\end{itemize}

\textbf{2}) \emph{Shiny}

\begin{itemize}
\tightlist
\item
  Inlæs pakken og se på de forskellige eksempler fk. \texttt{runExample("05\_sliders")}.
\item
  Lav et nyt app, køre den default app.
\end{itemize}

\textbf{3}) \emph{Shiny}

\begin{itemize}
\tightlist
\item
  Slet default tekst og kopi koden fra ovenpå (med slider og to plotte) - køre appen.
\item
  Tilpas koden til at andre de datasæt fra \texttt{Iris} til \texttt{Penguins}.
\end{itemize}

\textbf{4}) \emph{Shiny}

\begin{itemize}
\tightlist
\item
  Lav et app som viser den første n række af datarammen \texttt{mtcars} (\texttt{numericInput})
\item
  Tilføj også en drop-down box med funktion \texttt{selectInput} for at vise en subset af datarammen efter de forskellige mulige værdier i variablen \texttt{gear}.
\end{itemize}

\textbf{5}) \emph{Shiny}

\begin{itemize}
\tightlist
\item
  Lav et app med en \texttt{sliderInput} som styr antallet af clusters med funktionen \texttt{kmeans} i datasættet \texttt{penguins}.
\item
  Vis clusters som forskellige farver indenfor et scatter plot (det kan være fk. to variabler eller den første to principal components).
\item
  Tilføj også en \texttt{selectInput} for at visualisere dine clusterings i de data subset efter variablen \texttt{island}.
\item
  Anvend \texttt{sidebarPanel} og \texttt{mainPanel} til at separere de inputs fra de plots.
\item
  Tilføj en app title samt plot title/akse labels osv. for at bedste viser din app over for andre.
\end{itemize}

  \bibliography{book.bib,packages.bib}

\end{document}
